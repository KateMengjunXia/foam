function FEATURE_ENABLED(labels){for(var i=0;i<labels.length;i++)if(FLAGS[labels[i]])return!0}function MODEL(model){function defineProperty(proto,key,map){map.value&&proto!==Object.prototype&&proto!==Array.prototype?proto[key]=map.value:Object.defineProperty.apply(this,arguments)}var proto;if(model.name?(GLOBAL[model.name]||(model["extends"]?GLOBAL[model.name]={__proto__:GLOBAL[model["extends"]]}:GLOBAL[model.name]={}),proto=GLOBAL[model.name]):proto=model.extendsProto?GLOBAL[model.extendsProto].prototype:GLOBAL[model.extendsObject],model.properties)for(var i=0;i<model.properties.length;i++){var p=model.properties[i];defineProperty(proto,p.name,{get:p.getter,enumerable:!1})}for(key in model.constants)defineProperty(proto,key,{value:model.constants[key],writable:!0,enumerable:!1});if(Array.isArray(model.methods))for(var i=0;i<model.methods.length;i++){var m=model.methods[i];defineProperty(proto,m.name,{value:m,writable:!0,enumerable:!1})}else for(var key in model.methods)defineProperty(proto,key,{value:model.methods[key],writable:!0,enumerable:!1})}function prep(arg){return"string"==typeof arg?literal(arg):arg}function prepArgs(args){for(var i=0;i<args.length;i++)args[i]=prep(args[i]);return args}function range(c1,c2){var f=function(ps){return ps.head?ps.head<c1||ps.head>c2?void 0:ps.tail.setValue(ps.head):void 0};return f.toString=function(){return"range("+c1+", "+c2+")"},f}function literal_ic(str,opt_value){str=str.toLowerCase();var f=function(ps){for(var i=0;i<str.length;i++,ps=ps.tail)if(!ps.head||str.charAt(i)!==ps.head.toLowerCase())return void 0;return ps.setValue(opt_value||str)};return f.toString=function(){return'"'+str+'"'},f}function anyChar(ps){return ps.head?ps.tail:void 0}function fail(ps){return void 0}function notChar(c){return function(ps){return ps.head&&ps.head!==c?ps.tail.setValue(ps.head):void 0}}function notChars(s){return function(ps){return ps.head&&-1==s.indexOf(ps.head)?ps.tail.setValue(ps.head):void 0}}function not(p,opt_else){p=prep(p),opt_else=prep(opt_else);var f=function(ps){return this.parse(p,ps)?void 0:opt_else?this.parse(opt_else,ps):ps};return f.toString=function(){return"not("+p+")"},f}function optional(p){p=prep(p);var f=function(ps){return this.parse(p,ps)||ps.setValue(void 0)};return f.toString=function(){return"optional("+p+")"},f}function copyInput(p){p=prep(p);var f=function(ps){var res=this.parse(p,ps);return res?res.setValue(ps.str_.toString().substring(ps.pos,res.pos)):res};return f.toString=function(){return"copyInput("+p+")"},f}function lookahead(p){p=prep(p);var f=function(ps){return this.parse(p,ps)&&ps};return f.toString=function(){return"lookahead("+p+")"},f}function repeat(p,opt_delim,opt_min,opt_max){p=prep(p),opt_delim=prep(opt_delim);var f=function(ps){for(var ret=[],i=0;!opt_max||opt_max>i;i++){var res;if(opt_delim&&0!=ret.length){if(!(res=this.parse(opt_delim,ps)))break;ps=res}if(!(res=this.parse(p,ps)))break;ret.push(res.value),ps=res}return opt_min&&ret.length<opt_min?void 0:ps.setValue(ret)};return f.toString=function(){return"repeat("+p+", "+opt_delim+", "+opt_min+", "+opt_max+")"},f}function plus(p,opt_delim){return repeat(p,opt_delim,1)}function noskip(p){return function(ps){return this.skip_=!1,ps=this.parse(p,ps),this.skip_=!0,ps}}function repeat0(p){p=prep(p);var f=function(ps){for(var res;res=this.parse(p,ps);)ps=res;return ps.setValue("")};return f.toString=function(){return"repeat0("+p+")"},f}function plus0(p){p=prep(p);var f=function(ps){var res;if(!(res=this.parse(p,ps)))return void 0;for(ps=res;res=this.parse(p,ps);)ps=res;return ps.setValue("")};return f.toString=function(){return"repeat0("+p+")"},f}function seq(){var args=prepArgs(arguments),f=function(ps){for(var ret=[],i=0;i<args.length;i++){if(!(ps=this.parse(args[i],ps)))return void 0;ret.push(ps.value)}return ps.setValue(ret)};return f.toString=function(){return"seq("+argsToArray(args).join(",")+")"},f}function seq1(n){var args=prepArgs(argsToArray(arguments).slice(1)),f=function(ps){for(var ret,i=0;i<args.length;i++){if(!(ps=this.parse(args[i],ps)))return void 0;i==n&&(ret=ps.value)}return ps.setValue(ret)};return f.toString=function(){return"seq1("+n+", "+argsToArray(args).join(",")+")"},f}function invalidateParsers(){parserVersion_++}function simpleAlt(){var args=prepArgs(arguments);if(1==args.length)return args[0];var f=function(ps){for(var i=0;i<args.length;i++){var res=this.parse(args[i],ps);if(res)return res}return void 0};return f.toString=function(){return"simpleAlt("+argsToArray(args).join(" | ")+")"},f}function alt(){function nullParser(){return void 0}function testParser(p,ps){var trapPS=TrapPStream.create(ps);return this.parse(p,trapPS),trapPS.goodChar}function getParserForChar(ps){var c=ps.head,p=map[c];if(!p){for(var alts=[],i=0;i<args.length;i++){var parser=args[i];testParser.call(this,parser,ps)&&alts.push(parser)}p=0==alts.length?nullParser:1==alts.length?alts[0]:simpleAlt.apply(null,alts),map[c]=p}return p}var SIMPLE_ALT=simpleAlt.apply(null,arguments),args=prepArgs(arguments),map={},parserVersion=parserVersion_,f=function(ps){parserVersion!==parserVersion_&&(map={},parserVersion=parserVersion_);var r1=this.parse(getParserForChar.call(this,ps),ps);return r1};return f.toString=function(){return"alt("+argsToArray(args).join(" | ")+")"},f}function str(p){p=prep(p);var f=function(ps){var ps=this.parse(p,ps);return ps?ps.setValue(ps.value.join("")):void 0};return f.toString=function(){return"str("+p+")"},f}function pick(as,p){p=prep(p);var f=function(ps){var ps=this.parse(p,ps);if(!ps)return void 0;for(var ret=[],i=0;i<as.length;i++)ret.push(ps.value[as[i]]);return ps.setValue(ret)};return f.toString=function(){return"pick("+as+", "+p+")"},f}function parsedebug(p){return function(ps){var old=DEBUG_PARSE;DEBUG_PARSE=!0;var ret=this.parse(p,ps);return DEBUG_PARSE=old,ret}}function sym(name){var f=function(ps){var p=this[name];return p||console.log("PARSE ERROR: Unknown Symbol <"+name+">"),this.parse(p,ps)};return f.toString=function(){return"<"+name+">"},f}function defineTTLProperty(obj,name,ttl,f){obj.__defineGetter__(name,function(){var accessed,value=void 0;return this.__defineGetter__(name,function(){function scheduleTimer(){var ref=setTimeout(function(){accessed?scheduleTimer():value=void 0,accessed=!1},ttl);ref&&ref.unref&&ref.unref()}return value?accessed=!0:(accessed=!1,value=f(),scheduleTimer()),value}),this[name]})}function lookup(key){if(!key)return void 0;if("string"!=typeof key)return key;var root=this,cache;cache=this.lookupCache_;var ret=cache[key];if(void 0===ret&&-1==key.indexOf(".")&&(ret=GLOBAL[key]),void 0===ret){for(var path=key.split("."),i=0;root&&i<path.length;i++)root=root[path[i]];ret=root,cache[key]=ret?ret:null}return ret}function set(key,value){Object.defineProperty(this,key,{value:value,writable:"window"!==key,configurable:!0}),GLOBAL.SimpleReadOnlyValue&&"$"!==key&&"$$"!==key&&(this[key+"$"]=SimpleReadOnlyValue.create({value:value}))}function setValue(key,value){var X=this;Object.defineProperty(this,key,{get:function(){return value.get()},configurable:!0}),"$"!==key&&"$$"!==key&&(this[key+"$"]=value)}function sub(opt_args,opt_name){var sub=Object.create(this);if(opt_args)for(var key in opt_args)if(opt_args.hasOwnProperty(key)){var asValue="$"!==key&&"$$"!=key&&"$"==key.charAt(key.length-1);asValue?sub.setValue(key.substring(0,key.length-1),opt_args[key]):sub.set(key,opt_args[key])}return opt_name&&(sub.NAME=opt_name),sub}function subWindow(w,opt_name,isBackground){return w?foam.ui.Window.create({window:w,name:opt_name,isBackground:isBackground},this).Y:this.sub()}function elementFromString(str){return str.element||(str.element=HTMLParser.create().parseString(str).children[0])}function $addWindow(w){w.window.$WID=$WID__++,$documents.push(w.document)}function $removeWindow(w){for(var i=$documents.length-1;i>=0;i--)$documents[i].defaultView&&$documents[i].defaultView!==w||$documents.splice(i,1)}function packagePath(X,path){function packagePath_(Y,path,i){return i===path.length?Y:(Y[path[i]]||(Y[path[i]]={},0==i&&(GLOBAL[path[i]]=Y[path[i]])),packagePath_(Y[path[i]],path,i+1))}return path?packagePath_(X,path.split("."),0):GLOBAL}function registerModel(model,opt_name,fastMode){var root=model["package"]?this:GLOBAL,name=model.name,pack=model["package"];if(opt_name){var a=opt_name.split(".");name=a.pop(),pack=a.join(".")}var modelRegName=(pack?pack+".":"")+name;if(root===GLOBAL||root===X){var path=packagePath(root,pack);fastMode?path[name]=model:Object.defineProperty(path,name,{value:model,configurable:!0}),path===GLOBAL&&(path=X,fastMode?path[name]=model:Object.defineProperty(path,name,{value:model,configurable:!0}))}Object.hasOwnProperty.call(this,"lookupCache_")||(this.lookupCache_=Object.create(this.lookupCache_||Object.prototype)),this.lookupCache_[modelRegName]=model,this.onRegisterModel(model)}function INTERFACE(imodel){var i=JSONUtil.mapToObj(X,imodel,Interface);packagePath(X,i["package"])[i.name]=i;var id=i["package"]?i["package"]+"."+i.name:i.name;NONMODEL_INSTANCES[id]=!0}function __DATA(obj){var pkg=obj["package"]?obj["package"]:obj.id.substring(0,obj.id.lastIndexOf(".")),name=obj.name?obj.name:obj.id.substring(obj.id.lastIndexOf(".")+1),path=packagePath(X,pkg),triggered=!1;Object.defineProperty(path,name,{get:function triggerDataLatch(){if(triggered)return null;triggered=!0;var object=JSONUtil.mapToObj(X,obj);return X.registerModel(object),object},configurable:!0})}function onRegisterModel(m){m["package"]||(GLOBAL[m.name]=m)}function defineLocalProperty(cls,name,factory){Object.defineProperty(cls,name,{get:function(){console.assert(this!==cls,"Called property getter from prototype: "+name);var value=factory.call(this);return Object.defineProperty(this,name,{configurable:!0,value:value}),value},configurable:!0})}function override(cls,methodName,method){var super_=cls[methodName];if(-1==method.toString().indexOf("SUPER"))return void(cls[methodName]=method);var SUPER=function(){return super_.apply(this,arguments)},slowF=function(OLD_SUPER,args){try{return method.apply(this,args)}finally{this.SUPER=OLD_SUPER}},f=function(){var OLD_SUPER=this.SUPER;if(this.SUPER=SUPER,OLD_SUPER)return slowF.call(this,OLD_SUPER,arguments);var ret=method.apply(this,arguments);return this.SUPER=null,ret};f.toString=function(){return method.toString()},f.super_=super_,cls[methodName]=f}function recopyModelFeatures(m){GLOBAL[m.name]=X[m.name]=m,m.model_=Model,m.methods=m.methods,m.relationships=m.relationships,m.properties=m.properties,m.models=m.models,DEBUG&&(m.tests=m.tests,m.issues=m.issues),m.properties&&m.properties[0]&&"Model"!==m.properties[0].__proto__.model_.name_&&m.properties.forEach(function(p){"Property"===p.__proto__.model_.name&&(p.__proto__=Property.getPrototype())}),DEBUG&&BootstrapModel.saveDefinition(m)}function or$(values,factory,opt_X){return OrValue.create({values:values,valueFactory:factory},opt_X)}function toNum(p){return p.replace?parseInt(p.replace("px","")):p}function elementForName(nodeName){nodeName=nodeName?nodeName:"div";var modelName=this.__element_map__[nodeName.toUpperCase()];if(modelName){var model=this.lookup(modelName);return console.assert(model,'Missing Model, Add "'+modelName+'" to your requires: block.'),model.create(null,this)}var i=nodeName.indexOf(":");return-1!=i?this.elementForFeature(nodeName.substring(0,i),nodeName.substring(i+1)):null}function elementForFeature(objName,featureName){var data=this[objName||"data"],X=objName?this.sub({data:this[objName]}):this;return data.model_.getFeature(featureName).toE(X)}function registerE(name,model){var m={__proto__:this.__element_map__};return m[name.toUpperCase()]=model,this.set("__element_map__",m),this}function E(opt_nodeName){(this===X||this===window)&&console.log("Deprecated global E() call",new Error);var e=this.elementForName&&this.elementForName(opt_nodeName);return e||(e=this.lookup("foam.u2.Element").create(null,this),opt_nodeName&&(e.nodeName=opt_nodeName)),e}function start(opt_nodeName){return this.E(opt_nodeName)}function compile_(a){return a.f?a:a===!0?TRUE:a===!1?FALSE:ConstantExpr.create({arg1:a})}function compileArray_(args){for(var b=[],i=0;i<args.length;i++){var a=args[i];null!==a&&void 0!==a&&b.push(compile_(a))}return b}function COUNT(){return CountExpr.create()}function EQ(arg1,arg2){var eq=EqExpr.create();return eq.instance_.arg1=compile_(arg1),eq.instance_.arg2=compile_(arg2),eq}function AND(){return AndExpr.create({args:compileArray_.call(null,arguments)})}function NEQ(arg1,arg2){return NeqExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function UPPER(arg1){return UpperExpr.create({arg1:compile_(arg1)})}function EQ_IC(arg1,arg2){return EQ(UPPER(arg1),UPPER(arg2))}function IN_IC(arg1,arg2){return IN(UPPER(arg1),arg2.map(UPPER))}function MAX(expr){return MaxExpr.create({arg1:expr})}function IN(arg1,arg2){return InExpr.create({arg1:compile_(arg1),arg2:arg2})}function LT(arg1,arg2){return LtExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function GT(arg1,arg2){return GtExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function LTE(arg1,arg2){return LteExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function GTE(arg1,arg2){return GteExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function EXPLAIN(arg){return ExplainExpr.create({arg1:arg})}function SUM(expr){return SumExpr.create({arg1:expr})}function MIN(expr){return MinExpr.create({arg1:expr})}function AVG(expr){return AvgExpr.create({arg1:expr})}function SEQ(){return SeqExpr.create({args:argsToArray(arguments)})}function UPDATE(expr,dao){return UpdateExpr.create({args:compileArray_.call(null,Array.prototype.slice.call(arguments,0,-1)),dao:arguments[arguments.length-1]})}function SET(arg1,arg2){return SetExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function GROUP_BY(expr1,opt_expr2){return GroupByExpr.create({arg1:expr1,arg2:opt_expr2||[].sink})}function GRID_BY(xFunc,yFunc,acc){return GridByExpr.create({xFunc:xFunc,yFunc:yFunc,acc:acc})}function MAP(fn,opt_sink){return MapExpr.create({arg1:fn,arg2:opt_sink||[].sink})}function FILTER(fn,sink){return FilterExpr.create({arg1:fn,arg2:sink})}function DISTINCT(fn,sink){return DistinctExpr.create({arg1:fn,arg2:sink})}function OR(){return OrExpr.create({args:compileArray_.call(null,arguments)})}function NOT(arg){return NotExpr.create({arg1:compile_(arg)})}function HAS(arg){return HasExpr.create({arg1:compile_(arg)})}function STARTS_WITH(arg1,arg2){return StartsWithExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function STARTS_WITH_IC(arg1,arg2){return StartsWithICExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function CONTAINS(arg1,arg2){return ContainsExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function CONTAINS_IC(arg1,arg2){return ContainsICExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function CONCAT(){return ConcatExpr.create({args:compileArray_.call(null,arguments)})}function TREE(parentProperty,childrenProperty){return TreeExpr.create({parentProperty:parentProperty,childrenProperty:childrenProperty})}function ADD(arg1,arg2){return AddExpr.create({arg1:compile_(arg1),arg2:compile_(arg2)})}function DESC(arg1){return DescExpr.isInstance(arg1)?arg1.arg1:DescExpr.create({arg1:arg1})}function MQL(mql){return MQLExpr.create({arg1:mql})}function KEYWORD(word){return KeywordExpr.create({arg1:word})}function atxn(afunc){return function(ret){if(GLOBAL.__TXN__)afunc.apply(this,arguments);else{GLOBAL.__TXN__={};var a=argsToArray(arguments);a[0]=function(){GLOBAL.__TXN__=void 0,ret()},afunc.apply(this,a)}}}function dump(o){return Array.isArray(o)?"["+o.map(dump).join(",")+"]":o?o.toString():"<undefined>"}function deferJsonP(X){var future=afuture();return X.ajsonp=function(){var args=arguments;return function(ret){future.get(function(f){f.apply(void 0,args)(ret)})}},future}navigator&&-1!=navigator.userAgent.indexOf("Firefox")&&(console.log("Loading Firefox Support."),Object.defineProperties(MouseEvent.prototype,{offsetX:{get:function(){return this.clientX-this.target.getBoundingClientRect().left}},offsetY:{get:function(){return this.clientY-this.target.getBoundingClientRect().top}}})),"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentElement&&this.parentElement.removeChild(this)}),"function"!=typeof Number.isNaN&&(Number.isNaN=function(value){return"number"==typeof value&&value!==value}),"function"!=typeof Number.isInteger&&(Number.isInteger=function(value){return"number"==typeof value&&Math.round(value)===value}),Number.name||(console.log("Polyfilling Function.prototype.name"),Object.defineProperty(Function.prototype,"name",{get:function(){var text=this.toString();return text.substring(text.indexOf("function")+9,text.indexOf("(")).trim()},configurable:!0,enumerable:!0})),function(){if("undefined"==typeof window.performance&&(window.performance={}),!window.performance.now){var nowOffset=Date.now();performance.timing&&performance.timing.navigationStart&&(nowOffset=performance.timing.navigationStart),window.performance.now=function now(){return Date.now()-nowOffset}}}(),"function"!=typeof Number.isFinite&&(Number.isFinite=function isFinite(value){return"number"!=typeof value?!1:value!==value||value===1/0||value===-(1/0)?!1:!0}),"function"!=typeof Number.isNaN&&(Number.isNaN=function(value){return"number"==typeof value&&value!==value}),"function"!=typeof Number.isInteger&&(Number.isInteger=function(value){return"number"==typeof value&&Math.round(value)===value});var DEBUG=DEBUG||!1,_DOC_=_DOC_||!1,FLAGS=FLAGS||{};FLAGS.javascript=!0,FLAGS.debug=DEBUG,FLAGS.documentation=_DOC_;var GLOBAL=GLOBAL||this,MODEL0=MODEL;MODEL({extendsObject:"GLOBAL",methods:[function memoize(f){var cache={},g=function(){var key=argsToArray(arguments).toString();return cache.hasOwnProperty(key)||(cache[key]=f.apply(this,arguments)),cache[key]};return g.name=f.name,g},function memoize1(f){var cache={},g=function(arg){var key=arg?arg.toString():"";return cache.hasOwnProperty(key)||(cache[key]=f.call(this,arg)),cache[key]};return g.name=f.name,g},function constantFn(v){return function(){return v}},function latchFn(f){var tripped=!1,val;return function(){return tripped||(tripped=!0,val=f(),f=void 0),val}},function argsToArray(args){for(var array=new Array(args.length),i=0;i<args.length;i++)array[i]=args[i];return array},function StringComparator(s1,s2){return s1==s2?0:s2>s1?-1:1},function equals(a,b){return a===b?!0:a&&b?a.equals?a.equals(b):a.compareTo?0===a.compareTo(b):b.compareTo?0===b.compareTo(a):a==b:!1},function compare(a,b){return a===b?0:null==a?-1:null==b?1:a.compareTo?a.compareTo(b):b.compareTo?-b.compareTo(a):a>b?1:-1},function toCompare(c){return Array.isArray(c)?CompoundComparator.apply(null,c):c.compare?c.compare.bind(c):c},function CompoundComparator(){for(var args=argsToArray(arguments),cs=[],i=0;i<args.length;i++)cs[i]=toCompare(args[i]);var f=function(o1,o2){for(var i=0;i<cs.length;i++){var r=cs[i](o1,o2);if(0!=r)return r}return 0};return f.toSQL=function(){return args.map(function(s){return s.toSQL()}).join(",")},f.toMQL=function(){return args.map(function(s){return s.toMQL()}).join(" ")},f.toBQL=function(){return args.map(function(s){return s.toBQL()}).join(" ")},f.toString=f.toSQL,f},function randomAct(){for(var totalWeight=0,i=0;i<arguments.length;i+=2)totalWeight+=arguments[i];for(var r=Math.random(),i=0,weight=0;i<arguments.length;i+=2)if(weight+=arguments[i],weight/totalWeight>=r)return void arguments[i+1]()},function Object_forEach(obj,fn){for(var key in obj)obj.hasOwnProperty(key)&&fn(obj[key],key)},function predicatedSink(predicate,sink){return predicate!==TRUE&&sink?{__proto__:sink,$UID:sink.$UID,put:function(obj,s,fc){!sink.put||obj&&!predicate.f(obj)||sink.put(obj,s,fc)},remove:function(obj,s,fc){!sink.remove||obj&&!predicate.f(obj)||sink.remove(obj,s,fc)},reset:function(){sink.reset&&sink.reset()},toString:function(){return"PredicatedSink("+sink.$UID+", "+predicate+", "+sink+")"}}:sink},function limitedSink(count,sink){var i=0;return{__proto__:sink,$UID:sink.$UID,put:function(obj,s,fc){i++>=count&&fc?fc.stop():sink.put(obj,s,fc)}}},function skipSink(skip,sink){var i=0;return{__proto__:sink,$UID:sink.$UID,put:function(obj,s,fc){i++>=skip&&sink.put(obj,s,fc)}}},function orderedSink(comparator,sink){return comparator=toCompare(comparator),{__proto__:sink,$UID:sink.$UID,i:0,arr:[],put:function(obj,s,fc){this.arr.push(obj)},eof:function(){this.arr.sort(comparator),this.arr.select(sink)}}},function defineLazyProperty(target,name,definitionFn){Object.defineProperty(target,name,{get:function(){var definition=definitionFn.call(this);return Object.defineProperty(this,name,definition),definition.get?definition.get.call(this):definition.value},configurable:!0})},function multiline(f){if("string"==typeof f)return f;var s=f.toString(),start=s.indexOf("/*"),end=s.lastIndexOf("*/");return s.substring(start+2,end)},function findPageXY(node){for(var x=0,y=0,parent;node;)parent=node,x+=node.offsetLeft,y+=node.offsetTop,node=node.offsetParent;return[x,y,parent]},function findViewportXY(node){var rect=node.getBoundingClientRect();return[rect.left,rect.top]},function nop(){},function stringtoutf8(str){for(var res=[],i=0;i<str.length;i++){var code=str.charCodeAt(i),count=0;128>code&&res.push(code)}return res},function createGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}]});var labelize=memoize1(function(str){return""===str?str:capitalize(str.replace(/[a-z][A-Z]/g,function(a){return a.charAt(0)+" "+a.charAt(1)}))}),constantize=memoize1(function(str){return"x"===str?"X_":"y"===str?"Y_":"$"===str?"$_":str.replace(/[a-z][^0-9a-z_]/g,function(a){return a.substring(0,1)+"_"+a.substring(1,2)}).toUpperCase()}),capitalize=memoize1(function(str){return str[0].toUpperCase()+str.substring(1)}),camelize=memoize1(function(str){var ret=str.replace(/(?:[-\s_])(\w)/g,function(_,a){return a?a.toUpperCase():""});return ret[0].toLowerCase()+ret.substring(1)}),daoize=memoize1(function(str){return str[0].toLowerCase()+str.substring(1)+"DAO"}),cssClassize=memoize1(function(str){return str.replace(/\./g,"-")});MODEL({extendsProto:"Object",properties:[{name:"$UID",getter:function(){var id=1;return function(){return Object.hasOwnProperty.call(this,"$UID__")?this.$UID__:(this.$UID__=id,id++,this.$UID__)}}()}],methods:[function become(other){for(var local=Object.getOwnPropertyNames(this),i=0;i<local.length;i++)delete this[local[i]];var remote=Object.getOwnPropertyNames(other);for(i=0;i<remote.length;i++)Object.defineProperty(this,remote[i],Object.getOwnPropertyDescriptor(other,remote[i]));this.__proto__=other.__proto__}]}),MODEL({extendsProto:"Array",constants:{oldForEach_:Array.prototype.forEach},methods:[function clone(){return this.slice()},function deepClone(){for(var a=this.clone(),i=0;i<a.length;i++){var o=a[i];o&&(o.deepClone?a[i]=o.deepClone():o.clone&&(a[i]=o.clone()))}return a},function forEach(f,opt_this){if(!this||!f||opt_this)return this.oldForEach_.call(this,f,opt_this);for(var l=this.length,i=0;l>i;i++)f(this[i],i,this)},function diff(other){for(var added=other.slice(0),removed=[],i=0;i<this.length;i++){for(var j=0;j<added.length;j++)if(0==this[i].compareTo(added[j])){added.splice(j,1),j--;break}j==added.length&&removed.push(this[i])}return{added:added,removed:removed}},function binaryInsert(item){for(var start=0,end=this.length-1;end>=start;){var m=start+Math.floor((end-start)/2),c=item.compareTo(this[m]);if(0==c)return this;0>c?end=m-1:start=m+1}return this.splice(start,0,item),this},function union(other){return this.concat(other.filter(function(o){return-1==this.indexOf(o)}.bind(this)))},function intersection(other){return this.filter(function(o){return-1!=other.indexOf(o)})},function intern(){for(var i=0;i<this.length;i++)this[i].intern&&(this[i]=this[i].intern());return this},function compareTo(other){if(this.length!==other.length)return-1;for(var i=0;i<this.length;i++){var result=this[i].compareTo(other[i]);if(0!==result)return result}return 0},function deleteF(v){for(var a=this.clone(),i=0;i<a.length;i++)if(a[i]===v){a.splice(i,1);break}return a},function deleteI(v){for(var i=0;i<this.length;i++)if(this[i]===v)return this.splice(i,1),!0;return!1},function removeF(p){for(var a=[],i=0;i<a.length;i++)if(p.f(a[i]))for(i++;i<a.length;i++)a.push(a[i]);return a},function removeI(p){for(var i=0;i<this.length;i++)if(p.f(this[i]))return this.splice(i,1),!0;return!1},function pushF(obj){var a=this.clone();return a.push(obj),a},function spliceF(start,end){var r=[],i;for(i=0;start>i;i++)r.push(this[i]);for(i=2;i<arguments.length;i++)r.push(arguments[i]);for(i=start+end;i<this.length;i++)r.push(this[i]);return r},function fReduce(comparator,arr){compare=toCompare(comparator);for(var result=[],i=0,j=0,k=0;i<this.length&&j<arr.length;){var a=compare(this[i],arr[j]);0>a?result[k++]=this[i++]:0!=a?result[k++]=arr[j++]:(result[k++]=this[i++],result[k++]=arr[j++])}return i!=this.length&&(result=result.concat(this.slice(i))),j!=arr.length&&(result=result.concat(arr.slice(j))),result},function pushAll(arr){return this.push.apply(this,arr),this.length},function mapFind(map){for(var i=0;i<this.length;i++){var result=map(this[i],i);if(result)return result}},function mapProp(prop){return this.map(function(x){return x[prop]})},function mapCall(){var args=Array.prototype.slice.call(arguments,0),func=args.shift();return this.map(function(x){return x[func]&&x[func].apply(x[func],args)})}],properties:[{name:"memento",getter:function(){throw"Array's can not be memorized properly as a memento."}}]}),MODEL({extendsProto:"String",methods:[function indexOfIC(a){return a.length>this.length?-1:this.toUpperCase().indexOf(a.toUpperCase())},function equals(other){return 0===this.compareTo(other)},function equalsIC(other){return other&&this.toUpperCase()===other.toUpperCase()},function capitalize(){return this.charAt(0).toUpperCase()+this.slice(1)},function labelize(){return this.replace(/[a-z][A-Z]/g,function(a){return a.charAt(0)+" "+a.charAt(1)}).capitalize()},function compareTo(o){return o==this?0:o>this?-1:1},String.prototype.startsWith||function startsWith(a){return 0==this.lastIndexOf(a,0)},String.prototype.endsWith||function endsWith(a){return this.length-a.length==this.lastIndexOf(a)},function startsWithIC(a){if(a.length>this.length)return!1;for(var l=a.length,i=0;l>i;i++)if(this[i].toUpperCase()!==a[i].toUpperCase())return!1;return!0},function put(obj){return this+obj.toJSON()},function(){var map={};return function intern(){return map[this]||(map[this]=this.toString())}}(),function hashCode(){var hash=0;if(0==this.length)return hash;for(i=0;i<this.length;i++){var code=this.charCodeAt(i);hash=(hash<<5)-hash+code,hash&=hash}return hash}]}),MODEL({extendsProto:"Function",methods:[function(){var oldBind=Function.prototype.bind,simpleBind=function(f,self){return function(){return f.apply(self,arguments)}};return function bind(arg){if(1==arguments.length)return simpleBind(this,arg);for(var args=new Array(arguments.length),i=0;i<arguments.length;i++)args[i]=arguments[i];return oldBind.apply(this,args)}}(),function equals(o){return this===o},function compareTo(o){return this===o?0:this.name.compareTo(o.name)||1},function o(f2){var f1=this;return function(){return f1.call(this,f2.apply(this,argsToArray(arguments)))}}]}),MODEL({extendsObject:"Math",methods:[function sign(n){return n>0?1:-1}]}),MODEL({extendsProto:"Date",methods:[function toRelativeDateString(){var seconds=Math.floor((Date.now()-this.getTime())/1e3);if(60>seconds)return"moments ago";var minutes=Math.floor(seconds/60);if(1==minutes)return"1 minute ago";if(60>minutes)return minutes+" minutes ago";var hours=Math.floor(minutes/60);if(1==hours)return"1 hour ago";if(24>hours)return hours+" hours ago";var days=Math.floor(hours/24);if(1==days)return"1 day ago";if(7>days)return days+" days ago";if(365>days){var year=1900+this.getYear(),noyear=this.toDateString().replace(" "+year,"");return noyear.substring(4)}return this.toDateString().substring(4)},function equals(o){return o&&o.getTime?this.getTime()===o.getTime():!1},function compareTo(o){if(o===this)return 0;if(!o)return 1;var d=this.getTime()-o.getTime();return 0==d?0:d>0?1:-1},function toMQL(){return this.getFullYear()+"/"+(this.getMonth()+1)+"/"+this.getDate()},function toBQL(){var str=this.toISOString();return str.substring(0,str.indexOf("."))}]}),MODEL({extendsProto:"Number",methods:[function compareTo(o){return o==this?0:o>this?-1:1}]}),MODEL({extendsProto:"Boolean",methods:[function compareTo(o){return(this.valueOf()?1:0)-(o?1:0)}]}),MODEL({extendsProto:"RegExp",methods:[function quote(str){return(str+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}]}),console.log.json=function(){for(var args=[],i=0;i<arguments.length;i++){var arg=arguments[i];args.push(arg&&arg.toJSON?arg.toJSON():arg)}console.log.apply(console,args)},console.log.str=function(){for(var args=[],i=0;i<arguments.length;i++){var arg=arguments[i];args.push(arg&&arg.toString?arg.toString():arg)}console.log.apply(console,args)},console.log.put=console.log.bind(console),console.log.remove=console.log.bind(console,"remove: "),console.log.error=console.log.bind(console,"error: "),console.log.json.put=console.log.json.bind(console),console.log.json.reduceI=console.log.json.bind(console,"reduceI: "),console.log.json.remove=console.log.json.bind(console,"remove: "),console.log.json.error=console.log.json.bind(console,"error: "),console.log.str.put=console.log.str.bind(console),console.log.str.remove=console.log.str.bind(console,"remove: "),console.log.str.error=console.log.str.bind(console,"error: "),document.put=function(obj){obj.write?obj.write(this.X):this.write(obj.toString())},window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.setImmediate,window.Blob&&(Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice),window.XMLHttpRequest&&(XMLHttpRequest.prototype.asend=function(ret,opt_data){var xhr=this;xhr.onerror=function(){console.log("XHR Error: ",arguments)},xhr.onloadend=function(){ret(xhr.response,xhr)},xhr.send(opt_data)}),String.fromCharCode=function(){var oldLookup=String.fromCharCode,lookupTable=[];return function(a){if(1==arguments.length)return lookupTable[a]||(lookupTable[a]=oldLookup(a));for(var result="",i=0;i<arguments.length;i++)result+=lookupTable[arguments[i]]||(lookupTable[arguments[i]]=oldLookup(arguments[i]));return result}}();var MementoProto={};Object.defineProperty(MementoProto,"equals",{enumerable:!1,configurable:!0,value:function(o){var keys=Object.keys(this),otherKeys=Object.keys(o);if(keys.length!=otherKeys.length)return!1;for(var i=0;i<keys.length;i++)if(!equals(this[keys[i]],o[keys[i]]))return!1;return!0}}),window.WeakMap||Object.defineProperty(window,"WeakMap",{configurable:!0,writable:!0,value:function WeakMap(){function del(key){delete key[id]}function get(key){return key[id]}function set(key,value){key[id]=value}function has(key){return!!key[id]}var id="__WEAK_MAP__"+this.$UID;return{__proto__:this,"delete":del,get:get,set:set,has:has}}}),MODEL({extendsProto:"Function",methods:[function abind(self){return function(ret){this.apply(self,arguments),ret()}.bind(this)},function ao(f2){var f1=this;return function(ret){var args=argsToArray(arguments);args[0]=f1.bind(this,ret),f2.apply(this,args)}},function aseq(f2){return f2.ao(this)}]}),MODEL({extendsObject:"GLOBAL",methods:[function anop(ret){ret&&ret(void 0)},function alog(){var args=arguments;return function(ret){console.log.apply(console,args),ret&&ret.apply(this,[].slice.call(arguments,1))}},function aprofile(afunc){return function(ret){var a=argsToArray(arguments);console.profile("aprofile");var ret2=function(){console.profileEnd(),ret&&ret(arguments)};aapply_(afunc,ret2,a)}},function aconstant(v){return function(ret){ret&&ret(v)}},function arepeat(n,afunc){return n?function(ret){var a=argsToArray(arguments);
a.splice(1,0,0,n);var next=atramp(function(){return a[1]==n-1?(a[0]=ret,void afunc.apply(this,a)):(afunc.apply(this,a),void a[1]++)});a[0]=next,next.apply(this,a)}:anop},function aforEach(arr,afunc){},function awhile(cond,afunc){return function(ret){var a=argsToArray(arguments),g=function(){return cond()?void afunc.apply(this,a):void ret.apply(void 0,arguments)};a[0]=g,g.apply(this,a)}},function aif(cond,afunc,aelse){return function(ret){("function"==typeof cond?cond.apply(this,argsToArray(arguments).slice(1)):cond)?afunc.apply(this,arguments):aelse?aelse.apply(this,arguments):ret()}},function aaif(acond,afunc,aelse){return function(ret){var args=argsToArray(arguments);args[0]=function(c){args[0]=ret,c?afunc.apply(null,args):aelse?aelse.apply(null,args):ret()},acond.apply(null,args)}},function(){var id=1,activeOps={};return function atime(str,afunc,opt_endCallback,opt_startCallback){var name=str;return aseq(function(ret){activeOps[str]?(name+="-"+id++,activeOps[str]++):activeOps[str]=1;var start=performance.now();opt_startCallback&&opt_startCallback(name),opt_endCallback||console.time(name),ret.apply(null,[].slice.call(arguments,1))},afunc,function(ret){if(activeOps[str]--,opt_endCallback){var end=performance.now();opt_endCallback(name,end-start)}else console.timeEnd(name);ret&&ret.apply(null,[].slice.call(arguments,1))})}}(),function ametric(){return this.atime.apply(this,arguments)},function asleep(ms){return function(ret){window.setTimeout(ret,ms)}},function ayield(){return function(ret){window.setTimeout(ret,0)}},function afuture(){var set=!1,values=void 0,waiters=[];return{isSet:function(){return set},set:function(){if(set)return void console.log("ERROR: redundant set on future");values=arguments,set=!0;for(var i=0;i<waiters.length;i++)waiters[i].apply(null,values);return waiters=void 0,this},get:function(ret){return set?void ret.apply(null,values):void waiters.push(ret)}}},function aapply_(f,ret,args){args.unshift(ret),f.apply(this,args)},function arequestqueue(f,opt_lock,opt_max){var lock=opt_lock||{};lock.q||(lock.q=[],lock.active=null);var onExit=function(){var next=lock.active=lock.q.pop();next&&setTimeout(function(){f(onExit,next)},0)},reduceDown=function(o,q){for(var i=q.length-1;i>=0;i--){var result=o.reduce(q[i]);if(result){q.splice(i,1),reduceDown(result,q);break}}q.push(o)};return function(o){if(lock.active){var first=o.reduce(lock.active);if(first&&first.equals(lock.active))return}reduceDown(o,lock.q,lock.q.length-1),lock.q.length>opt_max&&(lock.q.length=opt_max),lock.active||onExit()}},function asynchronized(f,opt_lock){function onExit(ret){return function(){var next=lock.q.shift();next?setTimeout(next,0):lock.active=!1,ret()}}var lock=opt_lock||{};return lock.q||(lock.q=[],lock.active=!1),function(ret){return lock.active?void lock.q.push(function(){f(onExit(ret))}):(lock.active=!0,void f(onExit(ret)))}},function atimeout(delay,f,opt_timeoutF){return function(ret){var timedOut=!1,completed=!1;setTimeout(function(){completed||(timedOut=!0,console.log("timeout"),opt_timeoutF&&opt_timeoutF())},delay),f(aseq(function(ret){timedOut||(completed=!0),completed&&ret()},ret))}},function amemo(f,opt_ttl){var memoized=!1,values,waiters,age=0,pending=!1;return function(ret){if(memoized)return ret.apply(null,values),void(void 0!=opt_ttl&&!pending&&Date.now()>age+opt_ttl&&(pending=!0,f(function(){values=arguments,age=Date.now(),pending=!1})));var first=!waiters;first&&(waiters=[]),waiters.push(ret),first&&f(function(){values=arguments,age=Date.now();for(var i=0;i<waiters.length;i++)waiters[i]&&waiters[i].apply(null,values);void 0==opt_ttl&&(f=void 0),memoized=!0,waiters=void 0})}},function amemo1(afunc){var cache={};return function(ret,arg){var key=arg?arg.toString():"";cache[key]||(cache[key]=afuture(),afunc(cache[key].set,arg)),cache[key].get(ret)}},function amerged(f){var waiters;return function(ret){var first=!waiters;if(first){waiters=[];var args=argsToArray(arguments)}waiters.push(ret),first&&(args[0]=function(){var calls=waiters;waiters=void 0;for(var i=0;i<calls.length;i++)calls[i]&&calls[i].apply(null,arguments)},f.apply(null,args))}},function mergeAsync(f){var active=!1,args;return function(){if(active)return void(args=argsToArray(arguments));active=!0;var ret=function(){args?(args.unshift(ret),f.apply(null,args),args=void 0):active=!1},a=argsToArray(arguments);a.unshift(ret),f.apply(null,a)}},function ao(){for(var ret=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)ret=arguments[i].ao(ret);return ret},function aseq(){if(0==arguments.lenth)return anop;for(var f=arguments[arguments.length-1],i=arguments.length-2;i>=0;i--)f=arguments[i].aseq(i%100==99?atramp(f):f);return f},function apar(){var aargs=[],count=0,fs=arguments;return function(ret){if(0==fs.length)return void(ret&&ret());for(var opt_args=Array.prototype.splice.call(arguments,1),ajoin=function(i){if(aargs[i]=Array.prototype.splice.call(arguments,1),++count==fs.length){for(var a=[],j=0;j<fs.length;j++)for(var k=0;k<aargs[j].length;k++)a.push(aargs[j][k]);ret&&ret.apply(null,a)}},i=0;i<fs.length;i++)fs[i].apply(null,[ajoin.bind(null,i)].concat(opt_args))}},function(){var active=!1,jobs=[];return function atramp(afunc){return function(){if(jobs.push([afunc,arguments]),!active){console.assert(jobs.length<=1,"atramp with multiple jobs"),active=!0;for(var job;null!=(job=jobs.pop());)job[0].apply(this,job[1]);active=!1}}}}(),function arepeatpar(n,afunc){return function(ret){if(0===n)return void(ret&&ret());for(var aargs=[],count=0,opt_args=Array.prototype.splice.call(arguments,1),ajoin=function(i){if(++count==n){var a=[];ret&&ret.apply(null,a)}},i=0;n>i;i++)afunc.apply(null,[ajoin.bind(null,i)].concat([i,n]).concat(opt_args))}},function axhr(url,opt_op,opt_params){var op=opt_op||"GET",params=opt_params||[];return function(ret){var xhr=new XMLHttpRequest;xhr.open(op,url),xhr.asend(function(json){ret(JSON.parse(json))},params&&params.join("&"))}},function futurefn(future){return function(){var args=arguments;future.get(function(f){f.apply(void 0,args)})}},function adelay(afunc,delay){function pump(){if(!timeout&&queue.length){var top=queue.shift(),f=top[0],args=top[1],ret=args[0];args[0]=function(){ret.apply(null,arguments),pump()},timeout=setTimeout(function(){timeout=0,f.apply(null,args)},delay)}}var queue=[],timeout;return function(){var args=arguments;queue.push([afunc,args]),pump()}},function adebugger(fn){return function(ret){fn.apply(null,arguments)}}]});var __JSONP_CALLBACKS__={},wrapJsonpCallback=function(){var nextID=0;return function(ret,opt_nonce){var id="c"+nextID++;opt_nonce&&(id+=Math.floor(16777215*Math.random()).toString(16));var cb=__JSONP_CALLBACKS__[id]=function(data){delete __JSONP_CALLBACKS__[id],ret&&ret.call(this,data)};return cb.id=id,cb}}(),ajsonp=function(url,params){return function(ret){var cb=wrapJsonpCallback(ret),script=document.createElement("script");script.src=url+"?callback=__JSONP_CALLBACKS__."+cb.id+(params?"&"+params.join("&"):""),script.onload=function(){document.body.removeChild(this)},script.onerror=function(){cb(null),document.body.removeChild(this)},document.body.appendChild(script)}},StringPS={create:function(str){var o=Object.create(this);return o.pos=0,o.str_=[str],o.tail_=[],o},set str(str){this.str_[0]=str},get head(){return this.pos>=this.str_[0].length?null:this.str_[0].charAt(this.pos)},get value(){return this.hasOwnProperty("value_")?this.value_:this.str_[0].charAt(this.pos-1)},get tail(){if(!this.tail_[0]){var tail=Object.create(this.__proto__);tail.str_=this.str_,tail.pos=this.pos+1,tail.tail_=[],this.tail_[0]=tail}return this.tail_[0]},setValue:function(value){var ret=Object.create(this.__proto__);return ret.str_=this.str_,ret.pos=this.pos,ret.tail_=this.tail_,ret.value_=value,ret},toString:function(){return this.str_[0].substring(this.pos)}},literal=function(){var cache={};return function(str,opt_value){if(!opt_value&&cache[str])return cache[str];var f;return f=1===str.length?function(ps){return str===ps.head?ps.tail.setValue(opt_value||str):void 0}:function(ps){for(var i=0;i<str.length;i++,ps=ps.tail)if(str.charAt(i)!==ps.head)return void 0;return ps.setValue(opt_value||str)},f.toString=function(){return'"'+str+'"'},opt_value?f:cache[str]=f}}(),alphaChar=alt(range("a","z"),range("A","Z")),alphaNumChar=alt(alphaChar,range("0","9")),wordChar=alt(alphaNumChar,"_"),parserVersion_=1,TrapPStream={create:function(ps){return{__proto__:this,head:ps.head,value:ps.value,goodChar:!1}},getValue:function(){return this.value},setValue:function(v){return this.value=v,this},get tail(){return this.goodChar=!0,{value:this.value,getValue:function(){return this.value},setValue:function(v){this.value=v}}}},DEBUG_PARSE=!1,grammar={parseString:function(str,opt_start){var ps=this.stringPS;ps.str=str;var res=this.parse(opt_start||this.START,ps);return res&&res.value},parse:function(parser,pstream){DEBUG_PARSE&&pstream.str_&&(console.log(new Array(pstream.pos).join("."),pstream.head),console.log(pstream.pos+"> "+pstream.str_[0].substring(0,pstream.pos)+"("+pstream.head+")"));var ret=parser.call(this,pstream);return DEBUG_PARSE&&console.log(parser+" ==> "+!!ret+"  "+(ret&&ret.value)),ret},"export":function(str){return this[str].bind(this)},addAction:function(sym,action){var p=this[sym];this[sym]=function(ps){var val=ps.value,ps2=this.parse(p,ps);return ps2&&ps2.setValue(action.call(this,ps2.value,val))},this[sym].toString=function(){return"<<"+sym+">>"}},addActions:function(map){for(var key in map)this.addAction(key,map[key]);return this}};defineTTLProperty(grammar,"stringPS",3e4,function(){return StringPS.create("")});var SkipGrammar={create:function(gramr,skipp){return{__proto__:gramr,skip_:!0,parse:function(parser,pstream){return this.skip_&&(pstream=this.skip.call(grammar,pstream)||pstream),this.__proto__.parse.call(this,parser,pstream)},skip:skipp}}},__ROOT__={};MODEL({name:"EventService","extends":"__ROOT__",constants:{UNSUBSCRIBE_EXCEPTION:"unsubscribe",WILDCARD:"*"},methods:{oneTime:function(listener){return function(){throw listener.apply(this,argsToArray(arguments)),EventService.UNSUBSCRIBE_EXCEPTION}},consoleLog:function(listener){return function(){var args=argsToArray(arguments);console.log(args),listener.apply(this,args)}},merged:function(listener,opt_delay,opt_X){var setTimeoutX=opt_X&&opt_X.setTimeout||setTimeout,delay=opt_delay||16;return function(){var triggered=!1,unsubscribed=!1,lastArgs=null,f=function(){if(lastArgs=arguments,unsubscribed)throw EventService.UNSUBSCRIBE_EXCEPTION;if(!triggered){triggered=!0;try{setTimeoutX(function(){triggered=!1;var args=argsToArray(lastArgs);lastArgs=null;try{listener.apply(this,args)}catch(x){x===EventService.UNSUBSCRIBE_EXCEPTION&&(unsubscribed=!0)}},delay)}catch(e){throw EventService.UNSUBSCRIBE_EXCEPTION}}};return DEBUG&&(f.toString=function(){return"MERGED("+delay+", "+listener.$UID+", "+listener+")"}),f}()},framed:function(listener,opt_X){opt_X=opt_X||this.X;var requestAnimationFrameX=opt_X&&opt_X.requestAnimationFrame||requestAnimationFrame;return function(){var triggered=!1,unsubscribed=!1,lastArgs=null,f=function(){if(lastArgs=arguments,unsubscribed)throw EventService.UNSUBSCRIBE_EXCEPTION;triggered||(triggered=!0,requestAnimationFrameX(function(){triggered=!1;var args=argsToArray(lastArgs);lastArgs=null;try{listener.apply(this,args)}catch(x){x===EventService.UNSUBSCRIBE_EXCEPTION&&(unsubscribed=!0)}}))};return DEBUG&&(f.toString=function(){return"FRAMED("+listener.$UID+", "+listener+")"}),f}()},async:function(listener,opt_X){return this.delay(0,listener,opt_X)},delay:function(delay,listener,opt_X){return opt_X=opt_X||this.X,function(){var args=argsToArray(arguments);(opt_X&&opt_X.setTimeout?opt_X.setTimeout:setTimeout)(function(){listener.apply(this,args)},delay)}},hasListeners:function(opt_topic){return opt_topic?(console.log("TODO: haslisteners"),!0):!!this.subs_},publish:function(topic){return this.subs_?this.pub_(this.subs_,0,topic,this.appendArguments([this,topic],arguments,1)):0},publishAsync:function(topic){var args=argsToArray(arguments),me=this;setTimeout(function(){me.publish.apply(me,args)},0)},deepPublish:function(topic){return this.publish.apply(this,arguments)},lazyPublish:function(topic,fn){return this.hasListeners(topic)?this.publish.apply(this,fn()):0},subscribe:function(topic,listener){this.subs_||(this.subs_={}),this.sub_(this.subs_,0,topic,listener)},unsubscribe:function(topic,listener){this.subs_&&this.unsub_(this.subs_,0,topic,listener)},unsubscribeAll:function(){this.sub_={}},pub_:function(map,topicIndex,topic,msg){var count=0;if(null==map)return 0;if(topicIndex<topic.length){var t=topic[topicIndex];if(t==this.WILDCARD)return this.notifyListeners_(topic,map,msg);t&&(count+=this.pub_(map[t],topicIndex+1,topic,msg))}return count+=this.notifyListeners_(topic,map[null],msg)},sub_:function(map,topicIndex,topic,listener){if(topicIndex==topic.length)map[null]||(map[null]=[]),map[null].push(listener);else{var key=topic[topicIndex];map[key]||(map[key]={}),this.sub_(map[key],topicIndex+1,topic,listener)}},unsub_:function(map,topicIndex,topic,listener){if(topicIndex==topic.length){if(!map[null])return!0;var i=map[null].indexOf(listener);-1==i||(map[null]=map[null].spliceF(i,1)),map[null].length||delete map[null]}else{var key=topic[topicIndex];if(!map[key])return!1;this.unsub_(map[key],topicIndex+1,topic,listener)&&delete map[key]}return 0==Object.keys(map).length},notifyListener_:function(topic,listener,msg){try{listener.apply(null,msg)}catch(err){return err!==this.UNSUBSCRIBE_EXCEPTION&&(console.error("Error delivering event (removing listener): ",topic.join("."),err),DEBUG&&console.error(err.stack)),!1}return!0},notifyListeners_:function(topic,listeners,msg){if(null==listeners)return 0;if(Array.isArray(listeners)){for(var i=0;i<listeners.length;i++){var listener=listeners[i];this.notifyListener_(topic,listener,msg)||this.unsubscribe(topic,listener)}return listeners.length}var count=0;for(var key in listeners)count+=this.notifyListeners_(topic,listeners[key],msg);return count},appendArguments:function(a,args,start){for(var i=start;i<args.length;i++)a.push(args[i]);return a}}}),MODEL({name:"PropertyChangeSupport","extends":"EventService",constants:{PROPERTY_TOPIC:"property"},methods:{propertyTopic:memoize1(function(property){return[this.PROPERTY_TOPIC,property]}),propertyChange:function(property,oldValue,newValue){this.subs_&&(null==property||oldValue!==newValue&&(oldValue===oldValue||newValue===newValue))&&this.publish(this.propertyTopic(property),oldValue,newValue)},propertyChange_:function(propertyTopic,oldValue,newValue){this.subs_&&(oldValue===newValue||oldValue!==oldValue&&newValue!==newValue||this.publish(propertyTopic,oldValue,newValue))},globalChange:function(){this.publish(this.propertyTopic(this.WILDCARD),null,null)},addListener:function(listener){console.assert(listener,"Listener cannot be null."),this.addPropertyListener(null,listener)},removeListener:function(listener){this.removePropertyListener(null,listener)},addPropertyListener:function(property,listener){this.subscribe(this.propertyTopic(property),listener)},removePropertyListener:function(property,listener){this.unsubscribe(this.propertyTopic(property),listener)},propertyValue:function(prop){if(!prop)throw"Property Name required for propertyValue().";var props=this.props_||(this.props_={});return Object.hasOwnProperty.call(props,prop)?props[prop]:props[prop]=PropertyValue.create(this,prop)}}});var FunctionStack={create:function(){var stack=[!1];return{stack:stack,push:function(f){stack.unshift(f)},pop:function(){stack.shift()}}}},Value={__isValue__:!0,isInstance:function(o){return o&&o.__isValue__},follow:function(srcValue){Events.follow(srcValue,this)}},PropertyValue={__proto__:Value,create:function(obj,prop){var o=Object.create(this);return o.$UID=obj.$UID+"."+prop,o.obj=obj,o.prop=prop,o},get:function(){return this.obj[this.prop]},set:function(val){this.obj[this.prop]=val},get value(){return this.get()},set value(val){this.set(val)},addListener:function(listener){this.obj.addPropertyListener(this.prop,listener)},removeListener:function(listener){this.obj.removePropertyListener(this.prop,listener)},toString:function(){return"PropertyValue("+this.prop+")"}},Events={listeners_:new WeakMap,recordListener:function(src,dst,listener,opt_dontCallListener){var srcMap=this.listeners_.get(src);srcMap||(srcMap=new WeakMap,this.listeners_.set(src,srcMap)),console.assert(!srcMap.get(dst),"recordListener: duplicate follow"),srcMap.set(dst,listener),src.addListener(listener),opt_dontCallListener||listener()},identity:function(x){return x},follow:function(srcValue,dstValue){srcValue&&dstValue&&this.recordListener(srcValue,dstValue,function(){var sv=srcValue.get(),dv=dstValue.get();equals(sv,dv)||dstValue.set(sv)})},unfollow:function(src,dst){if(src&&dst){var srcMap=this.listeners_.get(src);if(srcMap){var listener=srcMap.get(dst);listener&&(srcMap["delete"](dst),src.removeListener(listener))}}},map:function(srcValue,dstValue,f){srcValue&&dstValue&&this.recordListener(srcValue,dstValue,function(){var s=f(srcValue.get()),d=dstValue.get();equals(s,d)||dstValue.set(s)})},link:function(srcValue,dstValue){this.follow(srcValue,dstValue),this.follow(dstValue,srcValue)},relate:function(srcValue,dstValue,f,fprime,removeFeedback){if(srcValue&&dstValue){var feedback=!1,l=function(sv,dv,f){return function(){if(!removeFeedback||!feedback){var s=f(sv.get()),d=dv.get();equals(s,d)||(feedback=!0,dv.set(s),feedback=!1)}}},l1=l(srcValue,dstValue,f),l2=l(dstValue,srcValue,fprime);this.recordListener(srcValue,dstValue,l1,!0),this.recordListener(dstValue,srcValue,l2,!0),l1()}},unlink:function(value1,value2){this.unfollow(value1,value2),this.unfollow(value2,value1)},dynamicFn:function(fn,opt_fn,opt_X){var fn2=opt_fn?function(){opt_fn(fn())}:fn,listener=EventService.framed(fn2,opt_X),propertyValues=[];fn(),Events.onGet.push(function(obj,name,value){var l=obj.propertyValue(name);-1==propertyValues.indexOf(l)&&(obj.propertyValue(name).addListener(listener),propertyValues.push(l))});var ret=fn();return Events.onGet.pop(),opt_fn&&opt_fn(ret),{destroy:function(){propertyValues.forEach(function(p){p.removeListener(listener)})}}},onSet:FunctionStack.create(),onGet:FunctionStack.create()};MODEL({name:"Movement",methods:{distance:function(x,y){return Math.sqrt(x*x+y*y)},o:function(f1,f2){return function(x){return f1(f2(x))}},avg:function(f1,f2){return function(x){return(f1(x)+f2(x))/2}},spline:function(f1,f2){return function(x){return(1-x)*f1(x)+x*f2(x)}},linear:function(x){return x},back:function(x){return.5>x?2*x:2-2*x},accelerate:function(x){return(Math.sin(x*Math.PI-Math.PI/2)+1)/2},easeIn:function(a){var v=1/(1-a/2);return function(x){var x1=Math.min(x,a),x2=Math.max(x-a,0);return(a?.5*x1*(x1/a)*v:0)+x2*v}},reverse:function(f){return function(x){return 1-f(1-x)}},easeOut:function(b){return Movement.reverse(Movement.easeIn(b))},oscillate:function(b,a,opt_c){var c=opt_c||3;return function(x){if(1-b>x)return x/(1-b);var t=(x-1+b)/b;return 1+2*(1-t)*a*Math.sin(2*c*Math.PI*t)}},bounce:function(b,a,opt_c){var c=opt_c||3;return function(x){if(1-b>x)return x/(1-b);var t=(x-1+b)/b;return 1-2*(1-t)*a*Math.abs(Math.sin(2*c*Math.PI*t))}},bounce2:function(a){var v=1/(1-a);return function(x){if(1-a>x)return v*x;var p=(x-1+a)/a;return 1-(x-1+a)*v/2}},stepBack:function(a){return function(x){return a>x?-x:-2*a+(1+2*a)*x}},ease:function(a,b){return Movement.o(Movement.easeIn(a),Movement.easeOut(b))},seq:function(f1,f2){return f1&&f2?function(){f1.apply(this,argsToArray(arguments)),f2()}:f1?f1:f2},liveAnimations_:0,animate:function(duration,fn,opt_interp,opt_onEnd,opt_X){var requestAnimationFrameX=opt_X&&opt_X.requestAnimationFrame||requestAnimationFrame;if(0==duration)return Movement.seq(fn,opt_onEnd);var interp=opt_interp||Movement.linear;return function(){function stop(){var onEnd=opt_onEnd;if(!stopped&&(Movement.liveAnimations_--,stopped=!0,onEnd&&onEnd(),onEnd=null,0===Movement.liveAnimations_)){var tasks=Movement.idleTasks_;tasks&&tasks.length>0&&(Movement.idleTasks_=[],setTimeout(function(){var i;if(Movement.liveAnimations_>0)for(i=0;i<tasks.length;i++)Movement.idleTasks_.push(tasks[i]);else for(i=0;i<tasks.length;i++)tasks[i]()},20))}}function go(){if(!stopped){for(var now=Date.now(),p=interp((Math.min(now,startTime+duration)-startTime)/duration),last=now>=startTime+duration,i=0;i<ranges.length;i++){var r=ranges[i],obj=r[0],name=r[1],value1=r[2],value2=r[3];obj[name]=last?value2:value1+(value2-value1)*p}last?stop():requestAnimationFrameX(go)}}var ranges=[],stopped=!1;fn&&(Events.onSet.push(function(obj,name,value2){ranges.push([obj,name,obj[name],value2])}),fn.apply(this,argsToArray(arguments)),Events.onSet.pop());var startTime=Date.now();if(ranges.length>0)Movement.liveAnimations_++,requestAnimationFrameX(go);else{var setTimeoutX=opt_X&&opt_X.setTimeout||setTimeout;setTimeoutX(stop,duration)}return stop}},whenIdle:function(fn){return function(){if(Movement.liveAnimations_>0){Movement.idleTasks_||(Movement.idleTasks_=[]);var args=arguments;Movement.idleTasks_.push(function(){fn.apply(fn,args)})}else fn.apply(fn,arguments)}},compile:function(a,opt_rest){function noop(){}function isPause(op){return Array.isArray(op)&&0==op[0]}function compilePause(op,rest){return function(){var l=function(){document.removeEventListener("click",l),rest()};document.addEventListener("click",l)}}function isSimple(op){return Array.isArray(op)&&"number"==typeof op[0]}function compileSimple(op,rest){return op[3]=Movement.seq(op[3],rest),function(){Movement.animate.apply(null,op)()}}function isParallel(op){return Array.isArray(op)&&Array.isArray(op[0])}function compileParallel(op,rest){var join=function(num){return function(){--num||rest()}}(op.length);return function(){for(var i=0;i<op.length;i++)isSimple(op[i])?Movement.animate(op[i][0],op[i][1],op[i][2],Movement.seq(op[i][3],join))():Movement.compile(op[i],join)()}}function compileFn(fn,rest){return Movement.seq(fn,rest)}function compile_(a,i){if(i>=a.length)return opt_rest||noop;var rest=compile_(a,i+1),op=a[i];return isPause(op)?compilePause(op,rest):isSimple(op)?compileSimple(op,rest):isParallel(op)?compileParallel(op,rest):compileFn(op,rest)}return compile_(a,0)},onIntersect:function(o1,o2,fn){o1.model_.R?Events.dynamicFn(function(){o1.x,o1.y,o2.x,o2.y},function(){var dx=o1.x-o2.x,dy=o1.y-o2.y,d=dx*dx+dy*dy,r2=o1.r+o2.r;r2*r2>d&&fn.call(null,o1,o2)}):Events.dynamicFn(function(){o1.x,o1.y,o2.x,o2.y},function(){(o1.x<=o2.x&&o1.x+o1.width>o2.x&&o1.y<=o2.y&&o1.y+o1.height>o2.y||o2.x<=o1.x&&o2.x+o2.width>o1.x&&o2.y<=o1.y&&o2.y+o2.height>o1.y)&&fn.call(null,o1,o2)})},stepTowards:function(src,dst,maxStep){var dx=src.x-dst.x,dy=src.y-dst.y,theta=Math.atan2(dy,dx),r=Math.sqrt(dx*dx+dy*dy);r=0>r?Math.max(-maxStep,r):Math.min(maxStep,r),dst.x+=r*Math.cos(-theta),dst.y-=r*Math.sin(-theta)},moveTowards:function(t,body,sat,v){var bodyX=body.propertyValue("x"),bodyY=body.propertyValue("y"),satX=sat.propertyValue("x"),satY=sat.propertyValue("y");t.addListener(function(){var dx=bodyX.get()-satX.get(),dy=bodyY.get()-satY.get(),theta=Math.atan2(dy,dx),r=Math.sqrt(dx*dx+dy*dy);r=0>r?Math.max(-v,r):Math.min(v,r),satX.set(satX.get()+r*Math.cos(-theta)),satY.set(satY.get()-r*Math.sin(-theta))})},orbit:function(t,body,sat,r,p,opt_start){var bodyX=body.x$,bodyY=body.y$,satX=sat.x$,satY=sat.y$,start=opt_start||0;t.addListener(EventService.framed(function(){var time=t.time;satX.set(bodyX.get()+r*Math.sin(time/p*Math.PI*2+start)),satY.set(bodyY.get()+r*Math.cos(time/p*Math.PI*2+start))}))},strut:function(mouse,c,dx,dy){Events.dynamicFn(function(){mouse.x,mouse.y},function(){c.x=mouse.x+dx,c.y=mouse.y+dy})},gravity:function(c,opt_a,opt_theta){var a=opt_a||1,theta=opt_theta||1.5*Math.PI;Events.dynamicFn(function(){c.vx,c.vy},function(){c.vy+=a})},friction:function(c,opt_coef){var coef=opt_coef||.9;Events.dynamicFn(function(){c.vx,c.vy},function(){c.vx=Math.abs(c.vx)<.001?0:c.vx*coef,c.vy=Math.abs(c.vy)<.001?0:c.vy*coef})},inertia:function(c){var last=Date.now();Events.dynamicFn(function(){c.vx,c.vy,c.x,c.y},function(){var now=Date.now(),time=Math.min(Math.max(16,now-last),64)/16;Math.abs(c.vx)>.001&&(c.x+=c.vx*time),Math.abs(c.vy)>.001&&(c.y+=c.vy*time),last=now})},spring:function(mouse,c,dx,dy,opt_strength){var strength=opt_strength||6,d=Movement.distance(dx,dy);Events.dynamicFn(function(){mouse.x,mouse.y,c.x,c.y,c.vx,c.vy},function(){if(0===dx&&0===dy)c.x=mouse.x,c.y=mouse.y;else{var dx2=mouse.x+dx-c.x,dy2=mouse.y+dy-c.y,d2=Movement.distance(dx2,dy2),dv=strength*d2/d;if(Math.abs(dv)<.01)return;var a=Math.atan2(dy2,dx2);c.vx+=dv*Math.cos(a),c.vy+=dv*Math.sin(a)}})},spring2:function(c1,c2,length,opt_strength){var strength=opt_strength||4;Events.dynamicFn(function(){c1.x,c1.y,c2.x,c2.y},function(){var d=c1.distanceTo(c2),a=Math.atan2(c2.y-c1.y,c2.x-c1.x);d>length?(c1.applyMomentum(strength*(d/length-1),a),c2.applyMomentum(-strength*(d/length-1),a)):length>d&&(c1.applyMomentum(-strength*(length/d-1),a),c2.applyMomentum(strength*(length/d-1),a))})},createAnimatedPropertyInstallFn:function(duration,interpolation){return function(prop){this.defineProperty({name:prop.name+"$AnimationLatch",defaultValue:0,hidden:!0,documentation:function(){}});var actualSetter=this.__lookupSetter__(prop.name);this.defineProperty({name:prop.name+"$AnimationSetValue",defaultValue:0,hidden:!0,documentation:function(){},postSet:function(_,nu){actualSetter.call(this,nu)}}),this.__defineSetter__(prop.name,function(nu){var latch=this[prop.name+"$AnimationLatch"];latch&&latch();var anim=Movement.animate(duration,function(){this[prop.name+"$AnimationSetValue"]=nu}.bind(this),interpolation);this[prop.name+"$AnimationLatch"]=anim()})}}}}),Movement.easy=Movement.spline(Movement.spline(constantFn(0),Movement.linear),Movement.spline(Movement.linear,constantFn(1)));var AbstractFormatter={keyify:function(str){return'"'+str+'"'},stringify:function(obj){var buf="";return this.output(function(){for(var i=0;i<arguments.length;i++)buf+=arguments[i]},obj),buf},stringifyObject:function(obj,opt_defaultModel){var buf="";return this.outputObject_(function(){for(var i=0;i<arguments.length;i++)buf+=arguments[i]},obj,opt_defaultModel),buf},where:function(p){return{__proto__:this,p:p.f&&p.f.bind(p)||p}},p:function(){return!0}},JSONUtil={escape:function(str){return str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/[\x00-\x1f]/g,function(c){return"\\u00"+(c.charCodeAt(0)<16?"0"+c.charCodeAt(0).toString(16):c.charCodeAt(0).toString(16))})},parseToMap:function(str){return eval("("+str+")")},aparse:function(ret,X,str){var seq=[],res=this.parse(X,str,seq);return seq.length?void apar.apply(null,seq)(function(){ret(res)}):void ret(res)},amapToObj:function(ret,X,obj,opt_defaultModel){var seq=[],res=this.mapToObj(X,obj,opt_defaultModel,seq);return seq.length?void aseq.apply(null,seq)(function(){ret(res)}):res},parse:function(X,str,seq){return this.mapToObj(X,this.parseToMap(str),void 0,seq)},arrayToObjArray:function(X,a,opt_defaultModel,seq){for(var i=0;i<a.length;i++)a[i]=this.mapToObj(X,a[i],opt_defaultModel,seq);return a},mapToObj:function(X,obj,opt_defaultModel,seq){if(!obj||"object"==typeof obj.model_)return obj;if(Array.isArray(obj))return this.arrayToObjArray(X,obj,void 0,seq);if(obj instanceof Function)return obj;if(obj instanceof Date)return obj;if(obj instanceof Object){if(("Model"===obj.model_||"Model"===opt_defaultModel)&&obj.properties)for(var i=0;i<obj.properties.length;i++){var p=obj.properties[i];p.type&&!p.model_&&"Property"!==p.type&&(p.model_=p.type+"Property",X.arequire(p.model_)(function(obj,p){return function(m){Property&&!Property.isSubModel(m)&&console.log("ERROR: Use of non Property Sub-Model as Property type: ",obj["package"]+"."+obj.name,p.type)}}(obj,p)))}for(var key in obj)"model_"!=key&&"prototype_"!=key&&(obj[key]=this.mapToObj(X,obj[key],null,seq));if(opt_defaultModel&&!obj.model_)return opt_defaultModel.create(obj,X);if(obj.model_){var newObj=X.lookup(obj.model_);if(!newObj||!newObj.finished__){var future=afuture();return seq&&seq.push(future.get),X.arequire(obj.model_)(function(model){if(!model)return FLAGS.debug&&"Template"!==obj.model_&&"ArrayProperty"!==obj.model_&&"ViewFactoryProperty"!==obj.model_&&"Documentation"!==obj.model_&&"DocumentationProperty"!==obj.model_&&"CSSProperty"!==obj.model_&&"FunctionProperty"!==obj.model_&&console.warn("Failed to dynamically load: ",obj.model_),void future.set(obj);if(!obj.instance_){var tmp=model.create(obj,X);obj.become(tmp),future.set(obj)}}),obj}var ret=newObj?newObj.create(obj,X):obj;return ret.readResolve?ret.readResolve():ret}return obj}return obj},compact:{__proto__:AbstractFormatter,output:function(out,obj,opt_defaultModel){Array.isArray(obj)?this.outputArray_(out,obj):"string"==typeof obj?(out('"'),out(JSONUtil.escape(obj)),out('"')):obj instanceof Function?this.outputFunction_(out,obj):obj instanceof Date?out(obj.getTime()):obj instanceof RegExp?out(obj.toString()):obj instanceof Object?obj.model_&&obj.model_.id?this.outputObject_(out,obj,opt_defaultModel):this.outputMap_(out,obj):"number"==typeof obj?(isFinite(obj)||(obj=null),out(obj)):out(void 0===obj?null:obj)},outputObject_:function(out,obj,opt_defaultModel){var str="",first=!0;out("{"),obj.model_.id!==opt_defaultModel&&(this.outputModel_(out,obj),first=!1);var properties=obj.model_.getRuntimeProperties();for(var key in properties){var prop=properties[key];if(this.p(prop,obj)&&prop.name in obj.instance_){var val=obj[prop.name];if(Array.isArray(val)&&!val.length)continue;first||out(","),out(this.keyify(prop.name),": "),Array.isArray(val)&&prop.subType?this.outputArray_(out,val,prop.subType):this.output(out,val),first=!1}}out("}")},outputModel_:function(out,obj){out('model_:"'),obj.model_["package"]&&out(obj.model_["package"],"."),out(obj.model_.name,'"')},outputMap_:function(out,obj){var str="",first=!0;out("{");for(var key in obj){var val=obj[key];first||out(","),out(this.keyify(key),": "),this.output(out,val),first=!1}out("}")},outputArray_:function(out,a,opt_defaultModel){if(0==a.length)return out("[]"),out;var str="",first=!0;out("[");for(var i=0;i<a.length;i++,first=!1){var obj=a[i];first||out(","),this.output(out,obj,opt_defaultModel)}out("]")},outputFunction_:function(out,obj){out(obj)}},pretty:{__proto__:AbstractFormatter,output:function(out,obj,opt_defaultModel,opt_indent){var indent=opt_indent||"";Array.isArray(obj)?this.outputArray_(out,obj,null,indent):"string"==typeof obj?(out('"'),out(JSONUtil.escape(obj)),out('"')):obj instanceof Function?this.outputFunction_(out,obj,indent):obj instanceof Date?out(obj.getTime()):obj instanceof RegExp?out(obj.toString()):obj instanceof Object?obj.model_?this.outputObject_(out,obj,opt_defaultModel,indent):this.outputMap_(out,obj,indent):"number"==typeof obj?(isFinite(obj)||(obj=null),out(obj)):(void 0===obj&&(obj=null),out(obj))},outputObject_:function(out,obj,opt_defaultModel,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"   ",str="",first=!0;out(indent,"{\n"),obj.model_.id&&obj.model_.id!==opt_defaultModel&&(this.outputModel_(out,obj,nestedIndent),first=!1);var properties=obj.model_.getRuntimeProperties();for(var key in properties){var prop=properties[key];if(this.p(prop,obj)&&"parent"!==prop.name&&prop.name in obj.instance_){var val=obj[prop.name];if(Array.isArray(val)&&!val.length)continue;if(equals(val,prop.defaultValue))continue;first||out(",\n"),out(nestedIndent,this.keyify(prop.name),": "),Array.isArray(val)&&prop.subType?this.outputArray_(out,val,prop.subType,nestedIndent):this.output(out,val,null,nestedIndent),first=!1}}out("\n",indent,"}")},outputModel_:function(out,obj,indent){out(indent,'"model_": "',obj.model_.id,'"')},outputMap_:function(out,obj,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"   ",str="",first=!0;out(indent,"{\n",nestedIndent);for(var key in obj){var val=obj[key];first||out(",\n"),out(nestedIndent,this.keyify(key),": "),this.output(out,val,null,nestedIndent),first=!1}out("\n",indent,"}")},outputArray_:function(out,a,opt_defaultModel,opt_indent){
if(0==a.length)return out("[]"),out;var indent=opt_indent||"",nestedIndent=indent+"   ",str="",first=!0;out("[\n");for(var i=0;i<a.length;i++,first=!1){var obj=a[i];first||out(",\n"),this.output(out,obj,opt_defaultModel,nestedIndent)}out("\n",indent,"]")},outputFunction_:function(out,obj,indent){var str=obj.toString(),lines=str.split("\n");if(1==lines.length)return void out(str);for(var minIndent=1e4,i=0;i<lines.length;i++){for(var j=0;j<lines[i].length&&" "===lines[i].charAt(j)&&minIndent>j;j++);j>0&&minIndent>j&&(minIndent=j)}if(1e4===minIndent)return void out(str);for(var i=0;i<lines.length;i++)lines[i].length&&" "===lines[i].charAt(0)&&(lines[i]=indent+lines[i].substring(minIndent)),out(lines[i]),i<lines.length-1&&out("\n")}},moreCompact:{__proto__:AbstractFormatter},compressed:{__proto__:AbstractFormatter,stringify:function(obj){return Iuppiter.Base64.encode(Iuppiter.compress(JSONUtil.compact.stringify(obj),!0))}}};JSONUtil.prettyModel={__proto__:JSONUtil.pretty,outputModel_:function(out,obj,indent){out(indent,'model_: "',obj.model_.id,'"')},keys_:{},keyify:function(str){return this.keys_.hasOwnProperty(str)||(this.keys_[str]=/^[a-zA-Z\$_][0-9a-zA-Z$_]*$/.test(str)?str:'"'+str+'"'),this.keys_[str]}},JSONUtil.stringify=JSONUtil.pretty.stringify.bind(JSONUtil.pretty),JSONUtil.stringifyObject=JSONUtil.pretty.stringifyObject.bind(JSONUtil.pretty),JSONUtil.output=JSONUtil.pretty.output.bind(JSONUtil.pretty),JSONUtil.where=JSONUtil.pretty.where.bind(JSONUtil.pretty);var NOT_TRANSIENT=function(prop){return!prop["transient"]},XMLParser={__proto__:grammar,START:seq1(1,sym("whitespace"),sym("tag"),sym("whitespace")),tag:seq("<",sym("tagName"),sym("whitespace"),repeat(sym("attribute"),sym("whitespace")),sym("whitespace"),">",repeat(alt(sym("tag"),sym("text"))),"</",sym("tagName"),">"),label:str(plus(notChars(" =/	\r\n<>'\""))),tagName:sym("label"),text:str(plus(notChar("<"))),attribute:seq(sym("label"),"=",sym("value")),value:str(alt(seq1(1,'"',repeat(notChar('"')),'"'),seq1(1,"'",repeat(notChar("'")),"'"))),whitespace:repeat(alt(" ","	","\r","\n"))};XMLParser.addActions({tag:function(xs){if(xs[1]!=xs[8])return void 0;var obj={tag:xs[1],attrs:{},children:xs[6]};return xs[3].forEach(function(attr){obj.attrs[attr[0]]=attr[2]}),obj}});var XMLUtil={escape:function(str){return str&&str.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescape:function(str){return str&&str.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},escapeAttr:function(str){return str&&str.replace(/"/g,"&quot;")},unescapeAttr:function(str){return str&&str.replace(/&quot;/g,'"')},parse:function(str){var result=XMLParser.parseString(str);return result?this.parseArray(result.children):result},parseObject:function(tag){var obj={},self=this;if(tag.children.forEach(function(c){if("object"==typeof c&&c.attrs&&c.attrs.name){var result;if(c.attrs.type&&"function"==c.attrs.type){var code=XMLUtil.unescape(c.children.join(""));result=code.startsWith("function")?eval("("+code+")"):new Function(code)}else result=self.parseArray(c.children);obj[self.unescapeAttr(c.attrs.name)]=result}}),!tag.attrs.model)return obj;var model=this.unescapeAttr(tag.attrs.model);return GLOBAL[model]?GLOBAL[model].create(obj):obj},parseArray:function(a){var self=this,ret=[];return a.forEach(function(x){"object"==typeof x&&("i"==x.tag?ret.push(XMLUtil.unescape(x.children[0])):ret.push(self.parseObject(x)))}),ret.length?ret:XMLUtil.unescape(a.join(""))},compact:{stringify:function(obj){var buf=[];return this.output(buf.push.bind(buf),obj),"<foam>"+buf.join("")+"</foam>"},output:function(out,obj){Array.isArray(obj)?this.outputArray_(out,obj):"string"==typeof obj?out(XMLUtil.escape(obj)):obj instanceof Function?this.outputFunction_(out,obj):obj instanceof Date?out(obj.getTime()):obj instanceof Object?obj.model_?this.outputObject_(out,obj):this.outputMap_(out,obj):out(obj)},outputObject_:function(out,obj){out('<object model="',XMLUtil.escapeAttr(obj.model_.name),'">');var properties=obj.model_.getRuntimeProperties();for(var key in properties){var prop=properties[key];if("parent"!==prop.name&&obj.instance_&&prop.name in obj.instance_){var val=obj[prop.name];if(Array.isArray(val)&&0==val.length)continue;if(equals(val,prop.defaultValue))continue;out('<property name="',XMLUtil.escapeAttr(prop.name),'" '+("function"==typeof val?'type="function"':"")+">"),this.output(out,val),out("</property>")}}out("</object>")},outputMap_:function(out,obj){out("<object>");for(var key in obj){var val=obj[key];out('<property name="',XMLUtil.escapeAttr(key),'">'),this.output(out,val),out("</property>")}out("</object>")},outputArray_:function(out,a){if(0==a.length)return out;for(var i=0;i<a.length;i++,first=!1){var obj=a[i];"string"==typeof obj||"number"==typeof obj?out("<i>",XMLUtil.escape(obj),"</i>"):this.output(out,obj)}},outputFunction_:function(out,f){out(XMLUtil.escape(f.toString()))}},pretty:{stringify:function(obj){var buf=[];return this.output(buf.push.bind(buf),obj),"<foam>\n"+buf.join("")+"</foam>\n"},output:function(out,obj,opt_indent){var indent=opt_indent||"";if(Array.isArray(obj))this.outputArray_(out,obj,indent);else if("string"==typeof obj)out(XMLUtil.escape(obj));else if(obj instanceof Function)this.outputFunction_(out,obj,indent);else if(obj instanceof Date)out(obj.getTime());else if(obj instanceof Object)try{obj.model_&&"string"!=typeof obj.model_?this.outputObject_(out,obj,indent):this.outputMap_(out,obj,indent)}catch(x){console.log("toXMLError: ",x)}else out(obj)},outputObject_:function(out,obj,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"  ";out(indent,'<object model="',XMLUtil.escapeAttr(obj.model_.name),'">');var properties=obj.model_.getRuntimeProperties();for(var key in properties){var prop=properties[key];if("parent"!==prop.name&&obj.instance_&&prop.name in obj.instance_){var val=obj[prop.name];if(Array.isArray(val)&&0==val.length)continue;if(val==prop.defaultValue)continue;var type="function"==typeof obj[prop.name]?' type="function"':"";out("\n",nestedIndent,'<property name="',XMLUtil.escapeAttr(prop.name),'"',type,">"),this.output(out,val,nestedIndent),out("</property>")}}out("\n",indent,"</object>"),out("\n")},outputMap_:function(out,obj,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"  ";out(indent,"<object>");for(var key in obj){var val=obj[key];out("\n",nestedIndent,'<property name="',XMLUtil.escapeAttr(key),'">'),this.output(out,val,nestedIndent),out("</property>")}out("\n",indent,"</object>\n")},outputArray_:function(out,a,opt_indent){if(0==a.length)return out;for(var indent=opt_indent||"",nestedIndent=indent+"  ",i=0;i<a.length;i++,first=!1){var obj=a[i];out("\n"),"string"==typeof obj||"number"==typeof obj?out(nestedIndent,"<i>",XMLUtil.escape(obj),"</i>"):this.output(out,obj,nestedIndent)}out("\n",indent)},outputFunction_:function(out,f,opt_indent){out(XMLUtil.escape(f.toString())+"\n"+(opt_indent||""))}}};XMLUtil.stringify=XMLUtil.pretty.stringify.bind(XMLUtil.pretty),XMLUtil.output=XMLUtil.pretty.output.bind(XMLUtil.pretty),GLOBAL.lookupCache_={};var X={lookupCache_:GLOBAL.lookupCache_,sub:sub,subWindow:subWindow,set:set,lookup:lookup,setValue:setValue,GLOBAL:GLOBAL},foam=X.foam={},registerFactory=function(model,factory){},registerModelForModel=function(modelType,targetModel,model){},registerFactoryForModel=function(factory,targetModel,model){},JSONParser=SkipGrammar.create({__proto__:grammar,START:copyInput(sym("objAsString")),objAsString:copyInput(sym("obj")),obj:seq1(1,"{",repeat(sym("pair"),","),"}"),pair:seq(sym("key"),":",sym("value")),key:alt(sym("symbol"),sym("string")),symbol:noskip(str(seq(sym("char"),str(repeat(sym("alpha")))))),"char":alt(range("a","z"),range("A","Z"),"_","$"),alpha:alt(range("a","z"),range("A","Z"),"_","$",range("0","9")),value:simpleAlt(sym("null"),sym("undefined"),sym("function literal"),sym("expr"),sym("number"),sym("string"),sym("obj"),sym("bool"),sym("array")),"null":literal("null"),undefined:literal("undefined"),expr:str(seq(sym("symbol"),optional(str(alt(seq(".",sym("expr")),seq("(",str(repeat(sym("value"),",")),")")))))),number:noskip(seq(optional("-"),repeat(range("0","9"),null,1),optional(seq(".",repeat(range("0","9")))))),string:noskip(alt(sym("single quoted string"),sym("double quoted string"))),"double quoted string":seq1(1,'"',str(repeat(sym("double quoted char"))),'"'),"double quoted char":alt(sym("escape char"),literal('\\"','"'),notChar('"')),"single quoted string":seq1(1,"'",str(repeat(sym("single quoted char"))),"'"),"single quoted char":alt(sym("escape char"),literal("\\'","'"),notChar("'")),"escape char":alt(literal("\\\\","\\"),literal("\\n","\n")),bool:alt(literal("true",!0),literal("false",!1)),array:seq1(1,"[",repeat(sym("value"),","),"]"),"function prototype":seq("function",optional(sym("symbol")),"(",repeat(sym("symbol"),","),")"),"function literal":seq(sym("function prototype"),"{",repeat(notChar("}")),"}")}.addActions({obj:function(v){for(var m={},i=0;i<v.length;i++)m[v[i][0]]=v[i][2];return m},"null":function(){return null},undefined:function(){return void 0},number:function(v){var str="";return v[0]&&(str+=v[0]),str+=v[1].join(""),v[2]&&(str+=v[2][0]+v[2][1].join("")),v[2]?parseFloat(str):parseInt(str)}}),repeat0(alt(" ","	","\n","\r")));MODEL({name:"TemplateParser","extends":"grammar",methods:{START:sym("markup"),markup:repeat0(alt(sym("comment"),sym("foamTag"),sym("create child"),sym("simple value"),sym("live value tag"),sym("raw values tag"),sym("values tag"),sym("code tag"),sym("ignored newline"),sym("newline"),sym("single quote"),sym("text"))),comment:seq1(1,"<!--",repeat0(not("-->",anyChar)),"-->"),foamTag:sym("foamTag_"),foamTag_:function(){},"create child":seq("$$",repeat(notChars(" $\r\n<{,.")),optional(JSONParser["export"]("objAsString"))),"simple value":seq("%%",repeat(notChars(' ()-"\r\n><:;,')),optional("()")),"live value tag":seq("<%#",repeat(not("%>",anyChar)),"%>"),"raw values tag":alt(seq("<%=",repeat(not("%>",anyChar)),"%>"),seq("{{{",repeat(not("}}}",anyChar)),"}}}")),"values tag":seq("{{",repeat(not("}}",anyChar)),"}}"),"code tag":seq("<%",repeat(not("%>",anyChar)),"%>"),"ignored newline":alt(literal("\\\r\\\n"),literal("\\\n")),newline:alt(literal("\r\n"),literal("\n")),"single quote":literal("'"),text:anyChar}});var TemplateOutput={create:function(obj){console.assert(obj,"Owner required when creating TemplateOutput.");var buf=[],f=function templateOut(){for(var i=0;i<arguments.length;i++){var o=arguments[i];if("string"==typeof o)buf.push(o);else if(o&&"Element"===o.name_){var s=o.createOutputStream();o.output(s),buf.push(s.toString()),obj.addChild({initHTML:o.load.bind(o)})}else o&&o.toView_&&(o=o.toView_()),null!==o&&void 0!==o&&(o.appendHTML?o.appendHTML(this):o.toHTML?buf.push(o.toHTML()):buf.push(o),o.initHTML&&obj&&obj.addChild&&obj.addChild(o))}};return f.toString=function(){return 0===buf.length?"":(buf.length>1&&(buf=[buf.join("")]),buf[0])},f}},ConstantTemplate=function(str){var TemplateOutputCreate=TemplateOutput.create.bind(TemplateOutput),f=function(opt_out){var out=opt_out?opt_out:TemplateOutputCreate(this);return out(str),out.toString()};return f.toString=function(){return'ConstantTemplate("'+str.replace(/\n/g,"\\n").replace(/"/g,'\\"').replace(/\r/g,"")+'")'},f},TemplateCompiler={__proto__:TemplateParser,out:[],simple:!0,push:function(){this.simple=!1,this.pushSimple.apply(this,arguments)},pushSimple:function(){this.out.push.apply(this.out,arguments)}}.addActions({markup:function(v){var wasSimple=this.simple,ret=wasSimple?null:this.out.join("");return this.out=[],this.simple=!0,[wasSimple,ret]},"create child":function(v){var name=v[1].join("");this.push("', self.createTemplateView('",name,"'",v[2]?", "+v[2]:"","),\n'")},foamTag:function(e){var fName=e.getAttribute("f");fName?(this.push("', self.createTemplateView('",fName,"',{}).fromElement(FOAM("),this.push(JSONUtil.where(NOT_TRANSIENT).stringify(e)),this.push("))")):(this.push("', (function() { var tagView = X.foam.ui.FoamTagView.create({element: FOAM("),this.push(JSONUtil.where(NOT_TRANSIENT).stringify(e)),this.push(")}, Y); self.addDataChild(tagView); return tagView; })() ")),this.push(",\n'")},"simple value":function(v){this.push("',\n self.",v[1].join(""),v[2],",\n'")},"raw values tag":function(v){this.push("',\n",v[1].join(""),",\n'")},"values tag":function(v){this.push("',\nescapeHTML(",v[1].join(""),"),\n'")},"live value tag":function(v){this.push("',\nself.dynamicTag('span', function() { return ",v[1].join(""),"; }.bind(this)),\n'")},"code tag":function(v){this.push("');\n",v[1].join(""),";out('")},"single quote":function(){this.pushSimple("\\'")},newline:function(){this.pushSimple("\\n")},text:function(v){this.pushSimple(v)}});MODEL({name:"TemplateUtil",constants:{HEADER:"var self = this, X = this.X, Y = this.Y;var out = opt_out ? opt_out : TOC(this);out('",FOOTERS:{html:"');return out.toString();",css:"');return X.foam.grammars.CSSDecl.create({model:this.model_}).parser.parseString(out.toString());"}},methods:{lazyCompile:function(t){var delegate,f=function(){if(!delegate){if(!t.template)throw"Must arequire() template model before use for "+this.name_+"."+t.name;delegate=TemplateUtil.compile(Template.isInstance(t)?t:Template.create(t),this.model_)}return delegate.apply(this,arguments)};return f.toString=function(){return delegate?delegate.toString():t.toString()},f},compile_:function(t,code,model){for(var args=["opt_out"],i=0;i<t.args.length;i++)args.push(t.args[i].name);return eval("(function() { var escapeHTML = XMLUtil.escape, TOC = TemplateOutput.create.bind(TemplateOutput); return function("+args.join(",")+"){"+code+"};})()"+(model&&model.id?"\n\n//# sourceURL="+model.id.replace(/\./g,"/")+"."+t.name+"\n":""))},parseCSS:function(t,model){var parser=this.CSSParser_||(this.CSSParser_=X.foam.grammars.CSSDecl.create());return parser.model=model,parser.parser.parseString(t).toString()},parseU2:function(template,t,model){X.foam.u2.ElementParser.getPrototype();var parser=this.U2Parser_||(this.U2Parser_=X.foam.u2.ElementParser.parser__.create());parser.modelName_=cssClassize(model.id);var out=parser.parseString(t.trim(),"initE"===template.name?parser.initTemplate:parser.template);return out.toString()},compile:function(t,model){if("CSS"!==t.name){if(model.isSubModel(X.lookup("foam.u2.Element")))return eval("(function() { return "+this.parseU2(t,t.template,model)+"; })()");if(t.template.startsWith("#U2")){var code="(function() { return "+this.parseU2(t,t.template.substring(3),model)+"; })()";return eval(code)}}var parseResult=TemplateCompiler.parseString(t.template);if(parseResult[0])return ConstantTemplate("css"===t.language?this.parseCSS(t.template,model):t.template);var code=this.HEADER+parseResult[1]+this.FOOTERS[t.language];try{return this.compile_(t,code,model)}catch(err){return console.log("Template Error: ",err),console.log(parseResult),function(){}}},stringifyTemplate:function(template){return function(){var buf=[];return this.output(buf.push.bind(buf),obj),buf.join("")}},expandTemplate:function(self,t,opt_X){var X=opt_X||self.X;if("function"==typeof t)t=X.Template.create({name:t.name,args:t.toString().match(/\((.*?)\)/)[1].split(",").slice(1).map(function(a){return X.Arg.create({name:a.trim()})}),template:multiline(t)});else if("string"==typeof t)t=docTemplate=X.Template.create({name:"body",template:t});else if(t.template||t.code)"function"==typeof t.template&&(t.template=multiline(t.template));else{t=X.Template.create(t);var future=afuture(),path=self.sourcePath;if(t.futureTemplate=future.get,path=path.substring(0,path.lastIndexOf("/")+1),path+=t.path?t.path:self.name+"_"+t.name+".ft","undefined"!=typeof vm&&vm.runInThisContext){var fs=require("fs");fs.readFile(path,function(err,data){t.template=data.toString(),future.set(Template.create(t))})}else{var xhr=new XMLHttpRequest;xhr.open("GET",path),xhr.asend(function(data){t.template=data,future.set(Template.create(t))})}}return t.futureTemplate||(t.futureTemplate=aconstant(t)),t.template$||(t="undefined"!=typeof X.Template?JSONUtil.mapToObj(X,t,X.Template):t),t},expandModelTemplates:function(self){for(var templates=self.templates,i=0;i<templates.length;i++)templates[i]=TemplateUtil.expandTemplate(self,templates[i])}}});var aeval=function(src){return aconstant(eval("("+src+")"))},aevalTemplate=function(t,model){return aseq(t.futureTemplate,function(ret,t){ret(TemplateUtil.lazyCompile(t))})},escapeHTML=XMLUtil.escape,TOC=TemplateOutput.create.bind(TemplateOutput),$documents=[];window&&$documents.push(window.document);var $WID__=0,$=function(id){console.log("Deprecated use of GLOBAL.$.");for(var i=0;i<$documents.length;i++){if(document.FOAM_OBJECTS&&document.FOAM_OBJECTS[id])return document.FOAM_OBJECTS[id];var ret=$documents[i].getElementById(id);if(ret)return ret}return void 0},$$=function(cls){console.log("Deprecated use of GLOBAL.$$.");for(var i=0;i<$documents.length;i++){var ret=$documents[i].getElementsByClassName(cls);if(ret.length>0)return ret}return[]},FOAM=function(map,opt_X,seq){var obj=JSONUtil.mapToObj(opt_X||X,map,void 0,seq);return obj};FOAM.putFactory=function(ctx,name,factory){ctx.__defineGetter__(name,function(){return console.log("Bouncing Factory: ",name),delete ctx[name],ctx[name]=factory()})};var USED_MODELS={},UNUSED_MODELS={},NONMODEL_INSTANCES={};FOAM.browse=function(model,opt_dao,opt_X){var Y=opt_X||X.sub(void 0,"FOAM BROWSER");"string"==typeof model&&(model=Y[model]);var dao=opt_dao||Y[model.name+"DAO"]||Y[model.plural];dao||(Y[model.name+"DAO"]=[].dao);var ctrl=Y.foam.ui.DAOController.create({model:model,dao:dao,useSearchView:!1});if(Y.stack)Y.stack.pushView(ctrl);else{var w=opt_X?opt_X.window:window;Y.stack=Y.foam.ui.StackView.create();var win=Y.foam.ui.layout.Window.create({window:w,data:Y.stack},Y);document.body.insertAdjacentHTML("beforeend",win.toHTML()),win.initHTML(),Y.stack.setTopView(ctrl)}};var arequire=function(modelName){var THIS=this===GLOBAL?X:this,model=THIS.lookup(modelName);if(!model){if(!THIS.ModelDAO)return aconstant();if(THIS.arequire$ModelLoadsInProgress){if(THIS.arequire$ModelLoadsInProgress[modelName])return THIS.arequire$ModelLoadsInProgress[modelName]}else THIS.set("arequire$ModelLoadsInProgress",{});var future=afuture();return THIS.arequire$ModelLoadsInProgress[modelName]=future.get,THIS.ModelDAO.find(modelName,{put:function(m){m.X=THIS;var next_=function(m){THIS.arequire$ModelLoadsInProgress[modelName]=!1,THIS.GLOBAL.X.registerModel(m),THIS.lookupCache_[m.id]||(THIS.lookupCache_[m.id]=m),future.set(m)};m.arequire?m.arequire()(next_):next_(m)},error:function(){var args=argsToArray(arguments);"DocumentationProperty"!==modelName&&console.warn.apply(console,["Could not load model: ",modelName].concat(args)),THIS.arequire$ModelLoadsInProgress[modelName]=!1,future.set(void 0)}}),future.get}return model.arequire?model.arequire():aconstant(model)},FOAM_POWERED='<a style="text-decoration:none;" href="https://github.com/foam-framework/foam/" target="_blank"><font size=+1 face="catull" style="text-shadow:rgba(64,64,64,0.3) 3px 3px 4px;"><font color="#3333FF">F</font><font color="#FF0000">O</font><font color="#FFCC00">A</font><font color="#33CC00">M</font><font color="#555555" > POWERED</font></font></a>',CLASS=function(m){function registerModelLatch(path,m){var id=m["package"]?m["package"]+"."+m.name:m.name;if(EAGER[id]){USED_MODELS[id]=!0;var work=[],model=JSONUtil.mapToObj(X,m,Model,work);return work.length>0&&(model.extra__=aseq.apply(null,work)),X.registerModel(model,void 0,!0),model}GLOBAL.lookupCache_[id]=void 0,UNUSED_MODELS[id]=!0;var triggered=!1;Object.defineProperty(m["package"]?path:GLOBAL,m.name,{get:function triggerModelLatch(){if(triggered)return null;triggered=!0,USED_MODELS[id]=!0,UNUSED_MODELS[id]=void 0;var work=[],model=JSONUtil.mapToObj(X,m,Model,work);return work.length>0&&(model.extra__=aseq.apply(null,work)),X.registerModel(model),model},configurable:!0})}var EAGER={Method:!0,BooleanProperty:!0,Action:!0,FunctionProperty:!0,Constant:!0,Message:!0,ArrayProperty:!0,StringArrayProperty:!0,Template:!0,Arg:!0,Relationship:!0,ViewFactoryProperty:!0,FactoryProperty:!0,"foam.ui.Window":!0,StringProperty:!0,"foam.html.Element":!0,Expr:!0,AbstractDAO:!0};document&&document.currentScript&&(m.sourcePath=document.currentScript.src),registerModelLatch(packagePath(X,m["package"]),m)},MODEL=CLASS;X.$=$,X.$$=$$,X.registerModel=registerModel,X.arequire=arequire,X.onRegisterModel=onRegisterModel;var FObject={__proto__:PropertyChangeSupport,name_:"FObject",get Y(){return Object.prototype.hasOwnProperty.call(this,"Y_")?this.Y_:this.Y_=DEBUG?this.X.sub({},(this.X.NAME?this.X.NAME:"")+"_"+this.name_):this.X.sub()},replaceModel_:function(feature,dataModel,X){replacementName=(dataModel["package"]?dataModel["package"]+".":"")+(dataModel.name?dataModel.name:dataModel)+feature.name;var replacementModel=X.lookup(replacementName);return replacementModel?replacementModel:void 0},create_:function(){return Object.create(this)},create:function(args,opt_X){var dataModel=args?args.model?args.model:args.data?args.data.model_:void 0:void 0;if(dataModel&&(opt_X||X).Model.isInstance(dataModel)){var ret=this.replaceModel_(this.model_,dataModel,opt_X||X);if(ret)return ret.create(args,opt_X)}var o=this.create_(this);for(o.instance_={};!o.instance_;)o.instance_={};if(o.X=opt_X||X,this.model_.instance_.imports_&&this.model_.instance_.imports_.length){Object.prototype.hasOwnProperty.call(this,"imports__")||(this.imports__=this.model_.instance_.imports_.map(function(e){var s=e.split(" as ");return[s[0],s[1]||s[0]]}));for(var i=0;i<this.imports__.length;i++){var im=this.imports__[i];args&&args.hasOwnProperty(im[1])||"undefined"==typeof o.X[im[0]]||(o[im[1]]=o.X[im[0]])}}if(o.model_)for(var agents=this.initAgents(),i=0;i<agents.length;i++)agents[i][1](o,o.X,args);return o.init(args),o},init:nop,xbind:function(map){var newModel={__proto__:this,create:function(args,X){var createArgs={},key;args=args?args.instance_||args:{};for(key in args)args.hasOwnProperty(key)&&(createArgs[key]=args[key]);for(key in map)createArgs.hasOwnProperty(key)||(createArgs[key]=map[key]);return this.__proto__.create(createArgs,X)},xbind:function(m2){for(var key in map)m2.hasOwnProperty(key)||(m2[key]=map[key]);return this.__proto__.xbind(m2)}};return this.required__&&(newModel.required__=aseq(this.required__,aconstant(newModel))),newModel},X:X,addInitAgent:function(priority,desc,agent){agent.toString=function(){return desc},this.initAgents_.push([priority,agent])},initAgents:function(){if(this.model_){if(!Object.hasOwnProperty.call(this,"initAgents_")){var agents=this.initAgents_=[],self=this;Object_forEach(this.model_.instance_.exports_,function(e){var exp=e.split("as ");if(0!=exp.length){var key=exp[0].trim(),alias=exp[1]||exp[0];if(key){var asValue="$"!==key&&"$$"!=key&&"$"==key.charAt(key.length-1);asValue&&console.warn("Deprecated use of value$ export. Just remove the $. ",self.model_.id,this.name,key,alias),asValue&&(key=key.slice(0,key.length-1));var prop=self.model_.getProperty(key);prop?asValue?self.addInitAgent(1,"export property value "+key,function(o,X){o.Y.set(alias,o[prop.name$_])}):self.addInitAgent(1,"export property "+key,function(o,X){o.Y.setValue(alias,o[prop.name$_])}):self.addInitAgent(0,"export other "+key,function(o,X){var out="function"==typeof o[key]?o[key].bind(o):o[key];o.Y.set(alias,out)})}else self.addInitAgent(0,"export this",function(o,X){o.Y.set(alias,o)})}});var fastInit={Property:!0,Method:!0}[this.name_];if(fastInit){for(var keys={},ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var prop=ps[i];keys[prop.name]=keys[prop.name$_]=!0}this.addInitAgent(0,"fast copy args",function fastCopyArgs(o,X,m){if(m)if(m.instance_){m=m.instance_;for(var key in m)o[key]=m[key]}else for(var key in m)keys[key]&&(o[key]=m[key])})}for(var ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var prop=ps[i];prop.initPropertyAgents?prop.initPropertyAgents(self,fastInit):!function(name){self.addInitAgent(0,"set proto-property "+name,function setProtoProperty(o,X,m){m&&m.hasOwnProperty(name)&&(o[name]=m[name])})}(prop.name)}self.addInitAgent(0,"Add create() to Model",function(o,X){Model.isInstance(o)&&"Model"!=o.name&&(o.create=BootstrapModel.create)});for(var i=0;i<agents.length;i++)agents[i][2]=i;agents.sort(CompoundComparator(function(o1,o2){return o1[0]-o2[0]},function(o1,o2){return o1[2]-o2[2]}))}return this.initAgents_}},fromElement:function(e){var RESERVED_ATTRS={id:!0,model:!0,view:!0,showactions:!0,oninit:!0},elements=this.elementMap_;if(!elements){elements={};for(var properties=this.model_.getRuntimeProperties(),i=0;i<properties.length;i++){var p=properties[i];RESERVED_ATTRS[p.name]||(elements[p.name]=p,elements[p.name.toUpperCase()]=p),elements["p:"+p.name]=p,elements["P:"+p.name.toUpperCase()]=p}this.elementMap_=elements}for(var i=0;i<e.attributes.length;i++){var attr=e.attributes[i],p=elements[attr.name]||elements[attr.name.toUpperCase()],val=attr.value;if(p)if(val.startsWith("#")){val=val.substring(1);var $val=this.X.$(val);$val?this[attr.name]=this.X.$(val):this[p.name]=p.fromString(val)}else this[p.name]=p.fromString(val);else RESERVED_ATTRS[attr.name]||console.warn('Unknown attribute name: "'+attr.name+'"')}for(var i=0;i<e.children.length;i++){var c=e.children[i],p=elements[c.nodeName];p?p.fromElement.call(this,c,p):console.warn('Unknown element name: "'+c.nodeName+'"')}return this},createFOAMGetter:function(name,getter){var stack=Events.onGet.stack;return function FOAMGetter(){var value=getter.call(this,name),f=stack[0];return f&&f(this,name,value),value}},createFOAMSetter:function(name,setter){var stack=Events.onSet.stack;return function FOAMSetter(newValue){var f=stack[0];(!f||f(this,name,newValue))&&setter.call(this,newValue,name)}},toString:function(){return this.model_.name+"Prototype"},hasOwnProperty:function(name){return"undefined"!=typeof this.instance_[name]},writeActions:function(other,out){for(var properties=this.model_.getRuntimeProperties(),i=0,property;property=properties[i];i++)if(property.actionFactory)for(var actions=property.actionFactory(this,property.f(this),property.f(other)),j=0;j<actions.length;j++)out(actions[j])},validateObject:function(){for(var ret=null,ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var p=ps[i];if(p.validate){var e=p.validate.call(this);e&&(ret||(ret=[])).push([p,e])}}return ret},isValid:function(){return!this.validateObject()},equals:function(other){return 0==this.compareTo(other)},compareTo:function(other){if(other===this)return 0;if(this.model_!==other.model_)return this.model_.id.compareTo(other.model_&&other.model_.id)||1;for(var ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var r=ps[i].compare(this,other);if(r)return r}return 0},diff:function(other){for(var diff={},properties=this.model_.getRuntimeProperties(),i=0,property;property=properties[i];i++)if(Array.isArray(property.f(this))){var subdiff=property.f(this).diff(property.f(other));(0!==subdiff.added.length||0!==subdiff.removed.length)&&(diff[property.name]=subdiff)}else 0!==property.compare(this,other)&&(diff[property.name]=property.f(other));return diff},clearProperty:function(name){delete this.instance_[name]},defineProperty:function(prop){var name=prop.name;prop.name$_=name+"$",this[constantize(prop.name)]=prop;var obj=DEBUG?this:__ROOT__;obj.__lookupGetter__(prop.name$_)||Object.defineProperty(obj,prop.name$_,{get:function getValue(){return this.propertyValue(name)},set:function setValue(value){Events.link(value,this.propertyValue(name))},configurable:!0});var pgetter,psetter;if(prop.getter)pgetter=this.createFOAMGetter(name,prop.getter);else{if(prop.lazyFactory||prop.factory){var f=prop.lazyFactory||prop.factory;getter=function factory(){if("undefined"==typeof this.instance_[name]){this.instance_[name]=null;var val=f.call(this,prop);"undefined"==typeof val&&(val=null),this[name]=val}return this.instance_[name]}}else if(prop.defaultValueFn){var f=prop.defaultValueFn;getter=function defaultValueFn(){return"undefined"!=typeof this.instance_[name]?this.instance_[name]:f.call(this,prop)}}else{var defaultValue=prop.defaultValue;getter=function getInstanceVar(){return"undefined"!=typeof this.instance_[name]?this.instance_[name]:defaultValue}}pgetter=this.createFOAMGetter(name,getter)}if(prop.setter)psetter=this.createFOAMSetter(name,prop.setter);else{var setter=function setInstanceValue(oldValue,newValue){this.instance_[name]=newValue};("int"===prop.type||"float"===prop.type)&&(setter=function(setter){return function numberSetter(oldValue,newValue){setter.call(this,oldValue,"number"!=typeof newValue?Number(newValue):newValue)}}(setter)),prop.onDAOUpdate&&(setter="string"==typeof prop.onDAOUpdate?function(setter,onDAOUpdate,listenerName){return function onDAOUpdateSetter(oldValue,newValue){setter.call(this,oldValue,newValue);var listener=this[listenerName]||(this[listenerName]=this[onDAOUpdate].bind(this));oldValue&&oldValue.unlisten(listener),newValue&&(newValue.listen(listener),listener())}}(setter,prop.onDAOUpdate,prop.name+"_onDAOUpdate"):function(setter,onDAOUpdate,listenerName){return function onDAOUpdateSetter2(oldValue,newValue){setter.call(this,oldValue,newValue);var listener=this[listenerName]||(this[listenerName]=onDAOUpdate.bind(this));oldValue&&oldValue.unlisten(listener),newValue&&(newValue.listen(listener),listener())}}(setter,prop.onDAOUpdate,prop.name+"_onDAOUpdate")),prop.postSet&&(setter=function(setter,postSet){return function postSetSetter(oldValue,newValue){setter.call(this,oldValue,newValue),postSet.call(this,oldValue,newValue,prop)}}(setter,prop.postSet));var propertyTopic=PropertyChangeSupport.propertyTopic(name);setter=function(setter){return function propertyChangeSetter(oldValue,newValue){setter.call(this,oldValue,newValue),this.propertyChange_(propertyTopic,oldValue,newValue)}}(setter),prop.preSet&&(setter=function(setter,preSet){return function preSetSetter(oldValue,newValue){setter.call(this,oldValue,preSet.call(this,oldValue,newValue,prop))}}(setter,prop.preSet)),prop.adapt&&(setter=function(setter,adapt){return function adaptSetter(oldValue,newValue){setter.call(this,oldValue,adapt.call(this,oldValue,newValue,prop))}}(setter,prop.adapt)),prop.regex&&(setter=function(setter,name,regex){return function regexValidator(oldValue,newValue){if(!newValue||"string"!=typeof newValue||!newValue.match(regex))throw'Invalid Property value for "'+name+'", "'+newValue+'" violates regex: '+regex;setter.call(this,oldValue,newValue)}}(setter,prop.name,prop.regex)),setter=function(setter,defaultValue){return function setInstanceVar(newValue){setter.call(this,"undefined"==typeof this.instance_[name]?defaultValue:this.instance_[name],newValue)}}(setter,prop.defaultValue),psetter=this.createFOAMSetter(name,setter)}Object.defineProperty(this,name,{get:pgetter,set:psetter,configurable:!0}),prop.install&&prop.install.call(this,prop)},addMethod:function(name,method){this.__proto__[name]?override(this,name,method):this[name]=method},hashCode:function(){for(var hash=17,properties=this.model_.getRuntimeProperties(),i=0;i<properties.length;i++){var prop=this[properties[i].name],code=prop?prop.hashCode?prop.hashCode():prop.toString().hashCode():0;hash=(hash<<5)-hash+code,hash&=hash}return hash},toProtobuf:function(){var out=ProtoWriter.create();return this.outProtobuf(out),out.value},outProtobuf:function(out){for(var proprties=this.model_getRuntimeProperties(),i=0;i<properties.length;i++){var prop=properties[i];Number.isFinite(prop.prototag)&&prop.outProtobuf(this,out)}},clone:function(){var m={};for(var key in this.instance_){var value=this[key];if(void 0!==value){var prop=this.model_.getProperty(key);prop&&prop.cloneProperty?prop.cloneProperty.call(prop,value,m):prop.model_||(m[key]=value)}}return this.model_.create(m,this.X)},deepClone:function(){var m={};for(var key in this.instance_){var value=this[key];if(void 0!==value){var prop=this.model_.getProperty(key);prop&&prop.deepCloneProperty&&prop.deepCloneProperty.call(prop,value,m);
}}return this.model_.create(m,this.X)},copyFrom:function(src){if(src&&this.model_)for(var ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var prop=ps[i];src.hasOwnProperty(prop.name)&&(this[prop.name]=src[prop.name]),src.hasOwnProperty(prop.name$_)&&(this[prop.name$_]=src[prop.name$_])}return this},output:function(out){return JSONUtil.output(out,this)},toJSON:function(){return JSONUtil.stringify(this)},toXML:function(){return XMLUtil.stringify(this)},write:function(opt_X,opt_view){(opt_X||this.X).writeView(this.defaultView(opt_view))},defaultView:function(opt_view){return(opt_view||X.foam.ui.DetailView).create({model:this.model_,data:this,showActions:!0})},decorate:function(name,func,that){var delegate=this[name];return this[name]=function(){return func.call(this,that,delegate.bind(this),arguments)},this},addDecorator:function(decorator){decorator.decorateObject&&decorator.decorateObject(this);for(var i=0;i<decorator.model_.methods.length;i++){var method=decorator.model_.methods[i];"decorateObject"!==method.name&&this.decorate(method.name,method.code,decorator)}return this}};this.Constant=null,this.Method=null,this.Action=null,this.Relationship=null;var CCC=0,BootstrapModel={__proto__:PropertyChangeSupport,name_:"BootstrapModel <startup only, error if you see this>",addTraitToModel_:function(traitModel,parentModel){var parentName=parentModel&&parentModel.id?parentModel.id.replace(/\./g,"__"):"",traitName=traitModel.id?traitModel.id.replace(/\./g,"__"):"",name=parentName+"_ExtendedWith_"+traitName;if(!lookup(name)){var models=traitModel.models;traitModel=traitModel.clone(),traitModel["package"]="",traitModel.name=name,traitModel["extends"]=parentModel&&parentModel.id,traitModel.models=models,traitModel.X.registerModel(traitModel)}var ret=traitModel.X.lookup(name);return console.assert(ret,"Error adding Trait to Model, unknown name: ",name),ret},createMethod_:function(X,name,fn){var method=Method.create({name:name,code:fn});if(FEATURE_ENABLED(["debug"])&&Arg){var str=fn.toString(),match=str.match(/^function[ _$\w]*\(([ ,\w]+)/);match&&(method.args=match[1].split(",").map(function(name){return Arg.create({name:name.trim()})}))}return method},buildProtoImports_:function(props){Object_forEach(this.instance_.imports_,function(i){var imp=i.split(" as "),key=imp[0],alias=imp[1]||imp[0];if(alias.length&&"$"==alias.charAt(alias.length-1)&&(alias=alias.slice(0,alias.length-1)),!this.getProperty(alias)){var prop=ImportedProperty.create({name:alias});props.push(prop)}}.bind(this))},buildProtoProperties_:function(cls,extendsModel,props){for(var i=0;i<props.length;i++){var p=props[i];if(extendsModel){var superProp=extendsModel.getProperty(p.name);if(superProp){var p0=p;p=superProp.clone().copyFrom(p),p0.adapt&&superProp.adapt&&(p.adapt=function(a1,a2){return function(oldValue,newValue,prop){return a2.call(this,oldValue,a1.call(this,oldValue,newValue,prop),prop)}}(p0.adapt,superProp.adapt)),p0.preSet&&superProp.preSet&&(p.preSet=function(a1,a2){return function(oldValue,newValue,prop){return a2.call(this,oldValue,a1.call(this,oldValue,newValue,prop),prop)}}(p0.preSet,superProp.preSet)),p0.postSet&&superProp.postSet&&(p.postSet=function(a1,a2){return function(oldValue,newValue,prop){a2.call(this,oldValue,newValue,prop),a1.call(this,oldValue,newValue,prop)}}(p0.postSet,superProp.postSet)),props[i]=p,this[constantize(p.name)]=p}}cls.defineProperty(p)}this.propertyMap_=null},buildProtoMethods_:function(cls){if(Array.isArray(this.methods))for(var i=0;i<this.methods.length;i++){var m=this.methods[i];"function"==typeof m?cls.addMethod(m.name,m):cls.addMethod(m.name,m.code)}else for(key in this.methods){var m=this.methods[key];Method&&Method.isInstance(m)?cls.addMethod(m.name,m.generateFunction()):cls.addMethod(key,m)}},buildPrototype:function(){if(_DOC_&&BootstrapModel.saveDefinition(this),this["extends"]&&!this.X.lookup(this["extends"]))throw new Error("Unknown Model in extends: "+this["extends"]);var extendsModel=this["extends"]&&this.X.lookup(this["extends"]);if(this.traits)for(var i=0;i<this.traits.length;i++){var trait=this.traits[i],traitModel=this.X.lookup(trait);console.assert(traitModel,"Unknown trait: "+trait),traitModel?extendsModel=this.addTraitToModel_(traitModel,extendsModel):console.warn("Missing trait: ",trait,", in Model: ",this.name)}var proto=extendsModel?extendsModel.getPrototype():FObject,cls=Object.create(proto);cls.model_=this,cls.name_=this.name,this.models&&Object_forEach(this.models,function(m){if(this[m.name]){var model=this[m.name];defineLocalProperty(cls,m.name,function(){var Y=this.Y;return{__proto__:model,create:function(args,opt_X){return model.create(args,opt_X||Y)}}})}}.bind(this)),Object_forEach(this.requires,function(i){var imp=i.split(" as "),m=imp[0],path=m.split("."),key=imp[1]||path[path.length-1];defineLocalProperty(cls,key,function(){var Y=this.Y,model=this.X.lookup(m);return console.assert(model,"Unknown Model: "+m+" in "+this.name_),{__proto__:model,create:function(args,X){return model.create(args,X||Y)}}})});var props=this.instance_.properties_=this.properties?this.properties.clone():[];if(this.instance_.imports_=this.imports,extendsModel&&(this.instance_.imports_=this.instance_.imports_.concat(extendsModel.instance_.imports_)),this.buildProtoImports_(props),this.buildProtoProperties_(cls,extendsModel,props),extendsModel){for(var i=0;i<extendsModel.instance_.properties_.length;i++){var p=extendsModel.instance_.properties_[i],name=constantize(p.name);this[name]||(this[name]=p)}for(i=0;i<extendsModel.relationships.length;i++){var r=extendsModel.relationships[i],name=constantize(r.name);this[name]||(this[name]=r)}}if(this.instance_.exports_=this.exports?this.exports.clone():[],extendsModel&&(this.instance_.exports_=this.instance_.exports_.concat(extendsModel.instance_.exports_)),this.templates&&Object_forEach(this.templates,function(t){cls.addMethod(t.name,t.code?t.code:TemplateUtil.lazyCompile(t))}),this.instance_.actions_=this.actions?this.actions.clone():[],this.actions)for(var i=0;i<this.actions.length;i++)(function(a){if(extendsModel){var superAction=extendsModel.getAction(a.name);superAction&&(a=superAction.clone().copyFrom(a))}this.instance_.actions_[i]=a,Object.prototype.hasOwnProperty.call(cls,constantize(a.name))||(cls[constantize(a.name)]=a),this[constantize(a.name)]=a,cls.addMethod(a.name,function(opt_x){a.maybeCall(opt_x||this.X,this)})}).bind(this)(this.actions[i]);var key;if(this.constants)for(var i=0;i<this.constants.length;i++){var c=this.constants[i];cls[c.name]=this[c.name]=c.value}this.messages&&this.messages.length>0&&GLOBAL.Message&&Object_forEach(this.messages,function(m,key){Message.isInstance(m)||(m=this.messages[key]=Message.create(m));var clsProps={},mdlProps={},constName=constantize(m.name);clsProps[m.name]={get:function(){return m.value}},clsProps[constName]={value:m},mdlProps[constName]={value:m},Object.defineProperties(cls,clsProps),Object.defineProperties(this,mdlProps)}.bind(this)),this.buildProtoMethods_(cls);var self=this;this.instance_.relationships_=this.relationships,extendsModel&&(this.instance_.relationships_=this.instance_.relationships_.concat(extendsModel.instance_.relationships_)),this.relationships&&this.relationships.forEach(function(r){var name=constantize(r.name);self[name]||(self[name]=r),defineLazyProperty(cls,r.name,function(){var m=this.X.lookup(r.relatedModel),name=daoize(m.name),dao=this.X[name];return dao||console.error("Relationship "+r.name+" needs "+name+" in the context, and it was not found."),dao=RelationshipDAO.create({delegate:dao,relatedProperty:m.getProperty(r.relatedProperty),relativeID:this.id}),{get:function(){return dao},configurable:!0}})});var createListenerTrampoline=function(cls,name,fn,isMerged,isFramed,whenIdle){console.assert(fn,"createListenerTrampoline: fn not defined"),fn.name=name,Object.defineProperty(cls,name,{get:function(){var l=fn.bind(this);return whenIdle&&(l=Movement.whenIdle(l)),isFramed?l=EventService.framed(l,this.X):isMerged&&(l=EventService.merged(l,isMerged===!0?void 0:isMerged,this.X)),Object.defineProperty(this,name,{configurable:!0,value:l}),l},configurable:!0})};if(Array.isArray(this.listeners))for(var i=0;i<this.listeners.length;i++){var l=this.listeners[i];createListenerTrampoline(cls,l.name,l.code,l.isMerged,l.isFramed,l.whenIdle)}else this.listeners&&Object_forEach(this.listeners,function(l,key){createListenerTrampoline(cls,key,l)});if(this.topics&&Object_forEach(this.topics,function(t){}),extendsModel){this.getProperty("");for(var ips=[],ps=extendsModel.instance_.properties_,i=0;i<ps.length;i++){var p=ps[i];this.getProperty(p.name)||(ips.push(p),this.propertyMap_[p.name]=p)}ips.length&&(this.instance_.properties_=ips.concat(this.instance_.properties_));for(var ias=[],as=extendsModel.instance_.actions_,i=0;i<as.length;i++){var a=as[i];this.getAction&&this.getAction(a.name)||ias.push(a)}ias.length&&(this.instance_.actions_=ias.concat(this.instance_.actions_))}if(this.instance_.properties_.length>0&&!cls.__lookupGetter__("id")){var primaryKey=this.ids;1==primaryKey.length?(cls.__defineGetter__("id",function(){return this[primaryKey[0]]}),cls.__defineSetter__("id",function(val){this[primaryKey[0]]=val})):primaryKey.length>1&&(cls.__defineGetter__("id",function(){return primaryKey.map(function(key){return this[key]}.bind(this))}),cls.__defineSetter__("id",function(val){primaryKey.map(function(key,i){this[key]=val[i]}.bind(this))}))}return cls},getAllRequires:function(){function setModel(o){o&&o.model_&&(requires[o.model_.id]=!0)}var requires={};return this.requires.forEach(function(r){requires[r.split(" ")[0]]=!0}),this.traits.forEach(function(t){requires[t]=!0}),this["extends"]&&(requires[this["extends"]]=!0),this.properties.forEach(setModel),this.actions.forEach(setModel),this.templates.forEach(setModel),this.listeners.forEach(setModel),Object.keys(requires)},getPrototype:function(){return this.instance_.prototype_||(this.instance_.prototype_=this.buildPrototype(),this.onLoad&&this.onLoad()),this.instance_.prototype_},saveDefinition:function(self){self.definition_={},Array.isArray(self.methods)&&(self.definition_.methods=[].concat(self.methods)),Array.isArray(self.templates)&&(self.definition_.templates=[].concat(self.templates)),Array.isArray(self.relationships)&&(self.definition_.relationships=[].concat(self.relationships)),Array.isArray(self.properties)&&(self.definition_.properties=[].concat(self.properties)),Array.isArray(self.actions)&&(self.definition_.actions=[].concat(self.actions)),Array.isArray(self.listeners)&&(self.definition_.listeners=[].concat(self.listeners)),Array.isArray(self.models)&&(self.definition_.models=[].concat(self.models)),Array.isArray(self.tests)&&(self.definition_.tests=[].concat(self.tests)),Array.isArray(self.issues)&&(self.definition_.issues=[].concat(self.issues)),self.definition_.__proto__=FObject},create:function(args,opt_X){return"Model"===this.name?FObject.create.call(this.getPrototype(),args,opt_X):this.getPrototype().create(args,opt_X)},isSubModel:function(model){if(!model||!model.getPrototype)return!1;var subModels_=this.subModels_||(this.subModels_={});return subModels_.hasOwnProperty(model.id)||(subModels_[model.id]=model.getPrototype()===this.getPrototype()||this.isSubModel(model.getPrototype().__proto__.model_)),subModels_[model.id]},getRuntimeProperties:function(){return this.instance_.properties_||this.getPrototype(),this.instance_.properties_},getRuntimeActions:function(){return this.instance_.actions_||this.getPrototype(),this.instance_.actions_},getRuntimeRelationships:function(){return this.instance_.relationships_||this.getPrototype(),this.instance_.relationships_},getProperty:function(name){if(!this.propertyMap_){for(var m=this.propertyMap_={},properties=this.getRuntimeProperties(),i=0;i<properties.length;i++){var prop=properties[i];m[prop.name]=prop}this.propertyMap_=m}return this.propertyMap_[name]},getAction:function(name){for(var i=0;i<this.instance_.actions_.length;i++)if(this.instance_.actions_[i].name===name)return this.instance_.actions_[i]},hashCode:function(){var string="",properties=this.getRuntimeProperties();for(var key in properties)string+=properties[key].toString();return string.hashCode()},isInstance:function(obj){return obj&&obj.model_&&this.isSubModel(obj.model_)},toString:function(){return"BootstrapModel("+this.name+")"},arequire:function(){if(this.required__)return this.required__;var future=afuture();this.required__=future.get;var go=function(){var args=[],model=this,i;if(this["extends"]&&args.push(this.X.arequire(this["extends"])),this.models)for(i=0;i<this.models.length;i++)args.push(this.models[i].arequire());if(this.traits)for(i=0;i<this.traits.length;i++)args.push(this.X.arequire(this.traits[i]));if(this.templates)for(i=0;i<this.templates.length;i++){var t=this.templates[i];args.push(aif(!t.code,aseq(aevalTemplate(this.templates[i],this),function(t){return function(ret,m){t.code=m,ret()}}(t))))}if(args.length&&(args=[aseq.apply(null,args)]),this.requires)for(var i=0;i<this.requires.length;i++){var r=this.requires[i],m=r.split(" as ");m[0]==this.id?console.warn("Model requires itself: "+this.id):args.push(this.X.arequire(m[0]))}args.push(function(ret){this.X.i18nModel?this.X.i18nModel(ret,this,this.X):ret()}.bind(this)),aseq.apply(null,args)(function(){this.finished__=!0,future.set(this)}.bind(this))}.bind(this);return this.extra__?this.extra__(go):go(),this.required__},getMyFeature:function(featureName){function add(a){if(a)for(var i=0;i<a.length;i++){var f=a[i];map[f.name.toUpperCase()]=f}}if(!Object.prototype.hasOwnProperty.call(this,"featureMap_")){var map=this.featureMap_={};add(this.getRuntimeProperties()),add(this.instance_.actions_),add(this.methods),add(this.listeners),add(this.templates),add(this.models),add(this.tests),add(this.relationships),add(this.issues)}return this.featureMap_[featureName.toUpperCase()]},getRawFeature:function(featureName){function add(a){if(a)for(var i=0;i<a.length;i++){var f=a[i];map[f.name.toUpperCase()]=f}}if(!Object.prototype.hasOwnProperty.call(this,"rawFeatureMap_")){var map=this.featureMap_={};add(this.properties),add(this.actions),add(this.methods),add(this.listeners),add(this.templates),add(this.models),add(this.tests),add(this.relationships),add(this.issues)}return this.featureMap_[featureName.toUpperCase()]},getAllMyRawFeatures:function(){var featureList=[],arrayOrEmpty=function(arr){return arr&&Array.isArray(arr)?arr:[]};return[arrayOrEmpty(this.properties),arrayOrEmpty(this.actions),arrayOrEmpty(this.methods),arrayOrEmpty(this.listeners),arrayOrEmpty(this.templates),arrayOrEmpty(this.models),arrayOrEmpty(this.tests),arrayOrEmpty(this.relationships),arrayOrEmpty(this.issues)].map(function(list){featureList=featureList.concat(list)}),featureList},getFeature:function(featureName){var feature=this.getMyFeature(featureName);if(feature||!this["extends"])return feature;var ext=this.X.lookup(this["extends"]);return ext?ext.getFeature(featureName):void 0},getAllRawFeatures:function(){var featureList=this.getAllMyRawFeatures();if(this["extends"]){var ext=this.X.lookup(this["extends"]);ext&&ext.getAllFeatures().map(function(subFeat){var subName=subFeat.name.toUpperCase();featureList.mapFind(function(myFeat){return myFeat&&myFeat.name&&myFeat.name.toUpperCase()===subName})||featureList.push(subFeat)})}return featureList},atest:function(){for(var seq=[],allPassed=!0,i=0;i<this.tests.length;i++)seq.push(function(test,model){return function(ret){test.atest(model)(function(passed){passed||(allPassed=!1),ret()})}}(this.tests[i],this));return seq.push(function(ret){ret(allPassed)}),aseq.apply(null,seq)}},BinaryProtoGrammar,DocumentationBootstrap={name:"documentation",type:"Documentation",labels:["javascript"],help:"Documentation associated with this entity.",documentation:"The developer documentation for this $$DOC{ref:'.'}. Use a $$DOC{ref:'DocModelView'} to view documentation.",setter:function(nu){_DOC_&&(this.instance_.documentation=nu)},getter:function(){if(!_DOC_)return"";var doc=this.instance_.documentation;return!doc||"undefined"==typeof Documentation||!Documentation||doc.model_&&doc.model_.getPrototype&&Documentation.isInstance(doc)||(doc.body?this.instance_.documentation=Documentation.create(doc):this.instance_.documentation=Documentation.create({body:doc})),this.instance_.documentation}},Model={__proto__:BootstrapModel,instance_:{},name:"Model",plural:"Models",help:"Describes the attributes and properties of an entity.",documentation:{body:function(){}},tableProperties:["package","name","label","plural"],properties:[{name:"id",hidden:!0,"transient":!0},{name:"sourcePath",help:"Source location of this Model.",defaultValue:"",mode:"read-only","transient":!0},{name:"abstract",defaultValue:!1,help:"If the java class is abstract.",documentation:function(){}},{name:"package",help:"Package that this Model belongs to.",defaultValue:"",postSet:function(_,p){return this.id=p?p+"."+this.name:this.name},documentation:function(){}},{name:"name",type:"String",javaType:"String",postSet:function(_,n){return this.id=this["package"]?this["package"]+"."+n:n},required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return labelize(this.name)},help:"The display label for the entity.",documentation:function(){}},{name:"javaClassName",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return(this["abstract"]?"Abstract":"")+this.name},help:"The Java classname of this Model.",documentation:function(){}},{name:"javaClassImports",type:"Array[String]",labels:["java"],defaultValueFn:function(){return[]},help:"Imports to add at the top of the generated java class."},{name:"swiftClassName",type:"String",labels:["swift"],defaultValueFn:function(){return(this["abstract"]?"Abstract":"")+this.name},help:"The Swift classname of this model."},{name:"extends",label:"Extends",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"The parent model of this model.",documentation:function(){}},{name:"extendsModel",hidden:!0,compareProperty:constantFn(0),getter:function(){return null},setter:function(e){console.warn("Deprecated use of 'extendsModel'. Use 'extends' instead."),e&&(this["extends"]=e)}},{name:"traits",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Traits to mix-into this Model.",documentation:function(){}},{name:"plural",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.name+"s"},help:"The plural form of this model's name.",documentation:function(){}},{name:"version",defaultValue:1,help:"Version number of model.",documentation:function(){}},{name:"ids",label:"Key Properties",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){var id=this.getProperty("id");if(id)return["id"];var props=this.getRuntimeProperties();return props.length?[props[0].name]:[]},help:"Properties which make up unique id.",documentation:function(){}},{name:"requires",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Model imports.",documentation:function(){}},{name:"imports",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Context imports.",documentation:function(){}},{name:"exports",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Context exports.",documentation:function(){}},{name:"implements",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Interfaces implemented by this Model.",documentation:function(){}},{name:"swiftImplements",type:"Array[String]",labels:["swift"],defaultValueFn:function(){return this["implements"]},help:"Swift interfaces implemented by this Model."},{name:"swiftClassImports",type:"Array[String]",labels:["swift"],defaultValueFn:function(){return[]},help:"Imports to add at the top of the generated swift class."},{name:"swiftCode",type:"String",labels:["swift"],defaultValue:"",help:"Swift code to drop in when generating the swift class for this model."},{name:"javaCode",type:"String",labels:["java"],defaultValue:"",help:"Java code to drop in when generating the java class for this model."},{name:"onLoad",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A function which is called when a Model's prototype is built.",documentation:function(){}},{name:"tableProperties",type:"Array[String]",view:"foam.ui.StringArrayView",displayWidth:70,lazyFactory:function(){return(this.properties||this.properties_).filter(function(o){return!o.hidden}).map(function(o){return o.name})},help:"Properties to be displayed in table view. Defaults to all properties.",documentation:function(){}},{name:"searchProperties",type:"Array[String]",view:"foam.ui.StringArrayView",displayWidth:70,defaultValueFn:function(){return this.tableProperties},help:"Properties display in a search view. Defaults to table properties.",documentation:function(){}},{name:"properties",type:"Array[Property]",subType:"Property",javaType:"java.util.List<foam.core.Property>",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Properties associated with the entity.",preSet:function(oldValue,newValue){for(var i=0;i<newValue.length;i++){var p=newValue[i];"string"==typeof p?newValue[i]=p={name:p}:Array.isArray(p)&&(newValue[i]=p={name:p[0],defaultValue:p[1]}),!p.labels||FEATURE_ENABLED(p.labels)?(p.model_?"string"==typeof p.model_&&(p=newValue[i]=JSONUtil.mapToObj(this.X,p)):p.type&&this.X.lookup(p.type+"Property")?(p.model_=p.type+"Property",p.type=void 0,p=newValue[i]=JSONUtil.mapToObj(this.X,p)):p=newValue[i]=Property.create(p),this[constantize(p.name)]=newValue[i]):(newValue.splice(i,1),i--)}return this.propertyMap_=null,newValue},postSet:function(_,newValue){for(var i=0;i<newValue.length;i++)newValue[i].modelId=this.id},documentation:function(){}},{name:"actions",type:"Array[Action]",subType:"Action",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},help:"Actions associated with the entity.",adapt:function(_,a){if(!Action)return a;for(var i=0;i<a.length;i++){var p=a[i];"function"==typeof p?a[i]=Action.create({name:p.name,code:p}):p.model_?"string"==typeof p.model_&&(a[i]=FOAM(p)):a[i]=Action.create(p),p.name&&!this[constantize(p.name)]&&(this[constantize(p.name)]=a[i])}return a},documentation:function(){}},{name:"constants",type:"Array[Constant]",subType:"Constant",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},help:"Constants associated with the entity.",preSet:function(_,newValue){if(!Constant)return newValue;if(Array.isArray(newValue))return JSONUtil.arrayToObjArray(this.X,newValue,Constant);var constants=[];for(var key in newValue){var oldValue=newValue[key],constant=Constant.create({name:key,value:oldValue});constants.push(constant)}return constants}},{name:"messages",type:"Array[Message]",subType:"Constant",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},help:"Messages associated with the entity.",preSet:function(_,ms){if(!GLOBAL.Message)return ms;if(Array.isArray(ms))return JSONUtil.arrayToObjArray(this.X,ms,Message);var messages=[];for(var key in ms){var oldValue=ms[key],message=Message.create({name:key,value:oldValue});messages.push(message)}return messages}},{name:"methods",subType:"Method",factory:function(){return[]},help:"Methods associated with the entity.",adapt:function(_,a){if(!Method)return a;if(Array.isArray(a)){for(var i=0;i<a.length;i++)a[i]="function"==typeof a[i]?this.createMethod_(this.X,a[i].name,a[i]):JSONUtil.mapToObj(this.X,a[i],Method,seq);return a}var methods=[];for(var key in a)methods.push(this.createMethod_(this.X,key,a[key]));return methods},documentation:function(){}},{name:"listeners",type:"Array[Method]",subType:"Method",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},adapt:function(_,a){if(!Method)return a;if(Array.isArray(a)){for(var i=0;i<a.length;i++)a[i]="function"==typeof a[i]?this.createMethod_(this.X,a[i].name,a[i]):JSONUtil.mapToObj(this.X,a[i],Method,seq);return a}console.error("Expecting array of listeners.")},help:"Event listeners associated with the entity.",documentation:function(){}},{name:"templates",type:"Array[Template]",subType:"Template",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},preSet:function(_,templates){for(var i=0;i<templates.length;i++)!templates[i].labels||FEATURE_ENABLED(templates[i].labels)||(templates.splice(i,1),i--);return templates},postSet:function(_,templates){TemplateUtil.expandModelTemplates(this)},help:"Templates associated with this entity.",documentation:function(){}},{name:"models",type:"Array[Model]",subType:"Model",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},adapt:function(_,newValue){if(!Model)return newValue;if(!Array.isArray(newValue))return newValue;var id=this.id;return JSONUtil.arrayToObjArray(this.X,newValue,Model).map(function(m){return m["package"]=id,m})},postSet:function(_,models){for(var i=0;i<models.length;i++)this[models[i].name]=models[i]},help:"Sub-models embedded within this model.",documentation:function(){}},{name:"tests",label:"Unit Tests",type:"Array[Unit Test]",subType:"UnitTest",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},adapt:function(_,a){if(!a)return a;for(var i=0;i<a.length;i++)"function"==typeof a[i]&&(a[i]=UnitTest.create({name:a[i].name,code:a[i]}));return a},help:"Unit tests associated with this model.",documentation:function(){}},{name:"relationships",subType:"Relationship",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},help:"Relationships of this model to other models.",preSet:function(_,newValue){if(!Relationship)return newValue;for(var i=0;i<newValue.length;i++){var p=newValue[i];p.model_?"string"==typeof p.model_&&(p=newValue[i]=FOAM(p)):p=newValue[i]=Relationship.create(p),this[constantize(p.name)]=newValue[i]}return newValue},documentation:function(){}},{name:"issues",type:"Array[Issue]",subType:"Issue",labels:["debug"],view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&visitor.visitArray(o[this.name])},help:"Issues associated with this model.",documentation:function(){}},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,view:"foam.ui.TextAreaView",defaultValue:"",help:"Help text associated with the entity.",documentation:function(){}},{name:"i18nComplete_",defaultValue:!1,hidden:!0,"transient":!0},{name:"translationHint",label:"Description for Translation",type:"String",defaultValueFn:function(){return this.name}},DocumentationBootstrap,{name:"notes",type:"String",displayWidth:70,displayHeight:6,view:"foam.ui.TextAreaView",defaultValue:"",help:"Internal documentation associated with this entity.",documentation:function(){}}],templates:[],toString:function(){return"Model"}};GLOBAL.Property={__proto__:BootstrapModel,instance_:{},name:"Property","implements":["ExprProtocol"],plural:"Properties",help:"Describes a properties of a modelled entity.",ids:["name"],tableProperties:["name","label","type","required","defaultValue"],documentation:function(){},properties:[{name:"name",swiftType:"String",javaType:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",mode:"read-only",help:"The coding identifier for the property.",documentation:function(){}},{name:"labels",type:"Array",subType:"String",labels:["debug","javascript"]},{name:"label",swiftType:"String",javaType:"String",required:!1,displayWidth:70,displayHeight:1,defaultValueFn:function(){return labelize(this.name)},help:"The display label for the property.",documentation:function(){}},{name:"translationHint",type:"String",required:!1,documentation:"Used to describe the property for translators."},{name:"speechLabel",type:"String",required:!1,displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The speech label for the property.",documentation:function(){}},{name:"speechLabelTranslationHint",type:"String",required:!1,documentation:"Used to describe the speech label for translators.",defaultValueFn:function(){return this.translationHint}},{name:"tableLabel",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The table display label for the entity.",documentation:function(){}},{name:"type",type:"String",required:!0,view:{factory_:"foam.ui.ChoiceView",choices:["Array","Boolean","Color","Date","DateTime","Email","Enum","Float","Function","Image","Int","Object","Password","String","String[]","URL"]},defaultValue:"String",help:"The type of the property.",documentation:function(){}},{name:"swiftDefaultValue",labels:["swift","compiletime"],adapt:function(_,n){return multiline(n)}},{name:"swiftDefaultValueFn",labels:["swift","compiletime"],adapt:function(_,n){return multiline(n)}},{name:"javaDefaultValue",labels:["java","compiletime"],adapt:function(_,n){return multiline(n)}},{name:"javaDefaultValueFn",labels:["java","compiletime"],adapt:function(_,n){return multiline(n)}},{name:"protobufType",type:"String",required:!1,help:"The protobuf type that represents the type of this property.",defaultValueFn:function(){return this.type.toLowerCase()},documentation:function(){}},{name:"javaType",type:"String",labels:["compiletime","java"],required:!1,defaultValue:"Object",help:"The java type that represents the type of this property.",documentation:function(){}},{name:"javascriptType",type:"String",labels:["compiletime","javascript"],required:!1,defaultValueFn:function(){return this.type},help:"The javascript type that represents the type of this property.",documentation:function(){}},{name:"swiftType",type:"String",required:!1,labels:["compiletime","swift"],defaultValue:"AnyObject?",help:"The Swift type that represents this type of property."},{name:"swiftNSCoderEncode",type:"String",required:!1,labels:["compiletime","swift"],defaultValue:"// <%= this.name %> is unsupported for coding."},{name:"swiftNSCoderDecode",type:"String",required:!1,labels:["compiletime","swift"],defaultValue:"// <%= this.name %> is unsupported for coding."},{name:"shortName",type:"String",required:!0,displayWidth:10,displayHeight:1,defaultValue:"",help:"A short alternate name to be used for compact encoding.",documentation:"A short alternate $$DOC{ref:'.name'} to be used for compact encoding."},{name:"singular",type:"String",required:!1,displayWidth:70},{name:"aliases",labels:["javascript"],view:"foam.ui.StringArrayView",factory:function(){return[]},help:"Alternate names for this property.",documentation:function(){}},{name:"mode",type:"String",defaultValue:"read-write",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]},documentation:function(){}},{name:"subType",label:"Sub-Type",type:"String",displayWidth:30,help:"The type of the property.",documentation:function(){}},{name:"subKey",labels:["javascript"],displayWidth:20,defaultValue:"ID",help:"The foreign key that this property references.",documentation:function(){}},{name:"units",type:"String",required:!0,displayWidth:70,displayHeight:1,defaultValue:"",help:"The units of the property.",
documentation:function(){}},{name:"required",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!0,help:"Indicates if the property is a required field.",documentation:function(){}},{name:"visibility",choices:["rw","final","ro","hidden"],postSet:function(_,v){"hidden"===v&&(this.hidden=!0)}},{name:"hidden",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!1,postSet:function(old,hidden){!old&&hidden&&(this.visibility="hidden")},help:"Indicates if the property is hidden.",documentation:function(){}},{name:"transient",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!1,help:"Indicates if the property is transient.",documentation:function(){}},{name:"modelId",type:"String",view:"foam.ui.TextFieldView",help:"Id of the model that this is a property of","transient":!0},{name:"displayWidth",type:"Int",displayWidth:8,displayHeight:1,defaultValue:30,help:"The display width of the property.",documentation:function(){}},{name:"displayHeight",type:"Int",displayWidth:8,displayHeight:1,defaultValue:1,help:"The display height of the property.",documentation:function(){}},{name:"view",labels:["javascript"],defaultValue:"foam.ui.TextFieldView",help:"View component for the property.",documentation:function(){}},{name:"toPropertyE",labels:["javascript"],defaultValue:function toPropertyE(X){var e=this.displayHeight>1?X.lookup("foam.u2.MultiLineTextField").create(null,X):X.lookup("foam.u2.TextField").create(null,X);return e.attrs({size:this.displayWidth}),e},adapt:function(_,nu){if("string"==typeof nu){var f=function(X){return X.lookup(nu).create(null,X)};return f.toString=function(){return"'"+nu+"'"},f}return nu}},{name:"detailView",labels:["javascript"],defaultValueFn:function(){return this.view},help:"View component for the property when rendering within a DetailView.",documentation:function(){}},{name:"citationView",labels:["javascript"],defaultValueFn:function(){return this.view},help:"View component for the property when rendering within a CitationView.",documentation:function(){}},{name:"swiftView",type:"String",labels:["compiletime","swift"],help:"The default view name for this property in swift."},{name:"detailViewPreRow",labels:["javascript"],defaultValue:function(){return""},help:"Inject HTML before row in DetailView.",documentation:function(){}},{name:"detailViewPostRow",labels:["javascript"],defaultValue:function(){return""},help:"Inject HTML before row in DetailView.",documentation:function(){}},{name:"defaultValue",type:"String",required:!1,labels:["javascript"],displayWidth:70,displayHeight:1,defaultValue:"",postSet:function(old,nu){nu&&this.defaultValueFn&&(this.defaultValueFn=void 0)},help:"The property's default value.",documentation:function(){}},{name:"defaultValueFn",label:"Default Value Function",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",postSet:function(old,nu){nu&&this.defaultValue&&(this.defaultValue=void 0)},help:"The property's default value function.",documentation:function(){}},{name:"dynamicValue",label:"Value's Dynamic Function",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A dynamic function which computes the property's value.",documentation:function(){}},{name:"factory",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Factory for creating initial value when new object instantiated.",documentation:function(){}},{name:"lazyFactory",type:"Function",labels:["javascript"],required:!1,view:"foam.ui.FunctionView",help:"Factory for creating the initial value. Only called when the property is accessed for the first time.",documentation:function(){}},{name:"regex",labels:["javascript"]},{name:"validate",type:"Function",swiftType:"FoamFunction?",javaType:"FoamFunction<String>",required:!1,view:"foam.ui.FunctionView",help:"Function for validating property value.",preSet:function(_,f){if(!f.dependencies){var str=f.toString(),deps=str.match(/^function[ _$\w]*\(([ ,\w]*)/)[1];deps=deps?deps.split(",").map(function(name){return name.trim()}):[];var f2=function(){for(var args=[],i=0;i<deps.length;i++)args.push(this[deps[i]]);return f.apply(this,args)};return f2.dependencies=deps,f2.toString=function(){return f.toString()},f2}return f},compareProperty:function(o1,o2){return o1.toString()!==o2.toString()},documentation:function(){}},{name:"swiftValidate",labels:["swift","compiletime"]},{name:"javaValidate",labels:["java","compiletime"]},{name:"javaAdapt",type:"String",labels:["compiletime","java"],defaultValue:function(){}},{name:"javaPreSet",type:"String",labels:["compiletime","java"],defaultValue:function(){}},{name:"javaPostSet",type:"String",labels:["compiletime","java"],defaultValue:"//javaPostSet goes here."},{name:"javaGetter",type:"String",labels:["compiletime","java"]},{name:"javaFactory",type:"String",labels:["compiletime","java"],adapt:function(_,n){return"function"==typeof n?multiline(n):n}},{name:"javaLazyFactory",type:"String",labels:["compiletime","java"],adapt:function(_,n){return"function"==typeof n?multiline(n):n}},{name:"swiftAdapt",type:"String",labels:["compiletime","swift"],defaultValue:function(){}},{name:"swiftPreSet",type:"String",labels:["compiletime","swift"],defaultValue:"return newValue"},{name:"swiftPostSet",type:"String",labels:["compiletime","swift"],defaultValue:"//swiftPostSet goes here."},{name:"swiftGetter",type:"String",labels:["compiletime","swift"]},{name:"swiftFactory",type:"String",labels:["compiletime","swift"]},{name:"swiftLazyFactory",type:"String",labels:["compiletime","swift"]},{name:"getter",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"The property's default value function.",documentation:function(){}},{name:"adapt",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"An adapter function called before preSet.",documentation:function(){}},{name:"preSet",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"An adapter function called before normal setter logic.",documentation:function(){}},{name:"postSet",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A function called after normal setter logic, but before property change event fired.",documentation:function(){}},{name:"setter",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"The property's default value function.",documentation:function(){}},{name:"tableFormatter",label:"Table Cell Formatter",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Function to format value for display in TableView.",documentation:"A function to format the value for display in a $$DOC{ref:'foam.ui.TableView'}."},{name:"summaryFormatter",label:"Summary Formatter",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Function to format value for display in SummaryView.",documentation:"A function to format the value for display in a $$DOC{ref:'SummaryView'}."},{name:"tableWidth",type:"String",required:!1,defaultValue:"",help:"Table View Column Width.",documentation:"A Suggestion for $$DOC{ref:'foam.ui.TableView'} column width."},{name:"help",label:"Help Text",type:"String",required:!1,displayWidth:70,displayHeight:6,view:"foam.ui.TextAreaView",defaultValue:"",help:"Help text associated with the property.",documentation:function(){}},{name:"helpTranslationHint",type:"String",help:"The translation hint for the help property."},DocumentationBootstrap,{name:"prototag",label:"Protobuf tag",type:"Int",defaultValue:0,required:!1,help:"The protobuf tag number for this field.",documentation:"The protobuf tag number for this field."},{name:"actionFactory",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Factory to create the action objects for taking this property from value A to value B",documentation:"Factory to create the $$DOC{ref:'Action'} objects for taking this $$DOC{ref:'Property'} from value A to value B"},{name:"compareProperty",type:"Function",swiftType:"FoamFunction",javaType:"FoamFunction<Integer>",view:"foam.ui.FunctionView",displayWidth:70,displayHeight:5,defaultValue:function(o1,o2){return o1===o2?0:o1||o2?o1?o2?o1.localeCompare?o1.localeCompare(o2):o1.compareTo?o1.compareTo(o2):o1.$UID.compareTo(o2.$UID):1:-1:0},swiftDefaultValue:function(){},javaDefaultValue:function(){},help:"Comparator function.",documentation:"A comparator function two compare two instances of this $$DOC{ref:'Property'}."},{name:"fromString",labels:["javascript"],defaultValue:function(s){return s},help:"Function to extract value from a String."},{name:"fromElement",labels:["javascript"],defaultValue:function propertyFromElement(e,p){if(!p.subType||!this.X.lookup||"String"===p.subType)return void(this[p.name]=p.fromString(e.innerHTML));var model=this.X.lookup(p.subType);if(!model)return void(this[p.name]=p.fromString(e.innerHTML));var o=model.create();return o.fromElement?void(this[p.name]=o.fromElement(e)):void(this[p.name]=p.fromString(e.innerHTML))},help:"Function to extract from a DOM Element.",documentation:"Function to extract a value from a DOM Element."},{name:"propertyToJSON",labels:["javascript"],defaultValue:function(visitor,output,o){this["transient"]||(output[this.name]=visitor.visit(o[this.name]))},help:"Function to extract from a DOM Element.",documentation:"Function to extract a value from a DOM Element."},{name:"autocompleter",subType:"Autocompleter",labels:["javascript"],help:"Name or model for the autocompleter for this property.",documentation:function(){}},{name:"install",type:"Function",labels:["javascript"],required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A function which installs additional features into the Model's prototype.",documentation:function(){}},{name:"exclusive",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!0,help:"Indicates if the property can only have a single value.",documentation:function(){}},{name:"memorable",type:"Boolean",help:"True if this value should be included in a memento for this object.",defaultValue:!1},{name:"attribute",type:"Boolean",help:"True if this property is settable as an element attribute.",defaultValue:!1}],methods:[function partialEval(){return this},{name:"f",code:function(obj){return obj[this.name]},args:[{name:"obj",swiftType:"AnyObject?",javaType:"Object"}],swiftReturnType:"AnyObject?",javaReturnType:"Object",swiftCode:function(){},javaCode:function(){}},{name:"compare",code:function(o1,o2){return this.compareProperty(this.f(o1),this.f(o2))},args:[{name:"o1",swiftType:"AnyObject?",javaType:"Object"},{name:"o2",swiftType:"AnyObject?",javaType:"Object"}],returnType:"Int",swiftCode:function(){},javaCode:function(){}},function readResolve(){return this.modelId?this.X.lookup(this.modelId)[constantize(this.name)]:this},function toSQL(){return this.name},function toMQL(){return this.name},function toBQL(){return this.name},function cloneProperty(value,cloneArgs){cloneArgs[this.name]=value&&value.clone?value.clone():value},function deepCloneProperty(value,cloneArgs){cloneArgs[this.name]=value&&value.deepClone?value.deepClone():value},function exprClone(){return this},function dot(nextProp){var PropertySequence=this.X.lookup("foam.mlang.PropertySequence");return PropertySequence?PropertySequence.isInstance(this)?(this.next_?this.next_=this.next_.dot(nextProp):this.next_=nextProp,this):PropertySequence.xbind({next_:nextProp}).create(this,this.Y):(console.warn("Missing foam.mlang.PropertySequence for Property.dot()"),this)},function initPropertyAgents(proto,fastInit){var prop=this,name=prop.name,name$_=prop.name$_;if(fastInit||proto.addInitAgent(this.postSet||this.setter?9:0,name+": "+(this.postSet||this.setter?"copy arg (postSet)":"copy arg"),function(o,X,m){m&&(m.hasOwnProperty(name)&&(o[name]=m[name]),m.hasOwnProperty(name$_)&&(o[name$_]=m[name$_]))}),this.dynamicValue){var dynamicValue=prop.dynamicValue;Array.isArray(dynamicValue)?proto.addInitAgent(10,name+": dynamicValue",function(o,X){Events.dynamicFn(dynamicValue[0].bind(o),function(){o[name]=dynamicValue[1].call(o)},X||this.X)}):proto.addInitAgent(10,name+": dynamicValue",function(o,X){Events.dynamicFn(dynamicValue.bind(o),function(value){o[name]=value},X||this.X)})}this.factory&&proto.addInitAgent(11,name+": factory",function(o,X){o.hasOwnProperty(name)||o[name]})},function toE(opt_X){var X=opt_X||this.X;return X.lookup("foam.u2.PropertyView").create({prop:this,view:this.toPropertyE(X)},X)}],toString:function(){return"Property"}},Model.methods={},"createMethod_ getProperty getAction hashCode buildPrototype addTraitToModel_ buildProtoImports_ buildProtoProperties_ buildProtoMethods_ getPrototype isSubModel isInstance getAllRequires arequire getMyFeature getRawFeature getAllMyRawFeatures getFeature getAllRawFeatures atest getRuntimeProperties getRuntimeActions create".split(" ").forEach(function(k){Model.methods[k]=BootstrapModel[k]}),Model=Model.create(Model),Model.model_=Model,Model.create=BootstrapModel.create,Property=Model.create(Property);for(var ps=Property.getRuntimeProperties(),i=0;i<ps.length;i++)Property[constantize(ps[i].name)]=ps[i]=Property.create(ps[i]);if(USED_MODELS.Property=!0,USED_MODELS.Model=!0,CLASS({name:"Message",plural:"messages",tableProperties:["name","value","translationHint"],documentation:function(){},properties:[{name:"name",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the message.",documentation:function(){}},{name:"value",help:"The message itself."},{name:"labels",type:"StringArray",labels:["debug","javascript"]},{name:"meaning",help:"Linguistic clarification to resolve ambiguity.",documentation:function(){}},{name:"placeholders",help:"Placeholders to inject into the message.",documentation:function(){},factory:function(){return[]}},{name:"replaceValues",documentation:function(){},defaultValue:function(unused_selectors,args){for(var phs=this.placeholders||[],value=this.value,i=0;i<phs.length;++i){var name=phs[i].name,replacement=args.hasOwnProperty(name)?args[name]:phs[i].example;value=value.replace(new RegExp("[$]"+name+"[$]","g"),replacement)}return value}},{name:"translationHint",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this message and the context in which it used.",documentation:function(){}}]}),CLASS({name:"StringProperty","extends":"Property",help:"Describes a properties of type String.",label:"Text",messages:[{name:"errorPatternMismatch",value:"The text does not match the pattern."},{name:"errorBelowMinLength",value:"The text is too short. Minimum: $min$",placeholders:[{name:"min"}]},{name:"errorAboveMaxLength",value:"The text is too long. Maximum: $max$",placeholders:[{name:"max"}]}],properties:[{name:"displayHeight",displayWidth:8,defaultValue:1,help:"The display height of the property."},{name:"adapt",labels:["javascript"],defaultValue:function(_,v){return void 0===v||null===v?"":"function"==typeof v?multiline(v):v.toString()}},{name:"swiftAdapt",defaultValue:function(){}},{name:"javaType",displayWidth:70,defaultValue:"String",help:"The Java type of this property."},{name:"swiftType",defaultValue:"String"},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"swiftDefaultValue",defaultValueFn:function(){var defaultValue=this.defaultValue||"";return'"'+defaultValue+'"'}},{name:"javaDefaultValue",defaultValueFn:function(){var defaultValue=this.defaultValue||"";return'"'+defaultValue+'"'}},{name:"view",labels:["javascript"],defaultValue:"foam.ui.TextFieldView"},{name:"swiftView",defaultValue:"FoamUITextField"},{name:"pattern",help:"Regex pattern for property."},{name:"minChars",label:"Minimum characters",help:"The minimum number of characters required.",adapt:function(old,nu){return""===nu?"":parseInt(nu)}},{name:"maxChars",label:"Maximum characters",help:"The maximum number of characters allowed.",adapt:function(old,nu){return""===nu?"":parseInt(nu)}},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."},{name:"validate",lazyFactory:function(){var prop=this,ret=constantFn(""),min=prop.minChars;""!==min&&(ret=function(result){return result||(this[prop.name].length<min?prop.ERROR_BELOW_MIN_LENGTH.replaceValues(null,{min:min}):"")}.o(ret),ret.dependencies=[prop.name]);var max=prop.maxChars;""!==max&&(ret=function(result){return result||(this[prop.name].length>max?prop.ERROR_ABOVE_MAX_LENGTH.replaceValues(null,{max:max}):"")}.o(ret),ret.dependencies=[prop.name]);var pattern=prop.pattern;if(pattern){var testable=pattern.test?pattern:new RegExp(pattern.toString(),"i"),errMsg=pattern.errorMessage?pattern.errorMessage():prop.errorPatternMismatch;ret=function(result){return result||(testable.test(this[prop.name])?"":errMsg)}.o(ret),ret.dependencies=[prop.name]}return ret}}]}),CLASS({name:"BooleanProperty","extends":"Property",help:"Describes a properties of type Boolean.",label:"True or false",properties:[{name:"swiftType",type:"String",displayWidth:70,defaultValue:"Bool"},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeBool(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeBoolForKey("<%= this.name %>"))'},{name:"swiftDefaultValue",defaultValueFn:function(){return this.defaultValue+""}},{name:"javaDefaultValue",defaultValueFn:function(){return this.defaultValue+""}},{name:"javaType",type:"String",displayWidth:70,defaultValue:"boolean",help:"The Java type of this property."},{name:"view",labels:["javascript"],defaultValue:"foam.ui.BooleanView"},{name:"swiftView",defaultValue:"FoamUISwitch"},{name:"toPropertyE",labels:["javascript"],defaultValue:function(X){return X.lookup("foam.u2.tag.Checkbox").create(null,X)}},["defaultValue",!1],{name:"adapt",defaultValue:function(_,v){return!!v},labels:["javascript"]},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."},{name:"fromString",labels:["javascript"],defaultValue:function(s){var txt=s.trim();return txt.equalsIC("y")||txt.equalsIC("yes")||txt.equalsIC("true")||txt.equalsIC("t")},help:"Function to extract value from a String."},{name:"fromMemento",labels:["javascript"],defaultValue:function(mem){return!mem||"false"!==mem.toLowerCase()&&"0"!==mem?!!mem:!1}}]}),CLASS({name:"DateProperty","extends":"Property",help:"Describes a properties of type Date.",label:"Date",properties:[["displayWidth",50],{name:"swiftType",defaultValue:"NSDate?"},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"javaType",defaultValue:"java.util.Date",help:"The Java type of this property."},["view","foam.ui.DateFieldView"],{name:"toPropertyE",labels:["javascript"],defaultValue:function(X){return X.lookup("foam.u2.DateView").create(null,X)}},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."},{name:"adapt",defaultValue:function(_,d){if("number"==typeof d)return new Date(d);if("string"==typeof d){var ret=new Date(d);return"Invalid Date"===ret.toUTCString()?new Date(+d):ret}return d}},["tableFormatter",function(d){return d?d.toRelativeDateString():""}],["compareProperty",function(o1,o2){return o1?o2?o1.compareTo(o2):1:o2?-1:0}]]}),CLASS({name:"DateTimeProperty","extends":"DateProperty",help:"Describes a properties of type DateTime.",label:"Date and time",properties:[["view","foam.ui.DateTimeFieldView"],{name:"toPropertyE",labels:["javascript"],defaultValue:function(X){return X.lookup("foam.u2.md.DateTimeField").create(null,X)}}]}),CLASS({name:"NumericProperty_","extends":"Property",help:"Base model for a property of any numeric type.",messages:[{name:"errorBelowMinimum",value:"The value must be at least $min$.",placeholders:[{name:"min"}]},{name:"errorAboveMaximum",value:"The value can be at most $max$.",placeholders:[{name:"max"}]}],properties:[{name:"minValue",label:"Minimum Value",required:!1,help:"The minimum value this property accepts.",defaultValue:"",adapt:function(old,nu){return""===nu?"":this.adapt(null,nu)}},{name:"maxValue",label:"Maximum Value",required:!1,help:"The maximum value this property accepts.",defaultValue:"",adapt:function(old,nu){return""===nu?"":this.adapt(null,nu)}},{name:"compareProperty",defaultValue:function(o1,o2){return o1===o2?0:o1>o2?1:-1},swiftDefaultValue:function(){}},{name:"validate",lazyFactory:function(){var prop=this,ret=constantFn(""),min=prop.minValue;""!==min&&(ret=function(result){return result||(this[prop.name]<min?prop.ERROR_BELOW_MINIMUM.replaceValues(null,{min:min}):"")}.o(ret),ret.dependencies=[prop.name]);var max=prop.maxValue;return""!==max&&(ret=function(result){return result||(this[prop.name]>max?prop.ERROR_ABOVE_MAXIMUM.replaceValues(null,{max:max}):"")}.o(ret),ret.dependencies=[prop.name]),ret}},{name:"swiftDefaultValue",defaultValueFn:function(){return""+this.defaultValue}}]}),CLASS({name:"IntProperty","extends":"NumericProperty_",help:"Describes a properties of type Int.",label:"Round numbers",properties:[["displayWidth",10],{name:"javaType",displayWidth:10,defaultValue:"int",help:"The Java type of this property."},{name:"swiftType",defaultValue:"Int"},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeInteger(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeIntegerForKey("<%= this.name %>"))'},{name:"swiftAdapt",defaultValue:function(){}},{name:"javaAdapt",defaultValue:function(){}},{name:"swiftDefaultValue",defaultValueFn:function(){return this.defaultValue+""}},{name:"javaDefaultValue",defaultValueFn:function(){return this.defaultValue+""}},{name:"view",labels:["javascript"],defaultValue:"foam.ui.IntFieldView"},{name:"swiftView",defaultValue:"FoamIntUITextField"},{name:"adapt",labels:["javascript"],defaultValue:function(_,v){return"number"==typeof v?Math.round(v):v?parseInt(v):0}},["defaultValue",0],{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"LongProperty","extends":"IntProperty",help:"Describes a properties of type Long.",label:"Round long numbers",properties:[{name:"displayWidth",labels:["javascript"],defaultValue:12},{name:"javaType",labels:["javascript"],defaultValue:"long"},{name:"swiftType",labels:["compiletime","swift"],defaultValue:"NSNumber"},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"swiftAdapt",defaultValue:function(){}},{name:"javaAdapt",defaultValue:function(){}}]}),CLASS({name:"FloatProperty","extends":"NumericProperty_",help:"Describes a properties of type Float.",label:"Decimal numbers",properties:[{name:"defaultValue",defaultValue:0},{name:"swiftDefaultValue",defaultValueFn:function(){return""+this.defaultValue}},{name:"javaDefaultValue",defaultValueFn:function(){return""+this.defaultValue}},{name:"javaType",displayWidth:10,defaultValue:"double",help:"The Java type of this property."},{name:"swiftType",defaultValue:"Float"},{name:"swiftView",defaultValue:"FoamFloatUITextField"},{name:"displayWidth",defaultValue:15},{name:"view",defaultValue:"foam.ui.FloatFieldView"},{name:"adapt",defaultValue:function(_,v){return"number"==typeof v?v:v?parseFloat(v):0}},{name:"swiftAdapt",defaultValue:function(){}},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"FunctionProperty","extends":"Property",help:"Describes a properties of type Function.",label:"Code that can be run",properties:[{name:"javaType",displayWidth:10,defaultValue:"FoamFunction",help:"The Java type of this property."},{name:"swiftType",defaultValue:"FoamFunction"},{name:"swiftDefaultValue",defaultValue:"FoamFunction(fn: { (_) -> AnyObject? in return nil })"},{name:"displayWidth",defaultValue:15},{name:"view",defaultValue:"foam.ui.FunctionView"},{name:"toPropertyE",defaultValue:function(X){return X.lookup("foam.u2.FunctionView").create(void 0,X)}},{name:"defaultValue",defaultValue:function(){}},{name:"fromElement",defaultValue:function(e,p){var txt=e.innerHTML.trim();this[p.name]=txt}},{name:"adapt",defaultValue:function(_,value){if("string"==typeof value){var parse=JSONParser.parseString(value,JSONParser["function prototype"]);if(parse){var body=value.substring(value.indexOf("{")+1,value.lastIndexOf("}"));return new Function(parse[3],body)}return new Function(value)}return value}}]}),CLASS({name:"TemplateProperty","extends":"FunctionProperty",properties:[{name:"adapt",defaultValue:function(_,value){return TemplateUtil.expandTemplate(this,value)}},{name:"defaultValue",adapt:function(_,value){return TemplateProperty.ADAPT.defaultValue.call(this,_,value)}},{name:"toPropertyE",defaultValue:function(X){return X.lookup("foam.u2.MultiLineTextField").create(void 0,X)}},{name:"install",defaultValue:function(prop){defineLazyProperty(this,prop.name+"$f",function(){var f=TemplateUtil.lazyCompile(this[prop.name]);return{get:function(){return f},configurable:!0}})}}]}),CLASS({name:"ArrayProperty","extends":"Property",javaClassImports:["java.util.List"],help:"Describes a property of type Array.",label:"List of items",properties:[{name:"swiftType",defaultValueFn:function(){return"["+this.swiftSubType+"]"}},{name:"swiftSubType",defaultValueFn:function(){var type=this.subType||"AnyObject";return type.split(".").pop()}},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"swiftFactory",defaultValue:"return []"},{name:"singular",displayWidth:70,defaultValueFn:function(){return this.name.replace(/s$/,"")},help:"The plural form of this model's name.",documentation:function(){}},{name:"subType",displayWidth:20,defaultValue:"",help:"The FOAM sub-type of this property."},{name:"protobufType",defaultValueFn:function(){return this.subType}},{name:"adapt",defaultValue:function(_,a,prop){var m=prop.subType_||(prop.subType_=this.X.lookup(prop.subType)||GLOBAL.lookup(prop.subType));if(m)for(var i=0;i<a.length;i++)m.isInstance(a[i])||(a[i]=a[i].model_?FOAM(a[i]):m.create(a[i]));return a}},{name:"postSet",defaultValue:function(oldA,a,prop){var name=prop.nameArrayRelay_||(prop.nameArrayRelay_=prop.name+"ArrayRelay_"),l=this[name]||(this[name]=function(){this.propertyChange(prop.name,null,this[prop.name])}.bind(this));oldA&&oldA.unlisten&&oldA.unlisten(l),a&&a.listen&&a.listen(l)}},{name:"javaType",displayWidth:10,defaultValueFn:function(p){return"java.util.List<"+this.subType+">"},help:"The Java type of this property."},{name:"javaLazyFactory",defaultValueFn:function(p){return"return new java.util.ArrayList<"+this.subType+">();"}},{name:"view",defaultValue:"foam.ui.ArrayView"},{name:"factory",defaultValue:function(){return[]}},{name:"propertyToJSON",defaultValue:function(visitor,output,o){!this["transient"]&&o[this.name].length&&(output[this.name]=visitor.visitArray(o[this.name]))}},{name:"install",defaultValue:function(prop){defineLazyProperty(this,prop.name+"$Proxy",function(){var proxy=this.X.lookup("foam.dao.ProxyDAO").create({delegate:this[prop.name].dao});return this.addPropertyListener(prop.name,function(_,__,___,a){proxy.delegate=a.dao}),{get:function(){return proxy},configurable:!0}}),this.addMethod("get"+capitalize(prop.singular),function(id){for(var i=0;i<this[prop.name].length;i++)if(this[prop.name][i].id===id)return this[prop.name][i]})}},{name:"fromElement",defaultValue:function(e,p){for(var model=this.X.lookup(e.getAttribute("model")||p.subType),children=e.children,a=[],i=0;i<children.length;i++){var o=model.create(null,this.Y);o.fromElement(children[i],p),a.push(o)}this[p.name]=a}},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."},{name:"compareProperty",swiftDefaultValue:function(){},javaDefaultValue:function(){}}]}),CLASS({name:"BlobProperty","extends":"Property",help:"A chunk of binary data.",label:"Binary data",properties:[{name:"type",type:"String",defaultValue:"Blob",help:"The FOAM type of this property."},{name:"javaType",type:"String",defaultValue:"byte[]",help:"The Java type for this property."}]}),CLASS({name:"ReferenceProperty","extends":"Property",help:"A foreign key reference to another Entity.",label:"Reference to another object",properties:[{name:"subType",displayWidth:20,defaultValue:"",help:"The FOAM sub-type of this property."},{name:"subKey",displayWidth:20,defaultValue:"ID",help:"The foreign key that this property references."},{name:"javaType",displayWidth:10,defaultValueFn:function(){return this.X.lookup(this.subType)[this.subKey].javaType},help:"The Java type of this property."},{name:"view",defaultValue:"foam.ui.TextFieldView"},{name:"toPropertyE",defaultValue:function(X){return X.lookup("foam.u2.ReferenceView").create(null,X)}},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"StringArrayProperty","extends":"Property",javaClassImports:["java.util.List"],help:"An array of String values.",label:"List of text strings",properties:[{name:"swiftType",defaultValue:"[String]"},{name:"swiftFactory",defaultValue:"return []"},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"javaLazyFactory",defaultValue:"return new java.util.ArrayList<String>();"},{name:"singular",displayWidth:70,defaultValueFn:function(){return this.name.replace(/s$/,"")},help:"The plural form of this model's name.",documentation:function(){}},{name:"subType",displayWidth:20,defaultValue:"String",help:"The FOAM sub-type of this property."},{name:"displayWidth",defaultValue:50},{name:"adapt",defaultValue:function(_,v){return Array.isArray(v)?v:v||0===v?[v]:[]}},{name:"factory",defaultValue:function(){return[]}},{name:"javaType",displayWidth:10,defaultValue:"java.util.List<String>",help:"The Java type of this property."},{name:"view",defaultValue:"foam.ui.StringArrayView"},{name:"prototag",label:"Protobuf tag",required:!1,help:"The protobuf tag number for this field."},{name:"exclusive",defaultValue:!1},{name:"fromString",defaultValue:function(s){return s.split(",")}},{name:"fromElement",defaultValue:function(e,p){for(var val=[],name=p.singular||"item",i=0;i<e.children.length;i++)e.children[i].nodeName===name&&val.push(e.children[i].innerHTML);this[p.name]=val}},{name:"toMemento",defaultValue:function(o,p){return o.map(function(x){return x.replace(/,/g,"&#44;")}).join(",")}},{name:"fromMemento",defaultValue:function(s,p){return s?s.split(",").map(function(x){return x.replace(/&#44;/g,",")}):void 0}},{name:"compareProperty",swiftDefaultValue:function(){},javaDefaultValue:function(){}}]}),CLASS({name:"ModelProperty",
"extends":"Property",help:"Describes a Model property.",label:"Data Model definition",properties:[{name:"getter",labels:["javascript"],defaultValue:function(name){var value=this.instance_[name];if("undefined"==typeof value){var prop=this.model_.getProperty(name);value=prop?prop.lazyFactory?this.instance_[prop.name]=prop.lazyFactory.call(this,prop):prop.factory?this.instance_[prop.name]=prop.factory.call(this,prop):prop.defaultValueFn?prop.defaultValueFn.call(this,prop):void 0!==typeof prop.defaultValue?prop.defaultValue:"":""}if("string"==typeof value){if(!value)return"";var ret=this.X.lookup(value);return ret}return Model.isInstance(value)?value:""}},{name:"propertyToJSON",labels:["javascript"],defaultValue:function(visitor,output,o){this["transient"]||(output[this.name]=o[this.name].id)}}]}),CLASS({name:"ViewProperty","extends":"Property",help:"Describes a View-Factory property.",properties:[{name:"adapt",doc:"Can be specified as either a function, a Model, a Model path, or a JSON object.",defaultValue:function(_,f){return"function"==typeof f?f:"string"==typeof f?function(d,opt_X){return(opt_X||this.X).lookup(f).create(d,opt_X||this.Y)}.bind(this):"function"==typeof f.create?f.create.bind(f):"string"==typeof f.model_?function(d,opt_X){return FOAM(f,opt_X||this.Y).copyFrom(d)}:(console.error("******* Unknown view factory: ",f),f)}},{name:"defaultValue",adapt:function(_,f){return ViewProperty.ADAPT.defaultValue.call(this,null,f)}}]}),CLASS({name:"FactoryProperty","extends":"Property",help:"Describes a Factory property.",properties:[{name:"preSet",doc:"Can be specified as either a function, a Model, a Model path, or a JSON object.",defaultValue:function(_,f){return f?"function"==typeof f?f:"string"==typeof f?function(map,opt_X){return(opt_X||this.X).lookup(f).create(map,opt_X||this.Y)}.bind(this):Model.isInstance(f)?f.create.bind(f):f.factory_?function(map,opt_X){var X=opt_X||this.X,m=X.lookup(f.factory_);return console.assert(m,"Unknown Factory Model: "+f.factory_),m.create(f,opt_X||this.Y)}.bind(this):(console.error("******* Invalid Factory: ",f),f):f}}]}),CLASS({name:"ViewFactoryProperty","extends":"FactoryProperty",help:"Describes a View Factory property.",properties:[{name:"defaultValue",preSet:function(_,f){return ViewFactoryProperty.ADAPT.defaultValue.call(this,null,f)}},{name:"defaultValueFn",preSet:function(_,f){var fp=function(prop){return ViewFactoryProperty.ADAPT.defaultValue.call(this,null,f.call(this,prop))};return fp.toString=function(){return f.toString()},fp}},{name:"fromElement",defaultValue:function(e,p){this[p.name]=e.innerHTML_||(e.innerHTML_=e.innerHTML)}},{name:"adapt",doc:"Can be specified as either a function, String markup, a Model, a Model path, or a JSON object.",defaultValue:function(_,f){if(!f)return f;if("function"==typeof f)return f;var ret;if("string"==typeof f){if(/[^0-9a-zA-Z$_.]/.exec(f)){var VIEW_CACHE=ViewFactoryProperty.VIEW_CACHE||(ViewFactoryProperty.VIEW_CACHE={}),viewModel=VIEW_CACHE[f];viewModel||(viewModel=VIEW_CACHE[f]=Model.create({name:"InnerDetailView"+this.$UID,"extends":"foam.ui.DetailView",templates:[{name:"toHTML",template:f}]}),viewModel.arequire()),ret=function(args,X){return viewModel.create(args,X||this.Y)}}else ret=function(map,opt_X){var model=(opt_X||this.X).lookup(f);return console.assert(!!model,"Unknown model: "+f+" in "+this.name+" property"),model.create(map,opt_X||this.Y)}.bind(this);return ret.toString=function(){return'"'+f+'"'},ret}return Model.isInstance(f)?function(args,opt_X){return f.create(args,opt_X||this.Y)}.bind(this):f.factory_?(ret=function(map,opt_X){var m=(opt_X||this.X).lookup(f.factory_);return console.assert(m,"Unknown ViewFactory Model: "+f.factory_),m.create(f,opt_X||this.Y).copyFrom(map)},ret.toString=function(){return JSONUtil.compact.stringify(f)},ret):this.X.lookup("foam.ui.BaseView").isInstance(f)?constantFn(f):(console.error("******* Invalid Factory: ",f),f)}}]}),CLASS({name:"ReferenceArrayProperty","extends":"ReferenceProperty",properties:[{name:"factory",defaultValue:function(){return[]}},{name:"javaType",defaultValueFn:function(){return this.X.lookup(this.subType).ID.javaType+"[]"}},{name:"view",defaultValue:"foam.ui.StringArrayView"}]}),CLASS({name:"EMailProperty","extends":"StringProperty",label:"Email address",properties:[["pattern","^.+@.+$"]]}),CLASS({name:"ImageProperty","extends":"StringProperty",label:"Image data or link",properties:[{name:"view",labels:["javascript"],defaultValue:"foam.ui.md.ImagePickerView"}]}),CLASS({name:"URLProperty","extends":"StringProperty",label:"Web link (URL or internet address)"}),CLASS({name:"ColorProperty","extends":"StringProperty",label:"Color",properties:[["view","foam.ui.md.ColorFieldView"]]}),CLASS({name:"PasswordProperty","extends":"StringProperty",label:"Password that displays protected or hidden text",properties:[{name:"swiftView",defaultValue:"FoamPasswordUITextField"}]}),CLASS({name:"PhoneNumberProperty","extends":"StringProperty",label:"Phone number",properties:[["pattern","^[0-9-+()* ]*$"]]}),DEBUG&&CLASS({name:"DocumentationProperty","extends":"Property",help:"Describes the documentation properties found on Models, Properties, Actions, Methods, etc.",documentation:"The developer documentation for this $$DOC{ref:'.'}. Use a $$DOC{ref:'DocModelView'} to view documentation.",properties:[{name:"getter",labels:["debug"],defaultValue:function(name){var doc=this.instance_[name];return!doc||"undefined"==typeof Documentation||!Documentation||doc.model_&&doc.model_.getPrototype&&Documentation.isInstance(doc)||(doc.body?this.instance_[name]=Documentation.create(doc):this.instance_[name]=Documentation.create({body:doc})),this.instance_[name]}},{name:"view",defaultValue:"foam.ui.DetailView",labels:["debug"]},{name:"help",defaultValue:"Documentation for this entity.",labels:["debug"]},{name:"documentation",factory:function(){return"The developer documentation for this $$DOC{ref:'.'}. Use a $$DOC{ref:'DocModelView'} to view documentation."},labels:["debug"]}]}),CLASS({name:"ImportedProperty","extends":"Property",label:"A pseudo-property that does not clone its value.",properties:[["transient",!0],["hidden",!0]],methods:[function deepCloneProperty(value,cloneArgs){this.cloneProperty(value,cloneArgs)},function cloneProperty(value,cloneArgs){cloneArgs[this.name]=value}]}),CLASS({name:"EnumProperty","extends":"Property",properties:[{name:"enum",swiftType:"FoamEnum.Type"},{name:"view",labels:["javascript"],defaultValue:"foam.ui.EnumFieldView"},{name:"swiftType",defaultValueFn:function(){return this["enum"].split(".").pop()}},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`.value, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"swiftAdapt",defaultValue:function(){}},{name:"defaultValue",adapt:function(_,v){if("string"==typeof v&&X.lookup(this["enum"])){var e=X.lookup(this["enum"]);return e[e[v]]}return v}},{name:"swiftDefaultValue",defaultValueFn:function(){return"string"==typeof this.defaultValue&&(this.defaultValue=this.defaultValue),this.defaultValue&&this.defaultValue.name?this["enum"].split(".").pop()+"."+this.defaultValue.name:void 0}},{name:"javaDefaultValue",defaultValueFn:function(){return"string"==typeof this.defaultValue&&(this.defaultValue=this.defaultValue),this.defaultValue&&this.defaultValue.name?this["enum"]+"."+this.defaultValue.name:void 0}},{name:"javaType",defaultValueFn:function(){return this["enum"]}},{name:"toPropertyE",defaultValue:function(X){return X.lookup("foam.u2.EnumView").create(null,X)}},{name:"swiftView",defaultValue:"FoamEnumUILabel"}]}),CLASS({name:"FObjectProperty","extends":"Property",help:"Describes a properties of type FObject.",label:"FObject",properties:[{name:"javaType",defaultValueFn:function(){return this.subType||"FObject"}},{name:"swiftType",defaultValueFn:function(){return this.subType?this.subType.split(".").pop():"FObject"}},{name:"swiftNSCoderEncode",defaultValue:'aCoder.encodeObject(`<%= this.name %>`, forKey: "<%= this.name %>")'},{name:"swiftNSCoderDecode",defaultValue:'set("<%= this.name %>", value: aDecoder.decodeObjectForKey("<%= this.name %>"))'},{name:"compareProperty",swiftDefaultValue:function(){}}]}),CLASS({name:"Template",tableProperties:["name","description"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The template's unique name.",documentation:function(){}},{name:"description",type:"String",labels:["javascript"],required:!0,displayWidth:70,displayHeight:1,defaultValue:"",help:"The template's description.",documentation:"A human readable description of the $$DOC{ref:'.'}."},{type:"Array",name:"args",type:"Array[Arg]",subType:"Arg",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Method arguments.",documentation:function(){}},{name:"template",type:"String",displayWidth:180,displayHeight:30,defaultValue:"",view:"foam.ui.TextAreaView",help:"Template text. <%= expr %> or <% out(...); %>",documentation:"The string content of the uncompiled $$DOC{ref:'Template'} body."},{name:"path"},{name:"futureTemplate","transient":!0},{name:"code","transient":!0},{type:"Documentation",name:"documentation",labels:["debug"]},{name:"language",type:"String",lazyFactory:function(){return"CSS"===this.name?"css":"html"}},{name:"labels"}],methods:[function toE(X){return X.data[this.name]()}]}),CLASS({name:"Action",plural:"Actions",tableProperties:["name","label"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the action.",documentation:function(){}},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return labelize(this.name)},help:"The display label for the action.",documentation:function(){}},{name:"speechLabel",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The speech label for the action.",documentation:"A speakable label for the $$DOC{ref:'.'}. Used for accessibility."},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",help:"Help text associated with the action.",documentation:function(){}},{type:"Documentation",name:"documentation",documentation:"The developer documentation.",labels:["documentation"]},{name:"default",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!1,help:"Indicates if this is the default action.",documentation:function(){}},{type:"Function",name:"isAvailable",label:"Available",displayWidth:70,displayHeight:3,defaultValue:function(){return!0},help:"Function to determine if action is available.",documentation:function(){}},{type:"Function",name:"isEnabled",label:"Enabled",displayWidth:70,displayHeight:3,defaultValue:function(){return!0},help:"Function to determine if action is enabled.",documentation:function(){}},{type:"Function",name:"labelFn",label:"Label Function",defaultValue:function(action){return action.label},help:"Function to determine label. Defaults to 'this.label'.",documentation:function(){}},{name:"iconUrl",type:"String",defaultValue:void 0,help:"Provides a url for an icon to render for this action",documentation:function(){}},{type:"Function",name:"iconUrlFn",label:"Label Function",defaultValue:function(action){return action.iconUrl},help:"Function to determine iconUrl. Defaults to 'this.iconUrl'.",documentation:function(){}},{name:"ligature",type:"String",defaultValue:void 0,help:"Provides a ligature for font-based icons for this action",documentation:function(){}},{name:"showLabel",type:"String",defaultValue:!0,help:"Property indicating whether the label should be rendered alongside the icon",documentation:function(){}},{name:"children",type:"Array",factory:function(){return[]},subType:"Action",view:"foam.ui.ArrayView",help:"Child actions of this action.",documentation:function(){}},{name:"parent",type:"String",help:"The parent action of this action",documentation:function(){}},{type:"Function",name:"code",displayWidth:80,displayHeight:20,defaultValue:"",help:"Function to implement action.",documentation:function(){}},{type:"Function",name:"action",displayWidth:80,displayHeight:20,defaultValue:"",getter:function(){return console.log("deprecated use of Action.action"),this.code},setter:function(code){return console.log("deprecated use of Action.action"),this.code=code}},{type:"StringArray",name:"keyboardShortcuts",documentation:function(){}},{name:"translationHint",label:"Description for Translation",type:"String",defaultValue:""},{name:"priority",type:"Int",defaultValue:5,help:"Measure of importance of showing this action to the user when it is rendered in a list.",documentation:function(){}},{name:"order",type:"Float",defaultValue:5,help:"Indication of where this action should appear in an ordered list of actions.",documentation:function(){}},{type:"String",name:"swiftCode",labels:["swift"]},{model_:"TemplateProperty",name:"swiftSource",labels:["swift"],defaultValue:function(){}}],methods:[function toE(X){return console.assert(X,"X required for Action.toE()."),X.lookup("foam.u2.ActionButton").create({data:X.data,action:this},X)},function maybeCall(X,that){return this.isAvailable.call(that,this)&&this.isEnabled.call(that,this)?(this.code.call(that,X,this),that.publish(["action",this.name],this),!0):!1}]}),CLASS({name:"Arg",tableProperties:["type","name","description"],documentation:function(){},properties:[{name:"type",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"Object",labels:["debug"],help:"The type of this argument.",documentation:function(){}},{name:"javaType",type:"String",required:!1,defaultValueFn:function(){var type=X.lookup(this.type+"Property");if(type)return type.create().javaType},help:"The java type that represents the type of this property.",labels:["debug"],documentation:function(){}},{name:"javascriptType",type:"String",required:!1,defaultValueFn:function(){return this.type},help:"The javascript type that represents the type of this property.",labels:["debug"],documentation:function(){}},{name:"swiftType",type:"String",labels:["swift"],defaultValueFn:function(){var type=X.lookup(this.type+"Property");if(type)return type.create().swiftType}},{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{type:"Boolean",name:"required",defaultValue:!0,labels:["debug"],documentation:function(){}},{name:"defaultValue",help:"Default Value if not required and not provided.",labels:["debug"],documentation:function(){}},{name:"description",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this argument.",labels:["debug"],documentation:function(){}},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",help:"Help text associated with the entity.",labels:["debug"],documentation:function(){}},{type:"Documentation",name:"documentation",documentation:"The developer documentation.",labels:["debug"]}],methods:{decorateFunction:function(f,i){if("Object"===this.type)return f;var type=this.type;return this.required?function(){return console.assert(void 0!==arguments[i],"Missing required argument# "+i),console.assert(typeof arguments[i]===type,"argument# "+i+" type expected to be "+type+", but was "+typeof arguments[i]+": "+arguments[i]),f.apply(this,arguments)}:function(){return console.assert(void 0===arguments[i]||typeof arguments[i]===type,"argument# "+i+" type expected to be "+type+", but was "+typeof arguments[i]+": "+arguments[i]),f.apply(this,arguments)}}},templates:[{model_:"Template",name:"javaSource",description:"Java Source",template:"<%= this.javaType %> <%= this.name %>",labels:["debug"]},{model_:"Template",name:"closureSource",description:"Closure JavaScript Source",template:"@param {<%= this.javascriptType %>} <%= this.name %> .",labels:["debug"]},{model_:"Template",name:"webIdl",description:"Web IDL Source",template:"<%= this.type %> <%= this.name %>",labels:["debug"]}]}),CLASS({name:"Constant",plural:"constants",tableProperties:["name","value","description"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{type:"String",name:"units"},{type:"String",labels:["swift"],name:"swiftType",defaultValueFn:function(){var type=X.lookup(this.type+"Property");if(type)return type.create().swiftType}},{type:"String",labels:["swift"],name:"swiftValue",defaultValueFn:function(){if(this.type){var type=X.lookup(this.type+"Property");if(type)return type=type.create(),type.defaultValue=this.value,type.swiftDefaultValue}}},{type:"String",labels:["java"],name:"javaType",defaultValueFn:function(){var type=X.lookup(this.type+"Property");if(type)return type.create().javaType}},{type:"String",labels:["java"],name:"javaValue",defaultValueFn:function(){if(this.type){var type=X.lookup(this.type+"Property");if(type)return type=type.create(),type.defaultValue=this.value,type.javaDefaultValue}}},{name:"description",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this method.",documentation:function(){}},{type:"Documentation",name:"documentation",documentation:"The developer documentation.",labels:["debug"]},{name:"value",help:"The value of the constant."},{name:"type",defaultValue:"",help:"Type of the constant."},{name:"translationHint",label:"Description for Translation",type:"String",defaultValue:""}]}),CLASS({name:"Method",plural:"Methods",tableProperties:["name","description"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{name:"description",type:"String",labels:["javascript"],displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this method.",documentation:function(){}},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",labels:["debug"],help:"Help text associated with the entity.",documentation:function(){}},{type:"Documentation",name:"documentation",documentation:"The developer documentation.",labels:["debug"]},{name:"code",type:"Function",displayWidth:80,displayHeight:30,view:"foam.ui.FunctionView",help:"Javascript code to implement this method.",postSet:function(){if(_DOC_){var multilineComment=/^\s*function\s*\([\$\s\w\,]*?\)\s*{\s*\/\*([\s\S]*?)\*\/[\s\S]*$|^\s*\/\*([\s\S]*?)\*\/([\s\S]*)/.exec(this.code.toString());if(multilineComment){var bodyFn=multilineComment[1];this.documentation=this.Y.Documentation.create({name:this.name,body:bodyFn})}}},documentation:function(){}},{name:"returnType",defaultValue:"",help:"Return type.",documentation:function(){},labels:["debug"]},{name:"javaReturnType",labels:["java"],defaultValueFn:function(){if(!this.returnType)return"void";var type=X.lookup(this.returnType+"Property");if(type)return type.create().javaType}},{name:"swiftReturnType",labels:["swift"],defaultValueFn:function(){if(!this.returnType)return"Void";var type=X.lookup(this.returnType+"Property");if(type)return type.create().swiftType}},{type:"Boolean",name:"returnTypeRequired",defaultValue:!0,documentation:function(){},labels:["debug"]},{type:"Array",name:"args",type:"Array[Arg]",subType:"Arg",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Method arguments.",documentation:function(){},labels:["debug"],adapt:function(_,n){return n.forEach(function(arg,i){n[i]=Arg.create(arg)}.bind(this)),n}},{name:"whenIdle",help:"Should this listener be deferred until the system is idle (ie. not running any animations).",documentation:function(){}},{name:"isMerged",help:"As a listener, should this be merged?",documentation:function(){}},{type:"Boolean",name:"isFramed",help:"As a listener, should this be animated?",defaultValue:!1,documentation:function(){}},{type:"Boolean",name:"isStatic",labels:["java","swift"]},{name:"labels"},{type:"String",name:"swiftCode",labels:["swift"]},{type:"String",name:"javaCode",labels:["java"]},{model_:"TemplateProperty",name:"swiftSource",labels:["swift"],defaultValue:function(){}},{model_:"TemplateProperty",name:"javaSource",labels:["java"],defaultValue:function(){}}],methods:[function toE(X){return X.data[this.name]()}],templates:[{model_:"Template",name:"closureSource",description:"Closure JavaScript Source",template:"/**\n<% for ( var i = 0; i < this.args.length ; i++ ) { var arg = this.args[i]; %> * <%= arg.closureSource() %>\n<% } %><% if (this.returnType) { %> * @return {<%= this.returnType %>} .\n<% } %> */\n<%= arguments[1] %>.prototype.<%= this.name %> = goog.abstractMethod;"},{model_:"Template",name:"webIdl",description:"Web IDL Source",template:"<%= this.returnType || 'void' %> <%= this.name %>(<% for ( var i = 0 ; i < this.args.length ; i++ ) { var arg = this.args[i]; %><%= arg.webIdl() %><% if ( i < this.args.length-1 ) out(\", \"); %><% } %>)"}]}),Method.getPrototype().decorateFunction=function(f){for(var i=0;i<this.args.length;i++){var arg=this.args[i];f=arg.decorateFunction(f,i)}var returnType=this.returnType;return returnType?function(){var ret=f.apply(this,arguments);return console.assert(typeof ret===returnType,"return type expected to be "+returnType+", but was "+typeof ret+": "+ret),ret}:f},Method.getPrototype().generateFunction=function(){var f=this.code;return DEBUG?this.decorateFunction(f):f},Method.methods={decorateFunction:Method.getPrototype().decorateFunction,generateFunction:Method.getPrototype().generateFunction},CLASS({name:"Documentation",tableProperties:["name"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"documentation",help:"The Document's unique name.",documentation:"An optional name for the document. Documentation is normally referenced by the name of the containing Model."},{name:"label",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The Document's title or descriptive label.",documentation:"A human readable title to display. Used for books of documentation and chapters."},{name:"body",type:"Template",defaultValue:"",help:"The main content of the document.",documentation:"The main body text of the document. Any valid template can be used, including the $$DOC{ref:'foam.documentation.DocView'} specific $$DOC{ref:'foam.documentation.DocView',text:'$$DOC{\"ref\"}'} tag.",preSet:function(_,template){return TemplateUtil.expandTemplate(this,template)}},{type:"Array",name:"chapters",type:"Array[Document]",subtype:"Documentation",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Sub-documents comprising the full body of this document.",documentation:"Optional sub-documents to be included in this document. A viewer may choose to provide an index or a table of contents.",labels:["debug"],preSet:function(old,nu){if(!_DOC_)return[];var self=this,foamalized=[];return nu.forEach(function(chapter){!chapter||"undefined"==typeof self.Y.Documentation||!self.Y.Documentation||chapter.model_&&chapter.model_.getPrototype&&self.Y.Documentation.isInstance(chapter)?foamalized.push(chapter):chapter.body?foamalized.push(self.Y.Documentation.create(chapter)):foamalized.push(self.Y.Documentation.create({body:chapter}))}),foamalized}}]}),CLASS({name:"Relationship",tableProperties:["name","label","relatedModel","relatedProperty"],documentation:function(){},properties:[{name:"name",type:"String",displayWidth:30,displayHeight:1,defaultValueFn:function(){return GLOBAL[this.relatedModel]?GLOBAL[this.relatedModel].plural:""},documentation:function(){},help:"The coding identifier for the relationship."},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.name.labelize()},documentation:function(){},help:"The display label for the relationship."},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",documentation:function(){},help:"Help text associated with the relationship."},{type:"Documentation",name:"documentation",documentation:function(){}},{name:"relatedModel",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",documentation:function(){},help:"The name of the related Model."},{name:"destinationModel",type:"String",required:!1,displayWidth:30,displayHeight:1},{name:"destinationProperty",type:"String",required:!1,displayWidth:30,displayHeight:1},{name:"relatedProperty",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",documentation:function(){},help:"The join property of the related Model."},{name:"toRelationshipE",labels:["javascript"],defaultValue:function toRelationshipE(X){return X.lookup("foam.u2.DAOController").create(null,X)},adapt:function(_,nu){return"string"==typeof nu?function(X){return X.lookup(nu).create(null,X)}:nu}}],methods:[function toE(X){return X.lookup("foam.u2.RelationshipView").create({relationship:this,view:this.toRelationshipE(X)},X)}]}),function(){for(var i=0;i<Model.templates.length;i++)Model.templates[i]=JSONUtil.mapToObj(X,Model.templates[i]);Model.properties=Model.properties,delete Model.instance_.prototype_,Model=Model.create(Model)}(),recopyModelFeatures(Property),recopyModelFeatures(Model),recopyModelFeatures(Method),recopyModelFeatures(Action),recopyModelFeatures(Template),DEBUG)for(var id in UNUSED_MODELS)USED_MODELS[id]&&recopyModelFeatures(GLOBAL.lookup(id));USED_MODELS.Model=!0,CLASS({"package":"foam.ui",name:"Window",exports:["performance","$$","$","addStyle","animate","cancelAnimationFrame","clearInterval","clearTimeout","console","document","framed","dynamic","dynamicFn","dynamic2","dynamic3","error","info","installedModels","log","requestAnimationFrame","setInterval","setTimeout","warn","window","writeView","as FOAMWindow"],properties:[{name:"registeredModels",factory:function(){return{}}},{type:"String",name:"name",defaultValue:"window"},{name:"window",postSet:function(_,w){this.X.subDocument&&this.X.subDocument(w.document),w.X=this.Y,this.document=w.document,this.performance=w.performance}},{name:"document"},{name:"performance"},{name:"installedModels",documentation:"Each new Window context introduces a new document and resets installedModels so models will install again in the new document.",factory:function(){return{}}},{name:"installedStyles",factory:function(){return{}}},{type:"Boolean",name:"isBackground",defaultValue:!1},{name:"console",lazyFactory:function(){return this.window.console}}],methods:{addStyle:function(obj){var id=obj.model_.id;if(!this.installedStyles[id]){this.installedStyles[id]=!0;var css=obj.CSS()+"\n\n/*# sourceURL="+id.replace(/\./g,"/")+".CSS */\n";if(this.document&&this.document.createElement){var s=this.document.createElement("style");s.innerHTML=css,this.document.head.insertBefore(s,this.document.head.firstElementChild)}}},log:function(){this.console.log.apply(this.console,arguments)},warn:function(){this.console.warn.apply(this.console,arguments)},info:function(){this.console.info.apply(this.console,arguments)},error:function(){this.console.error.apply(this.console,arguments)},$:function(id){return this.document.FOAM_OBJECTS&&this.document.FOAM_OBJECTS[id]?this.document.FOAM_OBJECTS[id]:this.document.getElementById(id)},$$:function(cls){return this.document.getElementsByClassName(cls)},framed:function(listener){return EventService.framed(listener,this)},dynamic:function(fn){return 1==arguments.length?FunctionValue.create({valueFactory:fn},this):OrValue.create({valueFactory:fn,values:Array.prototype.splice.call(arguments,1)},this)},dynamicFn:function(fn,opt_fn){return Events.dynamicFn(fn,opt_fn,this.Y)},dynamic2:function(fn){var listener=this.framed(fn),propertyValues=[];fn(),Events.onGet.push(function(obj,name,value){if(arguments.callee.caller.caller!==fn)return void console.log("false alarm ",fn.toString());var value=obj.propertyValue(name);value.addListener(listener),propertyValues.push(value)});var ret=fn();Events.onGet.pop();var f=function(){propertyValues.forEach(function(p){p.removeListener(listener)})};return f.destroy=f,f},dynamic3:function(obj,fn,opt_ret){for(var values=fn.dependencies.map(function(name){return obj.propertyValue(name)}),listener=this.framed(function(){var ret=fn.call(obj);opt_ret&&opt_ret(ret)}),i=0;i<values.length;i++)values[i].addListener(listener);var f=function(){for(var i=0;i<values.length;i++)values[i].removeListener(listener)};return f.destroy=f,f},animate:function(duration,fn,opt_interp,opt_onEnd){return Movement.animate(duration,fn,opt_interp,opt_onEnd,this.Y)},setTimeout:function(f,t){return this.window.setTimeout.apply(this.window,arguments)},clearTimeout:function(id){this.window.clearTimeout(id)},setInterval:function(f,t){return this.window.setInterval.apply(this.window,arguments)},clearInterval:function(id){this.window.clearInterval(id)},requestAnimationFrame:function(f){return this.isBackground?this.setTimeout(f,16):(console.assert(this.window.requestAnimationFrame,"requestAnimationFrame not defined"),this.window.requestAnimationFrame(f))},cancelAnimationFrame:function(id){return this.isBackground?void this.clearTimeout(id):void(this.window.cancelAnimationFrame&&this.window.cancelAnimationFrame(id))},writeView:function(view,opt_X){var document=(opt_X||this).document,html=view.toHTML();document.body.insertAdjacentHTML("beforeend",html),view.initHTML()}}}),function(){var w=foam.ui.Window.create({window:window,name:"DEFAULT WINDOW",isBackground:"object"==typeof process},X);FObject.X=X=w.Y}(),CLASS({name:"SimpleValue",properties:[{name:"value"}],constants:{__isValue__:!0},methods:[function init(value){this.value=value||""},function get(){return this.value},function set(val){this.value=val},function toString(){return"SimpleValue("+this.value+")"},function follow(srcValue){Events.follow(srcValue,this)}]}),CLASS({name:"FunctionValue","extends":"SimpleValue",properties:[{name:"values",factory:function(){return[]}},{name:"valueFactory"}],methods:[function init(){this.SUPER(),this.valueFactory();var f=this.valueFactory;this.startRecordingDependencies(),this.value=f(),this.endRecordingDependencies();for(var i=0;i<this.values.length;i++)this.values[i].addListener(this.onSubValueChange)},function destroy(){for(var i=0;i<this.values.length;i++)this.values[i].removeListener(this.onSubValueChange)},function startRecordingDependencies(){var values=this.values,onSubValueChange=this.onSubValueChange;Events.onGet.push(function(obj,name,value){var l=obj.propertyValue(name);-1==values.indexOf(l)&&(values.push(l),l.addListener(onSubValueChange))})},function endRecordingDependencies(){Events.onGet.pop()},function get(){return this.value},function set(val){},function toString(){return"FunctionValue("+this.value+")"}],listeners:[function onSubValueChange_(){this.value=this.valueFactory()},{name:"onSubValueChange",isFramed:!0,code:function(){this.onSubValueChange_()}}]}),CLASS({name:"OrValue","extends":"SimpleValue",properties:[{name:"values"},{name:"valueFactory",defaultValue:function(){return arguments}}],methods:[function init(){this.SUPER();for(var i=0;i<this.values.length;i++)this.values[i].addListener(this.onSubValueChange);this.onSubValueChange_()},function destroy(){for(var i=0;i<this.values.length;i++)this.values[i].removeListener(this.onSubValueChange)},function get(){return this.value},function set(val){},function toString(){return"OrValue("+this.value+")"}],listeners:[function onSubValueChange_(){for(var args=new Array(this.values.length),i=0;i<this.values.length;i++)args[i]=this.values[i].get();this.value=this.valueFactory.apply(this,args)},{name:"onSubValueChange",isFramed:!0,code:function(){this.onSubValueChange_()}}]}),CLASS({name:"SimpleReadOnlyValue","extends":"SimpleValue",documentation:"A simple value that can only be set during initialization.",
properties:[{name:"value",preSet:function(old,nu){return"undefined"==typeof this.instance_.value?nu:old}}],methods:{set:function(val){"undefined"==typeof this.instance_.value&&this.SUPER(val)},toString:function(){return"SimpleReadOnlyValue("+this.value+")"}}});var DOM={init:function(X){X.document.FOAM_OBJECTS||(X.document.FOAM_OBJECTS={});for(var fs=X.document.querySelectorAll("foam"),models=[],i=0;i<fs.length;i++){var e=fs[i];X.lookup(e.getAttribute("view")),X.lookup(e.getAttribute("model")),e.getAttribute("view")&&models.push(X.arequire(e.getAttribute("view"))),e.getAttribute("model")&&models.push(X.arequire(e.getAttribute("model")))}for(var key in USED_MODELS)models.push(X.arequire(key));atime("DOMInit",aseq(apar.apply(null,models),function(ret){for(var i=0;i<fs.length;i++){for(var e=fs[i],node=e,body=X.document.body;node&&node!==body;)node=node.parentNode;node&&(this.initElement(e,X,X.document),e.innerHTML=""),ret()}}.bind(this)))()},initElementChildren:function(e,X){for(var a=[],i=0;i<e.children.length;i++){var c=e.children[i];"FOAM"===c.tagName&&a.push(DOM.initElement(c,X))}return a},initElement:function(e,X,opt_document){X.arequire("foam.ui.FoamTagView")(function(t){foam.ui.FoamTagView.create({element:e},X)})},setClass:function(e,className,opt_enabled){var oldClassName=e.className||"",enabled=void 0===opt_enabled?!0:opt_enabled;e.className=oldClassName.replace(" "+className,"").replace(className,""),enabled&&(e.className=e.className+" "+className)}};window&&window.addEventListener&&window.addEventListener("load",function(){DOM.init(X)},!1);var DomValue={DEFAULT_EVENT:"change",DEFAULT_PROPERTY:"value",__isValue__:!0,create:function(element,opt_event,opt_property){if(!element)throw"Missing Element in DomValue";return{__proto__:this,element:element,event:opt_event||this.DEFAULT_EVENT,property:opt_property||this.DEFAULT_PROPERTY}},setElement:function(element){this.element=element},get:function(){return this.element[this.property]},set:function(value){this.element[this.property]!==value&&(this.element[this.property]=value)},addListener:function(listener){if(this.event)try{this.element.addEventListener(this.event,listener,!1)}catch(x){}},removeListener:function(listener){if(this.event)try{this.element.removeEventListener(this.event,listener,!1)}catch(x){}},toString:function(){return"DomValue("+this.event+", "+this.property+")"}};CLASS({name:"DOMValue",constants:{__isValue__:!0},properties:[{name:"element",required:!0},{name:"property",defaultValue:"value"},{name:"event",defaultValue:"change"},{name:"value",postSet:function(_,value){this.element[this.property]=value}},{name:"firstListener_",defaultValue:!0}],methods:{init:function(){this.SUPER(),this.value=this.element[this.property]},get:function(){return this.value},set:function(value){this.value=value},addListener:function(listener){this.firstListener_&&(this.event&&this.element.addEventListener(this.event,function(){},!1),this.firstListener_=!1),this.value$.addListener(listener)},removeListener:function(listener){this.value$.removeListener(listener)},toString:function(){return"DOMValue("+this.event+", "+this.property+")"}}});var __element_map__={INPUT:"foam.u2.tag.Input",TEXTAREA:"foam.u2.tag.TextArea",SELECT:"foam.u2.tag.Select"};X.__element_map__=__element_map__,X.elementForName=elementForName,X.elementForFeature=elementForFeature,X.registerE=registerE,X.E=E,X.start=start,CLASS({"package":"foam.ui",name:"FoamTagView","extends":"foam.ui.View",requires:["foam.html.Element","foam.ui.View","foam.ui.DetailView"],imports:["document"],properties:[{name:"element"},{name:"className",defaultValue:"foam-tag"}],methods:{init:function(){this.SUPER(),this.Element.isInstance(this.element)||this.install()},install:function(){var e=this.element,models=[],style=e.getAttribute("style"),modelName=e.getAttribute("model"),viewName=e.getAttribute("view"),onInit=e.getAttribute("oninit");modelName&&models.push(this.X.arequire(modelName)),viewName&&models.push(this.X.arequire(viewName)),aseq(apar.apply(null,models),function(ret){if(this.holder()){var model=this.X.lookup(modelName);if(!model)return void this.error("Unknown Model: ",modelName);model.getPrototype();var obj=model.create(null,this.X);obj.fromElement(e),obj.model_.DATA&&this.hasOwnProperty("data")&&(obj.data=this.data);var view;if(viewName){var viewModel=this.X.lookup(viewName);view=viewModel.create({model:model,data:obj},obj.Y)}else if(obj.toHTML)view=obj;else if(obj.toView_)view=obj.toView_();else if(obj.toE)view=obj.toE(obj.Y);else{var a=this.element.getAttribute("showActions"),showActions=!a||a.equalsIC("y")||a.equalsIC("yes")||a.equalsIC("true")||a.equalsIC("t");view=this.X.lookup("foam.ui.DetailView").create({model:model,data:obj,showActions:showActions},obj.Y)}e.id&&(this.document.FOAM_OBJECTS[e.id]=obj),obj.view_=view,this.holder().outerHTML=view.toHTML(),style&&view.$.setAttribute("style",style),view.initHTML(),onInit&&aeval("function() { "+onInit+" }")(function(f){f.call(obj)})}}.bind(this))()},holder:function(){return this.Element.isInstance(this.element)?this.$:this.element},error:function(msg){console.error(msg),this.holder.innerHTML=msg},initHTML:function(){this.install()}}}),CLASS({"package":"foam.grammars",name:"CSSDecl",imports:["assert"],documentation:function(){},constants:{PREFIXES:["-webkit-"],PREFIXED_KEYS:{"align-content":!0,"align-items":!0,"align-self":!0,animation:!0,"box-shadow":!0,"column-count":!0,"column-gap":!0,"column-rule":!0,display:"flex",filter:!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"font-feature-settings":!0,hyphens:!0,"justify-content":!0,keyframes:!0,order:!0,transform:!0,"transform-origin":!0,"user-select":!0}},properties:[{name:"parser",lazyFactory:function(){return SkipGrammar.create(this.parser_,seq("/*",repeat(not("*/",anyChar)),"*/"))}},{name:"parser_",lazyFactory:function(){var css=this;return{__proto__:grammar,START:sym("stylesheet"),ws:alt(" ","	","\n","\r","\f"),wsc:alt(sym("ws"),","),ws_:repeat0(sym("ws")),wsp_:plus0(sym("ws")),alphaNum:alt("-",range("a","z"),range("A","Z"),range("0","9")),punct:alt(range("!","'"),range("*","+"),range("-","/"),range("<","@"),range("[","`"),"|","~"),anp:alt(sym("alphaNum"),sym("punct")),stylesheet:str(seq(sym("ws_"),str(repeat(alt(sym("stmtRule"),sym("blockRule")),sym("ws_"))))),rulePrefix:plus(str(plus(alt(sym("anp"),",","(",")",":"))),sym("wsp_")),stmtRule:str(seq(sym("rulePrefix"),";")),blockRule:str(seq(sym("rulePrefix"),sym("block"))),blockList:str(plus(sym("blockRule"),sym("ws_"))),fnArgs:seq("(",sym("ws_"),str(repeat(sym("fnArg"))),")"),fnArg:seq(str(plus(alt(sym("fnArgs"),sym("fnArgIdent")))),repeat(sym("wsc"))),fnArgIdent:str(plus(alt(sym("anp"),"{","}",";",":"))),declLHS:str(plus(alt(sym("anp"),",","(",")",";"))),declRHS:plus(str(plus(alt(sym("fnArgs"),sym("declRHSIdent")))),sym("wsp_")),declRHSIdent:str(plus(alt(sym("anp"),",",":"))),decl:seq(sym("declLHS"),sym("ws_"),":",sym("ws_"),sym("declRHS")),declList:plus(sym("decl"),seq(";",sym("ws_"))),block:seq("{",sym("ws_"),optional(alt(sym("blockList"),sym("declList"))),"}")}.addActions({rulePrefix:function(parts){return parts=parts.map(function(p){return p.indexOf("^")>=0?p.replace(/\^/g,css.modelName_+"-"):p}),parts.join(" ")},block:function(parts){return"{"+(parts[2]?parts[2]:"")+"}"},declList:function(parts){return parts.join(";")},declRHS:function(parts){return parts.join(" ")},decl:function(parts){var key=parts[0],value=parts[4],data=css.PREFIXED_KEYS[key];if(!data||0===css.PREFIXES.length)return key+":"+value;var rtn="";if(data===!0||data===value)for(var i=0;i<css.PREFIXES.length;++i){var prefix=css.PREFIXES[i];rtn+=data===!0?prefix+key+":"+value+";":key+":"+prefix+value+";"}return rtn+=key+":"+value},fnArg:function(parts){return parts[0]+(parts[1].indexOf(",")>=0?", ":" ")},fnArgs:function(parts){return"("+parts[2].trim()+")"}})}},{name:"model",documentation:"Optional model which contains this CSS template. Used to expand ^ signs in CSS selectors to the model name.",postSet:function(old,nu){nu&&(nu.buildPrototype(),this.modelName_=nu.CSS_CLASS||cssClassize(nu.id))}},{name:"modelName_",documentation:"The converted model name itself.",adapt:function(old,nu){return"."+nu.split(/ +/).join(".")}}]}),CLASS({"package":"foam.html",name:"Element",constants:{OPTIONAL_CLOSE_TAGS:{HTML:!0,HEAD:!0,BODY:!0,P:!0,DT:!0,DD:!0,LI:!0,OPTION:!0,THEAD:!0,TH:!0,TBODY:!0,TR:!0,TD:!0,TFOOT:!0,COLGROUP:!0},ILLEGAL_CLOSE_TAGS:{IMG:!0,INPUT:!0,BR:!0,HR:!0,FRAME:!0,AREA:!0,BASE:!0,BASEFONT:!0,COL:!0,ISINDEX:!0,LINK:!0,META:!0,PARAM:!0}},properties:[{name:"id"},{name:"nodeName"},{name:"attributeMap_","transient":!0,factory:function(){return{}}},{name:"attributes",factory:function(){return[]},postSet:function(_,attrs){for(var i=0;i<attrs.length;i++)this.attributeMap_[attrs[i].name]=attrs[i]}},{name:"childNodes",factory:function(){return[]}},{name:"children","transient":!0,getter:function(){return this.childNodes.filter(function(c){return"string"!=typeof c})}},{name:"outerHTML","transient":!0,getter:function(){var out="<"+this.nodeName;this.id&&(out+=' id="'+this.id+'"');for(key in this.attributeMap_){var value=this.attributeMap_[key].value;out+=void 0==value?" "+key:" "+key+'="'+this.attributeMap_[key].value+'"'}return this.ILLEGAL_CLOSE_TAGS[this.nodeName]||this.OPTIONAL_CLOSE_TAGS[this.nodeName]&&!this.childNodes.length||(out+=">",out+=this.innerHTML,out+="</"+this.nodeName),out+=">"}},{name:"innerHTML","transient":!0,getter:function(){for(var out="",i=0;i<this.childNodes.length;i++)out+=this.childNodes[i].toString();return out}}],methods:{setAttribute:function(name,value){var attr=this.getAttributeNode(name);attr?attr.value=value:(attr={name:name,value:value},this.attributes.push(attr),this.attributeMap_[name]=attr)},getAttributeNode:function(name){return this.attributeMap_[name]},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value},appendChild:function(c){this.childNodes.push(c)},removeChild:function(c){for(var i=0;i<this.childNodes.length;++i)if(this.childNodes[i]===c){this.childNodes.splice(i,1);break}},toString:function(){return this.outerHTML}}});var HTMLParser={__proto__:grammar,create:function(){return{__proto__:this,stack:[X.foam.html.Element.create({nodeName:"html"})]}},peek:function(){return this.stack[this.stack.length-1]},START:sym("html"),html:repeat0(sym("htmlPart")),htmlPart:simpleAlt(sym("cdata"),sym("comment"),sym("text"),sym("endTag"),sym("startTag")),tag:seq(sym("startTag"),repeat(seq1(1,sym("matchingHTML"),sym("htmlPart")))),matchingHTML:function(ps){return this.stack.length>1?ps:null},startTag:seq("<",sym("tagName"),sym("whitespace"),sym("attributes"),sym("whitespace"),optional("/"),">"),endTag:function(){var endTag_=sym("endTag_");return function(ps){return this.stack.length>1?this.parse(endTag_,ps):void 0}}(),endTag_:seq1(1,"</",sym("tagName"),">"),cdata:seq1(1,"<![CDATA[",str(repeat(not("]]>",anyChar))),"]]>"),comment:seq("<!--",repeat0(not("-->",anyChar)),"-->"),attributes:repeat(sym("attribute"),sym("whitespace")),label:str(plus(notChars(" %=/	\r\n<>'\""))),tagName:sym("label"),text:str(plus(alt("<%",notChar("<")))),attribute:seq(sym("label"),optional(seq1(1,"=",sym("value")))),value:str(alt(plus(alt(range("a","z"),range("A","Z"),range("0","9"))),seq1(1,'"',repeat(notChar('"')),'"'))),whitespace:repeat0(alt(" ","	","\r","\n"))}.addActions({START:function(xs){var ret=this.stack[0];return this.stack=[X.foam.html.Element.create({nodeName:"html"})],ret},tag:function(xs){var ret=this.stack[0];return this.stack=[X.foam.html.Element.create({nodeName:"html"})],ret.childNodes[0]},attribute:function(xs){return{name:xs[0],value:xs[1]}},cdata:function(xs){this.peek()&&this.peek().appendChild(xs)},text:function(xs){this.peek()&&this.peek().appendChild(xs)},startTag:function(xs){var tag=xs[1],obj=X.foam.html.Element.create({nodeName:tag,attributes:xs[3]});return this.peek()&&this.peek().appendChild(obj),"/"!=xs[5]&&this.stack.push(obj),obj},endTag:function(tag){for(var stack=this.stack;stack.length>1;){if(this.peek().nodeName===tag)return void stack.pop();var top=stack.pop();this.peek().childNodes=this.peek().childNodes.concat(top.childNodes),top.childNodes=[]}}});!function(){var registry={};X.registerElement=function(name,model){registry[name]=model,TemplateParser.foamTag_=function(){var start=seq("<",simpleAlt.apply(null,Object.keys(registry).sort(function(o1,o2){return o2.compareTo(o1)}).map(function(k){return literal_ic(k)})),alt("/"," ",">")),html=HTMLParser.create()["export"]("tag");return function(ps){var res=this.parse(start,ps)&&this.parse(html,ps);if(!res)return null;var elem=res.value,model=registry[elem.nodeName];return model&&elem.setAttribute("model",model),res.setValue(elem)}}(),invalidateParsers()},X.elementModel=function(name){return registry[name]}}(),X.registerElement("foam",null),CLASS({name:"Expr","implements":["ExprProtocol"],documentation:"Parent model for all mLang expressions. Contains default implementations for many methods.",methods:[{name:"f",args:[{name:"obj",swiftType:"AnyObject?"}],swiftReturnType:"AnyObject?",swiftCode:'fatalError("You must extend and implement this.")'},function toMQL(){return this.label_},function toSQL(){return this.label_},function toBQL(){return this.label_},function toString(){return this.toMQL()},function exprClone(){var c=Object.create(this.__proto__);c.instance_={},c.X=this.X;for(var key in this.instance_){var value=this[key];void 0!==value&&("function"==typeof value.exprClone?c.instance_[key]=value.exprClone():c.instance_[key]=value)}return c},function collectInputs(terms){terms.push(this)},function partialEval(){return this},function minterm(index,term){return!!(term>>>index[0]--&1)},function normalize(){return this;var inputs,minterms,i,terms,subterms,j},function pipe(sink){var expr=this;return{__proto__:sink,put:function(obj){expr.f(obj)&&sink.put(obj)},remove:function(obj){expr.f(obj)&&sink.remove(obj)}}}]}),CLASS({name:"TrueExpr","extends":"Expr",documentation:"Model for the primitive true value.",methods:[function clone(){return this},function deepClone(){return this},function exprClone(){return this},function toString(){return"<true>"},function toSQL(){return"( 1 = 1 )"},function toMQL(){return""},function toBQL(){return""},function readResolve(){return TRUE},{name:"f",code:function(){return!0},swiftCode:"return true"}]}),CLASS({name:"FalseExpr","extends":"Expr",documentation:"Model for the primitive false value.",methods:[function clone(){return this},function deepClone(){return this},function exprClone(){return this},function toSQL(out){return"( 1 <> 1 )"},function toMQL(out){return"<false>"},function toBQL(out){return"<false>"},function readResolve(){return FALSE},{name:"f",code:function(){return!1},swiftCode:"return false"}]}),CLASS({name:"IdentityExpr","extends":"Expr",documentation:"The identity expression, which passes through its input unchanged.",methods:{clone:function(){return this},deepClone:function(){return this},exprClone:function(){return this},f:function(obj){return obj},toString:function(){return"IDENTITY"},readResolve:function(){return IDENTITY}}});var TRUE=TrueExpr.create(),FALSE=FalseExpr.create(),IDENTITY=IdentityExpr.create();CLASS({name:"NARY","extends":"Expr","abstract":!0,documentation:"Parent model for expressions which take an arbitrary number of arguments.",properties:[{name:"args",label:"Arguments",swiftType:"NSArray",swiftFactory:"return []",help:"Sub-expressions",documentation:"An array of subexpressions which are the arguments to this n-ary expression.",factory:function(){return[]}}],methods:{toString:function(){for(var s=this.name_+"(",i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toString(),i<this.args.length-1&&(s+=", ")}return s+")"},toSQL:function(){var s;s=this.model_.label,s+="(";for(var i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toSQL(),i<this.args.length-1&&out.push(",")}return s+=")"},toMQL:function(){var s;s=this.model_.label,s+="(";for(var i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toMQL(),i<this.args.length-1&&out.push(",")}return s+=")",str},toBQL:function(){var s;s=this.model_.label,s+="(";for(var i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toBQL(),i<this.args.length-1&&out.push(",")}return s+=")",str}}}),CLASS({name:"UNARY","extends":"Expr","abstract":!0,documentation:"Parent model for one-argument expressions.",properties:[{name:"arg1",label:"Argument",swiftType:"AnyObject?",help:"Sub-expression",documentation:"The first argument to the expression.",defaultValue:TRUE,swiftDefaultValue:"TRUE"}],methods:{toSQL:function(){return this.label_+"("+this.arg1.toSQL()+")"},toMQL:function(){return this.label_+"("+this.arg1.toMQL()+")"},toBQL:function(){return this.label_+"("+this.arg1.toBQL()+")"}}}),CLASS({name:"BINARY","extends":"UNARY","abstract":!0,documentation:'Parent model for two-argument expressions. Extends $$DOC{ref: "UNARY"} to include $$DOC{ref: ".arg2"}.',properties:[{name:"arg2",label:"Argument",swiftType:"AnyObject?",swiftDefaultValue:"TRUE",help:"Sub-expression",documentation:"Second argument to the expression.",defaultValue:TRUE}],methods:{toSQL:function(){return this.arg1.toSQL()+" "+this.label_+" "+this.arg2.toSQL()},toMQL:function(){return this.arg1.toMQL()+" "+this.label_+" "+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+" "+this.label_+" "+this.arg2.toBQL()}}}),CLASS({name:"CountExpr","extends":"Expr",properties:[{type:"Int",name:"count",defaultValue:0},{name:"value",getter:function(){return this.count}}],methods:{reduce:function(other){return CountExpr.create({count:this.count+other.count})},reduceI:function(other){this.count=this.count+other.count},pipe:function(sink){sink.put(this)},put:function(obj){this.count++},remove:function(obj){this.count--},toString:function(){return this.count}}}),CLASS({name:"EqExpr","extends":"BINARY",documentation:function(){},methods:[function toSQL(){return this.arg1.toSQL()+"="+this.arg2.toSQL()},function toMQL(){return this.arg1.toMQL&&this.arg2.toMQL?this.arg2===TRUE?"is:"+this.arg1.toMQL():""==this.arg2.f()?"-has:"+this.arg1.toMQL():this.arg1.toMQL()+"="+this.arg2.toMQL():""},function toBQL(){return this.arg1.toBQL&&this.arg2.toBQL?this.arg2===TRUE?this.arg1.toBQL()+":true":this.arg1.toBQL()+":"+this.arg2.toBQL():""},function partialEval(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(this.f()):this.arg1!==newArg1||this.arg2!==newArg2?EqExpr.create({arg1:newArg1,arg2:newArg2}):this},{name:"f",code:function(obj){var arg1=this.arg1.f(obj),arg2=this.arg2.f(obj);if(Array.isArray(arg1)){if(!Array.isArray(arg2))return arg1.some(function(arg){return arg==arg2});if(arg1.length!==arg2.length)return!1;for(var i=0;i<arg1.length;i++)if(arg1[i]!=arg2[i])return!1;return!0}return arg2===TRUE?!!arg1:arg2===FALSE?!arg1:equals(arg1,arg2)},swiftCode:"return equals(arg1?.f(obj), b: arg2?.f(obj))"}]}),CLASS({name:"ConstantExpr","extends":"UNARY",methods:[function escapeSQLString(str){return"'"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},function escapeMQLString(str){return str.length>0&&-1==str.indexOf(" ")&&-1==str.indexOf('"')&&-1==str.indexOf(",")?str:'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},function toSQL(){return"string"==typeof this.arg1?this.escapeSQLString(this.arg1):this.arg1.toString()},function toMQL(){return"string"==typeof this.arg1?this.escapeMQLString(this.arg1):this.arg1.toMQL?this.arg1.toMQL():this.arg1.toString()},function toBQL(){return"string"==typeof this.arg1?this.escapeMQLString(this.arg1):this.arg1.toBQL?this.arg1.toBQL():this.arg1.toString()},{name:"f",code:function(obj){return this.arg1},swiftCode:"return arg1"}]}),CLASS({name:"AndExpr","extends":"NARY",documentation:"N-ary expression which is true only if each of its 0 or more arguments is true. AND() === TRUE",methods:[function toSQL(){for(var s="",i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toSQL(),i<this.args.length-1&&(s+=" AND ")}return s},function toMQL(){for(var s="",i=0;i<this.args.length;i++){var a=this.args[i],sub=a.toMQL();OrExpr.isInstance(a)&&(sub="("+sub+")"),s+=sub,i<this.args.length-1&&(s+=" ")}return s},function toBQL(){for(var s="",i=0;i<this.args.length;i++){var a=this.args[i],sub=a.toBQL();OrExpr.isInstance(a)&&(sub="("+sub+")"),s+=sub,i<this.args.length-1&&(s+=" ")}return s},function collectInputs(terms){for(var i=0;i<this.args.length;i++)this.args[i].collectInputs(terms)},function minterm(index,term){for(var out=!0,i=0;i<this.args.length;i++)out=this.args[i].minterm(index,term)&&out;return out},function partialAnd(e1,e2){if(OrExpr.isInstance(e2)){var tmp=e1;e1=e2,e2=tmp}if(OrExpr.isInstance(e1)){for(var args=[],i=0;i<e1.args.length;i++)args.push(AND(e2,e1.args[i]));return OrExpr.create({args:args}).partialEval()}if(!BINARY.isInstance(e1))return null;if(!BINARY.isInstance(e2))return null;if(e1.arg1!=e2.arg1)return null;for(var RULES=this.PARTIAL_AND_RULES,i=0;i<RULES.length;i++){if(e1.model_.name==RULES[i][0]&&e2.model_.name==RULES[i][1])return RULES[i][2](e1,e2);if(e2.model_.name==RULES[i][0]&&e1.model_.name==RULES[i][1])return RULES[i][2](e2,e1)}return DEBUG&&console.log("Unknown partialAnd combination: ",e1.name_,e2.name_),null},function partialEval(){for(var newArgs=[],updated=!1,i=0;i<this.args.length;i++){var a=this.args[i],newA=this.args[i].partialEval();if(newA===FALSE)return FALSE;if(AndExpr.isInstance(newA)){for(var j=0;j<newA.args.length;j++)newArgs.push(newA.args[j]);updated=!0}else newA===TRUE?updated=!0:(newArgs.push(newA),a!==newA&&(updated=!0))}for(var i=0;i<newArgs.length-1;i++)for(var j=i+1;j<newArgs.length;j++){var a=this.partialAnd(newArgs[i],newArgs[j]);if(a){if(a===FALSE)return FALSE;newArgs[i]=a,newArgs.splice(j,1)}}return 0==newArgs.length?TRUE:1==newArgs.length?newArgs[0]:updated?AndExpr.create({args:newArgs}):this},{name:"f",code:function(obj){return this.args.every(function(arg){return arg.f(obj)})},swiftCode:function(){}}],constants:{PARTIAL_AND_RULES:[["EqExpr","EqExpr",function(e1,e2){return e1.arg1.exclusive?e1.arg2.f()==e2.arg2.f()?e1:FALSE:e1.arg2.f()==e2.arg2.f()?e1:null}],["InExpr","InExpr",function(e1,e2){var i=e1.arg1.exclusive?e1.arg2.intersection(e2.arg2):e1.arg2.union(e2.arg2);return i.length?IN(e1.arg1,i):FALSE}],["InExpr","ContainedInICExpr",function(e1,e2){if(!e1.arg1.exclusive)return null;var i=e1.arg2.filter(function(o){return o=o.toUpperCase(),e2.arg2.some(function(o2){return-1!=o.indexOf(o2)})});return i.length?IN(e1.arg1,i):FALSE}],["ContainedInICExpr","ContainedInICExpr",function(e1,e2){console.assert(!1,"AND.partialEval: ContainedInICExpr has no partialEval rule")}],["InExpr","ContainsICExpr",function(e1,e2){if(e1.arg1.exclusive)var i=e1.arg2.filter(function(o){return-1!==o.indexOfIC(e2.arg2.f())})}],["InExpr","ContainsExpr",function(e1,e2){if(e1.arg1.exclusive){var i=e1.arg2.filter(function(o){return-1!==o.indexOf(e2.arg2.f())});return i.length?IN(e1.arg1,i):FALSE}}],["EqExpr","InExpr",function(e1,e2){return e1.arg1.exclusive?-1===e2.arg2.indexOf(e1.arg2.f())?FALSE:e1:void 0}]]}}),CLASS({name:"NeqExpr","extends":"BINARY","abstract":!0,methods:{toSQL:function(){return this.arg1.toSQL()+"<>"+this.arg2.toSQL()},toMQL:function(){return"-"+this.arg1.toMQL()+"="+this.arg2.toMQL()},toBQL:function(){return"-"+this.arg1.toBQL()+":"+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(this.f()):this.arg1!==newArg1||this.arg2!=newArg2?NeqExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){var arg1=this.arg1.f(obj),arg2=this.arg2.f(obj);if(Array.isArray(arg1)){if(!Array.isArray(arg2))return!arg1.some(function(arg){return arg==arg2});if(arg1.length!==arg2.length)return!0;for(var i=0;i<arg1.length;i++)if(arg1[i]!=arg2[i])return!0;return!1}return arg2===TRUE?!arg1:arg2===FALSE?!!arg1:!equals(arg1,arg2)}}}),CLASS({name:"UpperExpr","extends":"UNARY",properties:[{name:"label_",defaultValue:"UPPER"}],methods:[function partialEval(){var newArg1=this.arg1.partialEval();if(ConstantExpr.isInstance(newArg1)){var val=newArg1.f();if("string"==typeof val)return compile_(val.toUpperCase())}else Array.isArray(newArg1);return this},{name:"f",code:function(obj){var a=this.arg1.f(obj);return Array.isArray(a)?a.map(function(s){return s.toUpperCase?s.toUpperCase():s}):a&&a.toUpperCase?a.toUpperCase():a}},function toMQL(){return ConstantExpr.isInstance(this.arg1)&&"string"==typeof this.arg1.arg1?this.arg1.arg1.toUpperCase():this.arg1.toMQL()}]}),CLASS({name:"MaxExpr","extends":"UNARY",properties:[{name:"max",help:"Maximum value."},{name:"value",compareProperty:function(){return 0},getter:function(){return this.max}}],methods:{maximum:function(o1,o2){return o1.compareTo(o2)>0?o1:o2},reduce:function(other){return MaxExpr.create({max:this.maximum(this.max,other.max)})},reduceI:function(other){this.max=this.maximum(this.max,other.max)},pipe:function(sink){sink.put(this)},put:function(obj){var v=this.arg1.f(obj);this.max=this.hasOwnProperty("max")?this.maximum(this.max,v):v},remove:function(obj){},toString:function(){return this.max}}}),CLASS({name:"InExpr","extends":"BINARY",documentation:"Binary expression which is true if its first argument is EQ to any element of its second argument, which is an array.",properties:[{name:"arg2",label:"Argument",type:"Expr",help:"Sub-expression",postSet:function(){this.valueSet_=void 0}}],methods:{partialEval:function(){return 1==this.arg2.length?EQ(this.arg1,this.arg2[0]):this},valueSet:function(){if(!this.valueSet_){for(var s={},i=0;i<this.arg2.length;i++)s[this.arg2[i]]=!0;this.valueSet_=s}return this.valueSet_},toSQL:function(){return this.arg1.toSQL()+" IN "+this.arg2},toMQL:function(){return this.arg1.toMQL()+"="+this.arg2.join(",")},toBQL:function(){return this.arg1.toBQL()+":("+this.arg2.join("|")+")"},f:function(obj){return this.valueSet().hasOwnProperty(this.arg1.f(obj))}}}),CLASS({name:"LtExpr","extends":"BINARY","abstract":!0,methods:{toSQL:function(){return this.arg1.toSQL()+"<"+this.arg2.toSQL()},toMQL:function(){return this.arg1.toMQL()+"-before:"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+"<"+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(this.f()):this.arg1!==newArg1||this.arg2!=newArg2?LtExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){return compare(this.arg1.f(obj),this.arg2.f(obj))<0}}}),CLASS({name:"GtExpr","extends":"BINARY","abstract":!0,methods:{toSQL:function(){return this.arg1.toSQL()+">"+this.arg2.toSQL()},toMQL:function(){return this.arg1.toMQL()+"-after:"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+">"+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(this.f()):this.arg1!==newArg1||this.arg2!=newArg2?GtExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){return compare(this.arg1.f(obj),this.arg2.f(obj))>0}}}),CLASS({name:"LteExpr","extends":"BINARY","abstract":!0,methods:{toSQL:function(){return this.arg1.toSQL()+"<="+this.arg2.toSQL()},toMQL:function(){return this.arg1.toMQL()+"-before:"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+"<="+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(this.f()):this.arg1!==newArg1||this.arg2!=newArg2?LtExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){return compare(this.arg1.f(obj),this.arg2.f(obj))<=0}}}),CLASS({name:"GteExpr","extends":"BINARY","abstract":!0,methods:{toSQL:function(){return this.arg1.toSQL()+">="+this.arg2.toSQL()},toMQL:function(){return this.arg1.toMQL()+"-after:"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+">="+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(this.f()):this.arg1!==newArg1||this.arg2!=newArg2?GtExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){return compare(this.arg1.f(obj),this.arg2.f(obj))>=0}}}),CLASS({name:"ExplainExpr","extends":"UNARY",documentation:"Pseudo-expression which outputs a human-readable description of its subexpression, and the plan for evaluating it.",properties:[{name:"plan",help:"Execution Plan",defaultValue:""}],methods:{toString:function(){return this.plan},toSQL:function(){return this.arg1.toSQL()},toMQL:function(){return this.arg1.toMQL()},toBQL:function(){return this.arg1.toBQL()},partialEval:function(){var newArg=this.arg1.partialEval();return this.arg1===newArg?this:EXPLAIN(newArg)},f:function(obj){return this.arg1.f(obj)}}}),CLASS({name:"OrExpr","extends":"NARY",documentation:"N-ary expression which is true if any one of its 0 or more subexpressions is true. OR() === FALSE",methods:{toSQL:function(){var s;s="(";for(var i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toSQL(),i<this.args.length-1&&(s+=" OR ")}return s+=")"},toMQL:function(){for(var s="",i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toMQL(),i<this.args.length-1&&(s+=" OR ")}return s},toBQL:function(){for(var s="",i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toBQL(),i<this.args.length-1&&(s+=" | ")}return s},collectInputs:function(terms){for(var i=0;i<this.args.length;i++)this.args[i].collectInputs(terms)},minterm:function(index,term){for(var out=!1,i=0;i<this.args.length;i++)out=this.args[i].minterm(index,term)||out;return out}},constants:{PARTIAL_OR_RULES:[["InExpr","EqExpr",function(e1,e2){return IN(e1.arg1,e1.arg1.union([e2.arg2.f()]))}],["InExpr","InExpr",function(e1,e2){var i=e1.arg2.filter(function(o){return-1!==e2.arg2.indexOf(o)});return IN(e1.arg1,e1.arg2.union(e2.arg2))}]],partialOr:function(e1,e2){if(!BINARY.isInstance(e1))return null;if(!BINARY.isInstance(e2))return null;if(e1.arg1!=e2.arg1)return null;for(var RULES=this.PARTIAL_OR_RULES,i=0;i<RULES.length;i++){if(e1.model_.name==RULES[i][0]&&e2.model_.name==RULES[i][1])return RULES[i][2](e1,e2);if(e2.model_.name==RULES[i][0]&&e1.model_.name==RULES[i][1])return RULES[i][2](e2,e1)}return null},partialEval:function(){for(var newArgs=[],updated=!1,i=0;i<this.args.length;i++){var a=this.args[i],newA=this.args[i].partialEval();if(newA===TRUE)return TRUE;if(OrExpr.isInstance(newA)){for(var j=0;j<newA.args.length;j++)newArgs.push(newA.args[j]);updated=!0}else newA!==FALSE&&newArgs.push(newA),a!==newA&&(updated=!0)}for(var i=0;i<newArgs.length-1;i++)for(var j=i+1;j<newArgs.length;j++){var a=this.partialOr(newArgs[i],newArgs[j]);if(a){if(a===TRUE)return TRUE;newArgs[i]=a,newArgs.splice(j,1)}}return 0==newArgs.length?FALSE:1==newArgs.length?newArgs[0]:updated?OrExpr.create({args:newArgs}):this},f:function(obj){return this.args.some(function(arg){return arg.f(obj)})}}}),CLASS({name:"NotExpr","extends":"UNARY","abstract":!0,documentation:"Unary expression which inverts the truth value of its argument.",methods:{toSQL:function(){return"not ( "+this.arg1.toSQL()+" )"},toMQL:function(){return"-"+this.arg1.toMQL()},toBQL:function(){return"-"+this.arg1.toBQL()},collectInputs:function(terms){this.arg1.collectInputs(terms)},minterm:function(index,term){return!this.arg1.minterm(index,term)},partialEval:function(){var newArg=this.arg1.partialEval();return newArg===TRUE?FALSE:newArg===FALSE?TRUE:NotExpr.isInstance(newArg)?newArg.arg1:EqExpr.isInstance(newArg)?NeqExpr.create(newArg):NeqExpr.isInstance(newArg)?EqExpr.create(newArg):LtExpr.isInstance(newArg)?GteExpr.create(newArg):GtExpr.isInstance(newArg)?LteExpr.create(newArg):LteExpr.isInstance(newArg)?GtExpr.create(newArg):GteExpr.isInstance(newArg)?LtExpr.create(newArg):this.arg1===newArg?this:NOT(newArg);
},f:function(obj){return!this.arg1.f(obj)}}}),CLASS({name:"HasExpr","extends":"UNARY",documentation:"Unary expression that checks if its argument has a meaningful, non-empty value (nonempty strings, nonempty arrays, etc.)",methods:[function toSQL(){return this.arg1.toSQL()+" IS NOT NULL"},function toMQL(){return"has:"+this.arg1.toMQL()},function toBQL(){return this.toMQL()},function collectInputs(terms){this.arg1.collectInputs(terms)},function partialEval(){return this.arg1&&this.arg1.partialEval&&(this.arg1=this.arg1.partialEval()),this},function f(obj){var value=this.arg1.f(obj),notHas=void 0===value||null===value||""===value||Array.isArray(value)&&0===value.length;return!notHas}]}),CLASS({name:"ContainedInICExpr","extends":"BINARY",documentation:"Checks if the first argument is contained in the array-valued right argument, ignoring case in strings.",properties:[{name:"arg2",label:"Argument",help:"Sub-expression",preSet:function(_,a){return a.map(function(o){return o.toUpperCase()})}}],methods:{toSQL:function(){return this.arg1.toSQL()+" IN "+this.arg2},toMQL:function(){return this.arg1.toMQL()+":"+this.arg2.join(",")},toBQL:function(){return this.arg1.toBQL()+":("+this.arg2.join("|")+")"},f:function(obj){var v=this.arg1.f(obj);if(Array.isArray(v)){for(var j=0;j<v.length;j++)for(var a=v[j].toUpperCase(),i=0;i<this.arg2.length;i++)if(-1!=a.indexOf(this.arg2[i]))return!0}else{v=(""+v).toUpperCase();for(var i=0;i<this.arg2.length;i++)if(-1!=v.indexOf(this.arg2[i]))return!0}return!1}}}),CLASS({name:"ContainsExpr","extends":"BINARY",methods:{toSQL:function(){return this.arg1.toSQL()+" like '%' + "+this.arg2.toSQL()+"+ '%'"},toMQL:function(){return this.arg1.toMQL()+":"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+":"+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(-1!=newArg1.f().indexOf(newArg2.f())):this.arg1!==newArg1||this.arg2!=newArg2?ContainsExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){var arg1=this.arg1.f(obj),arg2=this.arg2.f(obj);return Array.isArray(arg1)?arg1.some(function(arg){return-1!=arg.indexOf(arg2)}):-1!=arg1.indexOf(arg2)}}}),CLASS({name:"ContainsICExpr","extends":"BINARY",properties:[{name:"arg2",label:"Argument",help:"Sub-expression",defaultValue:TRUE,postSet:function(_,value){this.pattern_=void 0}}],methods:{toSQL:function(){return this.arg1.toSQL()+" like '%' + "+this.arg2.toSQL()+"+ '%'"},toMQL:function(){return this.arg1.toMQL()+":"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+":"+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(-1!=newArg1.f().toLowerCase().indexOf(newArg2.f())):this.arg1!==newArg1||this.arg2!=newArg2?ContainsICExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){var arg1=this.arg1.f(obj),pattern=this.pattern_||(this.pattern_=new RegExp(this.arg2.f().toString().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"));if(Array.isArray(arg1)){var pattern=this.pattern_;return arg1.some(function(arg){return pattern.test(arg)})}return this.pattern_.test(arg1)}}}),CLASS({name:"StartsWithExpr","extends":"BINARY",methods:{toSQL:function(){return this.arg1.toSQL()+" like '%' + "+this.arg2.toSQL()+"+ '%'"},toMQL:function(){return this.arg1.toMQL()+"-after:"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+">="+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(newArg1.f().startsWith(newArg2.f())):this.arg1!==newArg1||this.arg2!=newArg2?StartsWithExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){var arg1=this.arg1.f(obj),arg2=this.arg2.f(obj);return Array.isArray(arg1)?arg1.some(function(arg){return arg.startsWith(arg2)}):arg1.startsWith(arg2)}}}),CLASS({name:"StartsWithICExpr","extends":"BINARY",methods:{toSQL:function(){return this.arg1.toSQL()+" like '%' + "+this.arg2.toSQL()+"+ '%'"},toMQL:function(){return this.arg1.toMQL()+"-after:"+this.arg2.toMQL()},toBQL:function(){return this.arg1.toBQL()+">="+this.arg2.toBQL()},partialEval:function(){var newArg1=this.arg1.partialEval(),newArg2=this.arg2.partialEval();return ConstantExpr.isInstance(newArg1)&&ConstantExpr.isInstance(newArg2)?compile_(newArg1.f().startsWithIC(newArg2.f())):this.arg1!==newArg1||this.arg2!=newArg2?StartsWithICExpr.create({arg1:newArg1,arg2:newArg2}):this},f:function(obj){return this.arg1.f(obj).startsWithIC(this.arg2.f(obj))}}}),CLASS({name:"ConcatExpr","extends":"NARY",label:"concat",methods:{partialEval:function(){return this},f:function(obj){for(var str=[],i=0;i<this.args.length;i++)str.push(this.args[i].f(obj));return str.join("")}}}),CLASS({name:"SumExpr","extends":"UNARY",properties:[{name:"sum",help:"Sum of values.",factory:function(){return 0}},{name:"value",compareProperty:function(){return 0},getter:function(){return this.sum}}],methods:{pipe:function(sink){sink.put(this)},put:function(obj){this.instance_.sum+=+this.arg1.f(obj)},remove:function(obj){this.sum-=this.arg1.f(obj)},toString:function(){return this.sum}}}),CLASS({name:"AvgExpr","extends":"UNARY",properties:[{name:"count",type:"Int",defaultValue:0},{name:"sum",help:"Sum of values.",defaultValue:0},{name:"avg",help:"Average of values.",getter:function(){return this.sum/this.count}},{name:"value",compareProperty:function(){return 0},getter:function(){return this.avg}}],methods:{pipe:function(sink){sink.put(this)},put:function(obj){this.count++,this.sum+=this.arg1.f(obj)},remove:function(obj){this.count--,this.sum-=this.arg1.f(obj)},toString:function(){return this.avg}}}),CLASS({name:"MinExpr","extends":"UNARY",properties:[{name:"min",help:"Minimum value.",defaultValue:void 0},{name:"value",compareProperty:function(){return 0},getter:function(){return this.min}}],methods:{minimum:function(o1,o2){return o1.compareTo(o2)>0?o2:o1},reduce:function(other){return MinExpr.create({min:this.mininum(this.min,other.min)})},reduceI:function(other){this.min=this.minimum(this.min,other.min)},pipe:function(sink){sink.put(this)},put:function(obj){var v=this.arg1.f(obj);this.min=this.hasOwnProperty("min")?this.minimum(this.min,v):v},remove:function(obj){},toString:function(){return this.min}}}),CLASS({name:"DistinctExpr","extends":"BINARY",properties:[{name:"values",help:"Distinct values.",factory:function(){return{}}},{name:"value",compareProperty:function(){return 0},getter:function(){return this.arg2.value}}],methods:{reduce:function(other){},reduceI:function(other){},put:function(obj){var key=this.arg1.f(obj);this.values.hasOwnProperty(key)||(this.values[key]=!0,this.arg2.put(obj))},remove:function(obj){},toString:function(){return this.arg2.toString()},toHTML:function(){return this.arg2.toHTML()}}}),CLASS({name:"GroupByExpr","extends":"BINARY",properties:[{name:"groups",help:"Groups.",factory:function(){return{}}},{name:"groupKeys",factory:function(){return[]}}],methods:{sortedKeys:function(opt_comparator){var c=opt_comparator||this.arg1.compareProperty;return this.groupKeys.sort(c),this.groupKeys},reduce:function(other){},reduceI:function(other){for(var i in other.groups)this.groups[i]?this.groups[i].reduceI(other.groups[i]):this.groups[i]=other.groups[i].deepClone()},pipe:function(sink){for(key in this.groups)sink.push([key,this.groups[key].toString()]);return sink},putInGroup_:function(key,obj){var group=this.groups.hasOwnProperty(key)&&this.groups[key];group||(group=this.arg2.exprClone(),this.groups[key]=group,this.groupKeys.push(key)),group.put(obj)},put:function(obj){var key=this.arg1.f(obj);if(Array.isArray(key))if(key.length)for(var i=0;i<key.length;i++)this.putInGroup_(key[i],obj);else this.putInGroup_("",obj);else this.putInGroup_(key,obj)},clone:function(){return GroupByExpr.create({arg1:this.arg1,arg2:this.arg2})},exprClone:function(){return GroupByExpr.create({arg1:this.arg1,arg2:this.arg2.exprClone()})},remove:function(obj){},toString:function(){return this.groups},deepClone:function(){var cl=this.clone();cl.groups={};for(var i in this.groups)cl.groups[i]=this.groups[i].deepClone();return cl},toView_:function(){return this},toHTML:function(){var out=[];out.push("<table border=1>");for(var key in this.groups){var value=this.groups[key],str=value.toView_?value.toView_().toHTML():value;out.push("<tr><th>",key,"</th><td>",str,"</td></tr>")}return out.push("</table>"),out.join("")},initHTML:function(){for(var key in this.groups){var value=this.groups[key];value.toView_&&value.toView_().initHTML()}}}}),CLASS({name:"GridByExpr","extends":"Expr",properties:[{name:"xFunc",label:"X-Axis Function",help:"Sub-expression",defaultValue:TRUE},{name:"yFunc",label:"Y-Axis Function",help:"Sub-expression",defaultValue:TRUE},{name:"acc",label:"Accumulator",help:"Sub-expression",defaultValue:TRUE},{name:"rows",help:"Rows.",factory:function(){return{}}},{name:"cols",label:"Columns",help:"Columns.",factory:function(){return{}}},{type:"Array",name:"children"}],methods:{init:function(){this.SUPER();var self=this,f=function(){self.cols=GROUP_BY(self.xFunc,COUNT()),self.rows=GROUP_BY(self.yFunc,GROUP_BY(self.xFunc,self.acc))};self.addPropertyListener("xFunc",f),self.addPropertyListener("yFunc",f),self.addPropertyListener("acc",f),f()},reduce:function(other){},reduceI:function(other){},pipe:function(sink){},put:function(obj){this.rows.put(obj),this.cols.put(obj)},exprClone:function(){return this.model_.create({xFunc:this.xFunc,yFunc:this.yFunc,acc:this.acc.exprClone()})},remove:function(obj){},toString:function(){return this.groups},renderCell:function(x,y,value){var str=value?value.toHTML?value.toHTML():value:"";return value&&value.toHTML&&value.initHTML&&this.children.push(value),"<td>"+str+"</td>"},sortAxis:function(values,f){return values.sort(f.compareProperty)},sortCols:function(cols,xFunc){return this.sortAxis(cols,xFunc)},sortRows:function(rows,yFunc){return this.sortAxis(rows,yFunc)},sortedCols:function(){return this.sortCols(this.cols.groupKeys,this.xFunc)},sortedRows:function(){return this.sortRows(this.rows.groupKeys,this.yFunc)},toHTML_:function(){return this},toHTML:function(){var out;this.children=[];var cols=this.cols.groups,rows=this.rows.groups,sortedCols=this.sortedCols(),sortedRows=this.sortedRows();out='<table border=0 cellspacing=0 class="gridBy"><tr><th></th>';for(var i=0;i<sortedCols.length;i++){var x=sortedCols[i],str=x.toHTML?x.toHTML():x;out+="<th>"+str+"</th>"}out+="</tr>";for(var j=0;j<sortedRows.length;j++){var y=sortedRows[j];out+="<tr><th>"+y+"</th>";for(var i=0;i<sortedCols.length;i++){var x=sortedCols[i],value=rows[y].groups[x];value&&(value.x=x,value.y=y),out+=this.renderCell(x,y,value)}out+="</tr>"}return out+="</table>"},initHTML:function(){for(var i=0;i<this.children.length;i++)this.children[i].initHTML();this.children=[]}}}),CLASS({name:"MapExpr","extends":"BINARY",methods:{reduce:function(other){},reduceI:function(other){},pipe:function(sink){},put:function(obj){var val=this.arg1.f?this.arg1.f(obj):this.arg1(obj),acc=this.arg2;acc.put(val)},exprClone:function(){return MapExpr.create({arg1:this.arg1,arg2:this.arg2.exprClone()})},remove:function(obj){var acc=this.arg2;if(acc.remove){var val=this.arg1.f?this.arg1.f(obj):this.arg1(obj);acc.remove(val)}},toString:function(){return this.arg2.toString()},deepClone:function(){},toHTML:function(){return this.arg2.toHTML?this.arg2.toHTML():this.toString()},initHTML:function(){this.arg2.initHTML&&this.arg2.initHTML()}}}),CLASS({name:"FilterExpr","extends":"BINARY",methods:{reduce:function(other){},reduceI:function(other){},pipe:function(sink){},put:function(obj){var discard=!(this.arg1.f?this.arg1.f(obj):this.arg1(obj)),acc=this.arg2;discard||acc.put(obj)},remove:function(obj){var acc=this.arg2;if(acc.remove){var discard=!(this.arg1.f?this.arg1.f(obj):this.arg1(obj));discard||acc.remove(obj)}},toString:function(){return this.arg2.toString()},exprClone:function(){return FilterExpr.create({arg1:this.arg1,arg2:this.arg2.exprClone()})},deepClone:function(){},toHTML:function(){return this.arg2.toHTML?this.arg2.toHTML():this.toString()},initHTML:function(){this.arg2.initHTML&&this.arg2.initHTML()}}}),CLASS({name:"SeqExpr","extends":"NARY",properties:[{name:"value",compareProperty:function(){return 0},getter:function(){return this.args.map(function(x){return x.value})}}],methods:{pipe:function(sink){sink.put(this)},put:function(obj){for(var ret=[],i=0;i<this.args.length;i++){var a=this.args[i];a.put(obj)}},f:function(obj){for(var ret=[],i=0;i<this.args.length;i++){var a=this.args[i];ret.push(a.f(obj))}return ret},exprClone:function(){return SeqExpr.create({args:this.args.map(function(o){return o.exprClone()})})},deepClone:function(){return SeqExpr.create({args:this.args.deepClone()})},toString:function(obj){var out=[];out.push("(");for(var i=0;i<this.args.length;i++){var a=this.args[i];out.push(a.toString()),i<this.args.length-1&&out.push(",")}return out.push(")"),out.join("")},toHTML:function(obj){for(var out=[],i=0;i<this.args.length;i++){var a=this.args[i];out.push(a.toHTML?a.toHTML():a.toString()),i<this.args.length-1&&out.push("&nbsp;")}return out.join("")}}}),CLASS({name:"UpdateExpr","extends":"NARY",label:"UpdateExpr",properties:[{name:"dao","transient":!0,hidden:!0}],methods:{put:function(obj){(this.objs_||(this.objs_=[])).push(obj)},eof:function(){if(this.objs_){for(var i=0;i<this.objs_.length;i++){var obj=this.objs_[i],newObj=this.f(obj);newObj.id!==obj.id&&this.dao.remove(obj.id),this.dao.put(newObj)}this.objs_=void 0}},f:function(obj){for(var newObj=obj.clone(),i=0;i<this.args.length;i++)this.args[i].f(newObj);return newObj},reduce:function(other){return UpdateExpr.create({args:this.args.concat(other.args),dao:this.dao})},reduceI:function(other){this.args=this.args.concat(other.args)},toString:function(){return this.toSQL()},toSQL:function(){for(var s="SET ",i=0;i<this.args.length;i++){var a=this.args[i];s+=a.toSQL(),i<this.args.length-1&&(s+=", ")}return s}}}),CLASS({name:"SetExpr",label:"SetExpr","extends":"BINARY",methods:{toSQL:function(){return this.arg1.toSQL()+" = "+this.arg2.toSQL()},f:function(obj){Property.isInstance(this.arg1)&&(obj[this.arg1.name]=this.arg2.f(obj))}}}),CLASS({name:"TreeExpr","extends":"Expr",properties:[{name:"parentProperty"},{name:"childrenProperty"},{name:"items_",help:"Temporary map to store collected objects.",factory:function(){return{}},"transient":!0},{type:"Array",name:"roots"}],methods:{put:function(o){this.items_[o.id]=o,this.parentProperty.f(o)||this.roots.push(o)},eof:function(){var pprop=this.parentProperty,cprop=this.childrenProperty;for(var key in this.items_){var item=this.items_[key],parentId=pprop.f(item);if(parentId){var parent=this.items_[parentId];parent[cprop.name]=cprop.f(parent).concat(item)}}this.items_={}}}}),CLASS({name:"DescExpr","extends":"UNARY",methods:{toSQL:function(){return this.arg1.toSQL()+" DESC"},toMQL:function(){return"-"+this.arg1.toMQL()},compare:function(o1,o2){return-1*this.arg1.compare(o1,o2)}}}),CLASS({name:"AddExpr","extends":"BINARY",methods:{toSQL:function(){return this.arg1.toSQL()+" + "+this.arg2.toSQL()},f:function(o){return this.arg1.f(o)+this.arg2.f(o)}}});var JOIN=function(dao,key,sink){return sink=sink||[].sink,{f:function(o){var s=sink.clone();return dao.where(EQ(key,o.id)).select(s),[o,s]}}};CLASS({name:"MQLExpr","extends":"UNARY",documentation:"Parse an MQL query string and use it as a predicate.",properties:[{name:"specializations_",factory:function(){return{}}}],methods:{specialize:function(model){var qp=QueryParserFactory(model,!0);return qp.parseString(this.arg1)||FALSE},specialization:function(model){return this.specializations_[model.name]||(this.specializations_[model.name]=this.specialize(model))},toSQL:function(){return this.arg1},toMQL:function(){return this.arg1},partialEval:function(){return this},f:function(obj){return this.specialization(obj.model_).f(obj)}}}),CLASS({name:"KeywordExpr","extends":"UNARY",documentation:"Keyword search.",methods:{toSQL:function(){return this.arg1},toMQL:function(){return this.arg1},partialEval:function(){return this},f:function(obj){var pattern=this.pattern_||(this.pattern_=new RegExp(this.arg1.toString().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"));return this.pattern_.test(obj.toJSON())}}});var MONTH=function(p){return{f:function(o){return p.f(o).getMonth()}}},QueryParserFactory=function(model,opt_enableKeyword){for(var g={__proto__:grammar,START:sym("query"),query:sym("or"),or:repeat(sym("and"),alt(literal_ic(" OR "),literal(" | ")),1),and:repeat(sym("expr"),alt(literal_ic("AND "),not(alt(literal_ic(" OR"),literal(" |"))," ")),1),expr:alt(sym("paren"),sym("negate"),sym("has"),sym("is"),sym("equals"),sym("before"),sym("after"),sym("id"),sym("keyword")),paren:seq1(1,"(",sym("query"),")"),negate:alt(seq("-",sym("expr")),seq("NOT ",sym("expr"))),id:sym("number"),has:seq(literal_ic("has:"),sym("fieldname")),is:seq(literal_ic("is:"),sym("fieldname")),equals:seq(sym("fieldname"),alt(":","="),sym("valueList")),before:seq(sym("fieldname"),alt("<=","<","-before:"),sym("value")),after:seq(sym("fieldname"),alt(">=",">","-after:"),sym("value")),value:alt(sym("me"),sym("date"),sym("string"),sym("number")),compoundValue:alt(sym("negateValue"),sym("orValue"),sym("andValue")),negateValue:seq("(",alt("-",literal_ic("not ")),sym("value"),")"),orValue:seq("(",repeat(sym("value"),alt("|",literal_ic(" or ")," | "),1),")"),andValue:seq("(",repeat(sym("value"),alt(literal_ic(" and ")," "),1),")"),valueList:alt(sym("compoundValue"),repeat(sym("value"),seq(",",repeat0(" ")),1)),keyword:function(){var keyword_=sym("keyword_");return function(ps){return opt_enableKeyword&&this.parse(keyword_,ps)}}(),keyword_:str(plus(notChar(" "))),me:seq(literal_ic("me"),lookahead(not(sym("char")))),date:alt(sym("range date"),sym("literal date"),sym("relative date")),"range date":seq(sym("literal date"),"..",sym("literal date")),"literal date":alt(seq(sym("number"),"-",sym("number"),"-",sym("number"),"T",sym("number"),":",sym("number")),seq(sym("number"),"-",sym("number"),"-",sym("number"),"T",sym("number")),seq(sym("number"),"-",sym("number"),"-",sym("number")),seq(sym("number"),"-",sym("number")),seq(sym("number"),"/",sym("number"),"/",sym("number")),seq(sym("number"),"/",sym("number"))),"relative date":seq(literal_ic("today"),optional(seq("-",sym("number")))),string:alt(sym("word"),sym("quoted string")),"quoted string":str(seq1(1,'"',repeat(alt(literal('\\"','"'),notChar('"'))),'"')),word:str(plus(sym("char"))),"char":alt(range("a","z"),range("A","Z"),range("0","9"),"-","^","_","@","%","."),number:str(plus(range("0","9")))},fields=[],properties=model.getRuntimeProperties(),i=0;i<properties.length;i++){var prop=properties[i];fields.push(literal_ic(prop.name,prop));for(var j=0;j<prop.aliases.length;j++)prop.aliases[j]&&fields.push(literal_ic(prop.aliases[j],prop));prop.shortName&&fields.push(literal_ic(prop.shortName,prop))}return fields.sort(function(a,b){var d=a.length-b.length;return 0!==d?d:a==b?0:b>a?1:-1}),g.fieldname=alt.apply(null,fields),g.maybeConvertYearToDateRange=function(prop,num){var isDateField=DateProperty.isInstance(prop)||DateTimeProperty.isInstance(prop),isDateRange=Array.isArray(num)&&num[0]instanceof Date;if(isDateField&&!isDateRange){var start=new Date(0),end=new Date(0);return start.setUTCFullYear(num),end.setUTCFullYear(+num+1),[start,end]}return num},g.addActions({id:function(v){return EQ(model.ID,v)},or:function(v){return OR.apply(OR,v)},and:function(v){return AND.apply(AND,v)},negate:function(v){return NOT(v[1])},number:function(v){return parseInt(v)},me:function(){return this.ME||this.X.ME||""},has:function(v){return HAS(v[1])},is:function(v){return EQ(v[1],TRUE)},before:function(v){return v[2]=this.maybeConvertYearToDateRange(v[0],v[2]),Array.isArray(v[2])&&v[2][0]instanceof Date&&(v[2]="<="===v[1]?v[2][1]:v[2][0]),("<="===v[1]?LTE:LT)(v[0],v[2])},after:function(v){return v[2]=this.maybeConvertYearToDateRange(v[0],v[2]),Array.isArray(v[2])&&v[2][0]instanceof Date&&(v[2]=">="===v[1]?v[2][0]:v[2][1]),(">="===v[1]?GTE:GT)(v[0],v[2])},equals:function(v){var prop=v[0],values=v[2],isInt=IntProperty.isInstance(prop),isNum=isInt||FloatProperty.isInstance(prop),isDateField=DateProperty.isInstance(prop)||DateTimeProperty.isInstance(prop),isDateRange=Array.isArray(values[0])&&values[0][0]instanceof Date;if(isDateField||isDateRange){if(!isDateRange){var start=new Date(0),end=new Date(0);start.setUTCFullYear(values[0]),end.setUTCFullYear(+values[0]+1),values=[[start,end]]}var q=AND(GTE(prop,values[0][0]),LT(prop,values[0][1]));return q}var expr;if(isNum){for(var i=0;i<values.length;i++)values[i]=isInt?parseInt(values[i]):parseFloat(values[i]);expr=IN(v[0],values)}else expr="="===v[1]?IN_IC(v[0],values):ContainedInICExpr.create({arg1:compile_(prop),arg2:values});return values.negated?NOT(expr):values.and?AndExpr.create({args:values.map(function(x){return expr.model_.create({arg1:expr.arg1,arg2:[x]})})}):expr},keyword:function(v){return KEYWORD(v)},negateValue:function(v){return v.negated=!0,v},orValue:function(v){return v=v[1],v.or=!0,v},andValue:function(v){return v=v[1],v.and=!0,v},"literal date":function(v){var start,end,interval;start=new Date,end=new Date;for(var ops=["FullYear","Month","Date","Hours","Minutes","Seconds"],defaults=[0,1,1,0,0,0],i=0;i<ops.length;i++){var x=2*i>v.length?defaults[i]:v[2*i];start["setUTC"+ops[i]](x-(1==i?1:0)),end["setUTC"+ops[i]](x-(1==i?1:0))}var last=Math.floor(v.length/2),op="UTC"+ops[last];return end["set"+op](end["get"+op]()+1),[start,end]},"relative date":function(v){var d=new Date;return v[1]&&d.setDate(d.getDate()-v[1][1]),d},"range date":function(v){return[v[0][0],v[2][1]]}}),g},Visitor={create:function(){return{__proto__:this,stack:[]}},push:function(o){this.stack.push(o)},pop:function(){return this.stack.pop()},top:function(){return this.stack.length&&this.stack[this.stack.length-1]},visit:function(o){return Array.isArray(o)?this.visitArray(o):"string"==typeof o?this.visitString(o):"number"==typeof o?this.visitNumber(o):o instanceof Function?this.visitFunction(o):o instanceof Date?this.visitDate(o):o===!0?this.visitTrue():o===!1?this.visitFalse():null===o?this.visitNull():o instanceof Object?o.model_?this.visitObject(o):this.visitMap(o):this.visitUndefined()},visitArray:function(o){for(var len=o.length,i=0;len>i;i++)this.visitArrayElement(o,i);return o},visitArrayElement:function(arr,i){this.visit(arr[i])},visitString:function(o){return o},visitFunction:function(o){return o},visitNumber:function(o){return o},visitDate:function(o){return o},visitObject:function(o){var properties=o.model_.getRuntimeProperties();for(var key in properties){var prop=properties[key];prop.name in o.instance_&&this.visitProperty(o,prop)}return o},visitProperty:function(o,prop){this.visit(o[prop.name])},visitMap:function(o){for(var key in o)this.visitMapElement(key,o[key]);return o},visitMapElement:function(key,value){},visitTrue:function(){return!0},visitFalse:function(){return!1},visitNull:function(){return null},visitUndefined:function(){return void 0}};CLASS({name:"XHR",properties:[{type:"Int",name:"delay",defaultValue:0},{type:"Int",name:"retries",defaultValueFn:function(){return this.authAgent?2:0}},{name:"authAgent"},{name:"responseType",defaultValue:"text"},{name:"contentType",defaultValue:"application/json"}],methods:{init:function(args){this.SUPER(args),this.delay&&this.addDecorator(DelayDecorator.create({delayMs:this.delay})),this.authAgent&&this.addDecorator(OAuthXhrDecorator.create({authAgent:this.authAgent})),this.retries&&this.addDecorator(RetryDecorator.create({maxAttempts:this.retries}))},makeXhr:function(){return new XMLHttpRequest},open:function(xhr,method,url){xhr.open(method,url)},setRequestHeader:function(xhr,header,value){xhr.setRequestHeader(header,value)},configure:function(xhr){xhr.responseType=this.responseType,this.contentType&&this.setRequestHeader(xhr,"Content-Type",this.contentType)},bindListeners:function(xhr,ret){var self=this;xhr.onreadystatechange=function(){if(4==xhr.readyState){if("json"===self.responseType&&"string"==typeof xhr.response)var response=JSON.parse(xhr.response);else response=xhr.response;ret(response,xhr,xhr.status>=200&&xhr.status<300)}}},send:function(xhr,data){xhr.send(data)},asend:function(ret,url,data,method){var xhr=this.makeXhr();this.open(xhr,method||"GET",url),this.configure(xhr),this.bindListeners(xhr,ret),this.send(xhr,data&&data.toJSON?data.toJSON():data)}}}),CLASS({name:"OAuthXhrDecorator",properties:["authAgent"],methods:{configure:function(decorator,delegate,args){var xhr=args[0];return xhr.setRequestHeader("Authorization","Bearer "+decorator.authAgent.accessToken),delegate.apply(this,args)},asend:function(decorator,delegate,args){var ret=args[0];return args[0]=function(response,xhr,status){401===xhr.status?decorator.authAgent.refresh(function(){ret(response,xhr,status)}):ret(response,xhr,status)},delegate.apply(null,args)}}}),CLASS({name:"RetryDecorator",properties:[{type:"Int",name:"maxAttempts",defaultValue:3}],methods:{asend:function(decorator,delegate,args){var originalRet=args[0],attempts=0,self=this,response;awhile(function(){return!0},aseq(function(ret){args[0]=ret,delegate.apply(self,args)},function(ret,response,xhr,status){return xhr.status>=200&&xhr.status<300||404===xhr.status||++attempts>=decorator.maxAttempts?(finished=!0,void originalRet(response,xhr,status)):void ret()}))(function(){})}}}),CLASS({name:"DelayDecorator",properties:[{type:"Int",name:"delayMs"}],methods:{decorateObject:function(target){var asend=adelay(target.asend.bind(target),this.delayMs);target.decorate("asend",function(_,__,args){asend.apply(null,args)})}}}),CLASS({name:"XhrMessenger",properties:[{type:"URL",name:"url"},{type:"String",name:"method",defaultValue:"POST"}],methods:{put:function(obj,sink){var xhr=this.Y.XHR.create();xhr.asend(function(response,xhr){return xhr.status>=200&&xhr.status<300?void(sink&&sink.put&&sink.put(response)):void(sink&&sink.error&&sink.error([response,xhr]))},this.url,obj,this.method)}}});var ObjectToJSON={__proto__:Visitor.create(),visitFunction:function(o){return o.toString()},visitObject:function(o){return this.push({model_:(o.model_["package"]?o.model_["package"]+".":"")+o.model_.name}),this.__proto__.visitObject.call(this,o),this.pop()},visitProperty:function(o,prop){prop.propertyToJSON(this,this.top(),o)},visitMap:function(o){return this.push({}),Visitor.visitMap.call(this,o),this.pop()},visitMapElement:function(key,value){this.top()[key]=this.visit(value)},visitArray:function(o){return this.push([]),this.__proto__.visitArray.call(this,o),this.pop()},visitArrayElement:function(arr,i){this.top().push(this.visit(arr[i]))}},JSONToObject={__proto__:ObjectToJSON.create(),visitObject:function(o){var model=X.lookup(o.model_);if(!model)throw new Error("Unknown Model: "+o.model_);var obj=model.create();return Object_forEach(o,function(value,key){"model_"!==key&&(obj[key]=this.visit(value))}.bind(this)),obj},visitArray:Visitor.visitArray,visitArrayElement:function(arr,i){arr[i]=this.visit(arr[i])}};CLASS({name:"FilteredDAO_","extends":"foam.dao.ProxyDAO",documentation:"<p>Internal use only.</p>",properties:[{name:"query",swiftType:"ExprProtocol!",swiftDefaultValue:"nil",required:!0}],methods:[{name:"select",code:function(sink,options,opt_X){return this.delegate.select(sink,options?{__proto__:options,query:options.query?AND(this.query,options.query):this.query}:{query:this.query},opt_X)},swiftCode:function(){}},{name:"removeAll",code:function(sink,options,opt_X){return this.delegate.removeAll(sink,options?{__proto__:options,query:options.query?AND(this.query,options.query):this.query}:{query:this.query},opt_X)},swiftCode:function(){}},{name:"listen",code:function(sink,options){return this.SUPER(sink,options?{__proto__:options,query:options.query?AND(this.query,options.query):this.query}:{query:this.query})},swiftCode:function(){}},function toString(){return this.delegate+".where("+this.query+")"}]}),CLASS({name:"OrderedDAO_","extends":"foam.dao.ProxyDAO",documentation:function(){},properties:[{name:"comparator",required:!0}],methods:{select:function(sink,options,opt_X){return options?options.order||(options={__proto__:options,order:this.comparator}):options={order:this.comparator},this.delegate.select(sink,options,opt_X)},toString:function(){return this.delegate+".orderBy("+this.comparator+")"}}}),CLASS({name:"LimitedDAO_","extends":"foam.dao.ProxyDAO",documentation:function(){},properties:[{name:"count",required:!0}],methods:{select:function(sink,options,opt_X){return options=options?"limit"in options?{__proto__:options,limit:Math.min(this.count,options.limit)}:{__proto__:options,limit:this.count}:{limit:this.count},this.delegate.select(sink,options,opt_X)},toString:function(){return this.delegate+".limit("+this.count+")"}}}),CLASS({name:"SkipDAO_","extends":"foam.dao.ProxyDAO",documentation:function(){},properties:[{name:"skip",required:!0,postSet:function(){this.skip!==Math.floor(this.skip)&&console.warn("skip() called with non-integer value: "+this.skip)}}],methods:{select:function(sink,options,opt_X){return options=options?{__proto__:options,skip:this.skip}:{skip:this.skip},this.delegate.select(sink,options,opt_X)},toString:function(){return this.delegate+".skip("+this.skip+")"}}}),CLASS({name:"RelationshipDAO","extends":"FilteredDAO_",documentation:"Adapts a DAO based on a Relationship.",properties:[{name:"relatedProperty",required:!0},{name:"relativeID",required:!0},{name:"query",lazyFactory:function(){return AND(NEQ(this.relatedProperty,""),EQ(this.relatedProperty,this.relativeID))}}],methods:[function put(obj,sink){obj[this.relatedProperty.name]=this.relativeID,this.SUPER(obj,sink)}]}),CLASS({name:"AbstractDAO",documentation:function(){},properties:[{name:"daoListeners_","transient":!0,hidden:!0,factory:function(){return[]},swiftType:"NSMutableArray",swiftFactory:"return NSMutableArray()",compareProperty:function(){return 0}}],methods:[function update(expr){return this.select(UPDATE(expr,this))},{name:"select",code:function(sink,options){},args:[{name:"sink",swiftType:"Sink = ArraySink()"},{name:"options",swiftType:"DAOQueryOptions = DAOQueryOptions()"}],swiftReturnType:"Future",swiftCode:"return Future().set(sink)"},{name:"put",args:[{name:"obj",swiftType:"FObject"},{name:"sink",swiftType:"Sink = ArraySink()"}],swiftCode:"// Override"},{name:"remove",code:function(query,sink){},args:[{name:"obj",swiftType:"FObject"},{name:"sink",swiftType:"Sink = ArraySink()"}],swiftCode:"// Override"},{name:"find",code:function(id,sink){},args:[{name:"id",swiftType:"String"},{name:"sink",swiftType:"Sink"}],swiftCode:"// Override"},function pipe(sink,options){sink=this.decorateSink_(sink,options,!0);var fc=this.createFlowControl_(),self=this;this.select({put:function(){sink.put&&sink.put.apply(sink,arguments)},remove:function(){sink.remove&&sink.remove.apply(sink,arguments)},error:function(){sink.error&&sink.error.apply(sink,arguments)},eof:function(){fc.stopped?sink.eof&&sink.eof():self.listen(sink,options)}},options,fc)},{name:"decorateSink_",code:function(sink,options,isListener,disableLimit){return options&&(disableLimit||(options.limit&&(sink=limitedSink(options.limit,sink)),options.skip&&(sink=skipSink(options.skip,sink))),options.order&&!isListener&&(sink=orderedSink(options.order,sink)),options.query&&(sink=predicatedSink(options.query.partialEval?options.query.partialEval():options.query,sink))),sink},args:[{name:"sink",swiftType:"Sink"},{name:"options",swiftType:"DAOQueryOptions"}],swiftReturnType:"Sink",swiftCode:function(){}},function createFlowControl_(){return{stop:function(){this.stopped=!0},error:function(e){this.errorEvt=e}}},{name:"where",code:function(query){return(this.Y||X).lookup("FilteredDAO_").create({query:query,delegate:this})},args:[{
name:"query",swiftType:"ExprProtocol"}],swiftReturnType:"AbstractDAO",swiftCode:function(){}},function limit(count){return(this.Y||X).lookup("LimitedDAO_").create({count:count,delegate:this})},function skip(skip){return(this.Y||X).lookup("SkipDAO_").create({skip:skip,delegate:this})},function orderBy(){return(this.Y||X).lookup("OrderedDAO_").create({comparator:1==arguments.length?arguments[0]:argsToArray(arguments),delegate:this})},{name:"listen",code:function(sink,options){this.daoListeners_.push(this.decorateSink_(sink,options,!0))},args:[{name:"sink",swiftType:"Sink"},{name:"options",swiftType:"DAOQueryOptions = DAOQueryOptions()"}],swiftCode:"self.daoListeners_.addObject(self.decorateSink_(sink, options: options))"},{name:"unlisten",code:function unlisten(sink){for(var ls=this.daoListeners_,i=0;i<ls.length;i++)if(ls[i].$UID===sink.$UID)return ls.splice(i,1),!0;DEBUG&&console.warn("Phantom DAO unlisten: ",this,sink)},args:[{name:"sink",swiftType:"Sink"}],swiftReturnType:"Bool",swiftCode:function(){}},{name:"removeAll",code:function(sink,options){var self=this,future=afuture();return this.select({put:function(obj){self.remove(obj,{remove:sink&&sink.remove})}})(function(){sink&&sink.eof(),future.set()}),future.get},args:[{name:"sink",swiftType:"Sink = ArraySink()"},{name:"options",swiftType:"DAOQueryOptions = DAOQueryOptions()"}],swiftReturnType:"Future",swiftCode:function(){}},{name:"notify_",code:function(fName,args){for(var i=0;i<this.daoListeners_.length;i++){var l=this.daoListeners_[i],fn=l[fName];if(fn){args[2]={stop:function(fn,l){return function(){fn(l)}}(this.unlisten.bind(this),l),error:function(e){}};try{fn.apply(l,args)}catch(err){err!==this.UNSUBSCRIBE_EXCEPTION&&(console.error("Error delivering event (removing listener): ",fName,err),DEBUG&&console.error(err.stack)),this.unlisten(l)}}}},args:[{name:"fName",swiftType:"String"},{name:"fObj",swiftType:"FObject? = nil"}],swiftCode:function(){}}]}),Function.prototype.put=function(){this.apply(this,arguments)},Function.prototype.remove=function(){this.apply(this,arguments)},Function.prototype.reset=function(){this.call(this)},function(){var pmap={};for(var key in AbstractDAO.methods)pmap[AbstractDAO.methods[key].name]=AbstractDAO.methods[key].code;for(var key in pmap)Object.defineProperty(Array.prototype,key,{value:pmap[key],configurable:!0,writable:!0})}(),defineLazyProperty(Array.prototype,"daoListeners_",function(){return{value:[],configurable:!0}});var ArraySink={__proto__:Array.prototype,put:function(obj,sink){this.push(obj),this.notify_("put",arguments),sink&&sink.put&&sink.put(obj)},clone:function(){return this.slice().sink},deepClone:function(){for(var r=new Array(this.length),i=0;i<this.length;i++)r[i]=this[i].deepClone();return r.sink},exprClone:function(){return this.deepClone()}};MODEL0({extendsProto:"Array",properties:[{name:"dao",getter:function(){return this.__proto__=Array.prototype,this}},{name:"sink",getter:function(){return this.__proto__=ArraySink,this}}],methods:{listen:AbstractDAO.getPrototype().listen,unlisten:AbstractDAO.getPrototype().unlisten,notify_:AbstractDAO.getPrototype().notify_,put:function(obj,sink){for(var idx=0;idx<this.length;idx++)if(this[idx].id===obj.id)return this[idx]=obj,sink&&sink.put&&sink.put(obj),void this.notify_("put",arguments);this.push(obj),this.notify_("put",arguments),sink&&sink.put&&sink.put(obj)},find:function(query,sink){if(query.f){for(var idx=0;idx<this.length;idx++)if(query.f(this[idx]))return void(sink&&sink.put&&sink.put(this[idx]))}else for(var idx=0;idx<this.length;idx++)if(this[idx].id===query)return void(sink&&sink.put&&sink.put(this[idx]));sink&&sink.error&&sink.error("find",query)},remove:function(obj,sink){if(!obj)return void(sink&&sink.error&&sink.error("missing key"));for(var objId=obj.id,id=void 0!==objId&&""!==objId?objId:obj,idx=0;idx<this.length;idx++)if(this[idx].id===id){var rem=this.splice(idx,1)[0];return this.notify_("remove",[rem]),void(sink&&sink.remove&&sink.remove(rem))}sink&&sink.error&&sink.error("remove",obj)},removeAll:function(sink,options){options||(options={}),options.query||(options.query={f:function(){return!0}});for(var i=0;i<this.length;i++){var obj=this[i];if(options.query.f(obj)){var rem=this.splice(i,1)[0];this.notify_("remove",[rem]),sink&&sink.remove&&sink.remove(rem),i--}}return sink&&sink.eof&&sink.eof(),anop()},select:function(sink,options){sink=sink||[].sink;var hasQuery=options&&(options.query||options.order),originalsink=sink;if(sink=this.decorateSink_(sink,options,!1,!hasQuery),!hasQuery&&GLOBAL.CountExpr&&CountExpr.isInstance(sink))return sink.count=this.length,aconstant(originalsink);for(var fc=this.createFlowControl_(),start=Math.max(0,hasQuery?0:options&&options.skip||0),end=hasQuery?this.length:Math.min(this.length,start+(options&&options.limit||this.length)),i=start;end>i&&(sink.put(this[i],null,fc),!fc.stopped);i++)if(fc.errorEvt)return sink.error&&sink.error(fc.errorEvt),aconstant(originalsink,fc.errorEvt);return sink.eof&&sink.eof(),aconstant(originalsink)}}});var NOT_FOUND={cost:0,execute:function(_,sink,__){return anop},toString:function(){return"no-match(cost=0)"}},NO_PLAN={cost:Number.MAX_VALUE,execute:function(){return anop},toString:function(){return"no-plan"}},ValueIndex={put:function(s,newValue){return newValue},remove:function(){return void 0},plan:function(){var plan={cost:1,execute:function(s,sink){return sink.put(s),anop},toString:function(){return"unique"}};return function(){return plan}}(),get:function(value,key){return value},select:function(value,sink,options){if(options){if(options.query&&!options.query.f(value))return;if("skip"in options&&options.skip-->0)return;if("limit"in options&&options.limit--<=0)return}sink.put(value)},selectReverse:function(value,sink,options){this.select(value,sink,options)},size:function(obj){return 1},toString:function(){return"value"}},KEY=0,VALUE=1,SIZE=2,LEVEL=3,LEFT=4,RIGHT=5,TreeIndex={create:function(prop,tail){return tail=tail||ValueIndex,{__proto__:this,prop:prop,tail:tail,selectCount:0}},bulkLoad:function(a){if(this.tail===ValueIndex)return a.sort(toCompare(this.prop)),this.bulkLoad_(a,0,a.length-1);for(var s=void 0,i=0;i<a.length;i++)s=this.put(s,a[i]);return s},bulkLoad_:function(a,start,end){if(start>end)return void 0;var m=start+Math.floor((end-start+1)/2),tree=this.put(void 0,a[m]);return tree[LEFT]=this.bulkLoad_(a,start,m-1),tree[RIGHT]=this.bulkLoad_(a,m+1,end),tree[SIZE]+=this.size(tree[LEFT])+this.size(tree[RIGHT]),tree},dedup:function(obj,value){obj[this.prop.name]=value},maybeClone:function(s){return s&&this.selectCount>0?s.clone():s},put:function(s,newValue){return this.putKeyValue(s,this.prop.f(newValue),newValue)},putKeyValue:function(s,key,value){if(!s)return[key,this.tail.put(null,value),1,1];s=this.maybeClone(s);var r=this.compare(s[KEY],key);if(0===r)this.dedup(value,s[KEY]),s[SIZE]-=this.tail.size(s[VALUE]),s[VALUE]=this.tail.put(s[VALUE],value),s[SIZE]+=this.tail.size(s[VALUE]);else{var side=r>0?LEFT:RIGHT;s[side]&&(s[SIZE]-=s[side][SIZE]),s[side]=this.putKeyValue(s[side],key,value),s[SIZE]+=s[side][SIZE]}return this.split(this.skew(s))},skew:function(s){if(s&&s[LEFT]&&s[LEFT][LEVEL]===s[LEVEL]){var l=this.maybeClone(s[LEFT]);return s[LEFT]=l[RIGHT],l[RIGHT]=s,this.updateSize(s),this.updateSize(l),l}return s},updateSize:function(s){s[SIZE]=this.size(s[LEFT])+this.size(s[RIGHT])+this.tail.size(s[VALUE])},split:function(s){if(s&&s[RIGHT]&&s[RIGHT][RIGHT]&&s[LEVEL]===s[RIGHT][RIGHT][LEVEL]){var r=this.maybeClone(s[RIGHT]);return s[RIGHT]=r[LEFT],r[LEFT]=s,r[LEVEL]++,this.updateSize(s),this.updateSize(r),r}return s},remove:function(s,value){return this.removeKeyValue(s,this.prop.f(value),value)},removeKeyValue:function(s,key,value){if(!s)return s;s=this.maybeClone(s);var r=this.compare(s[KEY],key);if(0===r){if(s[SIZE]-=this.tail.size(s[VALUE]),s[VALUE]=this.tail.remove(s[VALUE],value),s[VALUE])return s[SIZE]+=this.tail.size(s[VALUE]),s;if(!s[LEFT]&&!s[RIGHT])return void 0;var side=s[LEFT]?LEFT:RIGHT,l=side===LEFT?this.predecessor(s):this.successor(s);s[KEY]=l[KEY],s[VALUE]=l[VALUE],s[side]=this.removeNode(s[side],l[KEY])}else{var side=r>0?LEFT:RIGHT;s[SIZE]-=this.size(s[side]),s[side]=this.removeKeyValue(s[side],key,value),s[SIZE]+=this.size(s[side])}return s=this.skew(this.decreaseLevel(s)),s[RIGHT]&&(s[RIGHT]=this.skew(this.maybeClone(s[RIGHT])),s[RIGHT][RIGHT]&&(s[RIGHT][RIGHT]=this.skew(this.maybeClone(s[RIGHT][RIGHT])))),s=this.split(s),s[RIGHT]=this.split(this.maybeClone(s[RIGHT])),s},removeNode:function(s,key){if(!s)return s;s=this.maybeClone(s);var r=this.compare(s[KEY],key);if(0===r)return s[LEFT]?s[LEFT]:s[RIGHT];var side=r>0?LEFT:RIGHT;return s[SIZE]-=this.size(s[side]),s[side]=this.removeNode(s[side],key),s[SIZE]+=this.size(s[side]),s},predecessor:function(s){if(!s[LEFT])return s;for(s=s[LEFT];s[RIGHT];s=s[RIGHT]);return s},successor:function(s){if(!s[RIGHT])return s;for(s=s[RIGHT];s[LEFT];s=s[LEFT]);return s},decreaseLevel:function(s){var expectedLevel=Math.min(s[LEFT]?s[LEFT][LEVEL]:0,s[RIGHT]?s[RIGHT][LEVEL]:0)+1;return expectedLevel<s[LEVEL]&&(s[LEVEL]=expectedLevel,s[RIGHT]&&expectedLevel<s[RIGHT][LEVEL]&&(s[RIGHT]=this.maybeClone(s[RIGHT]),s[RIGHT][LEVEL]=expectedLevel)),s},get:function(s,key){if(!s)return void 0;var r=this.compare(s[KEY],key);return 0===r?s[VALUE]:this.get(r>0?s[LEFT]:s[RIGHT],key)},select:function(s,sink,options){if(s){if(options){if("limit"in options&&options.limit<=0)return;var size=this.size(s);if(options.skip>=size&&!options.query)return void(options.skip-=size)}this.select(s[LEFT],sink,options),this.tail.select(s[VALUE],sink,options),this.select(s[RIGHT],sink,options)}},selectReverse:function(s,sink,options){if(s){if(options){if("limit"in options&&options.limit<=0)return;var size=this.size(s);if(options.skip>=size&&!options.query)return console.log("reverse skipping: ",s[KEY]),void(options.skip-=size)}this.selectReverse(s[RIGHT],sink,options),this.tail.selectReverse(s[VALUE],sink,options),this.selectReverse(s[LEFT],sink,options)}},gt:function(s,key){if(!s)return s;var r=this.compare(key,s[KEY]);if(0>r){var l=this.gt(s[LEFT],key);return[s[KEY],s[VALUE],this.size(s)-this.size(s[LEFT])+this.size(l),s[LEVEL],l,s[RIGHT]]}return r>0?this.gt(s[RIGHT],key):s[RIGHT]},gte:function(s,key){if(!s)return s;var r=this.compare(key,s[KEY]);if(0>r){var l=this.gte(s[LEFT],key);return[s[KEY],s[VALUE],this.size(s)-this.size(s[LEFT])+this.size(l),s[LEVEL],l,s[RIGHT]]}return r>0?this.gte(s[RIGHT],key):[s[KEY],s[VALUE],this.size(s)-this.size(s[LEFT]),s[LEVEL],null,s[RIGHT]]},lt:function(s,key){if(!s)return s;var r=this.compare(key,s[KEY]);if(r>0){var r=this.lt(s[RIGHT],key);return[s[KEY],s[VALUE],this.size(s)-this.size(s[RIGHT])+this.size(r),s[LEVEL],s[LEFT],r]}return 0>r?this.lt(s[LEFT],key):s[LEFT]},lte:function(s,key){if(!s)return s;var r=this.compare(key,s[KEY]);if(r>0){var r=this.lte(s[RIGHT],key);return[s[KEY],s[VALUE],this.size(s)-this.size(s[RIGHT])+this.size(r),s[LEVEL],s[LEFT],r]}return 0>r?this.lte(s[RIGHT],key):[s[KEY],s[VALUE],this.size(s)-this.size(s[RIGHT]),s[LEVEL],s[LEFT],null]},size:function(s){return s?s[SIZE]:0},compare:function(o1,o2){return this.prop.compareProperty(o1,o2)},plan:function(s,sink,options){options=this.cloneOptions(options);var query=options.query;if(query===FALSE)return NOT_FOUND;if(!query&&CountExpr.isInstance(sink)){var count=this.size(s);return{cost:0,execute:function(unused,sink,options){return sink.count+=count,anop},toString:function(){return"short-circuit-count("+count+")"}}}var prop=this.prop,isExprMatch=function(model){if(!model)return void 0;if(query){if(model.isInstance(query)&&query.arg1===prop){var arg2=query.arg2;return options.query=query=void 0,arg2}if(AndExpr.isInstance(query))for(var i=0;i<query.args.length;i++){var q=query.args[i];if(model.isInstance(q)&&q.arg1===prop)return query=query.clone(),query.args[i]=TRUE,options.query=query=query.partialEval(),query===TRUE&&(options.query=query=void 0),q.arg2}}return void 0},index=this,arg2=isExprMatch(GLOBAL.InExpr);if(arg2&&Math.log(this.size(s))/Math.log(2)*arg2.length<this.size(s)){for(var keys=arg2,subPlans=[],results=[],cost=1,i=0;i<keys.length;i++){var result=this.get(s,keys[i]);if(result){var subPlan=this.tail.plan(result,sink,options);cost+=subPlan.cost,subPlans.push(subPlan),results.push(result)}}return 0==subPlans.length?NOT_FOUND:{cost:1+cost,execute:function(s2,sink,_){for(var pars=[],i=0;i<subPlans.length;i++)pars.push(subPlans[i].execute(results[i],sink,options));return apar.apply(null,pars)},toString:function(){return"IN(key="+prop.name+", size="+results.length+")"}}}if(arg2=isExprMatch(GLOBAL.EqExpr),void 0!=arg2){var key=arg2.f(),result=this.get(s,key);if(!result)return NOT_FOUND;var subPlan=this.tail.plan(result,sink,options);return{cost:1+subPlan.cost,execute:function(s2,sink,_){return subPlan.execute(result,sink,options)},toString:function(){return"lookup(key="+prop.name+", cost="+this.cost+(query&&query.toSQL?", query: "+query.toSQL():"")+") "+subPlan.toString()}}}arg2=isExprMatch(GLOBAL.GtExpr),arg2&&(s=this.gt(s,arg2.f())),arg2=isExprMatch(GLOBAL.GteExpr),arg2&&(s=this.gte(s,arg2.f())),arg2=isExprMatch(GLOBAL.LtExpr),arg2&&(s=this.lt(s,arg2.f())),arg2=isExprMatch(GLOBAL.LteExpr),arg2&&(s=this.lte(s,arg2.f()));var cost=this.size(s),sortRequired=!1,reverseSort=!1;return options.order&&(options.order===prop||(GLOBAL.DescExpr&&DescExpr.isInstance(options.order)&&options.order.arg1===prop?reverseSort=!0:(sortRequired=!0,0!=cost&&(cost*=Math.log(cost)/Math.log(2))))),sortRequired||(options.skip&&(cost-=options.skip),options.limit&&(cost=Math.min(cost,options.limit))),{cost:cost,execute:function(){if(sortRequired){var a=[].sink;index.selectCount++,index.select(s,a,{query:options.query}),index.selectCount--,a.sort(toCompare(options.order));var skip=options.skip||0,limit=Number.isFinite(options.limit)?options.limit:a.length;limit+=skip,limit=Math.min(a.length,limit);for(var i=skip;limit>i;i++)sink.put(a[i])}else index.selectCount++,reverseSort?index.selectReverse(s,sink,options):index.select(s,sink,options),index.selectCount--;return anop},toString:function(){return"scan(key="+prop.name+", cost="+this.cost+(query&&query.toSQL?", query: "+query.toSQL():"")+")"}}},cloneOptions:function(options){var c={};return options&&(options.query&&(c.query=options.query),options.skip&&(c.skip=options.skip),options.order&&(c.order=options.order),"limit"in options&&(c.limit=options.limit)),c},toString:function(){return"TreeIndex("+this.prop.name+", "+this.tail+")"}},CITreeIndex={__proto__:TreeIndex,create:function(prop,tail){return tail=tail||ValueIndex,{__proto__:this,prop:prop,tail:tail}},put:function(s,newValue){return this.putKeyValue(s,this.prop.f(newValue).toLowerCase(),newValue)},remove:function(s,value){return this.removeKeyValue(s,this.prop.f(value).toLowerCase(),value)}},SetIndex={__proto__:TreeIndex,create:function(prop,tail){return tail=tail||ValueIndex,{__proto__:this,prop:prop,tail:tail}},dedup:function(obj,value){},put:function(s,newValue){var a=this.prop.f(newValue);if(a.length)for(var i=0;i<a.length;i++)s=this.putKeyValue(s,a[i],newValue);else s=this.putKeyValue(s,"",newValue);return s},remove:function(s,value){var a=this.prop.f(value);if(a.length)for(var i=0;i<a.length;i++)s=this.removeKeyValue(s,a[i],value);else s=this.removeKeyValue(s,"",value);return s}},PositionQuery={create:function(args){return{__proto__:this,skip:args.skip,limit:args.limit,s:args.s}},reduce:function(other){var otherFinish=other.skip+other.limit,myFinish=this.skip+this.limit;return other.skip>myFinish?null:other.skip>=this.skip?PositionQuery.create({skip:this.skip,limit:Math.max(myFinish,otherFinish)-this.skip,s:this.s}):other.reduce(this)},equals:function(other){return this.skip===other.skip&&this.limit===other.limit}},AutoPositionIndex={create:function(factory,mdao,networkdao,maxage){var obj={__proto__:this,factory:factory,maxage:maxage,dao:mdao,networkdao:networkdao,sets:[],alt:AltIndex.create()};return obj},put:function(s,value){return this.alt.put(s,value)},remove:function(s,value){return this.alt.remove(s,value)},bulkLoad:function(a){return[]},addIndex:function(s,index){return this},addPosIndex:function(s,options){var index=PositionIndex.create(options&&options.order,options&&options.query,this.factory,this.dao,this.networkdao,this.queue,this.maxage);this.alt.delegates.push(index),s.push(index.bulkLoad([]))},hasIndex:function(options){for(var i=0;i<this.sets.length;i++){var set=this.sets[i];if(set[0].equals(options&&options.query||"")&&set[1].equals(options&&options.order||""))return!0}return!1},plan:function(s,sink,options){var subPlan=this.alt.plan(s,sink,options);return subPlan!=NO_PLAN?subPlan:options&&null!=options.skip&&null!=options.limit||CountExpr.isInstance(sink)?this.hasIndex(options)?NO_PLAN:(this.sets.push([options&&options.query||"",options&&options.order||""]),this.addPosIndex(s,options),this.alt.plan(s,sink,options)):NO_PLAN}},PositionIndex={create:function(order,query,factory,dao,networkdao,queue,maxage){var obj={__proto__:this,order:order||"",query:query||"",factory:factory,dao:dao,networkdao:networkdao.where(query).orderBy(order),maxage:maxage,queue:arequestqueue(function(ret,request){var s=request.s;obj.networkdao.skip(request.skip).limit(request.limit).select()(function(objs){for(var now=Date.now(),i=0;i<objs.length;i++)s[request.skip+i]={obj:objs[i].id,timestamp:now},s.feedback=objs[i].id,obj.dao.put(objs[i]),s.feedback=null;ret()})},void 0,1)};return obj},put:function(s,newValue){if(s.feedback===newValue.id)return s;if(this.query&&!this.query.f(newValue))return s;for(var compare=toCompare(this.order),i=0;i<s.length;i++){var entry=s[i];if(entry){if(this.dao.find(entry.obj,{put:function(o){entry=o}}),entry.id===newValue.id)break;if(compare(entry,newValue)>0){for(var j=s.length;j>i;j--)s[j]=s[j-1];(0==i||s[i-1])&&(s[i]={obj:newValue.id,timestamp:Date.now()});break}}}return s},remove:function(s,obj){if(s.feedback===obj.id)return s;for(var i=0;i<s.length;i++)if(s[i]&&s[i].obj===obj.id){for(var j=i;j<s.length-1;j++)s[j]=s[j+1];break}return s},bulkLoad:function(a){return[]},plan:function(s,sink,options){var order=options&&options.order||"",query=options&&options.query||"",skip=options&&options.skip,limit=options&&options.limit,self=this;if(!order.equals(this.order)||!query.equals(this.query))return NO_PLAN;if(CountExpr.isInstance(sink))return{cost:0,execute:function(s,sink,options){return s.count||(s.count=amemo(function(ret){self.networkdao.select(COUNT())(function(c){ret(c)})},self.maxage)),function(ret,count){sink.copyFrom(count),ret()}.ao(s.count)},toString:function(){return"position-index(cost="+this.cost+", count)"}};if(void 0==skip||void 0==limit)return NO_PLAN;var threshold=Date.now()-this.maxage;return{cost:0,toString:function(){return"position-index(cost="+this.cost+")"},execute:function(s,sink,options){for(var objs=[],min,max,i=0;limit>i;i++){var o=s[i+skip];(!o||o.timestamp<threshold)&&(void 0==min&&(min=i+skip),max=i+skip),o?self.dao.find(o.obj,{put:function(obj){objs[i]=obj}}):objs[i]=self.factory(),!objs[i]}void 0!=min&&self.queue(PositionQuery.create({skip:min,limit:max-min+1,s:s}));for(var i=0;i<objs.length;i++)sink.put(objs[i]);return anop}}}},AltIndex={GOOD_ENOUGH_PLAN:10,create:function(){return{__proto__:this,delegates:argsToArray(arguments)}},addIndex:function(s,index){var a=[].sink;return this.plan(s,a).execute(s,a),s.push(index.bulkLoad(a)),this.delegates.push(index),this},bulkLoad:function(a){for(var root=[].sink,i=0;i<this.delegates.length;i++)root[i]=this.delegates[i].bulkLoad(a);return root},get:function(s,key){return this.delegates[0].get(s[0],key)},put:function(s,newValue){s=s||[].sink;for(var i=0;i<this.delegates.length;i++)s[i]=this.delegates[i].put(s[i],newValue);return s},remove:function(s,obj){s=s||[].sink;for(var i=0;i<this.delegates.length;i++)s[i]=this.delegates[i].remove(s[i],obj);return s},plan:function(s,sink,options){for(var bestPlan,bestPlanI=0,i=0;i<this.delegates.length;i++){var plan=this.delegates[i].plan(s[i],sink,options);if(plan.cost<=AltIndex.GOOD_ENOUGH_PLAN){bestPlanI=i,bestPlan=plan;break}(!bestPlan||plan.cost<bestPlan.cost)&&(bestPlanI=i,bestPlan=plan)}return void 0==bestPlan||bestPlan==NO_PLAN?NO_PLAN:{__proto__:bestPlan,execute:function(unused,sink,options){return bestPlan.execute(s[bestPlanI],sink,options)}}},size:function(obj){return this.delegates[0].size(obj[0])},toString:function(){return"Alt("+this.delegates.join(",")+")"}},mLangIndex={create:function(mlang){return{__proto__:this,mlang:mlang,PLAN:{cost:0,execute:function(s,sink,options){return sink.copyFrom(s),anop},toString:function(){return"mLangIndex("+this.s+")"}}}},bulkLoad:function(a){return a.select(this.mlang),this.mlang},put:function(s,newValue){return s=s||this.mlang.clone(),s.put(newValue),s},remove:function(s,obj){return s=s||this.mlang.clone(),s.remove&&s.remove(obj),s},size:function(s){return Number.MAX_VALUE},plan:function(s,sink,options){return options&&options.query?NO_PLAN:sink.model_&&sink.model_.isInstance(s)&&s.arg1===sink.arg1?(this.PLAN.s=s,this.PLAN):NO_PLAN},toString:function(){return"mLangIndex("+this.mlang+")"}},AutoIndex={create:function(mdao){return{__proto__:this,properties:{id:!0},mdao:mdao}},put:function(s,newValue){return s},remove:function(s,obj){return s},bulkLoad:function(a){return"auto"},addIndex:function(prop){GLOBAL.DescExpr&&DescExpr.isInstance(prop)&&(prop=prop.arg1),console.log("Adding AutoIndex : ",prop.id),this.properties[prop.name]=!0,this.mdao.addIndex(prop)},plan:function(s,sink,options){return options&&(options.order&&Property.isInstance(options.order)&&!this.properties[options.order.name]?this.addIndex(options.order):options.query),NO_PLAN},toString:function(){return"AutoIndex()"}},MDAO=Model.create({"extends":"AbstractDAO",name:"MDAO",label:"Indexed DAO",properties:[{name:"model",type:"Model",required:!0},{type:"Boolean",name:"autoIndex",defaultValue:!1}],methods:{init:function(){this.SUPER(),this.map={},this.index=TreeIndex.create(this.model.getProperty(this.model.ids[0])),this.autoIndex&&this.addRawIndex(AutoIndex.create(this))},addIndex:function(){for(var props=argsToArray(arguments),i=0;i<this.model.ids.length;i++)if(props.push(this.model.getProperty(this.model.ids[i])),!props[props.length-1])throw"Undefined index property";return this.addUniqueIndex.apply(this,props)},addUniqueIndex:function(){for(var index=ValueIndex,i=arguments.length-1;i>=0;i--){var prop=arguments[i],proto="Array[]"==prop.type?SetIndex:TreeIndex;index=proto.create(prop,index)}return this.addRawIndex(index)},addRawIndex:function(index){return this.index.delegates||(this.index=AltIndex.create(this.index),this.root=[this.root]),this.index.addIndex(this.root,index),this},bulkLoad:function(dao,sink){var self=this;dao.select({__proto__:[].sink,eof:function(){self.root=self.index.bulkLoad(this),sink&&sink.eof&&sink.eof()}})},put:function(obj,sink){var oldValue=this.map[obj.id];oldValue?this.root=this.index.put(this.index.remove(this.root,oldValue),obj):this.root=this.index.put(this.root,obj),this.map[obj.id]=obj,this.notify_("put",[obj]),sink&&sink.put&&sink.put(obj)},findObj_:function(key,sink){var obj=this.map[key];obj?sink.put&&sink.put(obj):sink.error&&sink.error("find",key)},find:function(key,sink){if(void 0==key)return void(sink&&sink.error&&sink.error("missing key"));if(!key.f)return void this.findObj_(key,sink);var found=!1;this.where(key).limit(1).select({put:function(obj){found=!0,sink&&sink.put&&sink.put(obj)},eof:function(){found||sink&&sink.error&&sink.error("find",key)}})},remove:function(obj,sink){if(!obj)return void(sink&&sink.error&&sink.error("missing key"));var id=void 0!==obj.id&&""!==obj.id?obj.id:obj,self=this;this.find(id,{put:function(obj){self.root=self.index.remove(self.root,obj),delete self.map[obj.id],self.notify_("remove",[obj]),sink&&sink.remove&&sink.remove(obj)},error:function(){sink&&sink.error&&sink.error("remove",obj)}})},removeAll:function(sink,options){options||(options={}),options.query||(options.query=TRUE);var future=afuture();return this.where(options.query).select()(function(a){for(var i=0;i<a.length;i++)this.root=this.index.remove(this.root,a[i]),delete this.map[a[i].id],this.notify_("remove",[a[i]]),sink&&sink.remove&&sink.remove(a[i]);sink&&sink.eof&&sink.eof(),future.set(sink)}.bind(this)),future.get},select:function(sink,options){if(sink=sink||[].sink,options&&(options={__proto__:options}),GLOBAL.ExplainExpr&&GLOBAL.ExplainExpr.isInstance(sink)){var plan=this.index.plan(this.root,sink.arg1,options);return sink.plan="cost: "+plan.cost+", "+plan.toString(),sink&&sink.eof&&sink.eof(),aconstant(sink)}if(options&&options.query){var query=options.query.partialEval();options.query=query===TRUE?void 0:query}var plan=this.index.plan(this.root,sink,options),future=afuture();return plan.execute(this.root,sink,options)(function(ret){sink&&sink.eof&&sink.eof(),future.set(sink)}),future.get},toString:function(){return"MDAO("+this.model.name+","+this.index+")"}}});CLASS({name:"Binding",documentation:function(){},properties:[{name:"id",hidden:!0},{name:"value",hidden:!0},{name:"version",defaultValue:1,hidden:!0}]}),CLASS({name:"PersistentContext",documentation:function(){},properties:[{name:"dao",label:"DAO",type:"DAO",hidden:!0},{name:"context",hidden:!0},{name:"predicate",type:"Expr",defaultValueFn:function(){return TRUE},hidden:!0}],methods:{manage:function(name,obj,version){var write=EventService.merged(function(){this.dao.put(this.Y.Binding.create({id:name,value:JSONUtil.where(this.predicate).stringify(obj),version:version}))}.bind(this),void 0,this.Y);obj.addListener(write),write()},bindObjects:function(a){},clearBinding:function(ret,name){var self=this;self.dao.remove.ao(self.dao.find.bind(self.dao,name))(ret)},bindObject:function(name,factory,transientValues,version){version=version||1;var future=afuture();if(transientValues=transientValues||{},this.context[name])future.set(this.context[name]);else{var newinit=function(){var obj=factory.create();obj.copyFrom(transientValues),this.context[name]=obj,this.manage(name,obj,version),future.set(obj)}.bind(this);this.dao.find(name,{put:function(binding){if(binding.version!==version)return void newinit();try{var json=JSON.parse(binding.value),obj=JSONUtil.mapToObj(this.Y,json);obj.copyFrom(transientValues),this.context[name]=obj,this.manage(name,obj,version),future.set(obj)}catch(e){console.log("PersistentContext","existingInit serialization error",name),newinit()}}.bind(this),error:newinit})}return future.get}}}),CLASS({name:"UserInfo",label:"UserInfo",properties:[{type:"String",name:"email"}]}),arequire=function(modelName){var THIS=this===GLOBAL?X:this;return function(ret){var m=THIS.lookup(modelName);m||console.warn("Model missing from package:",modelName),ret(m)}},CLASS({"package":"com.google.mail",name:"MobileController","extends":"foam.browser.ui.BrowserView",requires:["MDAO","XHR","com.google.mail.ComposeView","com.google.mail.InnerComposeView","com.google.mail.EMailCitationView","com.google.mail.EMailDAO","com.google.mail.EMailView","com.google.mail.FOAMGMailLabel","com.google.mail.GMailRestDAO","com.google.mail.GMailUserInfo","com.google.mail.MenuView","com.google.mail.ProfileView","com.google.mail.QueryParser","foam.dao.CachingDAO","foam.dao.IDBDAO","foam.dao.ProxyDAO","foam.mlang.CannedQuery","foam.lib.contacts.Contact as Contact","foam.lib.contacts.ContactNetworkDAO as ContactNetworkDAO","foam.lib.email.EMail","foam.oauth2.OAuth2RedirectJsonp as Auth","foam.ui.DetailView","foam.ui.ScrollView","foam.util.busy.BusyFlagTracker","foam.util.busy.BusyStatus"],imports:["setInterval"],exports:["XHR","contactDAO as ContactDAO","labelDao as LabelDAO","emailDao as EMailDAO","emailDao as eMailDAO","profile$ as profile$","openComposeView","as controller"],properties:[{name:"XHR",factory:function(){return XHR.xbind({authAgent:this.oauth,retries:3,delay:10})}},{name:"jsonpFuture",factory:function(){return deferJsonP(this.X)}},{name:"busyStatus",factory:function(){return this.BusyStatus.create()}},{name:"oauth",factory:function(){return this.Auth.create({clientId:"945476427475-oaso9hq95r8lnbp2rruo888rl3hmfuf8.apps.googleusercontent.com",clientSecret:"GTkp929u268_SXAiHitESs-1",scopes:["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email","https://mail.google.com/","https://www.google.com/m8/feeds"]})},postSet:function(_,v){v.setJsonpFuture(this.X,this.jsonpFuture)}},{name:"emailDao",factory:function(){return this.EMailDAO.create()},postSet:function(_,dao){dao.sync&&this.BusyFlagTracker.create({busyStatus:this.busyStatus,target:dao.sync.syncing$})}},{model_:"foam.core.types.DAOProperty",name:"labelDao",factory:function(){return this.CachingDAO.create({src:this.GMailRestDAO.create({model:this.FOAMGMailLabel,modelName:"labels"}),delegate:this.MDAO.create({model:this.FOAMGMailLabel})})},type:"foam.core.types.DAO"},{name:"cannedQueryDAO",factory:function(){var proxy=this.ProxyDAO.create();return this.labelDao.listen({put:this.buildCannedQueries_,remove:this.buildCannedQueries_}),this.buildCannedQueries_(),proxy}},{name:"contactDAO",factory:function(){return this.CachingDAO.create({src:this.ContactNetworkDAO.create(),delegate:this.IDBDAO.create({model:this.Contact,useSimpleSerialization:!1})})}},{name:"title",defaultValue:"Gmail"},{name:"cannedQuery",factory:function(){return this.CannedQuery.create({id:"INBOX",label:"Inbox",expression:CONTAINS(this.EMail.LABELS,"INBOX")})},postSet:function(old,nu){nu&&(this.title=nu.label)}},{name:"data",factory:function(){var self=this;return this.BrowserConfig.create({model:this.EMail,dao:this.emailDao,title$:this.title$,headerColor:"#db4437",listView:{factory_:"foam.ui.ScrollView",rowView:"com.google.mail.EMailCitationView"},detailView:function(args,X){return args.data.isDraft?X.com.google.mail.ComposeView.create({data:args.data,innerView:{factory_:"com.google.mail.InnerComposeView"}},X):X.foam.ui.md.UpdateDetailView.create({immutable:!0},X).copyFrom(args)},innerDetailView:"com.google.mail.EMailView",queryParser:this.QueryParser.create().parser,busyStatus:this.busyStatus,sortChoices:[[DESC(this.EMail.TIMESTAMP),"Newest First"],[this.EMail.TIMESTAMP,"Oldest First"],[this.EMail.SUBJECT,"Subject"]],menuRowView:"com.google.mail.MenuLabelCitationView",menuHeaderView:function(args){return self.ProfileView.create({data$:self.profile$},self.Y)},menuFactory:function(){var dao=this.X.EMailDAO,sink=GROUP_BY(dao.model.LABELS,COUNT());return dao.select(sink),this.Y.counts=sink,this.model_.MENU_FACTORY.defaultValue.call(this)},cannedQuery$:this.cannedQuery$,cannedQueryDAO$:this.cannedQueryDAO$,createView:function(args,X){return this.X.com.google.mail.ComposeView.create({data:this.X.foam.lib.email.EMail.create({id:"draft_"+Math.floor(4294967295*Math.random()).toString(16),labels:["DRAFT"]},this.Y),exitOnSave:!0,innerView:{factory_:"com.google.mail.InnerComposeView"}},this.Y)}})}},{name:"profile"}],actions:[{name:"refresh",isAvailable:function(){return!0},isEnabled:function(){return this.emailDao,this.emailDao.withSync?!this.emailDao.sync.syncing:!0},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAxUlEQVQ4Ed3BPU7CABgA0G8RykkcCP9cEJxRCCF24CROxksQOxmjJ3CgNbFPQ4wppTHMvBdxgYykMoVPmdQwDsyiiY6tY6VUYk6c0vGEvYWxtpaJlQIvfsQpW7zqRoWhDwdRZ4S9bhxx41fUSbGII+b+RJ0M46gwUxF1CrTjfAq043yeMYnzucddNLDGbdQZKOV6UWOg8OU6Tknxph8V+t6xjCYSj8gtTXUkplZyPLiKZhKpUlVprRX/MbCxkyvsbPTiAn0DBHjsbF9BcVMAAAAASUVORK5CYII=",code:function(){this.emailDao.sync&&this.emailDao.sync.sync()}}],constants:[{name:"SYNC_INTERVAL",value:3e4}],methods:[function init(args){this.SUPER(args);var xhr=this.Y.XHR.create({responseType:"json"});aseq(function(ret){xhr.asend(ret,"https://www.googleapis.com/oauth2/v1/userinfo")})(function(resp){var user=this.GMailUserInfo.create();user.fromJSON(resp),this.profile=user}.bind(this))}],listeners:[{name:"buildCannedQueries_",code:function(){console.log("Building canned queries");var dao=this.MDAO.create({model:this.CannedQuery}),self=this,toQuery=function(label,section,order){
var cq=self.CannedQuery.create({id:label.name,label:label.label,iconUrl:label.iconUrl,expression:CONTAINS(self.EMail.LABELS,label.id)});return section&&(cq.section=section),order&&(cq.order=order),cq},fetchLabel=function(id,section,order){self.labelDao.find(id,{put:function(label){dao.put(toQuery(label,section,order))}})};fetchLabel("INBOX",1,1),fetchLabel("STARRED",1,2),fetchLabel("DRAFT",1,3),fetchLabel("SENT",2,1),fetchLabel("SPAM",2,2),fetchLabel("TRASH",2,3),this.labelDao.where(AND(EQ(this.X.com.google.mail.FOAMGMailLabel.getProperty("type"),"system"),NOT(IN(this.X.com.google.mail.FOAMGMailLabel.ID,["INBOX","STARRED","UNREAD","DRAFT","SENT","SPAM","TRASH"])))).select([])(function(arr){arr.forEach(function(label){dao.put(toQuery(label,2))})}),dao.put(this.CannedQuery.create({id:"ALL MAIL",label:"All Mail",expression:TRUE,section:3,order:1})),this.labelDao.where(NEQ(this.X.com.google.mail.FOAMGMailLabel.getProperty("type"),"system")).orderBy(this.X.com.google.mail.FOAMGMailLabel.NAME).select([])(function(arr){arr.forEach(function(label){dao.put(toQuery(label,3))})}),this.cannedQueryDAO.delegate=dao},isMerged:100},{name:"openComposeView",code:function(X,email){X.stack.replaceView(this.ComposeView.create({data:email},this.Y))}}],templates:[{name:"CSS",code:ConstantTemplate(".mdui-app-controller .header{background:#db4437}.mdui-app-controller.searchMode .header .search{background:#db4437}.header canvas{background:#db4437}input[name=q]{background:#db4437}table{border-spacing:0}*{box-sizing:border-box}body, tbody, tr, td{margin:0;padding:0}hr{border-top:1px solid rgba(0, 0, 0, .1);border:none;height:1px;margin:0;padding:0;background:rgba(0, 0, 0, .1)}a{text-decoration:none;color:#4285f4}.actionButton{padding:8px;vertical-align:middle;background:#db4437;border:none;-webkit-box-shadow:none;box-shadow:none;opacity:0.76;outline:none}.actionButton img{height:24px;opacity:0.76;width:24px}.popupChoiceList{-webkit-box-shadow:0 0 2px 2px rgba(0, 0, 0, .1), 0 0 3px 1px rgba(0, 0, 0, .1);box-shadow:0 0 2px 2px rgba(0, 0, 0, .1), 0 0 3px 1px rgba(0, 0, 0, .1);border:none;border-radius:2px;padding:8px 0;min-width:190px}.popupChoiceList li{color:rgba(0, 0, 0, 0.54);font-size:16px;padding:16px;margin:0;line-height:16px}.popupChoiceList li.selected{color:#e51c23}.star{-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-shrink:0;height:24px;opacity:0.76;vertical-align:middle;width:24px;margin-top:auto}.hide{display:none}::-webkit-search-cancel-button{-webkit-appearance:none}.actionButton-leaveSearchMode, .actionButton-back{margin:4px}.actionButton-leaveSearchMode img, .actionButton-back img{margin:4px;opacity:0.76}select[name=sortOrder]{-webkit-align-self:center;align-self:center;-webkit-align-self:center;margin:20px}.swipeAltOuter{-webkit-flex-grow:1;-webkit-flex-grow:1;flex-grow:1}.swipeAltInner{padding-top:8px}span[name=projectName]{-webkit-align-self:center;align-self:center;-webkit-align-self:center;color:white;-webkit-flex:1.0;flex:1.0;-webkit-box-flex:1.0;vertical-align:middle;font-size:20px;font-weight:500;margin-left:16px}.stackview{height:100%}.stackview table{height:100%}.stackview_navbar{display:none}.stackview_navactions{display:none}.stackview-previewarea-td{display:none}.stackview-viewarea{height:100%}.actionButton-save{border:none;margin-right:40px}.status-icon{height:24px;margin:0 24px 0 0;opacity:0.54;padding:2px;width:24px}select[name=pri], select[name=status]{background:white;border-color:white;width:250px;height:30px;margin-left:30px;margin-top:16px;outline:none}.actionButton-changeProject{margin:4px}.swipeAltHeader{height:36px}.swipeAltHeader li{font-size:14px;opacity:0.8;line-height:48px;padding-bottom:14px}.swipeAltHeader .selected{border-bottom:2px solid #ff3f80;color:white;font-weight:500;opacity:1}ul.swipeAltHeader{background:#db4437;-webkit-box-shadow:0 1px 1px rgba(0, 0, 0, .25);box-shadow:0 1px 1px rgba(0, 0, 0, .25);color:white;height:48px;margin:0;overflow:hidden;padding:0 0 0 56px}.actionButton{width:48px;height:48px;background:transparent}.foamChoiceListView{padding:14px 16px;margin:0}.stackview-slidearea{-webkit-box-shadow:1px 0px 1px 1px rgba(0, 0, 0, .2);box-shadow:1px 0px 1px 1px rgba(0, 0, 0, .2)}.email-compose-view .header{background:#db4437;position:fixed;width:100%;top:0;z-index:2;-webkit-box-shadow:0 1px 1px rgba(0, 0, 0, .15), 0 1px 3px rgba(0, 0, 0, .15);box-shadow:0 1px 1px rgba(0, 0, 0, .15), 0 1px 3px rgba(0, 0, 0, .15);display:-webkit-flex;display:flex;display:-webkit-flex}.email-compose-view .header .actionButton{margin:4px}.email-compose-view .content{margin-top:62px;margin-left:6px;margin-right:6px}.email-compose-view .to{}.email-compose-view .cc{}.email-compose-view .bcc{}.email-compose-view .subject{color:#fff;display:block;font-size:20px;line-height:28px;margin:auto;overflow-x:hidden;padding:0px 16px;text-overflow:ellipsis;white-space:nowrap;-webkit-flex:1;flex:1;-webkit-box-flex:1.0}.email-compose-view .richtext{height:300px}"),language:"css"}]}),CLASS({"package":"com.google.mail",name:"ComposeView","extends":"foam.ui.md.UpdateDetailView",properties:[{name:"title",dynamicValue:null},{name:"leftActions_",lazyFactory:function(){return[this.ToolbarAction.create({data:this,action:this.model_.getAction("back")})]}},{name:"rightActions_",lazyFactory:function(){return[this.ToolbarAction.create({data:this,action:this.model_.getAction("save")}),this.ToolbarAction.create({data:this,action:this.model_.getAction("send")})]}}],actions:[{name:"send",iconUrl:"images/send.png",code:function(){this.data.messageSent=!0;var self=this;this.dao.put(this.data,{put:function(){self.stack.popView()}})}}]}),CLASS({"package":"foam.ui.md",name:"UpdateDetailView","extends":"foam.ui.md.BaseDetailView",requires:["foam.ui.PopupChoiceView","foam.ui.md.Toolbar","foam.ui.md.ToolbarAction"],imports:["dao as importDao","stack","controllerMode"],exports:["toolbar as mdToolbar"],properties:[{name:"dao",lazyFactory:function(){return this.importDao||this.X[daoize(this.model.name)]}},{name:"title",dynamicValue:function(){return(this.data&&this.data.id?"Edit":"New")+(this.model?" "+this.model.label:"")}},{name:"rawData",postSet:function(old,nu){if(old&&old.removeListener(this.rawUpdate),nu&&nu.addListener(this.rawUpdate),nu.data&&nu.data.model_){var modelClassName=nu.data.model_.id.replace(/[.]/g,"-");if(this.$){var className=this.$.className;className=className.replace(new RegExp(modelClassName,"g"),""),className=className+" "+modelClassName,this.$.className=className}else this.extraClassName=modelClassName}}},{name:"originalData"},{name:"data",preSet:function(_,v){return v?(this.rawData=v,v.deepClone()):void 0},postSet:function(_,data){if(data){this.originalData=data.deepClone(),data&&data.model_&&(this.model=data.model_);var self=this;data.addPropertyListener(null,function(o,topic){var prop=o.model_.getProperty(topic[1]);prop["transient"]||(self.version++,self.rawData="")})}}},{name:"immutable",defaultValue:!1},{name:"liveEdit",defaultValue:!1},{name:"exitOnSave",defaultValue:!1},{model_:"IntProperty",name:"version",type:"Int"},{model_:"BooleanProperty",name:"showModelActions",type:"Boolean",defaultValue:!0},{model_:"BooleanProperty",name:"outstandingChanges",type:"Boolean",visibility:"hidden",hidden:!0,dynamicValue:function(){return this.version,this.immutable,!this.immutable&&!this.originalData.equals(this.data)},postSet:function(old,nu){nu&&this.liveEdit&&this.commit_()}},{name:"toolbar",lazyFactory:function(){return this.Toolbar.create({data$:this.data$,title$:this.title$},this.Y)},postSet:function(old,nu){old!==nu&&(old&&(old.removeLeftActions(this.leftActions_),old.removeRightActions(this.rightActions_)),nu&&(nu.addLeftActions(this.leftActions_),nu.addRightActions(this.rightActions_)))}},{model_:"ViewFactoryProperty",name:"innerView",type:"ViewFactory",defaultValue:"foam.ui.md.DetailView"},{name:"className",defaultValue:"md-update-detail-view"},{model_:"ArrayProperty",name:"leftActions_",type:"Array",lazyFactory:function(){var myModel=this.model_;return[this.ToolbarAction.create({data:this,action:myModel.getAction("back")},this.Y),this.ToolbarAction.create({data:this,action:myModel.getAction("reset")},this.Y)]},postSet:function(old,nu){var toolbar=this.toolbar;old!==nu&&toolbar&&(old&&toolbar.removeLeftActions(old),nu&&toolbar.addLeftActions(nu))}},{model_:"ArrayProperty",name:"rightActions_",type:"Array",lazyFactory:function(){return[this.ToolbarAction.create({data:this,action:this.model_.getAction("save")}),this.ToolbarAction.create({data:this,action:this.model_.getAction("delete")})]},postSet:function(old,nu){var toolbar=this.toolbar;old!==nu&&toolbar&&(old&&toolbar.removeRightActions(old),nu&&toolbar.addRightActions(nu))}}],actions:[{name:"back",help:"Go back",isAvailable:function(){return this.liveEdit||!this.outstandingChanges},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAPUlEQVQ4y2NgGLbgf8P/BtKU////+78WacpDSFMeSlPlYaQo/0OacjyAcg1wJ4WTGmHDS4sWaVrqhm/mBQAoLpX9t+4i2wAAAABJRU5ErkJggg==",ligature:"arrow_back",code:function(){this.stack.popView()},priority:0,order:0},{name:"save",help:"Save updates",isAvailable:function(){return!this.liveEdit&&this.outstandingChanges},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAUElEQVQ4jWNgGAW4wH9d0pRH///zv4E05f+J1jB0lP9n+b/0fzgJpv8PBUr++R9BgmP+N4C1RJLgdqiWKBK8CtVCUsiAtBCvHKqFFOUjAwAATIhwjZSqeJcAAAAASUVORK5CYII=",ligature:"check",code:function(){this.commit_()},priority:0,order:0},{name:"delete",isAvailable:function(){return this.controllerMode&&"update"==this.controllerMode},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAOklEQVQ4y2NgGPzgv8L/B/9h4MF/BXxK8QDqaCDH/aSaP6phVAMuDa+wqn+BW4P//5eYyv/7DvI8DwBDJ5LB6mdU8gAAAABJRU5ErkJggg==",ligature:"delete",code:function(){this.dao.remove(this.data,{remove:function(){this.stack.popView()}.bind(this),error:function(){}})},priority:0,order:0},{name:"reset",help:"Reset form (cancel update)",isAvailable:function(){return!this.liveEdit&&this.outstandingChanges},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAdklEQVQ4y+WTuQ3AIBAEaQKK8NN/BEUArmccgGyj43MMIZo5TqtFqbUPJxYtbg2OvS44IJQKhguwdUETSiXjXr77KhGICRjihWKm8Dw3KXP4Z5VZ/Lfw7B5kyD1cy5C7uAx5iJcht6vhRTUi4OrC0Szftvi/vAFNdbZ2Dp661QAAAABJRU5ErkJggg==",ligature:"close",code:function(){this.data=this.originalData.deepClone()},priority:0,order:1}],methods:[function commit_(){var self=this,obj=this.data;this.dao.put(obj,{put:function(){self.originalData=obj.deepClone(),self.exitOnSave&&!self.liveEdit&&self.stack.popView()},error:function(){console.error("Error saving",arguments)}})}],listeners:[{name:"rawUpdate",code:function(){this.data=this.rawData}}],templates:[{name:"CSS",code:ConstantTemplate(".md-update-detail-view{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;height:100%;width:100%}.md-update-detail-view-body{overflow-x:hidden;overflow-y:auto}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),">\n        ",self.toolbar,'\n        <div class="md-update-detail-view-body">\n          ',this.innerView({data$:this.data$},this.Y),"\n        </div>\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"PopupChoiceView","extends":"foam.ui.AbstractChoiceView",traits:["foam.input.touch.VerticalScrollNativeTrait"],requires:["foam.ui.ChoiceListView"],properties:[{name:"linkLabel"},{name:"iconUrl"},{name:"tagName",defaultValue:"span"},{name:"className",defaultValue:"popupChoiceView"},{model_:"BooleanProperty",name:"showValue",type:"Boolean"},{model_:"BooleanProperty",name:"opened",type:"Boolean","transient":!0},{model_:"FunctionProperty",name:"updateListener",type:"Function"},{name:"mode",defaultValue:"read-write"},{name:"scrollerID",factory:function(){return this.id+"-popup-list-scroller"}}],actions:[{name:"open",labelFn:function(){return this.linkLabel},code:function(){function mouseMove(evt){if(!view.$.contains(evt.target)){var margin=50,left=view.$.offsetLeft-margin,right=view.$.offsetWidth+left+2*margin,top=view.$.offsetTop-margin,bottom=view.$.offsetHeight+top+2*margin;left<evt.pageX&&evt.pageX<right&&top<evt.pageY&&evt.pageY<bottom||remove()}}function remove(){self.opened=!1,self.X.document.removeEventListener("touchstart",removeListener),self.X.document.removeEventListener("mousemove",mouseMove),view.$&&(view.$.outerHTML="")}if(!this.opened){var self=this,view=this.ChoiceListView.create({id:this.scrollerID,className:"popupChoiceList",data:this.data,choices:this.choices,autoSetData:this.autoSetData});self.opened=!0;var pos=findViewportXY(this.$.querySelector(".action")),e=this.X.document.body.insertAdjacentHTML("beforeend",view.toHTML()),s=this.X.window.getComputedStyle(view.$),removeListener;removeListener=function(evt){view&&view.$&&view.$.contains(evt.target)||remove()},view.data$.addListener(EventService.framed(function(){self.data=view.data,remove()},this.X)),view.$.style.top=pos[1]-2+"px";var left=Math.max(0,pos[0]-toNum(s.width)+30);view.$.style.left=left+"px",view.$.style.maxHeight=Math.max(200,this.X.window.innerHeight-pos[1]-10)+"px",view.initHTML(),this.X.document.addEventListener("touchstart",removeListener),this.X.document.addEventListener("mousemove",mouseMove)}}}],methods:[function toHTML(){return"read-only"===this.mode?'<span id="'+this.id+'" class="popupChoiceView-readonly">'+(this.choice&&this.choice[1]||"")+"</span>":this.SUPER()},function toInnerHTML(){if("read-only"===this.mode)return this.choice&&this.choice[1]||"";var out="";if(this.showValue){var id=this.nextID();out+='<span id="'+id+'" class="value">'+(this.choice&&this.choice[1]||"")+"</span>",this.updateListener&&this.data$.removeListener(this.updateListener),this.updateListener=function(){var e=this.X.$(id);e&&(e.innerHTML=this.choice[1])}.bind(this),this.data$.addListener(this.updateListener)}out+='<span class="action">';var action=this.model_.getAction("open");action.iconUrl=this.iconUrl;var button=this.createActionView(action).toView_();return this.addSelfDataChild(button),out+=button.toHTML(),out+="</span>"}],templates:[{name:"CSS",code:ConstantTemplate(".popupChoiceList{border:2px solid grey;background:white;display:table-footer-group;overflow-y:auto;position:absolute;top:20;left:50;margin:0}.popupChoiceList li{display:block;margin:15px;margin-left:-20px}"),language:"css"}]}),CLASS({"package":"foam.ui",name:"ChoiceListView","extends":"foam.ui.AbstractChoiceView",properties:[{name:"orientation",view:{factory_:"foam.ui.ChoiceView",choices:[["horizontal","Horizontal"],["vertical","Vertical"]]},defaultValue:"horizontal",postSet:function(old,nu){this.$&&(DOM.setClass(this.$,old,!1),DOM.setClass(this.$,nu))}},{name:"className",defaultValueFn:function(){return"foamChoiceListView "+this.orientation}},{name:"tagName",defaultValue:"ul"},{name:"innerTagName",defaultValue:"li"}],methods:[function init(){this.SUPER(),this.index$.addListener(this.updateSelected),this.choices$.addListener(this.updateSelected)},function choiceToHTML(id,choice){return"<"+this.innerTagName+' id="'+id+'" class="choice">'+choice[1]+"</"+this.innerTagName+">"},function toInnerHTML(){for(var out=[],i=0;i<this.choices.length;i++){var choice=this.choices[i],id=this.nextID();this.on("click",function(index){this.choice=this.choices[index]}.bind(this,i),id),out.push(this.choiceToHTML(id,choice))}return out.join("")},function initInnerHTML(){this.SUPER(),this.updateSelected()},function scrollToSelection(){var e=this.$&&this.$.children[this.index];if(e){for(var parent=e.parentElement;parent;){var overflow=this.X.window.getComputedStyle(parent).overflowY;if("scroll"===overflow||"auto"===overflow)break;parent=parent.parentElement}parent=parent||this.X.window,e.offsetTop<parent.scrollTop?parent.scrollTop=e.offsetTop:e.offsetTop+e.offsetHeight>=parent.scrollTop+parent.offsetHeight&&(parent.scrollTop=e.offsetTop+e.offsetHeight-parent.offsetHeight)}}],listeners:[{name:"updateSelected",code:function(){if(this.$&&this.$.children)for(var i=0;i<this.$.children.length;i++){var c=this.$.children[i];DOM.setClass(c,"selected",i===this.index)}}}],templates:[{name:"CSS",code:ConstantTemplate(".foamChoiceListView{list-style-type:none}.foamChoiceListView .selected{font-weight:bold}.foamChoiceListView.vertical{padding:0}.foamChoiceListView.vertical .choice{margin:4px}.foamChoiceListView.horizontal{padding:0}.foamChoiceListView.horizontal .choice{display:inline;margin:12px}"),language:"css"}]}),CLASS({"package":"foam.ui",name:"AbstractChoiceView","extends":"foam.ui.View",properties:[{model_:"BooleanProperty",name:"autoSetData",type:"Boolean",help:"If true, this.data is set when choices update and the current data is not one of the choices.",defaultValue:!0},{name:"prop",visibility:"hidden",hidden:!0},{name:"label",help:'The user-visible label for the ChoiceView. Not to be confused with $$DOC{ref:".text"}, the name of the currently selected choice.'},{name:"text",postSet:function(_,d){for(var i=0;i<this.choices.length;i++)if(this.choices[i][1]===d)return void(this.index!==i&&(this.index=i))},help:"The user-visible text of the current choice (ie. [value, text] -> text)."},{name:"choice",getter:function(){for(var value=this.data,i=0;i<this.choices.length;i++){var choice=this.choices[i];if(value===choice[0])return choice}return void 0},setter:function(choice){var oldValue=this.choice;this.data=choice[0],this.text=choice[1],this.propertyChange("choice",oldValue,this.choice)},help:"The current choice (ie. [value, text])."},{name:"choices",factory:function(){return[]},preSet:function(_,a){if("object"==typeof a&&!Array.isArray(a)){var out=[];for(var key in a)a.hasOwnProperty(key)&&out.push([key,a[key]]);return out}a=a.clone();for(var i=0;i<a.length;i++)Array.isArray(a[i])||(a[i]=[a[i],a[i]]);return a},postSet:function(oldValue,newValue){for(var value=this.data,i=0;i<newValue.length;i++){var choice=newValue[i];if(value===choice[0]){this.useSelection?this.index=i:this.choice=choice;break}}this.autoSetData&&i===newValue.length&&(this.useSelection?this.index=0:this.data=newValue.length?newValue[0][0]:void 0);var labelsChanged=!0;if((oldValue&&oldValue.length)==(newValue&&newValue.length)){labelsChanged=!1;for(var i=0;i<oldValue.length;++i)if(!equals(oldValue[i][1],newValue[i][1])){labelsChanged=!0;break}}labelsChanged&&this.updateHTML()}},{model_:"IntProperty",name:"index",type:"Int","transient":!0,preSet:function(_,i){return 0>i||0==this.choices.length?0:i>=this.choices.length?this.choices.length-1:i},postSet:function(_,i){this.useSelection||this.choices.length&&this.data!==this.choices[i][0]&&(this.data=this.choices[i][0])},help:"The index of the current choice.",defaultValue:-1},{model_:"FunctionProperty",name:"objToChoice",type:"Function",help:"A Function which adapts an object from the DAO to a [key, value, ...] choice."},{model_:"BooleanProperty",name:"useSelection",type:"Boolean",help:"When set, data and choice do not update until an entry is firmly selected"},{model_:"foam.core.types.DAOProperty",name:"dao",onDAOUpdate:"onDAOUpdate"},{name:"data",postSet:function(old,nu){for(var i=0;i<this.choices.length;i++)if(this.choices[i][0]===nu)return void(this.index!==i&&(this.text=this.choices[i][1],this.index=i));nu&&this.choices.length&&console.warn("ChoiceView data set to invalid choice: ",nu)}}],methods:[function initHTML(){this.SUPER(),this.dao=this.dao},function findChoiceIC(name){name=name.toLowerCase();for(var i=0;i<this.choices.length;i++)if(this.choices[i][1].toLowerCase()==name)return this.choices[i]},function commit(){this.useSelection&&this.choices[this.index]&&(this.choice=this.choices[this.index])}],listeners:[{name:"onDAOUpdate",code:function(){this.dao.select(MAP(this.objToChoice))(function(map){this.choices=map.arg2}.bind(this))},isFramed:!0}]}),CLASS({"package":"foam.ui",name:"View","extends":"foam.ui.DestructiveDataView",traits:["foam.ui.HTMLViewTrait","foam.ui.U2ViewTrait"],requires:["Property"],exports:["propertyViewProperty"],properties:[{name:"propertyViewProperty",type:"Property",defaultValueFn:function(){return this.Property.DETAIL_VIEW}}]}),CLASS({"package":"foam.ui",name:"HTMLViewTrait",label:"HTMLView",requires:["foam.input.touch.GestureTarget","foam.ui.ActionBorder","foam.ui.PropertyView","foam.ui.AsyncLoadingView"],properties:[{model_:"StringProperty",name:"id",label:"Element ID",type:"String",factory:function(){return this.instance_.id||this.nextID()}},{model_:"foam.core.types.DocumentInstallProperty",name:"installCSS",documentInstallFn:function(X){for(var i=0;i<this.model_.templates.length;i++){var t=this.model_.templates[i];if("CSS"===t.name)return void t.futureTemplate(function(){X.addStyle(this)}.bind(this))}}},{name:"shortcuts",factory:function(){return[]}},{name:"$",labels:["javascript"],mode:"read-only",visibility:"hidden",hidden:!0,getter:function(){return this.X.document.getElementById(this.id)},setter:function(){},help:"DOM Element."},{name:"tagName",defaultValue:"span"},{name:"className",defaultValue:"",help:"CSS class name(s), space separated."},{name:"tooltip"},{name:"tabIndex"},{name:"extraClassName",defaultValue:""},{name:"propertyViewProperty",defaultValueFn:function(){return this.X.Property.VIEW}},{name:"initializers_",factory:function(){return[]}},{name:"destructors_",factory:function(){return[]}},{model_:"BooleanProperty",name:"showActions",type:"Boolean",postSet:function(oldValue,showActions){!oldValue&&showActions&&this.addDecorator(this.ActionBorder.create())},defaultValue:!1},{name:"minWidth",defaultValue:300},{name:"minHeight",defaultValue:0},{name:"preferredWidth",defaultValue:400},{name:"preferredHeight",defaultValue:40},{name:"maxWidth",defaultValue:1e4},{name:"maxHeight",defaultValue:1e4},{name:"$parent",labels:["javascript"],getter:function(){return this.$?this.$.parentElement:null}}],constants:[{name:"KEYPRESS_CODES",value:{8:!0,33:!0,34:!0,37:!0,38:!0,39:!0,40:!0}},{name:"NAMED_CODES",value:{37:"left",38:"up",39:"right",40:"down"}},{name:"ON_HIDE",value:["onHide"]},{name:"ON_SHOW",value:["onShow"]}],methods:[function strToHTML(str){return XMLUtil.escape(str.toString())},function cssClassAttr(){if(!this.className&&!this.extraClassName)return"";var s=' class="';return this.className&&(s+=this.className,this.extraClassName&&(s+=" ")),this.extraClassName&&(s+=this.extraClassName),s+'"'},function bindSubView(view,prop){view.setValue(this.propertyValue(prop.name))},function focus(){this.$&&this.$.focus&&this.$.focus()},function addChild(child){return child.toView_&&(child=child.toView_()),-1==this.children.indexOf(child)?this.SUPER(child):void 0},function addShortcut(key,callback,context){this.shortcuts.push([key,callback,context])},function nextID(){return"view"+(arguments.callee._nextId=(arguments.callee._nextId||0)+1)},function addInitializer(f){this.initializers_.push(f)},function addDestructor(f){this.destructors_.push(f)},function tapClick(){},function resize(){var e=this.X.document.createEvent("Event");e.initEvent("resize",!0,!0),this.$&&this.X.window.getComputedStyle(this.$),this.X.window.dispatchEvent(e)},function on(event,listener,opt_id){if(opt_id=opt_id||this.nextID(),listener=listener.bind(this),"click"===event&&this.X.gestureManager){var self=this,manager=this.X.gestureManager,target=this.GestureTarget.create({containerID:opt_id,enforceContainment:!0,handler:{tapClick:function(pointMap){return listener({preventDefault:function(){},stopPropagation:function(){},pointMap:pointMap,target:self.X.$(opt_id)})}},gesture:"tap"});return manager.install(target),this.addDestructor(function(){manager.uninstall(target)}),opt_id}return this.addInitializer(function(){var e=this.X.$(opt_id);e&&e.addEventListener(event,listener,!1)}.bind(this)),opt_id},function setAttribute(attributeName,valueFn,opt_id){var self=this;opt_id=opt_id||this.nextID(),valueFn=valueFn.bind(this),this.addInitializer(function(){self.X.dynamicFn(valueFn,function(){var e=self.X.$(opt_id);if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION;var newValue=valueFn(e.getAttribute(attributeName));void 0==newValue?e.removeAttribute(attributeName):e.setAttribute(attributeName,newValue)})})},function setStyle(styleName,valueFn,opt_id){var self=this;return opt_id=opt_id||this.nextID(),valueFn=valueFn.bind(this),this.addInitializer(function(){self.X.dynamicFn(valueFn,function(value){var e=self.X.$(opt_id);if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION;e.style[styleName]=value})}),opt_id},function setClass(className,predicate,opt_id){var self=this;return opt_id=opt_id||this.nextID(),predicate=predicate.bind(this),this.addInitializer(function(){self.addDestructor(self.X.dynamicFn(predicate,function(){var e=self.X.$(opt_id);if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION;DOM.setClass(e,className,predicate())}).destroy)}),opt_id},function setClasses(map,opt_id){opt_id=opt_id||this.nextID();for(var keys=Objects.keys(map),i=0;i<keys.length;i++)this.setClass(keys[i],map[keys[i]],opt_id);return opt_id},function insertInElement(name){var e=this.X.$(name);e.innerHTML=this.toHTML(),this.initHTML()},function write(opt_X){var X=opt_X||this.X;X.writeView(this,X)},function updateHTML(){this.$&&(this.destroy(),this.construct())},function construct(){this.SUPER(),this.generateContent()},function generateContent(){this.$&&(this.$.innerHTML=this.toInnerHTML(),this.initInnerHTML())},function toInnerHTML(){return""},function toHTML(){return this.invokeDestructors(),"<"+this.tagName+' id="'+this.id+'"'+this.cssClassAttr()+">"+this.toInnerHTML()+"</"+this.tagName+">"},function initHTML(){this.initInnerHTML(),this.initKeyboardShortcuts(),this.maybeInitTooltip()},function maybeInitTooltip(){this.tooltip&&this.$&&(this.$.addEventListener("mouseenter",this.openTooltip),this.$.addEventListener("mouseleave",this.closeTooltip))},function initInnerHTML(){this.invokeInitializers(),this.initChildren()},function initChildren(){if(this.children)for(var i=0;i<this.children.length;i++)try{this.children[i].initHTML&&this.children[i].initHTML()}catch(x){console.log("Error on View.child.initHTML",x,x.stack)}},function invokeInitializers(){for(var i=0;i<this.initializers_.length;i++)this.initializers_[i]();this.initializers_=[]},function invokeDestructors(){for(var i=0;i<this.destructors_.length;i++)this.destructors_[i]();this.destructors_=[]},function evtToCharCode(evt){var s="";return evt.altKey&&(s+="alt-"),evt.ctrlKey&&(s+="ctrl-"),evt.shiftKey&&"keydown"===evt.type&&(s+="shift-"),evt.metaKey&&(s+="meta-"),s+="keydown"===evt.type?this.NAMED_CODES[evt.which]||String.fromCharCode(evt.which):String.fromCharCode(evt.charCode)},function initKeyboardShortcuts(){function init(actions,opt_value){actions.forEach(function(action){for(var j=0;j<action.keyboardShortcuts.length;j++){var key=action.keyboardShortcuts[j];self.NAMED_CODES[key]?key=self.NAMED_CODES[key]:"number"==typeof key&&(key=String.fromCharCode(key)),keyMap[key]=opt_value?function(){action.maybeCall(self.X,opt_value.get())}:action.maybeCall.bind(action,self.X,self),found=!0}})}var keyMap={},found=!1,self=this;if(init(this.model_.getRuntimeActions()),this.data&&this.data.model_&&this.data.model_.getRuntimeActions().length&&init(this.data.model_.getRuntimeActions(),this.data$),found){console.assert(this.$,"View must define outer id when using keyboard shortcuts: "+this.name_),this.keyMap_=keyMap;var target=this.$parent;target.setAttribute("tabindex",target.tabIndex+""),target.addEventListener("keydown",this.onKeyboardShortcut),target.addEventListener("keypress",this.onKeyboardShortcut)}},function destroy(isParentDestroyed){this.invokeDestructors(),this.SUPER(isParentDestroyed),delete this.instance_.$},function close(){this.$&&this.$.remove(),this.destroy(),this.publish("closed")},function rectOnPage(){for(var node=this.$,x=0,y=0,parent,rect=this.$.getBoundingClientRect();node;)parent=node,x+=node.offsetLeft,y+=node.offsetTop,node=node.offsetParent;return{top:y,left:x,right:x+rect.width,bottom:y+rect.height,width:rect.width,height:rect.height}},function rectOnViewport(){return this.$.getBoundingClientRect()},function viewportOnPage(){var bodyRect=this.X.document.documentElement.getBoundingClientRect(),vpSize=this.viewportSize();return{left:-bodyRect.left,top:-bodyRect.top,width:vpSize.width,height:vpSize.height,right:-bodyRect.left+vpSize.width,bottom:-bodyRect.top+vpSize.height}},function viewportSize(){return{height:window.innerHeight||this.X.document.documentElement.clientHeight,width:window.innerWidth||this.X.document.documentElement.clientWidth}},function createView(prop,opt_args){var X=opt_args&&opt_args.X||this.Y,v=this.PropertyView.create({id:(this.nextID?this.nextID():this.id)+"PROP",prop:prop,copyFrom:opt_args},X);return this[prop.name+"View"]=v.view,v},function removeChild(child){this.PropertyView.isInstance(child)&&child.prop&&delete this[child.prop.name+"View"],this.SUPER(child)},function createRelationshipView(r,opt_args){if(opt_args.model_)return this.createView(r,opt_args);var X=opt_args&&opt_args.X||this.Y,v=this.AsyncLoadingView.create({id:this.nextID(),name:r.name,model:"foam.ui.RelationshipView",args:{relationship:r},copyFrom:opt_args},X);return v.view&&(v=v.view),this[r.name+"View"]=v,v},function createActionView(action,opt_args){var X=opt_args&&opt_args.X||this.Y,modelName=opt_args&&opt_args.model_?opt_args.model_:"foam.ui.ActionButton",v=this.AsyncLoadingView.create({id:this.nextID(),name:action.name,model:modelName,args:{action:action},copyFrom:opt_args},X);return v.view&&(v=v.view),this[action.name+"View"]=v.cview||v,v},function createTemplateView(name,opt_args){var args=opt_args||{},X=this.Y,myData=this.data$;if(myData&&myData.value&&myData.value.model_){var o=myData.value.model_.getFeature(name);if(o){var v;return v=Action.isInstance(o)?this.createActionView(o,args):Relationship.isInstance(o)?this.createRelationshipView(o,args):this.createView(o,args),this.addDataChild(v),v}}var o=this.model_.getFeature(name);if(!o)throw"Unknown View Name: "+name;var v;return v=Action.isInstance(o)?this.createActionView(o,args):Relationship.isInstance(o)?this.createRelationshipView(o,args):this.createView(o,args),this.addSelfDataChild(v),v},function dynamicTag(tagName,f){var id=this.nextID(),self=this;return this.addInitializer(function(){self.X.dynamicFn(function(){var html=f(),e=self.X.$(id);e&&(e.innerHTML=html)})}),"<"+tagName+' id="'+id+'"></'+tagName+">"}],listeners:[{name:"openTooltip",code:function(e){}},{name:"closeTooltip",code:function(e){this.tooltip_&&(this.tooltip_.close(),this.tooltip_=null)}},{name:"onKeyboardShortcut",code:function(evt){if("keydown"!==evt.type||this.KEYPRESS_CODES[evt.which]){var action=this.keyMap_[this.evtToCharCode(evt)];action&&(action(),evt.preventDefault(),evt.stopPropagation())}}}]}),CLASS({"package":"foam.input.touch",name:"GestureTarget",properties:[{name:"id"},{name:"gesture",help:"The name of the gesture to be tracked."},{name:"containerID",help:"The containing DOM node's ID. Used for checking what inputs are within which gesture targets."},{model_:"BooleanProperty",name:"enforceContainment",type:"Boolean",help:"Require that the start and end of a matching gesture be inside the container.",defaultValue:!1},{name:"getElement",defaultValue:function(){return this.X.$(this.containerID)},help:"Function to retrieve the element this gesture is attached to. Defaults to $(containerID)."},{name:"handler",help:"The target for the gesture's events, after it has been recognized."}],help:"Created by each view that wants to receive gestures."}),CLASS({"package":"foam.ui",name:"ActionBorder",methods:[function toHTML(border,delegate,args){var str="";str+=delegate.apply(this,args),str+='<div class="actionToolbar">';for(var actions=this.model_.getRuntimeActions(),i=0;i<actions.length;i++){var v=this.createActionView(actions[i]);this.addSelfDataChild(v),str+=" "+v.toView_().toHTML()+" "}if(this.X.lookup("foam.ui.DetailView").isInstance(this)){actions=this.model.actions;for(var i=0;i<actions.length;i++){
var v=this.createActionView(actions[i]);this.addDataChild(v),str+=" "+v.toView_().toHTML()+" "}}return str+="</div>"}]}),CLASS({"package":"foam.ui",name:"PropertyView","extends":"foam.ui.AsyncLoadingView",properties:[{name:"prop",postSet:function(old,nu){old&&this.bound_&&this.unbindData(this.data),nu&&!this.bound_&&this.bindData(this.data),this.args=nu,this.model=this.innerView||nu.view}},{name:"data",postSet:function(old,nu){old&&this.bound_&&this.unbindData(old),nu&&this.bindData(nu)}},{name:"childData"},{name:"innerView",postSet:function(old,nu){this.model=nu},help:"Override for prop.view"},{name:"view",adapt:function(_,v){return v&&v.toView_?v.toView_():v}},{model_:"BooleanProperty",name:"bound_",type:"Boolean",defaultValue:!1},{name:"parent",postSet:function(_,p){p&&(p[this.prop.name+"View"]=this.view.cview||this.view,this.view&&(this.view.parent=p))}}],methods:[function unbindData(oldData){if(this.bound_&&oldData&&this.prop){var pValue=oldData.propertyValue(this.prop.name);Events.unlink(pValue,this.childData$),this.bound_=!1}},function bindData(data){var self=this;if(!this.bound_&&data&&this.prop){var pValue=data.propertyValue(this.prop.name);Events.link(pValue,this.childData$),this.prop.validate&&this.X.dynamic3(data,this.prop.validate,function(error){self.view&&(self.view.$.style.border=error?"2px solid red":"")}),this.bound_=!0}},function toString(){return"PropertyView("+this.prop.name+", "+this.view+")"},function destroy(isParentDestroyed){this.unbindData(this.data),this.SUPER(isParentDestroyed)},function construct(){this.bindData(this.data),this.SUPER()},function finishRender(view){view.prop=this.prop,this.SUPER(view)},function addDataChild(child){Events.link(this.childData$,child.data$),this.addChild(child)}]}),CLASS({"package":"foam.ui",name:"AsyncLoadingView","extends":"foam.ui.BaseView",properties:[{model_:"StringProperty",name:"id",label:"Element ID",type:"String"},{name:"name",label:"The parent view's name for this"},{name:"model",label:"View model name, model definition, or JSON with a factory_ specified."},{name:"args",label:"View construction arguments",defaultValueFn:function(){return{}}},{name:"copyFrom",label:"Additional arguments to this.copyFrom(...) when ready.",lazyFactory:function(){return{}}},{name:"view"}],methods:[function init(){this.SUPER();var skipKeysArgDecorator=Object.create(this.args);if(skipKeysArgDecorator.hasOwnProperty=this.skipKeysFn_hasOwnProperty,skipKeysArgDecorator.inner=this.args,this.copyFrom&&this.copyFrom.model&&(skipKeysArgDecorator.model=this.copyFrom.model),this.copyFrom&&this.copyFrom.model_){if("string"==typeof this.copyFrom.model_)return this.requireModelName(this.copyFrom.model_,skipKeysArgDecorator);if(Model.isInstance(this.copyFrom.model_))return this.finishRender(this.copyFrom.model_.create(skipKeysArgDecorator,this.Y))}return"string"==typeof this.model?this.requireModelName(this.model,skipKeysArgDecorator):this.model.model_&&"string"==typeof this.model.model_?this.requireViewInstance(FOAM(this.model)):this.model.model_?Model.isInstance(this.model)?this.finishRender(this.model.create(skipKeysArgDecorator,this.Y)):(this.mergeWithCopyFrom(this.model),this.finishRender(this.model.model_.create(skipKeysArgDecorator,this.Y))):this.model.factory_?(this.mergeWithCopyFrom(this.model),this.requireModelName(this.model.factory_,skipKeysArgDecorator)):"function"==typeof this.model?this.finishRender(this.model(skipKeysArgDecorator,this.Y)):void console.warn("AsyncLoadingView: View load with invalid model. ",this.model,this.args,this.copyFrom)},function mergeWithCopyFrom(other){for(var key in other)"factory_"!=key&&(this.copyFrom[key]=other[key])},function skipKeysFn_hasOwnProperty(name){return"factory_"!=name&&"model_"!=name&&"view"!=name&&this.inner.hasOwnProperty(name)},function requireViewInstance(view){view.arequire()(function(m){this.finishRender(view)}.bind(this))},function requireModelName(name,args){this.X.arequire(name)(function(m){this.finishRender(m.create(args,this.Y))}.bind(this))},function finishRender(view){if(this.copyFrom){var skipKeysCopyFromDecorator=Object.create(this.copyFrom);skipKeysCopyFromDecorator.hasOwnProperty=this.skipKeysFn_hasOwnProperty,skipKeysCopyFromDecorator.inner=this.copyFrom,view.copyFrom(skipKeysCopyFromDecorator)}this.view=view.toView_(),this.addDataChild(this.view);var el=this.X.$(this.id);el&&(el.outerHTML=this.toHTML(),this.initHTML())},function toHTML(){return this.view?this.view.toHTML():'<div id="'+this.id+'"></div>'},function initHTML(){this.view&&this.view.initHTML()},function toString(){return"AsyncLoadingView("+this.model+", "+this.view+")"},function fromElement(e){return this.view.fromElement(e),this}]}),CLASS({"package":"foam.ui",name:"BaseView","extends":"foam.patterns.ChildTreeTrait",properties:[{name:"data"}],methods:[function addDataChild(child){Events.link(this.data$,child.data$),this.addChild(child)},function addSelfDataChild(child){child.data=this,this.addChild(child)},function toView_(){return this}]}),CLASS({"package":"foam.patterns",name:"ChildTreeTrait",properties:[{name:"parent",visibility:"hidden",hidden:!0},{name:"children",factory:function(){return[]}}],methods:[function onAncestryChange_(){Array.prototype.forEach.call(this.children,function(c){c.onAncestryChange_&&c.onAncestryChange_()})},function addChild(child){if(child.parent!==this){child.parent=this,child.onAncestryChange_&&child.onAncestryChange_();var children=this.children;return children.push(child),this.children=children,this}},function removeChild(child){return child.destroy&&child.destroy(!0),this.children.deleteI(child),child.parent=void 0,this},function removeAllChildren(isParentDestroyed){var list=this.children;this.children=[],Array.prototype.forEach.call(list,function(child){this.removeChild(child)}.bind(this))},function addChildren(){for(var i=0;i<arguments.length;++i)this.addChild(arguments[i]);return this},function destroy(isParentDestroyed){return isParentDestroyed?(Array.prototype.forEach.call(this.children,function(child){child.destroy&&child.destroy(!0)}),this.children=[]):this.removeAllChildren(),this},function construct(){return this},function deepPublish(topic){var count=this.publish.apply(this,arguments);if(this.children)for(var i=0;i<this.children.length;i++){var child=this.children[i];count+=child.deepPublish.apply(child,arguments)}return count}]}),CLASS({"package":"foam.core.types",name:"DocumentInstallProperty","extends":"Property",properties:[{model_:"FunctionProperty",name:"documentInstallFn",type:"Function"},{name:"hidden",defaultValue:!0}],methods:[function initPropertyAgents(proto,fastInit){this.SUPER(proto,fastInit);var thisProp=this,DocumentInstallProperty=thisProp.model_;if(proto.addInitAgent(12,": install in document ",function(o,X,Y){var model=o.model_;model&&X.installedModels&&!X.installedModels[model.id]&&thisProp.documentInstallFn.call(proto,X)}),proto.__proto__.model_){var recurse=function(baseProto){var baseProp=baseProto.model_.getProperty(thisProp.name);baseProp&&(proto.addInitAgent(12,": inherited install in document ",function(o,X,Y){var model=baseProto.model_;model&&X.installedModels&&!X.installedModels[model.id]&&baseProp.documentInstallFn.call(baseProto,X)}),proto.addInitAgent(13,": completed inherited install in document ",function(o,X,Y){X.installedModels[baseProto.model_.id]=!0}),baseProto.__proto__.model_&&recurse(baseProto.__proto__))};recurse(proto.__proto__)}proto.addInitAgent(13,": completed install in document ",function(o,X,Y){X.installedModels[o.model_.id]=!0})}],help:"Describes a function property that runs once per document"}),CLASS({"package":"foam.ui",name:"U2ViewTrait",methods:[function toE(){return this},function load(){return this.initHTML&&this.initHTML()},function unload(){return this.destroy&&this.destroy()},function toString(){return this.toHTML?this.toHTML():""}]}),CLASS({"package":"foam.ui",name:"DestructiveDataView","extends":"foam.ui.BaseView",requires:["SimpleValue"],properties:[{name:"data",preSet:function(old,nu){return this.shouldDestroy(old,nu)&&this.destroy(),nu},postSet:function(old,nu){this.shouldDestroy(old,nu)&&this.construct()}},{name:"dataLinkedChildren",factory:function(){return[]}}],methods:[function shouldDestroy(old,nu){return!0},function destroy(isParentDestroyed){isParentDestroyed||(this.dataLinkedChildren.forEach(function(child){Events.unfollow(this.data$,child.data$)}.bind(this)),this.dataLinkedChildren=[]),this.SUPER(isParentDestroyed)},function addDataChild(child){Events.follow(this.data$,child.data$),this.dataLinkedChildren.push(child),this.addChild(child)}]}),CLASS({"package":"foam.core.types",name:"DAOProperty","extends":"Property",requires:["foam.dao.FutureDAO","foam.dao.ProxyDAO"],imports:["console"],properties:[{name:"type",defaultValue:"DAO",help:"The FOAM type of this property."},{model_:"ModelProperty",name:"model",type:"Model",help:"The model for objects stored in the DAO."},{name:"view",defaultValue:"foam.ui.DAOListView"},{name:"onDAOUpdate"},{name:"install",defaultValue:function(prop){defineLazyProperty(this,prop.name+"$Proxy",function(){if(this[prop.name])delegate=this[prop.name];else var future=afuture(),delegate=prop.FutureDAO.create({future:future.get});var proxy=prop.ProxyDAO.create({delegate:delegate});return this.addPropertyListener(prop.name,function(_,__,___,dao){return future?(future.set(dao),void(future=null)):void(proxy.delegate=dao)}),{get:function(){return proxy},configurable:!0}})}},{name:"fromElement_",defaultValue:function(e,p,model){for(var children=e.children,i=0;i<children.length;i++)this[p.name].put(model.create(null,this.Y).fromElement(children[i],p))}},{name:"fromElement",defaultValue:function(e,p){var model=e.getAttribute("model")||this[p.name]&&this[p.name].model||p.model||"";return model?void("string"==typeof model?this.X.arequire(model)(function(model){p.fromElement_.call(this,e,p,model)}.bind(this)):p.fromElement_.call(this,e,p,model)):void this.console.warn("Attempt to load DAO from element without model")}}],help:"Describes a DAO property."}),CLASS({"package":"foam.dao",name:"FutureDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"delegate",factory:function(){return null}},{name:"future",required:!0},{name:"model",defaultValueFn:function(){return this.delegate?this.delegate.model:""}}],methods:[function init(){this.SUPER(),this.future(function(delegate){var listeners=this.daoListeners_;this.daoListeners_=[],this.delegate=delegate,this.daoListeners_=listeners,this.daoListeners_.length&&this.delegate.listen(this.relay)}.bind(this))},function put(value,sink){this.delegate?this.delegate.put(value,sink):this.future(this.put.bind(this,value,sink))},function remove(query,sink){this.delegate?this.delegate.remove(query,sink):this.future(this.remove.bind(this,query,sink))},function removeAll(){if(this.delegate)return this.delegate.removeAll.apply(this.delegate,arguments);var a=arguments,f=afuture();return this.future(function(delegate){this.removeAll.apply(this,a)(f.set)}.bind(this)),f.get},function find(key,sink){this.delegate?this.delegate.find(key,sink):this.future(this.find.bind(this,key,sink))},function select(sink,options){if(this.delegate)return this.delegate.select(sink,options);var a=arguments,f=afuture();return this.future(function(){this.select.apply(this,a)(f.set)}.bind(this)),f.get}]}),CLASS({"package":"foam.dao",name:"ProxyDAO","extends":"AbstractDAO",requires:["foam.dao.NullDAO"],properties:[{name:"relay",factory:function(){var self=this;return{put:function(){self.notify_("put",arguments)},remove:function(){self.notify_("remove",arguments)},reset:function(){self.notify_("reset",arguments)},toString:function(){return"RELAY("+this.$UID+", "+self.model_.name+", "+self.delegate+")"}}}},{name:"delegate",mode:"read-only",required:!0,visibility:"hidden",hidden:!0,"transient":!0,factory:function(){return this.NullDAO.create()},postSet:function(oldDAO,newDAO){this.daoListeners_.length&&(oldDAO&&oldDAO.unlisten(this.relay),newDAO.listen(this.relay),this.notify_("reset",[]))}},{model_:"ModelProperty",name:"model",type:"Model",required:!1,defaultValueFn:function(){return this.delegate.model}}],methods:[function put(value,sink){this.delegate.put(value,sink)},function remove(query,sink){this.delegate.remove(query,sink)},function removeAll(){return this.delegate.removeAll.apply(this.delegate,arguments)},function find(key,sink){this.delegate.find(key,sink)},function select(sink,options){return this.delegate.select(sink,options)},function listen(sink,options){!this.daoListeners_.length&&this.delegate&&this.delegate.listen(this.relay),this.SUPER(sink,options)},function unlisten(sink){this.SUPER(sink),0===this.daoListeners_.length&&this.delegate&&this.delegate.unlisten(this.relay)},function toString(){return this.name_+"("+this.delegate+")"}]}),CLASS({"package":"foam.dao",name:"NullDAO",methods:[function put(obj,sink){sink&&sink.put&&sink.put(obj)},function remove(obj,sink){sink&&sink.remove&&sink.remove(obj)},function select(sink){return sink&&sink.eof&&sink.eof(),aconstant(sink||[].sink)},function find(q,sink){sink&&sink.error&&sink.error("find",q)},function listen(){},function removeAll(){},function unlisten(){},function pipe(){},function where(){return this},function limit(){return this},function skip(){return this},function orderBy(){return this}],help:"A DAO that stores nothing and does nothing."}),CLASS({"package":"foam.input.touch",name:"VerticalScrollNativeTrait",requires:["foam.input.touch.GestureTarget"],properties:[{name:"scroller$",getter:function(){return this.X.$(this.scrollerID)}},{name:"scrollGesture",visibility:"hidden",hidden:!0,"transient":!0,lazyFactory:function(){return this.scrollerID?this.GestureTarget.create({containerID:this.scrollerID,handler:this,gesture:"verticalScrollNative"}):(console.warn("VerticalScrollNativeTrait attached to View without a scrollerID property set."),"")}}],methods:[function initHTML(){this.SUPER(),this.X.gestureManager&&this.X.gestureManager.install(this.scrollGesture),this.onScroll&&this.scroller$.addEventListener("scroll",this.onScroll)},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),this.X.gestureManager&&this.X.gestureManager.uninstall(this.scrollGesture),this.onScroll&&this.scroller$&&this.scroller$.removeEventListener("scroll",this.onScroll)}]}),CLASS({"package":"foam.ui.md",name:"Toolbar","extends":"foam.ui.SimpleView",requires:["foam.ui.ActionButton","foam.ui.md.ActionList","foam.ui.md.FlatButton","foam.ui.md.OverflowActionList","foam.ui.md.ToolbarAction"],properties:[{name:"data"},{name:"title"},{name:"extraClassName",defaultValue:"browser-header-color"},{name:"leftActionList",lazyFactory:function(){var Y=this.Y.sub();return Y.registerModel(this.ActionButton.xbind({displayMode:"ICON_ONLY"}),"foam.ui.ActionButton"),this.ActionList.create({data$:this.leftActions$,direction:"HORIZONTAL"},Y)}},{name:"rightActionList",lazyFactory:function(){return this.OverflowActionList.create({data$:this.rightActions$},this.Y)}},{model_:"ArrayProperty",name:"leftActions",type:"Array",subType:"foam.ui.md.ToolbarAction",postSet:function(old,nu){var actionsElem=this.$leftActions;if(old!==nu&&actionsElem){var out=TemplateOutput.create(this);this.leftActionsInnerHTML(out),actionsElem.innerHTML=out.toString(),this.leftActionList.initHTML()}}},{model_:"ArrayProperty",name:"rightActions",type:"Array",subType:"foam.ui.md.ToolbarAction"},{name:"$leftActions",getter:function(){return this.$&&this.$.querySelector("#"+this.id+"-left-actions")}}],actions:[{name:"moreActions",iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAGklEQVQ4y2NgGAVEg/9EAMo0jHp61NOjAAgAUWrXKeQhPE4AAAAASUVORK5CYII=",ligature:"more_vert",code:function(){this.moreActionsDropdown.open()}}],methods:[function addLeftAction(action){action&&this.addLeftActions([action])},function addRightAction(action){action&&this.addRightActions([action])},function removeLeftAction(action){action&&this.removeLeftActions([action])},function removeRightAction(action){action&&this.removeRightActions([action])},function addLeftActions(actions){return this.addActions("left",actions)},function addRightActions(actions){return this.addActions("right",actions)},function removeLeftActions(actions){return this.removeActions("left",actions)},function removeRightActions(actions){return this.removeActions("right",actions)},function addActions(side,actions){actions&&0!==actions.length&&(this[side+"Actions"]=this[side+"Actions"].concat(actions.filter(function(currentActions,newAction){return!currentActions.some(function(currentAction){return currentAction===newAction})}.bind(this,this[side+"Actions"]))))},function removeActions(side,actions){actions&&0!==actions.length&&(this[side+"Actions"]=this[side+"Actions"].filter(function(currentAction){return!actions.some(function(removeAction){return removeAction===currentAction})}))},function init(){this.SUPER(),this.model_.getAction("moreActions").isAvailable=this.areMoreActionsAvailable}],listeners:[{name:"areMoreActionsAvailable",code:function(){var data=this.data,toolbarActions=this.rightActions.slice();return toolbarActions.length>0&&toolbarActions.map(function(toolbarAction){return toolbarAction&&toolbarAction.action&&toolbarAction.action.isAvailable.call(data,toolbarAction.action)}).some(function(v){return v})}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <toolbar id="',self.id,'" ',self.cssClassAttr(),'>\n\n        <actions id="',self.id,'-left-actions" class="left">\n          '),this.leftActionsInnerHTML(out),out('\n        </actions>\n\n        <header id="',self.id,'-header" class="md-title">\n          <div class="toolbar-title-text">',self.dynamicTag("span",function(){return this.title}.bind(this)),"</div>\n        </header>\n\n        ",self.rightActionList,"\n        "),this.setClass("hidden",function(){return this.showActions}.bind(this),this.rightActionList.id),out("\n\n      </toolbar>\n    "),out.toString()},language:"html"},{name:"leftActionsInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      ",self.leftActionList,"\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate("toolbar{-webkit-align-items:center;align-items:center;background-color:#3e50b4;color:#fff;display:-webkit-flex;display:flex;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-grow:0;flex-grow:0;font-size:20px;font-weight:500;height:56px;padding:0;width:100%}.md-card toolbar, .md-card-shell toolbar{background-color:transparent;color:currentColor}.md-card toolbar action-list, .md-card-shell toolbar action-list{margin:0}toolbar header{margin-left:8px;-webkit-flex-grow:1;flex-grow:1;display:-webkit-flex;display:flex;overflow-x:hidden}.md-card toolbar header, .md-card-shell toolbar header{margin-left:0}toolbar header.md-title{color:#fff}.md-card toolbar header.md-title, .md-card-shell toolbar header.md-title{color:currentColor}toolbar actions{display:-webkit-flex;display:flex;position:relative}toolbar actions.left{-webkit-align-items:flex-start;align-items:flex-start}toolbar actions.right{-webkit-align-items:flex-end;align-items:flex-end}toolbar header .toolbar-title-text{-webkit-flex-shrink:0;flex-shrink:0}"),language:"css"}]}),CLASS({"package":"foam.ui",name:"ActionButton","extends":"foam.ui.BaseView",traits:["foam.ui.HTMLViewTrait"],properties:[{name:"action",postSet:function(old,nu){old&&old.removeListener(this.render),nu.addListener(this.render)}},{name:"data"},{name:"className",factory:function(){return"actionButton actionButton-"+this.action.name}},{name:"tagName",defaultValue:"button"},{name:"showLabel",defaultValueFn:function(){return this.action.showLabel}},{name:"label",defaultValueFn:function(){return this.data?this.action.labelFn.call(this.data,this.action):this.action.label},postSet:function(){this.updateHTML()}},{name:"iconUrl",defaultValueFn:function(){return this.data?this.action.iconUrlFn.call(this.data,this.action):this.action.iconUrl}},{name:"tooltip",defaultValueFn:function(){return this.action.help}}],methods:[function toHTML(){var superResult=this.SUPER(),self=this;return this.on("click",function(){self.action.maybeCall(self.X,self.data)},this.id),this.setAttribute("disabled",function(){return self.closeTooltip(),self.action.isEnabled.call(self.data,self.action)?void 0:"disabled"},this.id),this.setClass("available",function(){return self.closeTooltip(),self.action.isAvailable.call(self.data,self.action)},this.id),this.X.dynamicFn(function(){self.action.labelFn.call(self.data,self.action),self.updateHTML()}),this.X.dynamicFn(function(){self.action.iconUrlFn.call(self.data,self.action),self.updateHTML()}),superResult},function toInnerHTML(){var out="";return this.iconUrl&&(out+='<img src="'+XMLUtil.escapeAttr(this.iconUrl)+'">'),this.showLabel&&(out+=this.label),out},function initKeyboardShortcuts(){}],listeners:[{name:"render",code:function(){this.updateHTML()},isFramed:!0}]}),CLASS({"package":"foam.ui.md",name:"ActionList","extends":"foam.ui.SimpleView",requires:["foam.ui.md.FlatButton"],imports:["dropdown"],properties:[{model_:"StringProperty",name:"className",type:"String",defaultValue:"md-actions"},{model_:"ArrayProperty",name:"data",type:"Array",preSet:function(old,nu){if(!nu)return[];var list=nu.sort(this.actionComparator);return this.maxNumActions>0?list.slice(0,this.maxNumActions):list},subType:"foam.ui.md.ToolbarAction",postSet:function(old,nu){this.bindActionListeners(old,nu),this.onDataChange(old,nu)}},{model_:"foam.core.types.StringEnumProperty",name:"direction",defaultValue:"HORIZONTAL",postSet:function(old,nu){old!==nu&&this.$&&(this.$.style["flex-direction"]="VERTICAL"===nu?"column":"row")},choices:[["HORIZONTAL","Horizontal"],["VERTICAL","Vertical"]]},{model_:"IntProperty",name:"maxNumActions",type:"Int",defaultValue:0},{model_:"ViewFactoryProperty",name:"actionViewFactory",type:"ViewFactory",defaultValue:"foam.ui.ActionButton"}],methods:[function bindActionListeners(old,nu){if(old!==nu){var i;if(old&&old.length)for(i=0;i<old.length;++i)old[i].data$.removeListener(this.onActionDataChange);if(nu&&nu.length)for(i=0;i<nu.length;++i)nu[i].data$.addListener(this.onActionDataChange),this.onActionDataChange(nu[i],["property","data"],null,nu[i].data)}},function actionComparator(a,b){var aPriority=a&&a.action?a.action.priority:10,bPriority=b&&b.action?b.action.priority:10,priorityCmp=aPriority-bPriority;if(0!==priorityCmp)return priorityCmp;var aOrder=a&&a.action?a.action.order:100,bOrder=b&&b.action?b.action.order:100,orderCmp=aOrder-bOrder;return orderCmp}],listeners:[{name:"onDataChange",code:function(old,nu){if(this.$){if(0!==this.children.length)for(var children=this.children.slice(),i=0;i<children.length;++i)this.removeChild(children[i]);var out=TemplateOutput.create(this);this.toInnerHTML(out),this.$.innerHTML=out.toString(),this.initInnerHTML()}},isFramed:!0},{name:"onActionDataChange",code:function(toolbarAction,topic,old,nu){old&&old.unsubscribe&&old.unsubscribe(["action",toolbarAction.action.name],this.onAction),nu&&nu.subscribe&&nu.subscribe(["action",toolbarAction.action.name],this.onAction)}},{name:"onAction",code:function(){this.dropdown&&this.dropdown.close()}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <action-list id="',self.id,'" ',self.cssClassAttr(),">\n        "),this.toInnerHTML(out),out("\n      </action-list>\n      "),this.setClass("vertical",function(){return"VERTICAL"===this.direction}.bind(this),this.id),this.setClass("horizontal",function(){return"HORIZONTAL"===this.direction}.bind(this),this.id),out("\n    "),out.toString()},language:"html"},{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n      ");for(var actions=this.data,i=0;i<actions.length;++i){var actionView=this.actionViewFactory({data$:actions[i].data$,action$:actions[i].action$},this.Y);out(actionView),this.addChild(actionView)}return out("\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate("action-list{display:-webkit-flex;display:flex}action-list.vertical{-webkit-flex-direction:column;flex-direction:column;margin-top:8px}action-list.horizontal{-webkit-flex-direction:row;flex-direction:row;margin-left:8px}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"FlatButton","extends":"foam.flow.Element",requires:["foam.ui.Color","foam.ui.Icon","foam.ui.md.HaloView"],properties:[{name:"className",defaultValue:"md-button flatbutton noselect",postSet:function(old,nu){old!==nu&&this.$&&(this.$.className=this.className.split(" ").concat(this.extraClassName.split(" ")).join(" "))}},{name:"extraClassName",postSet:function(old,nu){old!==nu&&this.$&&(this.$.className=this.className.split(" ").concat(this.extraClassName.split(" ")).join(" "))}},{model_:"BooleanProperty",name:"raised",type:"Boolean",defaultValue:!1},{model_:"foam.ui.ColorProperty",name:"color",defaultValueFn:function(){return"ICON_ONLY"==this.displayMode_?"currentColor":"#02A8F3"},help:"The text and background color to use for the active state"},{model_:"StringProperty",name:"font",type:"String",postSet:function(old,nu){old!==nu&&this.$&&(this.$.style.font=nu)}},{model_:"FloatProperty",name:"alpha",type:"Float",postSet:function(old,nu){old!==nu&&this.$&&(this.$.style.opacity=null===nu?"":nu)},defaultValue:null},{model_:"StringProperty",name:"background",type:"String",postSet:function(old,nu){old!==nu&&this.$&&(this.$.style.background=nu)}},{model_:"foam.ui.ColorProperty",name:"haloColor",postSet:function(old,nu){old||Events.unfollow(this.currentColor_$,this.haloColor_$),nu?this.haloColor_=nu:Events.follow(this.currentColor_$,this.haloColor_$)}},{name:"action",postSet:function(_,nu){this.bindData()}},{name:"data",postSet:function(){this.bindData()}},{name:"escapeHtml",defaultValue:!0},{model_:"foam.core.types.StringEnumProperty",name:"displayMode",defaultValue:"ICON_AND_LABEL",choices:[["ICON_AND_LABEL","Icon and Label"],["ICON_ONLY","Icon Only"],["LABEL_ONLY","Label Only"]]},{model_:"foam.core.types.StringEnumProperty",name:"displayMode_",getter:function(){return this.iconUrl||this.ligature?this.displayMode:"LABEL_ONLY"}},{model_:"StringProperty",name:"iconUrl",type:"String"},{model_:"StringProperty",name:"ligature",type:"String"},{name:"icon",lazyFactory:function(){return this.Icon.create({url$:this.iconUrl$,ligature$:this.ligature$,color$:this.currentColor_$},this.Y)}},{name:"halo",lazyFactory:function(){return this.HaloView.create({className:"halo",recentering:!1,pressedAlpha:.2,startAlpha:.2,finishAlpha:0},this.Y)}},{name:"tooltip",defaultValueFn:function(){return this.action&&this.action.help}},{model_:"foam.ui.ColorProperty",name:"currentColor_",visibility:"hidden",hidden:!0,defaultValueFn:function(){return this.color},preSet:function(old,nu){return old!==nu&&nu&&this.Color.isInstance(nu)?(this.alpha=nu.alpha,nu.alpha=1,nu):nu}},{model_:"foam.ui.ColorProperty",name:"haloColor_",visibility:"hidden",hidden:!0},{model_:"BooleanProperty",name:"isHidden",type:"Boolean",defaultValue:!1}],methods:[function init(){this.SUPER(),this.haloColor||Events.follow(this.currentColor_$,this.haloColor_$),Events.map(this.haloColor_$,this.halo.color$,function(color){if("currentColor"==color&&this.$){var s=this.X.window.getComputedStyle(this.$);if(s&&s.color)return s.color}return color.toString()}.bind(this))},function initHTML(){this.SUPER(),this.currentColor_$.addListener(function(){this.$&&(this.$.style.color=this.currentColor_.toString())}.bind(this)),this.$.style.color=this.currentColor_.toString(),this.$.style.font=this.font,this.$.style.opacity=this.alpha,this.$.style.background=this.background;var temp=this.haloColor_;this.haloColor_="black",this.haloColor_=temp},function bindData(){if(this.action&&this.data){this.iconUrl||(this.iconUrl=this.action.iconUrl),this.ligature||(this.ligature=this.action.ligature);var self=this;this.action.labelFn&&this.X.dynamicFn(function(){self.action.label=self.action.labelFn.call(self.data,self.action)},function(){self.$&&(self.X.document.getElementById(self.id+"CONTENT").innerHTML=self.labelHTML())}),this.X.dynamicFn(function(){self.action.isEnabled.call(self.data,self.action)},function(){self.action.isEnabled.call(self.data,self.action)?self.currentColor_=self.color:self.currentColor_="rgba(0,0,0,0.65)"}),this.X.dynamicFn(function(){self.action.isAvailable.call(self.data,self.action)},function(){self.isHidden=!self.action.isAvailable.call(self.data,self.action)})}}],templates:[{name:"CSS",code:ConstantTemplate("flat-button{display:inline-flex;-webkit-align-items:baseline;align-items:baseline;-webkit-justify-content:center;justify-content:center;overflow:hidden;position:relative;border-radius:2px;cursor:pointer}flat-button.md-style-trait-inline{padding:8px 8px;margin:-4px -4px}flat-button .halo{border-radius:inherit}flat-button spacer{display:block;width:12px}flat-button.icon-only spacer, flat-button.label-only spacer{width:0px}flat-button.icon-only{border-radius:50%;transition:transform 250ms ease, width 249ms ease, margin 249ms ease, padding 249ms ease;transition-delay:249ms, 0ms, 0ms, 0ms;-webkit-transform:unset;transform:unset;width:40px;-webkit-flex-shrink:0;flex-shrink:0}flat-button.floatingActionButton{padding:10px}flat-button.md-button .md-button-label{color:inherit}flat-button.hidden, flat-button.label-only .flat-button-icon-container, flat-button.icon-only .md-button-label{display:none}flat-button.icon-only.hidden{display:inherit!important;-webkit-transform:rotateZ(180deg) scaleY(0);transform:rotateZ(180deg) scaleY(0);transition-delay:0ms, 250ms, 250ms, 250ms;width:0;margin:0;padding:0}flat-button:not(.label-only) .md-button-label{text-transform:none}flat-button .halo{position:absolute;left:0;top:0;z-index:2}flat-button:not(.icon-only) .flat-button-icon-container{width:24px;height:0px;position:relative}flat-button:not(.icon-only) .flat-button-icon{position:absolute;left:0px;bottom:-7px}flat-button.icon-only.floatingActionButton{width:44px;height:44px}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      <",self.tagName,' id="',self.id,'" ',this.cssClassAttr()," >\n        ",self.halo,'\n        <div class="flat-button-icon-container">\n          <div class="flat-button-icon">\n            ',self.icon,'\n          </div>\n        </div>\n        <spacer>\n        </spacer>\n        <span id="',this.id+"CONTENT",'" class="md-button-label">'),this.labelHTML(out),out("</span>\n      </",self.tagName,">\n      "),this.on("click",function(e){e.preventDefault(),e.stopPropagation(),self.action.maybeCall(self.X,self.data)},this.id),this.setClass("icon-only",function(){return this.iconUrl,this.ligature,this.displayMode,"ICON_ONLY"===this.displayMode_},this.id),this.setClass("label-only",function(){return this.iconUrl,this.ligature,this.displayMode,"LABEL_ONLY"===this.displayMode_},this.id),this.setClass("hidden",function(){return self.isHidden},this.id),this.setClass("raised",function(){return self.raised},this.id),out("\n    "),out.toString()},language:"html"},{name:"labelHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      "),this.action?(out("\n        "),this.escapeHtml?out("\n          ",escapeHTML(this.action.label),"\n        "):out("\n          ",this.action.label,"\n        "),out("\n      ")):this.inner?out("\n         ",this.inner(),"\n      "):out("label"),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"Color",properties:[{model_:"IntProperty",name:"red",type:"Int",preSet:function(_,v){return Math.max(0,Math.min(255,v))}},{model_:"IntProperty",name:"green",type:"Int",preSet:function(_,v){return Math.max(0,Math.min(255,v))}},{model_:"IntProperty",name:"blue",type:"Int",preSet:function(_,v){return Math.max(0,Math.min(255,v))}
},{model_:"FloatProperty",name:"alpha",type:"Float",preSet:function(_,v){return Math.max(0,Math.min(1,v))}}],methods:[function toString(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")"}]}),CLASS({"package":"foam.ui",name:"Icon","extends":"foam.ui.SimpleView",requires:["foam.fonts.LigatureTester","foam.ui.ImageView","foam.ui.LigatureView"],imports:["document"],properties:[{model_:"StringProperty",name:"url",type:"String"},{model_:"StringProperty",name:"ligature",type:"String",postSet:function(old,nu){old!==nu&&nu&&this.document.createElement&&(this.ligatureTester=this.LigatureTester.create({ligature$:this.ligature$,expectedWidth$:this.width$,expectedHeight$:this.height$,ligatureViewFactory:function(){return this.LigatureView.create({data$:this.ligature$,color$:this.color$,fontSize$:this.fontSize$,className$:this.ligatureClassName$},this.Y)}.bind(this)},this.Y))}},{model_:"IntProperty",name:"width",type:"Int",defaultValue:24},{model_:"IntProperty",name:"height",type:"Int",defaultValue:24},{model_:"foam.ui.ColorProperty",name:"color",lazyFactory:function(){return"currentColor"},postSet:function(old,nu){old&&old.alpha$&&Events.unfollow(old.alpha$,this.alpha$),nu&&nu.alpha$&&Events.follow(nu.alpha$,this.alpha$)}},{model_:"FloatProperty",name:"alpha",type:"Float",defaultValue:1},{model_:"IntProperty",name:"fontSize",type:"Int",defaultValue:24},{model_:"StringProperty",name:"imageClassName",type:"String",defaultValue:"icon"},{model_:"StringProperty",name:"imageClassName",type:"String",defaultValue:"material-icons-extended"},{name:"imageView",lazyFactory:function(){return this.ImageView.create({data$:this.url$,className$:this.imageClassName$,alpha$:this.alpha$,displayWidth$:this.width$,displayHeight$:this.height$},this.Y)}},{name:"ligatureView",defaultValue:null,postSet:function(old,nu){if(old!==nu&&this.$){for(var i=0;i<this.children.length;++i)this.children[i].destroy();this.children=[];var out=TemplateOutput.create(nu);nu.toHTML(out),this.$.innerHTML=out.toString(),nu.initHTML(),this.addChild(nu)}}},{name:"ligatureTester",defaultValue:null}],methods:[function init(){this.SUPER(),this.ligatureTester&&this.ligatureTester.ligatureViewFuture(function(ligatureView){this.ligatureView=ligatureView}.bind(this))}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <icon id="',self.id,'" ',self.cssClassAttr(),">\n        "),this.ligatureView?out("\n             ",self.ligatureView,"\n        "):out("\n             ",self.imageView,"\n        "),out("\n      </icon>\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate("icon{display:block}"),language:"css"}]}),CLASS({"package":"foam.fonts",name:"LigatureTester",requires:["foam.ui.LigatureView"],imports:["window","document"],properties:[{name:"ligature",defaultValue:"accessibility",postSet:function(old,nu){old!==nu&&this.ligatureView&&(this.ligatureView.data=nu)}},{model_:"IntProperty",name:"expectedWidth",type:"Int",required:!0,defaultValue:24},{model_:"IntProperty",name:"expectedHeight",type:"Int",required:!0,defaultValue:24},{model_:"IntProperty",name:"timeout",type:"Int",units:"ms",defaultValue:1e3},{name:"$parent",lazyFactory:function(){return this.document.createElement("div")},postSet:function(old,nu){old!==nu&&(old&&(this.document.body.removeChild(old),old.removeEventListener("scroll",this.onParentScroll)),nu&&(this.initParentStyle(),this.document.body.appendChild(nu),nu.addEventListener("scroll",this.onParentScroll)))}},{name:"parentStyle",factory:function(){return{position:"fixed",bottom:"0",right:"0",visibility:"hidden",width:"1px",height:"1px",overflow:"hidden","z-index":"-1000"}},postSet:function(old,nu){old!==nu&&this.$parent&&this.initParentStyle()}},{model_:"ViewFactoryProperty",name:"ligatureViewFactory",type:"ViewFactory",defaultValue:"foam.ui.LigatureView"},{name:"ligatureView",factory:function(){return this.ligatureViewFactory({data$:this.ligature$})},postSet:function(old,nu){if(old!==nu&&nu){var out=TemplateOutput.create(nu);nu.toHTML(out),this.$parent.innerHTML=out.toString(),nu.initHTML(),this.$parent.scrollTop=this.$parent.scrollHeight-this.$parent.clientHeight}}},{name:"ligatureViewFuture",lazyFactory:function(){return this.ligatureViewFuture_.get}},{name:"ligatureViewFuture_",lazyFactory:function(){return afuture()}},{model_:"IntProperty",name:"timeoutID",type:"Int"}],methods:[function init(){this.SUPER(),this.timeoutID=this.window.setTimeout(function(){this.ligatureViewFuture_.set(null),this.ligatureView=this.$parent=null}.bind(this),this.timeout)},function initParentStyle(){var parent=this.$parent;Object_forEach(this.parentStyle,function(value,key){parent.style[key]=value})}],listeners:[{name:"onParentScroll",code:function(){this.ligatureView&&this.ligatureView.$&&this.ligatureView.width===this.expectedWidth&&this.ligatureView.height===this.expectedHeight&&(this.window.clearTimeout(this.timeoutID),this.ligatureViewFuture_.set(this.ligatureView),this.ligatureView=this.$parent=null)}}]}),CLASS({"package":"foam.ui",name:"LigatureView","extends":"foam.ui.SimpleView",properties:[{model_:"StringProperty",name:"data",type:"String",defaultValue:"accessibility",postSet:function(old,nu){old!==nu&&this.$&&(this.$.textContent=nu)}},{model_:"StringProperty",name:"tagName",type:"String",defaultValue:"i",postSet:function(old,nu){if(old!==nu&&this.$){var out=TemplateOutput.create(this);this.toHTML(out),this.$.outerHTML=out.toString()}}},{model_:"StringProperty",name:"className",type:"String",defaultValue:"material-icons-extended",postSet:function(old,nu){old!==nu&&this.$&&(this.$.className=this.className+(this.extraClassName?" "+this.extraClassName:""))}},{model_:"StringProperty",name:"extraClassName",type:"String",postSet:function(old,nu){old!==nu&&this.$&&(this.$.className=this.className+(this.extraClassName?" "+this.extraClassName:""))}},{model_:"IntProperty",name:"width",type:"Int",getter:function(){return this.$?this.$.scrollWidth:0}},{model_:"IntProperty",name:"height",type:"Int",getter:function(){return this.$?this.$.scrollHeight:0}},{model_:"IntProperty",name:"fontSize",type:"Int",postSet:function(old,nu){old!==nu&&this.$&&(this.$.style["font-size"]=nu+"px")},defaultValue:24},{name:"color",defaultValue:"currentColor",postSet:function(old,nu){old!==nu&&this.$&&(this.$.style.color=nu)}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      <",escapeHTML(this.tagName),' id="',self.id,'" ',self.cssClassAttr(),'\n                        style="font-size: ',escapeHTML(this.fontSize),"px; color: ",self.color,'">',self.data,"</",self.tagName,">\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"SimpleView","extends":"foam.ui.BaseView",traits:["foam.ui.HTMLViewTrait","foam.ui.U2ViewTrait"],requires:["Property"],exports:["propertyViewProperty"],properties:[{name:"propertyViewProperty",defaultValueFn:function(){return this.Property.DETAIL_VIEW}}]}),CLASS({"package":"foam.ui",name:"ImageView","extends":"foam.ui.View",properties:[{name:"className",defaultValue:"imageView"},{name:"backupImage"},{name:"domValue",postSet:function(oldValue,newValue){oldValue&&Events.unfollow(this.data$,oldValue),newValue&&Events.follow(this.data$,newValue)}},{name:"displayWidth",postSet:function(_,newValue){this.$&&(this.$.style.width=newValue)}},{name:"displayHeight",postSet:function(_,newValue){this.$&&(this.$.style.height=newValue)}},{name:"alpha",defaultValue:1,postSet:function(_,newValue){this.$&&(this.$.style.opacity=newValue)}}],methods:[function toHTML(){var src=window.IS_CHROME_APP&&!this.isSupportedUrl(this.data)?this.backupImage?' src="'+this.backupImage+'"':"":' src="'+this.data+'"';return"<img "+this.cssClassAttr()+' id="'+this.id+'"'+src+'style="opacity:'+this.alpha+'">'},function isSupportedUrl(url){return url=url.trim().toLowerCase(),url.startsWith("data:")||url.startsWith("blob:")||url.startsWith("filesystem:")},function initHTML(){if(this.SUPER(),this.backupImage&&this.$.addEventListener("error",function(){this.data=this.backupImage}.bind(this)),window.IS_CHROME_APP&&!this.isSupportedUrl(this.data)){var self=this,xhr=new XMLHttpRequest;xhr.open("GET",this.data),xhr.responseType="blob",xhr.asend(function(blob){blob&&(self.$.src=URL.createObjectURL(blob))})}else this.domValue=DomValue.create(this.$,void 0,"src"),this.displayHeight=this.displayHeight,this.displayWidth=this.displayWidth}]}),CLASS({"package":"foam.ui",name:"ColorProperty","extends":"ColorProperty",requires:["foam.ui.Color"],properties:[{name:"adapt",defaultValue:function(old,nu,self){if(old===nu||self.Color.isInstance(nu))return nu;if("currentColor"==nu)return nu;var c=self.Color.create(),rgb=self.COLORS[nu];if(rgb)return c.red=rgb[0],c.green=rgb[1],c.blue=rgb[2],c.alpha=1,c;if(rgb=nu.match(/^\s*#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])\s*$/))return c.red=parseInt(rgb[1]+rgb[1],16),c.green=parseInt(rgb[2]+rgb[2],16),c.blue=parseInt(rgb[3]+rgb[3],16),c.alpha=1,c;if(rgb=nu.match(/^\s*#([0-9a-fA-F][0-9a-fA-F])([0-9a-fA-F][0-9a-fA-F])([0-9a-fA-F][0-9a-fA-F])\s*$/))return c.red=parseInt(rgb[1],16),c.green=parseInt(rgb[2],16),c.blue=parseInt(rgb[3],16),c.alpha=1,c;if(rgb=nu.match(/^\s*rgb[(]\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*[)]\s*$/))return c.red=parseInt(rgb[1]),c.green=parseInt(rgb[2]),c.blue=parseInt(rgb[3]),c.alpha=1,c;var rgba=nu.match(/^\s*rgba[(]\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]*[.]?[0-9]*)\s*[)]\s*$/);return rgba?(c.red=parseInt(rgba[1]),c.green=parseInt(rgba[2]),c.blue=parseInt(rgba[3]),c.alpha=parseFloat(rgba[4]),c):(c.red=c.green=c.blue=0,c.alpha=1,c)}}],constants:[{name:"COLORS",value:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}}]}),CLASS({"package":"foam.ui.md",name:"HaloView","extends":"foam.graphics.CView",requires:["foam.ui.md.Halo","foam.ui.md.HaloCViewView as CViewView"],properties:[{name:"background",defaultValue:"rgba(0,0,0,0)"},{model_:"ViewFactoryProperty",name:"halo",type:"ViewFactory",defaultValue:{factory_:"foam.ui.md.Halo"}},{name:"haloView",factory:function(){return this.halo({easeInTime$:this.easeInTime$,easeOutTime$:this.easeOutTime$,startAlpha$:this.startAlpha$,pressedAlpha$:this.pressedAlpha$,finishAlpha$:this.finishAlpha$,color$:this.color$,recentering$:this.recentering$},this.Y)}},{name:"style",defaultValue:"solid",postSet:function(_,style){style!==this.RING_INNER_COLOR&&this.setColorAndBorder()}},{name:"easeInTime",defaultValue:200},{name:"easeOutTime",defaultValue:150},{name:"startAlpha",defaultValue:.8},{name:"pressedAlpha",defaultValue:.4},{name:"finishAlpha",defaultValue:0},{name:"color"},{name:"recentering",defaultValue:!0}],methods:[function init(){this.SUPER(),this.addChild(this.haloView)}]}),CLASS({"package":"foam.ui.md",name:"Halo","extends":"foam.graphics.Circle",properties:[{name:"style",defaultValue:"solid",postSet:function(_,style){style!==this.RING_INNER_COLOR&&this.setColorAndBorder()}},{name:"state_",defaultValue:"default"},{name:"nextColor_",defaultValueFn:function(){return this.color}},{name:"color",preSet:function(old,nu){return"default"!==this.state_?(this.nextColor_=nu,old):nu}},{name:"easeInTime",defaultValue:200},{name:"easeOutTime",defaultValue:150},{name:"startAlpha",defaultValue:.8},{name:"pressedAlpha",defaultValue:.4},{name:"finishAlpha",defaultValue:0},{name:"alpha",defaultValue:0},{name:"recentering",defaultValue:!0},{model_:"FunctionProperty",name:"isEnabled",type:"Function",defaultValue:function(){return!0}}],constants:[{name:"RING_INNER_COLOR",value:"rgba(0, 0, 0, 0)"}],methods:[function setColorAndBorder(){if("ring"===this.style){var color=this.color;this.border=color,this.borderWidth=12,this.color=this.RING_INNER_COLOR}},function initCView(){this.$.addEventListener("mousedown",this.onMouseDown),this.$.addEventListener("mouseup",this.onMouseUp),this.$.addEventListener("mouseleave",this.onMouseUp),this.$.addEventListener("touchstart",this.onMouseDown),this.$.addEventListener("touchend",this.onMouseUp),this.$.addEventListener("touchleave",this.onMouseUp),this.$.addEventListener("touchcancel",this.onMouseUp)},function isTouchInRect(t,rect){return t.clientX>=rect.left&&t.clientX<=rect.right&&t.clientY>=rect.top&&t.clientY<=rect.bottom}],listeners:[{name:"onMouseDown",code:function(evt){if("default"===this.state_&&this.isEnabled()){if(this.state_="pressing","touchstart"===evt.type){for(var rect=this.$.getBoundingClientRect(),touchFound=!1,t,i=0;i<evt.touches.length;++i)if(t=evt.touches[i],this.isTouchInRect(t,rect)){touchFound=!0;break}touchFound?(this.x=t.clientX-rect.left,this.y=t.clientY-rect.top):(console.warn("No touches",evt.touches,"in element rect",rect),this.x=rect.width/2,this.y=rect.height/2)}else this.x=evt.offsetX,this.y=evt.offsetY;this.r=2,this.alpha=this.startAlpha;var recentering=this.recentering;this.X.animate(this.easeInTime,function(){recentering?(this.x=this.parent.width/2,this.y=this.parent.height/2,this.r=Math.min(28,Math.min(this.$.clientWidth,this.parent.height)/2)):this.r=Math.max(28,Math.max(this.$.clientWidth,this.parent.height)),this.alpha=this.pressedAlpha}.bind(this),void 0,function(){"cancelled"===this.state_?(this.state_="pressed",this.onMouseUp()):this.state_="pressed"}.bind(this))()}}},{name:"onMouseUp",code:function(evt){return"default"!==this.state_?"pressing"===this.state_?void(this.state_="cancelled"):void("cancelled"!==this.state_&&(this.state_="released",this.X.animate(this.easeOutTime,function(){this.alpha=this.finishAlpha}.bind(this),Movement.easeIn(.5),function(){"released"===this.state_&&(this.state_="default",this.color=this.nextColor_)}.bind(this))())):void 0}}]}),CLASS({"package":"foam.graphics",name:"Circle","extends":"foam.graphics.CView",properties:[{model_:"StringProperty",name:"border",label:"Border Color",type:"String",defaultValue:""},{name:"borderWidth",defaultValue:1},{model_:"FloatProperty",name:"r",label:"Radius",type:"Float",defaultValue:20},{name:"startAngle",defaultValue:0},{name:"endAngle",defaultValue:6.283185307179586},{name:"width",defaultValueFn:function(){return 2*(this.r+(this.border?this.borderWidth:0))}},{name:"height",defaultValueFn:function(){return 2*(this.r+(this.border?this.borderWidth:0))}}],methods:[function paintSelf(c){c&&this.r&&(this.color&&(c.beginPath(),c.moveTo(0,0),c.arc(0,0,this.r,-this.endAngle,-this.startAngle,!1),c.closePath(),c.fillStyle=this.color,c.fill()),this.paintBorder(c))},function paintBorder(c){this.border&&(c.lineWidth=this.borderWidth,c.beginPath(),c.arc(0,0,this.r+this.borderWidth/2-1,this.startAngle,this.endAngle),c.closePath(),c.strokeStyle=this.border,c.stroke())},function intersects(c){var r=this.r+c.r;return this.border&&(r+=this.borderWidth-2),c.border&&(r+=c.borderWidth-2),Movement.distance(this.x-c.x,this.y-c.y)<=r}]}),CLASS({"package":"foam.graphics",name:"CView",label:"CView",traits:["foam.patterns.ChildTreeTrait"],requires:["foam.graphics.PositionedCViewView","foam.graphics.CViewView"],properties:[{name:"view",visibility:"hidden",hidden:!0,"transient":!0,postSet:function(_,view){for(var key in this.children){var child=this.children[key];child.view=view,view&&child.addListener(view.paint)}}},{name:"children",visibility:"hidden",hidden:!0},{name:"$",visibility:"hidden",hidden:!0,"transient":!0,defaultValueFn:function(){return this.view&&this.view.$}},{name:"state",defaultValue:"initial"},{model_:"BooleanProperty",name:"suspended",type:"Boolean",defaultValue:!1},{name:"className",defaultValue:"",postSet:function(){this.$&&(this.$.className=this.className)},help:"CSS class name(s), space separated. Used if adapted with a CViewView."},{model_:"FloatProperty",name:"x",type:"Float",defaultValue:0},{model_:"FloatProperty",name:"y",type:"Float",defaultValue:0},{model_:"FloatProperty",name:"a",label:"Rotation",type:"Float",defaultValue:0},{model_:"FloatProperty",name:"scaleX",type:"Float",defaultValue:1},{model_:"FloatProperty",name:"scaleY",type:"Float",defaultValue:1},{name:"canvasX",visibility:"hidden",hidden:!0,getter:function(){return this.x+(this.parent?this.parent.canvasX:0)}},{name:"canvasY",visibility:"hidden",hidden:!0,getter:function(){return this.y+(this.parent?this.parent.canvasY:0)}},{model_:"IntProperty",name:"width",type:"Int",defaultValue:10},{model_:"IntProperty",name:"height",type:"Int",defaultValue:10},{model_:"FloatProperty",name:"alpha",type:"Float",defaultValue:1},{model_:"StringProperty",name:"color",label:"Foreground Color",type:"String",defaultValue:"black"},{model_:"StringProperty",name:"background",label:"Background Color",type:"String",defaultValue:"white"},{name:"font"},{model_:"BooleanProperty",name:"clipped",type:"Boolean",defaultValue:!1}],methods:[function toView_(){if(!this.view){var params={cview:this};this.className&&(params.className=this.className),this.tooltip&&(params.tooltip=this.tooltip),this.speechLabel&&(params.speechLabel=this.speechLabel),this.tabIndex&&(params.tabIndex=this.tabIndex),this.role&&(params.role=this.role),this.data$&&(params.data$=this.data$),this.view=this.CViewView.create(params)}return this.view},function toGLView_(){var model=this.X.lookup("foam.graphics.webgl.CViewGLView");return model?model.create({sourceView:this},this.Y):""},function toPositionedView_(){if(!this.view){var params={cview:this};this.className&&(params.className=this.className),this.view=this.PositionedCViewView.create(params)}return this.view},function initCView(){},function write(opt_X){var X=opt_X||this.X;X.writeView(this.toView_(),X)},function addChild(child){if(this.SUPER(child),this.view){child.view=this.view,child.addListener(this.view.paint);try{this.view.paint()}catch(x){}}return this},function removeChild(child){return this.SUPER(child),child.view=void 0,this.view&&(child.removeListener(this.view.paint),this.view.paint()),this},function removeAllChildren(child){for(var i=this.children.length-1;i>=0;i--)this.removeChild(this.children[i]);return this},function findChildAt(x,y){for(var c2={x:x,y:y,r:1},cs=this.children,i=cs.length-1;i>=0;i--){var c1=cs[i];if(c1.intersects&&c1.intersects(c2))return c1}},function erase(canvas){canvas.fillStyle=this.background,canvas.fillRect(0,0,this.width,this.height)},function paintChildren(c){for(var i=0;i<this.children.length;i++){var child=this.children[i];c.save(),c.beginPath(),child.paint(c),c.restore()}},function paintSelf(canvas){},function paint(canvas){if(this.width&&this.height&&("initial"===this.state&&(this.state="active",this.initCView()),!this.suspended)){var c=canvas||this.view.canvas;c.save(),c.globalAlpha*=this.alpha,this.transform(c),this.clipped&&(c.rect(0,0,this.width,this.height),c.clip()),this.paintSelf(c),this.paintChildren(c),c.restore()}},function transform(canvas){canvas.translate(this.x,this.y),canvas.scale(this.scaleX,this.scaleY),this.a&&canvas.rotate(this.a)},function scale(s){this.scaleX=this.scaleY=s},function mapToParent(point){return point.x+=this.x,point.y+=this.y,point},function mapToCanvas(point){return this.mapToParent(point),this.parent&&this.parent.mapToCanvas&&this.parent.mapToCanvas(point),point},function destroy(){}]}),CLASS({"package":"foam.graphics",name:"PositionedCViewView","extends":"foam.graphics.AbstractCViewView",traits:["foam.ui.layout.PositionedDOMViewTrait"],properties:[{name:"tagName",factory:function(){return"canvas"}}],methods:[function init(){this.SUPER(),this.X.dynamicFn(function(){this.cview,this.width,this.height}.bind(this),function(){this.cview&&(this.cview.width=this.width,this.cview.height=this.height)}.bind(this))},function toHTML(){var className=this.className?' class="'+this.className+'"':"";return'<canvas id="'+this.id+'"'+className+' width="'+this.canvasWidth()+'" height="'+this.canvasHeight()+'" '+this.layoutStyle()+"></canvas>"}],listeners:[{name:"resize",code:function(){this.$&&(this.$.width=this.canvasWidth(),this.$.style.width=this.styleWidth(),this.$.height=this.canvasHeight(),this.$.style.height=this.styleHeight(),this.cview.width=this.width,this.cview.height=this.height,this.paint())},isFramed:!0}]}),CLASS({"package":"foam.ui.layout",name:"PositionedDOMViewTrait",traits:["foam.ui.layout.PositionedViewTrait"],properties:[{name:"tagName",defaultValue:"div"}],methods:[function toHTML(){return"<"+this.tagName+' id="'+this.id+'"'+this.layoutStyle()+this.cssClassAttr()+">"+this.toInnerHTML()+"</div>"},function layoutStyle(){return' style="-webkit-transform:'+this.transform()+";width:"+this.styleWidth()+";height:"+this.styleHeight()+';position:absolute;"'},function initHTML(){this.SUPER();var self=this;this.X.dynamicFn(function(){self.x,self.y,self.z},this.position),this.X.dynamicFn(function(){self.width,self.height},this.resize),this.$.style.position="absolute",this.position(),this.resize()},function transform(){return"translate3d("+this.x+"px,"+this.y+"px,"+this.z+"px)"},function styleWidth(){return this.width+"px"},function styleHeight(){return this.height+"px"}],listeners:[{name:"position",code:function(){this.$&&(this.$.style.webkitTransform=this.transform())}},{name:"resize",code:function(){this.$&&(this.$.style.width=this.styleWidth(),this.$.style.height=this.styleHeight())}}]}),CLASS({"package":"foam.ui.layout",name:"PositionedViewTrait",properties:[{model_:"FloatProperty",name:"x",type:"Float",units:"px",defaultValue:0},{model_:"FloatProperty",name:"y",type:"Float",units:"px",defaultValue:0},{model_:"FloatProperty",name:"z",type:"Float",units:"px",defaultValue:0},{model_:"IntProperty",name:"width",type:"Int",units:"px",defaultValue:100},{model_:"IntProperty",name:"height",type:"Int",units:"px",defaultValue:100},{model_:"IntProperty",name:"preferredWidth",type:"Int",units:"px",defaultValue:100},{model_:"IntProperty",name:"preferredHeight",type:"Int",units:"px",defaultValue:100}]}),CLASS({"package":"foam.graphics",name:"AbstractCViewView","extends":"foam.ui.View",properties:[{name:"cview",postSet:function(_,cview){cview.view=this,this.width=cview.x+cview.width,this.height=cview.y+cview.height}},{name:"className",defaultValue:"",help:"CSS class name(s), space separated."},{model_:"FloatProperty",name:"scalingRatio",type:"Float",preSet:function(_,v){return 0>=v?1:v},defaultValue:1},{name:"speechLabel"},{name:"role"},{name:"tabIndex"},{model_:"IntProperty",name:"width",type:"Int",defaultValue:100},{model_:"IntProperty",name:"height",type:"Int",defaultValue:100},{name:"canvas",getter:function(){return this.instance_.canvas?this.instance_.canvas:this.instance_.canvas=this.$&&this.$.getContext("2d")}},{name:"gl",getter:function(){return null}}],methods:[function init(){this.SUPER(),this.X.dynamicFn(function(){this.scalingRatio,this.width,this.height}.bind(this),this.resize)},function styleWidth(){return this.width+"px"},function canvasWidth(){return this.width*this.scalingRatio},function styleHeight(){return this.height+"px"},function canvasHeight(){return this.height*this.scalingRatio},function toString(){return"CViewView("+this.cview+")"},function toHTML(){var className=this.className?' class="'+this.className+'"':"",title=this.speechLabel?' aria-role="button" aria-label="'+this.speechLabel+'"':"",tabIndex=this.tabIndex?' tabindex="'+this.tabIndex+'"':"",role=this.role?' role="'+this.role+'"':"";return'<canvas id="'+this.id+'"'+className+title+tabIndex+role+' width="'+this.canvasWidth()+'" height="'+this.canvasHeight()+'" style="width:'+this.styleWidth()+";height:"+this.styleHeight()+";min-width:"+this.styleWidth()+";min-height:"+this.styleHeight()+'"></canvas>'},function initHTML(){if(this.$){this.maybeInitTooltip(),this.canvas=this.$.getContext("2d");var devicePixelRatio=this.X.window.devicePixelRatio||1,backingStoreRatio=this.canvas.backingStoreRatio||this.canvas.webkitBackingStorePixelRatio||1;devicePixelRatio!==backingStoreRatio&&(this.scalingRatio=devicePixelRatio/backingStoreRatio);var style=this.X.window.getComputedStyle(this.$);style.backgroundColor&&!this.cview.hasOwnProperty("background")&&(this.cview.background=style.backgroundColor),this.paint()}},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed)}],listeners:[{name:"resize",code:function(){this.$&&(this.$.width=this.canvasWidth(),this.$.style.width=this.styleWidth(),this.$.style.minWidth=this.styleWidth(),this.$.height=this.canvasHeight(),this.$.style.height=this.styleHeight(),this.$.style.minHeight=this.styleHeight(),this.paint())},isFramed:!0},{name:"paint",code:function(){if(!this.$)throw EventService.UNSUBSCRIBE_EXCEPTION;this.canvas.save(),this.canvas.clearRect(0,0,this.canvasWidth(),this.canvasHeight()),this.canvas.fillStyle=this.cview.background,this.canvas.fillRect(0,0,this.canvasWidth(),this.canvasHeight()),this.canvas.scale(this.scalingRatio,this.scalingRatio),this.cview.paint(this.canvas),this.canvas.restore()},isFramed:!0}]}),CLASS({"package":"foam.graphics",name:"CViewView","extends":"foam.graphics.AbstractCViewView",properties:[{name:"cview",postSet:function(_,cview){cview.view=this,this.X.dynamicFn(function(){var w=cview.x+cview.width,h=cview.y+cview.height;this.width=w?Math.max(this.width,w):0,this.height=h?Math.max(this.height,h):0}.bind(this))}}],methods:[function shouldDestroy(){return!1},function destroy(){this.SUPER(),this.cview&&this.cview.destroy()}],help:"DOM wrapper for a CView, auto adjusts it size to fit the given cview."}),CLASS({"package":"foam.ui.md",name:"HaloCViewView","extends":"foam.graphics.AbstractCViewView",properties:[{name:"cview",postSet:function(_,cview){cview.view=this,cview.x=0,cview.y=0,this.resize()}}],methods:[function initHTML(){this.SUPER(),this.$&&this.$.addEventListener("mousedown",this.resize)}],listeners:[{name:"resize",code:function(){this.$&&this.$.clientWidth&&this.$.clientHeight&&(this.width=this.$.clientWidth,this.height=this.$.clientHeight,this.$.width=this.canvasWidth(),this.$.height=this.canvasHeight(),this.cview&&(this.cview.width=this.width,this.cview.height=this.height,this.paint()))}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <canvas id="',self.id,'"\n              ',this.className?'class="'+this.className+'"':"",'\n              style="width: 100%; height: 100%"></canvas>\n    '),out.toString()},language:"html"}]}),CLASS({"package":"foam.flow",name:"Element","extends":"foam.ui.View",requires:["foam.Name"],properties:[{model_:"ViewFactoryProperty",name:"inner",type:"ViewFactory"},{model_:"foam.core.types.DocumentInstallProperty",name:"registerElement",documentInstallFn:function(X){X.registerElement(this.getTagName(X),this.model_["package"]+"."+this.name_)}}],methods:[function init(){this.SUPER.apply(this,arguments),this.tagName=this.getTagName()},function getTagName(X){if(this.ELEMENT_NAME)return this.ELEMENT_NAME;var Name=this.X.lookup("foam.Name");return Name?Name.create({initial:this.name_},X||this.X).toTagName():"foam-flow-element"},function replaceAll(str,a,b){for(var next=str,prev="";prev!==next;)prev=next,next=next.replace(a,b);return next},function fromElement(e){if(this.SUPER(e),1!==e.children.length||"inner"!==e.children[0].nodeName){for(var childrenToRemove=[],i=0;i<e.children.length;i++)for(var child=e.children[i],properties=this.model_.getRuntimeProperties(),j=0;j<properties.length;j++){var prop=properties[j];if(child.nodeName===prop.name){childrenToRemove.push(child);break}}for(i=0;i<childrenToRemove.length;i++)e.removeChild(childrenToRemove[i]);this.inner=e.innerHTML}return this}],templates:[{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("",this.inner(),""),out.toString()},language:"html"}]}),CLASS({"package":"foam",name:"Name",requires:["foam.Memo"],properties:[{model_:"StringProperty",name:"initial",type:"String",required:!0},{model_:"StringArrayProperty",name:"parts",type:"StringArray"},{model_:"FunctionProperty",name:"toUpperCamel",type:"Function",factory:function(){return this.Memo.create({f:function(){return this.parts.map(function(p){return p.charAt(0).toUpperCase()+p.slice(1)}).join("")}}).get()}},{model_:"FunctionProperty",name:"toLowerCamel",type:"Function",factory:function(){return this.Memo.create({f:function(){return this.parts[0].toLowerCase()+this.parts.slice(1).map(function(p){return p.charAt(0).toUpperCase()+p.slice(1)}).join("")}}).get()}},{model_:"FunctionProperty",name:"toHyphen",type:"Function",factory:function(){return this.Memo.create({f:function(){return this.parts.map(function(p){return p.toLowerCase()}).join("-")}}).get()}},{model_:"FunctionProperty",name:"toUpperUnderscore",type:"Function",factory:function(){return this.Memo.create({f:function(){return this.parts.map(function(p){return p.toUpperCase()}).join("_")}}).get()}}],methods:[function init(){this.SUPER.apply(this,arguments);var str=this.initial,match=str.match(/^[^A-Z]*/),prefix="";for(match&&match[0]&&(prefix=match[0],
this.parts.push(prefix),str=str.slice(prefix.length));str;)match=str.match(/^[A-Z]+/),match&&match[0]&&match[0].length>1?(prefix=match[0].length===str.length?match[0]:match[0].slice(0,match[0].length-1),this.parts.push(prefix),str=str.slice(prefix.length)):(match=str.match(/^[A-Z][^A-Z]*/),match&&match[0]&&(prefix=match[0],this.parts.push(prefix),str=str.slice(prefix.length)))},function toModelName(){return this.toUpperCamel()},function toMethodName(){return this.toLowerCamel()},function toPropertyName(){return this.toLowerCamel()},function toTagName(){return this.toHyphen()},function toValueName(){return this.toLowerCamel()+"$"},function toConstantName(){return this.toUpperUnderscore()},function toPropertySymbolName(){return this.toUpperUnderscore()},function toPropertyValueSymbolName(){return this.toUpperUnderscore()+"$"}]}),CLASS({"package":"foam",name:"Memo",properties:[{model_:"FunctionProperty",name:"f",type:"Function",required:!0},{model_:"FunctionProperty",name:"f_",type:"Function","transient":!0},{model_:"FunctionProperty",name:"hashFunction",type:"Function",defaultValueFn:function(){return this.IDENTITY},defaultValue:function(){}},{name:"memos",factory:function(){return{}}}],constants:[{name:"IDENTITY",value:function(){var args=argsToArray(arguments);return JSON.stringify(args.map(function(a){return"object"==typeof a?a.$UID:a.toString()}))}},{name:"MODEL_IDENTITY",value:function(){var args=argsToArray(arguments);return JSON.stringify(args.map(function(a){return a.model_?a.$UID:a.toString()}))}},{name:"DEEP_VALUE",value:function(){var args=argsToArray(arguments);return JSON.stringify(args.map(function(a){return a.model_?JSONUtil.stringify(a):a}))}}],methods:[function init(){this.SUPER.apply(this,arguments);var self=this;this.f_=function(){var hash=self.hashFunction.apply(self,arguments);return self.memos[hash]?self.memos[hash]:(self.memos[hash]=self.f.apply(this,arguments),self.memos[hash])}},function get(){return this.f_}]}),CLASS({"package":"foam.core.types",name:"StringEnumProperty","extends":"StringProperty",traits:["foam.core.types.EnumPropertyTrait"]}),CLASS({"package":"foam.core.types",name:"EnumPropertyTrait",properties:[{model_:"ArrayProperty",name:"choices",type:"Array",required:!0,preSet:function(_,a){return a.map(function(c){return Array.isArray(c)?c:[c,c]})},help:"Array of [value, label] choices."},{name:"view",defaultValue:"foam.ui.ChoiceView"},{name:"toPropertyE",defaultValue:function(X){return X.lookup("foam.u2.tag.Select").create({prop:this,choices:this.choices},X)}}],methods:[function choiceLabel(value){var vl=this.choices.filter(function(vl){return vl[0]===value})[0];return vl?vl[1]:""},function choiceValue(label){var vl=this.choices.filter(function(vl){return vl[1]===label})[0];return vl?vl[0]:""}]}),CLASS({"package":"foam.ui.md",name:"OverflowActionList","extends":"foam.ui.SimpleView",requires:["foam.ui.ActionButton","foam.ui.md.ActionList","foam.ui.md.OverlayDropdownView"],properties:[{model_:"ArrayProperty",name:"data",type:"Array",subType:"foam.ui.md.ToolbarAction",postSet:function(old,nu){old!==nu&&(nu.length===this.maxShowActions+1?(this.showActions_=nu.slice(),this.moreActions_=[]):(this.showActions_=nu.slice(0,this.maxShowActions),this.moreActions_=nu.slice(this.maxShowActions)))}},{model_:"IntProperty",name:"maxShowActions",type:"Int",defaultValue:4},{name:"showActionList",lazyFactory:function(){return this.ActionList.create({data$:this.showActions_$,direction:"HORIZONTAL",actionViewFactory:this.ActionButton},this.Y)}},{model_:"ViewFactoryProperty",name:"moreActionsFactory",type:"ViewFactory",defaultValue:"foam.ui.ActionButton"},{name:"moreActionsDropdown",lazyFactory:function(){return this.OverlayDropdownView.create({data$:this.moreActions_$,delegate:this.ActionList.xbind({direction:"VERTICAL",actionViewFactory:this.moreActionsFactory},this.Y)},this.Y)}},{model_:"ArrayProperty",name:"showActions_",type:"Array",subType:"foam.ui.md.ToolbarAction"},{model_:"ArrayProperty",name:"moreActions_",type:"Array",subType:"foam.ui.md.ToolbarAction"}],actions:[{name:"moreActions",iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAGklEQVQ4y2NgGAVEg/9EAMo0jHp61NOjAAgAUWrXKeQhPE4AAAAASUVORK5CYII=",ligature:"more_vert",code:function(){this.moreActionsDropdown.open()}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <actions id="',self.id,'" ',self.cssClassAttr(),">\n        ",self.moreActionsDropdown,"\n        ",self.showActionList,"\n        ",self.createTemplateView("moreActions",{extraClassName:"more-actions-button"}),"\n        "),this.setClass("hide-more-actions",function(){return 0===this.moreActions_.length}.bind(this),this.moreActionsView.id),out("\n      </actions>\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate("actions flat-button.hide-more-actions{display:none}actions flat-button.more-actions-button{margin-left:0}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"OverlayDropdownView","extends":"foam.ui.SimpleView",requires:["foam.ui.md.FlatButton"],imports:["document","window"],exports:["as dropdown"],properties:[{name:"data"},{model_:"ViewFactoryProperty",name:"delegate",type:"ViewFactory"},{name:"delegateView",defaultValue:null},{model_:"FloatProperty",name:"height",type:"Float",postSet:function(old,nu){this.$&&old!==nu&&!Number.isNaN(nu)&&(0>nu?this.$.style.height=this.getFullHeight()+"px":this.$.style.height=nu+"px")},defaultValue:0},{model_:"foam.core.types.StringEnumProperty",name:"state",defaultValue:"CLOSED",choices:[["CLOSED","Closed"],["OPEN","open"]]},{model_:"foam.core.types.StringEnumProperty",name:"animationState",defaultValue:"CLOSED",choices:[["CLOSED","Closed"],["OPEN","open"]]},{model_:"BooleanProperty",name:"coverPage",type:"Boolean",postSet:function(old,nu){if(this.$&&old!==nu){var overlay=this.$overlay,style=overlay.style;nu?style.top=style.bottom=style.left=style.right="0":style.top=style.bottom=style.left=style.right="initial"}},defaultValue:!1},{name:"$overlay",defaultValueFn:function(){return this.document.querySelector("#"+this.id+"-overlay")}},{model_:"BooleanProperty",name:"listeningForCancel_",type:"Boolean",defaultValue:!1}],methods:[function open(){if("OPEN"!==this.state&&this.$){if(!this.delegateView){this.delegateView=this.delegate({data$:this.data$},this.Y);var out=TemplateOutput.create(this);this.delegateView.toHTML(out),this.$.innerHTML=out.toString(),this.delegateView.initHTML()}this.height=-1,this.coverPage=!0,this.state="OPEN",this.listenForCancel()}},function close(){"CLOSED"!==this.state&&this.$&&(this.height=0,this.coverPage=!1,this.state="CLOSED",this.unlistenForCancel())},function getPositionStyle(){return"height:"+(this.height<0?this.getFullHeight()+"px":this.height+"px")},function getFullHeight(){if(!this.$)return 0;var getComputedStyle=this.window.getComputedStyle.bind(this.window),myStyle=getComputedStyle(this.$),border=0;["border-top","border-bottom"].forEach(function(name){var match=myStyle[name].match(/^([0-9]+)px/);match&&(border+=parseInt(match[1]))});var last=this.$.lastElementChild,margin=parseInt(getComputedStyle(last)["margin-bottom"]);return margin=Number.isNaN(margin)?0:margin,Math.min(border+last.offsetTop+last.offsetHeight+margin,this.document.body.clientHeight-this.$.getBoundingClientRect().top)},function initHTML(){this.SUPER(),this.$.addEventListener("transitionend",this.onTransitionEnd),this.$.addEventListener("mouseleave",this.onMouseLeave),this.$.addEventListener("click",this.onClick)},function init(){this.SUPER(),this.Y.registerModel(this.FlatButton.xbind({displayMode:"LABEL_ONLY",color:"black"}),"foam.ui.ActionButton")}],listeners:[{name:"listenForCancel",code:function(){this.listeningForCancel_||"OPEN"!==this.state||(this.document.body.addEventListener("click",this.onCancel),this.listeningForCancel_=!0)},isFramed:!0},{name:"unlistenForCancel",code:function(){this.listeningForCancel_&&"CLOSED"===this.state&&(this.document.body.removeEventListener("click",this.onCancel),this.listeningForCancel_=!1)},isFramed:!0},{name:"onCancel",code:function(e){this.close()}},{name:"onTransitionEnd",code:function(e){this.animationState=this.state}},{name:"onMouseLeave",code:function(e){e.target===this.$&&this.close()}},{name:"onClick",code:function(e){e.stopPropagation()}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <dropdown-overlay id="',self.id,'-overlay"></dropdown-overlay>\n      <dropdown id="',self.id,'" style="',self.getPositionStyle(),'"></dropdown>\n      '),this.setClass("open",function(){return this.state,this.animationState,"OPEN"===this.state&&"OPEN"===this.animationState}.bind(this),this.id),out("\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate("dropdown-overlay{position:fixed;z-index:1009}dropdown{background:white;-webkit-box-shadow:0 1px 3px rgba(0, 0, 0, 0.38);box-shadow:0 1px 3px rgba(0, 0, 0, 0.38);display:block;font-size:13px;font-weight:400;overflow-x:hidden;overflow-y:hidden;position:absolute;right:3px;top:4px;transition:height 0.25s cubic-bezier(0, .3, .8, 1);z-index:1010}dropdown.open{overflow-y:auto}dropdown action-list.vertical{margin-top:0}dropdown action-list.vertical .md-button{border-radius:0}dropdown action-list.vertical .md-button-label{text-transform:none}dropdown .label-only{margin:0;padding:0}dropdown .label-only .md-button-label{margin:auto;font-weight:400}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"ToolbarAction",properties:[{name:"data"},{name:"action"}]}),CLASS({"package":"foam.ui.md",name:"BaseDetailView","extends":"foam.ui.DetailView",requires:["foam.ui.md.TextFieldView","foam.ui.md.IntFieldView","foam.ui.md.FloatFieldView","foam.ui.md.ToggleView","foam.ui.md.ChoiceRadioView","foam.ui.md.DateFieldView","foam.ui.md.DateTimeFieldView","foam.ui.md.ColorFieldView","foam.ui.md.ImagePickerView"],properties:[{name:"className",defaultValue:"md-detail-view"}],methods:[function init(){this.Y_=this.Y.sub(),this.Y.registerModel(this.TextFieldView,"foam.ui.TextFieldView"),this.Y.registerModel(this.IntFieldView,"foam.ui.IntFieldView"),this.Y.registerModel(this.FloatFieldView,"foam.ui.FloatFieldView"),this.Y.registerModel(this.ToggleView,"foam.ui.BooleanView"),this.Y.registerModel(this.ChoiceRadioView,"foam.ui.ChoiceListView"),this.Y.registerModel(this.DateFieldView,"foam.ui.DateFieldView"),this.Y.registerModel(this.DateTimeFieldView,"foam.ui.DateTimeFieldView"),this.Y.registerModel(this.ChoiceRadioView,"foam.ui.ChoiceView"),this.SUPER()},function titleHTML(){return""},function startForm(){return""},function endForm(){return""},function startColumns(){return""},function nextColumn(){return""},function endColumns(){return""},function rowToHTML(prop,view){var str="";return str+=view.toHTML(),str+="<br>"}],templates:[{name:"CSS",code:ConstantTemplate(".md-detail-view{-webkit-flex-grow:1;flex-grow:1}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"TextFieldView","extends":"foam.ui.SimpleView",traits:["foam.ui.md.MDStyleTrait"],requires:["foam.ui.QueryParserAutocompleter","foam.ui.md.AutocompleteView"],properties:[{name:"className",defaultValue:"md-text-field-container"},{name:"data"},{name:"softData"},{name:"inputId"},{name:"$input",getter:function(){return this.X.$(this.inputId)}},{name:"labelId"},{name:"$label",getter:function(){return this.X.$(this.labelId)}},{model_:"BooleanProperty",name:"focused",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"enabled",type:"Boolean",postSet:function(old,nu){nu?this.$input&&this.$input.removeAttribute("disabled"):this.$input&&this.$input.setAttribute("disabled","")},defaultValue:!0},{name:"prop"},{name:"label",defaultValueFn:function(){return this.prop.label}},{model_:"BooleanProperty",name:"onKeyMode",type:"Boolean",getter:function(){return this.updateMode===this.EACH_KEYSTROKE},setter:function(nu){this.updateMode=nu?this.EACH_KEYSTROKE:this.DONE_EDITING},help:"If true, value is updated on each keystroke."},{model_:"foam.core.types.StringEnumProperty",name:"updateMode",defaultValue:"DONE_EDITING",help:"Controls when the real .data is updated: on every keystroke, when the user presses enter or blurs the box, or on enter only.",choices:[["DONE_EDITING","Done editing"],["EACH_KEYSTROKE","Every keystroke"],["ENTER_ONLY","Enter only"]]},{name:"autocomplete",defaultValueFn:function(){return!(!this.prop||!this.prop.autocompleter)}},{model_:"FactoryProperty",name:"autocompleter",type:"Factory",defaultValue:"foam.ui.QueryParserAutocompleter"},{model_:"ViewFactoryProperty",name:"acRowView",type:"ViewFactory",defaultValue:"foam.ui.md.DetailView"},{name:"autocompleteView"},{model_:"IntProperty",name:"displayWidth",type:"Int"},{model_:"IntProperty",name:"displayHeight",type:"Int"},{model_:"StringProperty",name:"type",type:"String",defaultValue:"text"},{model_:"BooleanProperty",name:"floatingLabel",type:"Boolean",postSet:function(old,nu){},defaultValue:!0},{name:"placeholder",defaultValueFn:function(){return this.label}},{model_:"BooleanProperty",name:"growable",type:"Boolean",defaultValue:!1},{name:"clearAction",defaultValue:!1},{name:"clearIcon",defaultValue:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAABAUlEQVQ4y72Syw2CQBCGiQfpBbAILMFEIpHQxd+HJib2oIFifFwxG/EAHegFRx77BLmxc9nH98HM7ljWxAM2YqRg+FAwJIhg/8M3eKHSIkfQD89wNOAuDpiZwjBeK2Yy1Uis1VK73C/wUXKooNWtnT8xF0LMEZ9WXqsUcGi15GdbIaR8s4RHa5fgBl9I/zsLgUm5lnBrRccrPITwUcorfoqBV3gPC0696w0LTMfp656hZEJIDLyUyu/OTkKIlGvtcm/K9/lZKD9c3m5e6d7Vh7u3cyY9HCnBaGus9G46/MX3fe09rOx62ruW1tRiOsyMZBRlji3OeOBNkeGEUCl1kvEFpNGiJ85Uf0MAAAAASUVORK5CYII="},{name:"underline",defaultValue:!0,postSet:function(old,nu){}},{model_:"StringProperty",name:"mode",type:"String",defaultValue:"read-write",postSet:function(old,nu){old!==nu&&this.$&&(this.$.outerHTML=this.toHTML(),this.initHTML())},view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write"]}}],actions:[{name:"clear",label:"",isAvailable:function(){return!!this.softData.length},code:function(){this.data=this.softData=""}}],constants:[{name:"DONE_EDITING",value:"DONE_EDITING"},{name:"EACH_KEYSTROKE",value:"EACH_KEYSTROKE"},{name:"ENTER_ONLY",value:"ENTER_ONLY"}],methods:[function initHTML(){this.SUPER(),this.softValue=DomValue.create(this.$input,"input",this.growable?"textContent":"value"),this.softValue.set(this.data),Events.link(this.softValue,this.softData$),this.updateMode===this.EACH_KEYSTROKE?Events.link(this.data$,this.softData$):Events.follow(this.data$,this.softData$),this.setupAutocomplete()},function setupAutocomplete(){if(this.autocomplete){var view=this.autocompleteView=this.AutocompleteView.create({acRowView:this.acRowView,autocompleter:this.autocompleter({prop:this.prop},this.Y),target:this});this.bindAutocompleteEvents(view)}},function bindAutocompleteEvents(view){this.$input.addEventListener("blur",function(){view.publish("blur")}),this.$input.addEventListener("input",function(){view.autocomplete(this.softData)}.bind(this)),this.$input.addEventListener("focus",function(){view.autocomplete(this.softData)}.bind(this))},function onAutocomplete(data){this.data=this.softData=data,this.onChange()},function focus(){this.$input.focus()},function blur(){this.$input&&this.$input.blur()}],listeners:[{name:"onFocus",code:function(){this.focused=!0}},{name:"onBlur",code:function(){this.focused=!1,this.growable&&this.updateMode!==this.ENTER_ONLY&&(this.data=this.softData)}},{name:"onInput",code:function(){}},{name:"onChange",code:function(){this.updateMode!==this.ENTER_ONLY&&(this.data=this.softData)}},{name:"onKeyDown",code:function(e){this.autocompleter&&(this.publish(["keydown"],e),13!==e.keyCode)||13===e.keyCode&&!this.growable&&this.displayHeight<=1&&(this.data=this.softData)}},{name:"onKeyPress",code:function(e){e.stopPropagation()}},{name:"onClick",code:function(){this.$input.focus()}}],templates:[{name:"CSS",code:ConstantTemplate(".md-text-field-container{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;position:relative}.md-text-field-container.md-style-trait-standard{margin:8px;padding:32px 8px 8px 8px}.md-text-field-container.md-style-trait-inline{padding:32px 0px 0px 0px;margin:-32px 0px 0px 0px}.md-text-field-container.md-text-field-no-label.md-style-trait-inline{padding-top:0px;margin:0px}.md-text-field-label{position:absolute;top:32px;font-size:14px;font-weight:500;color:#999;transition:font-size 0.5s, top 0.5s;-webkit-flex-grow:1;flex-grow:1;z-index:0}.md-text-field-input{background:transparent;border-bottom:1px solid #e0e0e0;border-left:none;border-right:none;border-top:none;color:#444;-webkit-flex-grow:1;flex-grow:1;font-family:inherit;font-size:inherit;margin-bottom:-8px;padding:0 0 7px 0;resize:none;z-index:1}.disabled .md-text-field-input{border-bottom:none;padding-bottom:8px}.md-text-field-container.md-text-field-no-label .md-text-field-input{}.md-text-field-container.md-text-field-no-label{padding-top:8px}.md-text-field-borderless{border-bottom:none !important;padding-bottom:8px}.md-text-field-input:focus{border-bottom:2px solid #4285f4;padding:0 0 6px 0;outline:none}.md-text-field-label-offset{font-size:85%;top:8px}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n      ");var input=this.inputId=this.nextID(),label=this.labelId=this.nextID();return"read-only"!==this.mode&&(this.on("focus",this.onFocus,input),this.on("blur",this.onBlur,input),this.on("input",this.onInput,input),this.on("change",this.onChange,input),this.on("click",this.onClick,input),this.on("keydown",this.onKeyDown,input),this.on("keypress",this.onKeyPress,input)),this.floatingLabel?this.setClass("md-text-field-label-offset",function(){var focused=self.focused,data=self.data;return focused||(""+data).length>0},label):this.setClass("md-text-field-no-label",function(){return!0},this.id),this.setClass("disabled",function(){return"read-only"==self.mode},this.id),this.setMDClasses(),out("\n      <div ",this.cssClassAttr(),' id="',self.id,'">\n        '),this.floatingLabel&&out('\n          <label id="',label,'" class="md-text-field-label">',self.label,"</label>\n        "),out("\n        "),this.growable?out('\n          <div id="',input,'" class="md-text-field-input"',"read-write"==this.mode?" contenteditable":"",">\n          </div>\n        "):this.displayHeight>1?(out('\n          <textarea id="',input,'" type="',self.type,'" '),out(this.enabled?"":"disabled"),out(' class="md-text-field-input" rows="',this.displayHeight,'"',"read-only"==this.mode?" disabled":"","></textarea>\n        ")):"read-only"===this.mode?out('\n          <span id="',input,'" class="md-text-field-read-only">',self.dynamicTag("span",function(){return this.data}.bind(this)),"</span>\n        "):(out('\n          <input id="',input,'" type="',self.type,'" '),out(this.enabled?"":"disabled"),out('\n              class="md-text-field-input ',this.underline?"":"md-text-field-borderless",'"\n              ',this.floatingLabel?"":'placeholder="'+this.placeholder+'"',"","read-only"==this.mode?" disabled":""," />\n          "),this.clearAction&&out("\n            ",self.createTemplateView("clear",{iconUrl:this.clearIcon,ligature:"cancel"}),"\n          "),out("\n        ")),out("\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"QueryParserAutocompleter",properties:[{name:"prop"},{name:"model",defaultValueFn:function(){return this.prop.subType?this.X.lookup(this.prop.subType):this.dao.model}},{name:"parser",lazyFactory:function(){return QueryParserFactory(this.model,!0)}},{name:"projection_",lazyFactory:function(){var subKey=this.X.lookup(this.prop.subType+"."+this.prop.subKey);return function(obj){return subKey.f(obj)}}},{name:"dao",lazyFactory:function(){if(this.prop&&this.prop.subType){var last=this.prop.subType.split(".").pop(),daoName=last.substring(0,1).toLowerCase()+last.substring(1)+"DAO";return this.X[daoName]}return this.X.dao}},{model_:"foam.core.types.DAOProperty",name:"autocompleteDAO"}],methods:[function autocomplete(partial){var query=this.parser.parseString(partial);console.log('parsed "'+partial+'" into',query);var dao=this.dao.limit(4);query&&(console.log(query.toMQL()),dao=dao.where(query)),this.autocompleteDAO=dao}],listeners:[{name:"f",code:function(obj){return this.projection_(obj)}}]}),CLASS({"package":"foam.ui.md",name:"AutocompleteView","extends":"foam.ui.SimpleView",requires:["foam.ui.ChoiceListView"],properties:[{model_:"ViewFactoryProperty",name:"acRowView",type:"ViewFactory"},{name:"autocompleter"},{name:"target",postSet:function(old,nu){old&&old.unsubscribe(["keydown"],this.onKeyDown),nu.subscribe(["keydown"],this.onKeyDown)}},{name:"view_",postSet:function(old,nu){old&&(old.data$.removeListener(this.complete),old.choices$.removeListener(this.choicesUpdate)),nu.data$.addListener(this.complete),nu.choices$.addListener(this.choicesUpdate)}},{name:"maxHeight",defaultValue:400},{name:"closeTime",defaultValue:200},{name:"className",defaultValue:"md-autocomplete-popup"},{name:"closeTimeout_"},{name:"current_"}],methods:[function autocomplete(partial){this.view_||(this.view_=this.makeView()),this.current_=partial,this.open(this.target),this.autocompleter.autocomplete(partial)},function makeView(){return this.ChoiceListView.create({dao:this.autocompleter.autocompleteDAO$Proxy,rowView:this.acRowView,extraClassName:"autocomplete",orientation:"vertical",mode:"final",objToChoice:this.autocompleter.f,useSelection:!0},this.Y)},function init(args){this.SUPER(args),this.subscribe("blur",this.onBlur)},function open(e,opt_delay){if(this.closeTimeout_&&(this.X.clearTimeout(this.closeTimeout_),this.closeTimeout_=0),this.$)return void this.position(this.$.firstElementChild,e.$||e);var parentNode=e.$||e,document=parentNode.ownerDocument;console.assert(this.X.document===document,"X.document is not global document");var div=document.createElement("div"),window=document.defaultView;console.assert(this.X.window===window,"X.window is not global window"),parentNode.insertAdjacentHTML("afterend",this.toHTML().trim()),this.position(this.$.firstElementChild,parentNode),this.initHTML()},function close(opt_now){return opt_now?(this.closeTimeout_&&(this.X.clearTimeout(this.closeTimeout_),this.closeTimeout_=0),void(this.$&&this.$.remove())):void(this.closeTimeout_||(this.closeTimeout_=this.X.setTimeout(function(){this.closeTimeout_=0,this.$&&this.$.remove()}.bind(this),this.closeTime)))},function position(div,parentNode){var document=parentNode.ownerDocument,pos=findPageXY(parentNode),pageWH=[document.firstElementChild.offsetWidth,document.firstElementChild.offsetHeight];pageWH[1]-(pos[1]+parentNode.offsetHeight)<(this.height||this.maxHeight||400)&&(div.style.bottom=parentNode.offsetHeight);var focusedRect=document.activeElement.getBoundingClientRect(),parentRect=parentNode.getBoundingClientRect();div.style.width=(this.width||focusedRect.width)+"px",div.style.left=focusedRect.left-parentRect.left,this.maxWidth&&(div.style.maxWidth=this.maxWidth+"px"),this.maxHeight&&(div.style.maxHeight=this.maxHeight+"px")}],listeners:[{name:"onKeyDown",code:function(_,__,e){this.view_&&(38===e.keyCode?(this.view_.index--,this.view_.scrollToSelection(this.$),e.preventDefault()):40===e.keyCode?(this.view_.index++,this.view_.scrollToSelection(this.$),e.preventDefault()):13===e.keyCode&&(this.view_.commit(),e.preventDefault()))}},{name:"complete",code:function(){this.target.onAutocomplete(this.view_.data),this.view_=this.makeView(),this.close(!0)}},{name:"choicesUpdate",code:function(){this.view_&&(0===this.view_.choices.length||1===this.view_.choices.length&&this.view_.choices[0][1]===this.current)&&this.close(!0)}},{name:"onBlur",code:function(){this.close()}}],templates:[{name:"CSS",code:ConstantTemplate(".md-autocomplete-container{display:block;position:relative}.md-autocomplete-popup{background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 3px rgba(0, 0, 0, 0.38);box-shadow:0 1px 3px rgba(0, 0, 0, 0.38);margin:-4px 8px 8px 8px;overflow-y:auto;overflow-x:hidden;position:absolute;z-index:2000}.md-autocomplete-popup .autocomplete .choice{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <span id="',this.id,'" class="md-autocomplete-container">\n        <div ',this.cssClassAttr(),">\n          ",this.view_,"\n        </div>\n      </span>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"MDStyleTrait",properties:[{model_:"BooleanProperty",name:"inlineStyle",type:"Boolean",defaultValue:!1}],methods:[function setMDClasses(){this.setClass("md-style-trait-inline",function(){return this.inlineStyle},this.id),this.setClass("md-style-trait-standard",function(){return!this.inlineStyle},this.id)}]}),CLASS({"package":"foam.ui.md",name:"IntFieldView","extends":"foam.ui.md.TextFieldView"}),CLASS({"package":"foam.ui.md",name:"FloatFieldView","extends":"foam.ui.md.TextFieldView"}),CLASS({"package":"foam.ui.md",name:"ToggleView","extends":"foam.ui.SimpleView",traits:["foam.ui.md.MDStyleTrait"],requires:["foam.ui.md.HaloView"],properties:[{model_:"BooleanProperty",name:"data",type:"Boolean",view:"foam.ui.BooleanView"},{model_:"BooleanProperty",name:"enabled",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!0},{model_:"StringProperty",name:"label",type:"String",defaultValueFn:function(){return this.prop&&this.prop.label}},{name:"className",defaultValue:"toggle-container"},{name:"halo",factory:function(){return this.HaloView.create({},this.Y)}}],listeners:[{name:"onClick",code:function onClick(e){this.enabled&&(this.data=!this.data)},args:[{name:"e"}]}],templates:[{name:"CSS",code:ConstantTemplate(".toggle-container{display:-webkit-flex;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}.toggle-label{-webkit-flex-grow:1;flex-grow:1;-webkit-flex-grow:1;margin-top:auto;margin-bottom:auto}.toggle-text-indicator{margin-right:20px;width:1em;margin-top:auto;margin-bottom:auto}.toggle-outer{position:relative;width:36px;height:14px}.toggle-halo{position:absolute;width:48px;height:48px;cursor:pointer;top:-17px;left:-6px}.toggle-background{background-color:#9e9e9e;border-radius:7px;display:inline-block;height:14px;opacity:0.3;position:absolute;width:36px;pointer-events:none}.toggle-background.enabled{opacity:1.0}.toggle-lever{background-color:#f5f5f5;border-radius:50%;border:1px solid #ccc;-webkit-box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.15);box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.15);height:20px;left:0;position:absolute;top:-3px;transition:left .08s;width:20px;pointer-events:none}.toggle-background.toggledOn{background-color:#7baaf7}.toggle-background.toggledOn .toggle-lever{border:none;-webkit-box-shadow:0 2px 4px 0 rgba(0, 0, 0, 0.26);box-shadow:0 2px 4px 0 rgba(0, 0, 0, 0.26);background-color:#3367d6;left:inherit;left:16px}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',self.id,'" ',this.cssClassAttr(),'>\n        <span class="toggle-label noselect md-grey">',self.dynamicTag("span",function(){return this.label}.bind(this)),'</span>\n        <span class="toggle-text-indicator noselect">',self.dynamicTag("span",function(){return this.data?"ON":"OFF"}.bind(this)),'</span>\n        <div class="toggle-outer noselect">\n          <span id="',this.id,'-background" class="toggle-background">\n            <div class="toggle-lever"></div>\n          </span>\n          <div class="toggle-halo noselect">\n            ',this.halo,"\n          </div>\n        </div>\n      </div>\n      "),this.on("click",this.onClick,this.id),this.setClass("toggledOn",function(){return!!self.data},this.id+"-background"),this.setClass("enabled",function(){return!!self.enabled},this.id+"-background"),this.setMDClasses(),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"ChoiceRadioView","extends":"foam.ui.AbstractChoiceView",traits:["foam.ui.md.MDStyleTrait"],requires:["foam.ui.md.RadioOptionView","foam.ui.md.RadioOptionTextFieldView"],properties:[{name:"orientation",view:{factory_:"foam.ui.ChoiceView",choices:[["horizontal","Horizontal"],["vertical","Vertical"]]},defaultValue:"horizontal",postSet:function(old,nu){this.$&&(DOM.setClass(this.$,old,!1),DOM.setClass(this.$,nu))}},{name:"prop"},{name:"showLabel",defaultValue:!1},{name:"label",defaultValueFn:function(){return this.prop.label}},{name:"className",defaultValueFn:function(){return"md-choice-radio-view "+this.orientation}},{name:"tagName",defaultValue:"div"},{name:"innerTagName",defaultValue:"div"}],methods:[function shouldDestroy(old,nu){return!1},function scrollToSelection(){var e=this.$.children[this.index];if(e){for(var parent=e.parentElement;parent;){var overflow=this.X.window.getComputedStyle(parent).overflow;if("scroll"===overflow||"auto"===overflow)break;parent=parent.parentElement}parent=parent||this.X.window,e.offsetTop<parent.scrollTop?e.scrollIntoView(!0):e.offsetTop+e.offsetHeight>=parent.scrollTop+parent.offsetHeight&&e.scrollIntoView()}}],templates:[{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n      "),this.showLabel&&out('\n        <span class="md-choice-radio-view-title">',this.label,"</span>\n      "),out("\n");for(var i=0;i<this.choices.length;i++){var choice=this.choices[i];out('\n        <div class="choice">\n      '),"user"==choice[2]?out("\n          ",self.createTemplateView("data",{model_:"foam.ui.md.RadioOptionTextFieldView",inlineStyle$:this.inlineStyle$,choice:choice}),"\n      "):out("\n          ",self.createTemplateView("data",{model_:"foam.ui.md.RadioOptionView",inlineStyle$:this.inlineStyle$,choice:choice}),"\n      "),out("\n        </div>\n")}return this.setMDClasses(),out("\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate(".md-choice-radio-view{margin:0px;padding:0px}.md-choice-radio-view .selected{font-weight:bold}.md-choice-radio-view.vertical{padding:0;-webkit-flex-direction:column;flex-direction:column}.md-choice-radio-view.md-style-trait-standard.vertical{-webkit-align-items:flex-start;align-items:flex-start}.md-choice-radio-view.vertical .choice{display:block}.md-choice-radio-view.horizontal.md-style-trait-inline{margin-bottom:-3px}.md-choice-radio-view.md-style-trait-inline{margin:0px;padding:0px}.md-choice-radio-view.md-style-trait-standard{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;margin:0 0 0 16px;padding:0}.md-choice-radio-view.md-style-trait-standard .md-choice-radio-view-title{margin-right:16px}.md-choice-radio-view.horizontal .choice{display:inline-block;margin-right:16px}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"RadioOptionView","extends":"foam.ui.SimpleView",traits:["foam.ui.md.MDStyleTrait"],requires:["foam.ui.md.HaloView"],imports:["document"],properties:[{name:"data"},{name:"value"},{name:"label",defaultValueFn:function(){return this.value}},{name:"choice",getter:function(){return[this.value,this.label]},setter:function(val){this.value=val[0],this.label=val[1]}},{name:"className",defaultValue:"radiobutton-container noselect"},{name:"enabled",defaultValue:!0},{name:"halo",factory:function(){return this.HaloView.create({width:48,height:48},this.Y)}}],methods:[function init(){this.SUPER(),Events.dynamicFn(function(){this.data,this.value}.bind(this),function(){this.setHaloColor()}.bind(this))}],listeners:[{name:"setHaloColor",code:function(){this.halo.color=equals(this.data,this.value)?"#5a5a5a":"#4285f4"}},{name:"onClick",code:function(){var active=this.document.activeElement;active&&active.blur(),this.enabled&&(this.data=this.value),this.setHaloColor()}}],templates:[{name:"CSS",code:ConstantTemplate(".radiobutton-container{display:block;white-space:nowrap;position:relative}.radiobutton-container :focus{outline:none}#radioContainer{position:absolute;left:-16px;top:-16px;width:48px;height:48px;cursor:pointer}.radio-indicator{position:relative;width:16px;height:16px;-webkit-align-self:center;align-self:center}#radioContainer.labeled{display:inline-block;vertical-align:middle}#offRadio{position:absolute;top:0px;left:0px;width:16px;height:16px;border-radius:50%;border:solid 2px;border-color:#5a5a5a;transition:border-color 0.28s;pointer-events:none}.radiobutton-background{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-align-items:flex-end;align-items:flex-end;white-space:nowrap;position:relative}.radiobutton-background.checked #offRadio{border-color:#4285f4}#onRadio{position:absolute;top:4px;left:4px;width:8px;height:8px;border-radius:50%;background-color:#4285f4;-webkit-transform:scale(0);-webkit-transform:scale(0);transform:scale(0);transition:-webkit-transform ease 0.28s;transition:transform ease 0.28s;pointer-events:none}.radiobutton-background.checked #onRadio{-webkit-transform:scale(1);-webkit-transform:scale(1);transform:scale(1)}.radioLabel{position:relative;display:block;vertical-align:middle;margin-left:12px;white-space:normal;pointer-events:none}.radioLabel.hidden{display:none}.radiobutton-background.disabled{pointer-events:none}.radiobutton-background.disabled #offRadio, .radiobutton-background.disabled #onRadio{opacity:0.33}.radiobutton-background.disabled #offRadio{border-color:#5a5a5a}.radiobutton-background.disabled .radiobutton-background.checked #onRadio{background-color:#5a5a5a}"),
language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',self.id,'" ',this.cssClassAttr(),'>\n        <div id="',this.id,'-background" class="radiobutton-background">\n          <div class="radio-indicator">\n            <div id="onRadio"></div>\n            <div id="offRadio"></div>\n            <div id="radioContainer" class="labeled">\n              ',this.halo,'\n            </div>\n          </div>\n          <div class="radioLabel">',self.createTemplateView("label",{mode:"read-only",floatingLabel:!1}),"</div>\n        </div>\n      </div>\n      "),this.on("click",this.onClick,this.id),this.setClass("checked",function(){return equals(self.data,self.value)},this.id+"-background"),this.setClass("disabled",function(){return!self.enabled},this.id+"-background"),this.setMDClasses(),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"RadioOptionTextFieldView","extends":"foam.ui.md.RadioOptionView",requires:["foam.ui.md.TextFieldView as TextFieldView"],properties:[{name:"label",defaultValue:"Other"},{name:"value",postSet:function(old,nu){equals(this.data,old)&&(this.data=nu)}}],templates:[{name:"CSS",code:ConstantTemplate(".radioLabel.input{pointer-events:all}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',self.id,'" ',this.cssClassAttr(),'>\n        <div id="',this.id,'-background" class="radiobutton-background">\n          <div class="radio-indicator">\n            <div id="onRadio"></div>\n            <div id="offRadio"></div>\n            <div id="radioContainer" class="labeled">\n              ',this.halo,'\n            </div>\n          </div>\n          <div class="radioLabel">',self.createTemplateView("label",{mode:"read-only",floatingLabel:!1}),'</div>\n          <div class="radioLabel input">\n            ',self.createTemplateView("value",{model_:"foam.ui.md.TextFieldView",inlineStyle:!0,floatingLabel:!1,onKeyMode:!0}),"\n          </div>\n        </div>\n      </div>\n      "),this.on("click",this.onClick,this.id),this.setClass("checked",function(){return equals(self.data,self.value)},this.id+"-background"),this.setClass("disabled",function(){return!self.enabled},this.id+"-background"),this.setMDClasses(),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"DateFieldView","extends":"foam.ui.SimpleView",requires:["foam.ui.md.DatePickerView","foam.ui.md.PopupView"],imports:["document"],properties:[{name:"prop"},{name:"label",defaultValueFn:function(){return this.prop.label}},{name:"mode"},{name:"floatingLabel",defaultValue:!0},{name:"className",defaultValueFn:function(){return"md-date-field md-date-field-"+("read-only"===this.mode?"read-only":"writable")}}],listeners:[{name:"onClick",code:function(){var active=this.document.activeElement;active&&active.blur(),this.PopupView.create({delegate:this.DatePickerView,cardClass:"md-card-shell",data$:this.data$}).open()}}],templates:[{name:"CSS",code:ConstantTemplate(".md-date-field.md-date-field-writable{height:64px;margin:8px;padding:32px 8px 8px 8px;position:relative}.md-date-field.md-date-field-read-only{display:inline-block}.md-date-field-body{-webkit-align-items:center;align-items:center;border-bottom:1px solid #e0e0e0;padding:8px 0;-webkit-flex-grow:1;flex-grow:1}.md-date-field-read-only .md-date-field-body{border:none;display:inline-block;padding:0}.md-date-field .md-floating-label{font-size:85%;top:12px}.md-date-field{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-align-items:baseline;align-items:baseline;-webkit-flex-grow:1;flex-grow:1}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),">\n        "),this.floatingLabel&&out('\n          <label id="',this.id,'-label" class="md-floating-label">\n            ',this.label,"\n          </label>\n        "),out('\n        <div class="md-date-field-body">\n          ',self.dynamicTag("span",function(){return this.data?this.data.toDateString():"Choose date"}.bind(this)),"\n        </div>\n      </div>\n      "),this.on("click",this.onClick,this.id),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"DatePickerView","extends":"foam.ui.SimpleView",requires:["foam.ui.md.CalendarView"],imports:["animate","gestureManager","popup","window"],exports:["MONTH_NAMES"],properties:[{name:"data",postSet:function(old,nu){this.softData=nu}},{name:"softData",factory:function(){return new Date},adapt:function(old,nu){return"string"==typeof nu?new Date(nu):nu?nu:new Date},postSet:function(old,nu){this.year=nu.getFullYear(),this.month=nu.getMonth(),this.date=nu.getDate(),this.day=nu.getDay()}},{name:"years",factory:function(){for(var years=[],i=1900;2100>=i;i++)years.push(i);return years}},{name:"year"},{name:"month"},{name:"date"},{name:"day"},{name:"viewYear",factory:function(){return this.year},postSet:function(old,nu){old!==nu&&this.reconstructCalendars()}},{name:"viewMonth",factory:function(){return this.month},postSet:function(old,nu){old!==nu&&this.reconstructCalendars()}},{name:"leftYear",getter:function(){return 11===this.leftMonth?this.viewYear-1:this.viewYear}},{name:"leftMonth",getter:function(){return Math.max(0,this.viewMonth-1)}},{name:"rightYear",getter:function(){return 0===this.rightMonth?this.viewYear+1:this.viewYear}},{name:"rightMonth",defaultValueFn:function(){var m=this.viewMonth+1;return m>11&&(m=0),m}},{name:"$slider",getter:function(){return this.X.$(this.id+"-slider")}},{name:"$inner",getter:function(){return this.X.$(this.id+"-inner")}},{name:"width",defaultValue:300},{name:"x",visibility:"hidden",hidden:!0,"transient":!0,postSet:function(old,nu){this.adjustX(nu)}},{name:"swipeGesture",factory:function(){return this.GestureTarget.create({containerID:this.id+"-body",handler:this,gesture:"horizontalScroll"})}},{name:"calendarViews_",factory:function(){return[]}},{model_:"BooleanProperty",name:"showYears_",type:"Boolean",defaultValue:!1},{name:"className",defaultValue:"date-picker"}],actions:[{name:"cancel",label:"CANCEL",code:function(){this.popup.close()}},{name:"ok",label:"OK",code:function(){this.data=this.softData,this.popup.close()}},{name:"left",label:"<",code:function(){this.snapToView(-1)}},{name:"right",label:">",code:function(){this.snapToView(1)}}],constants:[{name:"DAY_NAMES",value:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},{name:"MONTH_NAMES",value:["January","February","March","April","May","June","July","August","September","October","November","December"]}],methods:[function init(args){this.SUPER(args),this.gestureManager.install(this.swipeGesture)},function snapToView(adj){var month=this.viewMonth,year=this.viewYear,targetX=this.width;0>adj?(month--,0>month&&(month=11,year--),targetX=0):adj>0&&(month++,month>11&&(month=0,year++),targetX=2*this.width);var time=300*(Math.abs(targetX-this.x)/this.width),self=this;this.animate(time,function(evt){self.x=targetX},Movement.ease(.8,.4),function(){self.viewYear=year,self.viewMonth=month})()},function rawAdjustX(x){var str="translate3d(-"+x+"px, 0, 0)",e=this.$slider;e.style.transform=e.style["-webkit-transform"]=str}],listeners:[{name:"adjustX",code:function(){this.rawAdjustX(this.x)},isFramed:!0},{name:"horizontalScrollMove",code:function(dx,tx){var x=this.width-tx;0>x&&(x=0),x>2*this.width&&(x=2*this.width),this.x=x}},{name:"horizontalScrollEnd",code:function(dx,tx,x){var adj=0;Math.abs(tx)>this.width/3&&(adj=tx>0?-1:1),this.snapToView(adj)}},{name:"reconstructCalendars",code:function(){for(var newCals=[this.CalendarView.create({data$:this.softData$,year:this.leftYear,month:this.leftMonth}),this.CalendarView.create({data$:this.softData$,year:this.viewYear,month:this.viewMonth}),this.CalendarView.create({data$:this.softData$,year:this.rightYear,month:this.rightMonth})],i=0;3>i;i++)this.calendarViews_[i]&&this.calendarViews_[i].destroy(),this.calendarViews_[i]=newCals[i];for(this.$inner.innerHTML="",this.x=this.width,this.rawAdjustX(this.width),i=0;3>i;i++)this.$inner.insertAdjacentHTML("beforeend",newCals[i].toHTML()),newCals[i].initHTML()},isFramed:!0},{name:"headerClick",code:function(){this.showYears_=!this.showYears_,this.showYears_&&this.scrollToYear()},isFramed:!0},{name:"scrollToYear",code:function(){var targetYear=Math.max(1900,this.viewYear-3),e=this.X.$(this.id+"-year-"+targetYear);e&&e.scrollIntoView()},isFramed:!0},{name:"pickYear",code:function(year){this.year=this.viewYear=year,this.softData=new Date(this.year,this.month,this.date,this.softData.getHours(),this.softData.getMinutes()),this.showYears_=!1}}],templates:[{name:"CSS",code:ConstantTemplate(".hidden{display:none !important}.date-picker{cursor:pointer}.date-picker-header{background-color:#3e50b4;color:#fff;font-size:16px;padding:12px 16px}.date-picker-header div{opacity:0.8}.date-picker-header div.selected{opacity:1}.date-picker-header-year{margin:8px 0}.date-picker-header-date{font-size:24px;font-weight:bolder}.date-picker-body{height:310px;overflow:hidden;position:relative;-webkit-user-select:none;-webkit-user-select:none;user-select:none;width:300px}.date-picker-slider{position:absolute;height:100%;top:0;width:900px}.date-picker-slider-inner{display:-webkit-flex;display:flex;height:100%;position:relative;width:100%}.date-picker-buttons{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;-webkit-justify-content:flex-end;justify-content:flex-end}.date-picker-switcher{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;height:48px;position:absolute;z-index:3}.date-picker-switcher-left{left:0}.date-picker-switcher-right{right:0}.date-picker-years{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;height:310px;overflow-y:scroll;width:300px}.date-picker-years-year{-webkit-flex-shrink:0;flex-shrink:0;padding:16px}.date-picker-years-year.selected{color:#3e50b4;font-size:24px;font-weight:bold}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out('\n      <div id="',this.id,'" ',this.cssClassAttr(),'>\n        <div id="',this.id,'-header" class="date-picker-header">\n          <div id="',this.id,'-header-year" class="date-picker-header-year">\n            ',self.dynamicTag("span",function(){return this.year}.bind(this)),'\n          </div>\n          <div id="',this.id,'-header-date" class="date-picker-header-date">\n            ',self.dynamicTag("span",function(){return this.DAY_NAMES[this.day]+", "+this.MONTH_NAMES[this.month]+" "+this.date}.bind(this)),"\n          </div>\n          "),this.setClass("selected",function(){return self.showYears_},this.id+"-header-year"),out("\n          "),this.setClass("selected",function(){return!self.showYears_},this.id+"-header-date"),out("\n        </div>\n        "),this.on("click",this.headerClick,this.id+"-header"),out('\n        <div id="',this.id,'-body" class="date-picker-body">\n          <span class="date-picker-switcher date-picker-switcher-left">\n            ',self.createTemplateView("left",{model_:"foam.ui.md.FlatButton",color:"#000"}),'\n          </span>\n          <span class="date-picker-switcher date-picker-switcher-right">\n            ',self.createTemplateView("right",{model_:"foam.ui.md.FlatButton",color:"#000"}),'\n          </span>\n          <div id="',this.id,'-slider" class="date-picker-slider">\n            <div id="',this.id,'-inner" class="date-picker-slider-inner">\n            </div>\n          </div>\n        </div>\n        <div id="',this.id,'-years" class="date-picker-years">\n          ');for(var i=1900;2100>=i;i++)out('\n            <span id="',this.id,"-year-",i,'" class="date-picker-years-year">',i,"</span>\n            "),this.setClass("selected",function(i){return self.viewYear===i}.bind(this,i),this.id+"-year-"+i),out("\n            "),this.on("click",this.pickYear.bind(this,i),this.id+"-year-"+i),out("\n          ");return out("\n        </div>\n        "),this.setClass("hidden",function(){return self.showYears_},this.id+"-body"),this.setClass("hidden",function(){return!self.showYears_},this.id+"-years"),out('\n        <div class="date-picker-buttons">\n          ',self.createTemplateView("cancel",{model_:"foam.ui.md.FlatButton"}),"\n          ",self.createTemplateView("ok",{model_:"foam.ui.md.FlatButton"}),"\n        </div>\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"CalendarView","extends":"foam.ui.View",imports:["MONTH_NAMES","document"],properties:[{name:"data",adapt:function(old,nu){return"string"==typeof nu?new Date(nu):nu}},{name:"day",defaultValueFn:function(){return this.data&&this.data.getDate()}},{name:"month",defaultValueFn:function(){return this.data.getMonth()}},{name:"year",defaultValueFn:function(){return this.data.getFullYear()}},{name:"hour",defaultValueFn:function(){return this.data.getHours()}},{name:"minute",defaultValueFn:function(){return this.data.getMinutes()}},{name:"className",defaultValue:"calendar"},{name:"preferredWidth",defaultValue:300}],methods:[function isToday(day){var today=new Date;return this.month===today.getMonth()&&this.year===today.getFullYear()&&day===today.getDate()},function isSelected(day){return this.data?this.month===this.data.getMonth()&&this.year===this.data.getFullYear()&&day===this.data.getDate():!1}],listeners:[{name:"onClick",code:function(e){var point=e.pointMap[Object.keys(e.pointMap)[0]],element=this.document.elementFromPoint(point.x,point.y);if(element&&"TD"===element.tagName){var newDay=element.innerText;this.data=new Date(this.year,this.month,newDay,this.hour,this.minute)}}}],templates:[{name:"CSS",code:ConstantTemplate(".calendar{height:310px;width:300px}.calendar-heading{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;font-size:14px;height:48px;-webkit-justify-content:center;justify-content:center}.calendar-body{display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center}.calendar-table{font-size:12px}.calendar-table th{color:#999;font-weight:normal;text-align:center}.calendar-table td{height:40px;text-align:center;width:38px}.calendar-selected{background-color:#4285f4;border-radius:50%;color:#fff}.calendar-today{color:#4285f4;font-weight:bolder}"),language:"css"},{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out('\n      <div class="calendar-heading">\n        <span class="calendar-heading-month">\n          ',this.MONTH_NAMES[this.month]," ",this.year,'\n        </span>\n      </div>\n\n      <div class="calendar-body">\n        <table id="',this.id,'-table" class="calendar-table">\n          <tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr>\n          ');for(var firstDay=new Date(this.year,this.month,1).getDay(),row=0;6>row;row++){out(" <tr> ");for(var col=0;7>col;col++)if(0===row&&firstDay>col)out(" <td></td> ");else{var day=7*row+(col-firstDay)+1,testDate=new Date(this.year,this.month,day,this.hour,this.minute);if(testDate.getMonth()!=this.month)out(" <td></td> ");else{var css=this.isSelected(day)?"calendar-selected":this.isToday(day)?"calendar-today":"";out(" <td ",css?'class="'+css+'"':"",">\n                      ",day,"\n                    </td> ")}}out(" </tr> ")}return out("\n        </table>\n        "),this.on("click",this.onClick,this.id+"-table"),out("\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"PopupView","extends":"foam.ui.SimpleView",requires:["foam.input.touch.GestureTarget"],imports:["clearTimeout","gestureManager","setTimeout","document"],exports:["as popup"],properties:[{model_:"ViewFactoryProperty",name:"delegate",type:"ViewFactory"},{name:"delegateView",defaultValue:null},{name:"$content",getter:function(){return this.document.getElementById(this.id+"Content")}},{name:"$blocker",getter:function(){return this.document.getElementById(this.id+"Blocker")}},{name:"cardClass",defaultValue:"md-card"},{name:"className",defaultValue:"popup-view-container"},{model_:"foam.core.types.StringEnumProperty",name:"layoutMode",defaultValue:"fixed",choices:[["fixed","Fixed"],["relative","Relative"]]},{model_:"foam.core.types.StringEnumProperty",name:"layoutPosition",defaultValue:"center",choices:[["center","Center"],["top","Top"],["bottom","Bottom"]]},{model_:"foam.core.types.StringEnumProperty",name:"blockerMode",defaultValue:"cancellable",choices:[["cancellable","Cancellable"],["modal","Modal"]]},{name:"state",defaultValue:"closed"},{name:"latch_"},{name:"latchState_"},{name:"width",help:"If set, specifies the CSS width of the content container."},{name:"height",help:"If set, specifies the CSS height of the content container."},{model_:"IntProperty",name:"dragHandleHeight",type:"Int",help:function(){},defaultValue:0},{name:"animationStrategy",lazyFactory:function(){return this.FADE},adapt:function(old,nu){return old===nu?nu:("string"==typeof nu&&this[nu.toUpperCase()]&&(nu=this[nu.toUpperCase()]),nu&&nu.animateToHidden&&nu.animateToOpen?nu:this.FADE)},help:"A strategy that implements animateToHidden() and animateToOpen()"},{model_:"BooleanProperty",name:"gestureTargetsInstalled_",type:"Boolean",help:"Track whether gesture targets are installed to avoid duplication.",defaultValue:!1}],constants:[{name:"TRANSITION_DURATION",value:.3},{name:"CANCEL",value:"cancel"},{name:"FADE",value:{animateToHidden:function(){this.$content&&(this.setTransition(this.$content,"opacity","cubic-bezier(0.4, 0.0, 1, 1) "+this.TRANSITION_DURATION+"s"),this.$content.style.opacity="0",this.$content.style.pointerEvents="none",this.setLatch("closed")),this.$blocker&&(this.setTransition(this.$blocker,"opacity","cubic-bezier(0.4, 0.0, 1, 1) "+this.TRANSITION_DURATION+"s","0"),this.$blocker.style.pointerEvents="none"),this.setLatch("closed",function(){this.destroy()}.bind(this))},animateToOpen:function(){this.setTransition(this.$content,"opacity","cubic-bezier(0.0, 0.0, 0.2, 1) "+this.TRANSITION_DURATION+"s"),this.$content.style.opacity="1",this.setTransition(this.$blocker,"opacity","cubic-bezier(0.0, 0.0, 0.2, 1) "+this.TRANSITION_DURATION+"s","0.4"),this.setLatch("open")}}},{name:"BOTTOM",value:{animateToHidden:function(opt_transitionTime){var transitionTime=opt_transitionTime||this.TRANSITION_DURATION;this.$content&&(this.setTransition(this.$content,"top","cubic-bezier(0.4, 0.0, 1, 1) "+transitionTime+"s","100%"),this.$content.style.pointerEvents="none"),this.$blocker&&(this.setTransition(this.$blocker,"opacity","cubic-bezier(0.4, 0.0, 1, 1) "+transitionTime+"s","0"),this.$blocker.style.pointerEvents="none"),this.setLatch("closed",function(){this.destroy()}.bind(this))},animateToOpen:function(opt_transitionTime){var transitionTime=opt_transitionTime||this.TRANSITION_DURATION;this.$content.style.position="absolute",this.$content.style.top="100%",this.$content.style.left="0",this.$content.style.width="100%",this.$content.style.height="50%",this.$content.style.opacity="1",this.setTransition(this.$content,"top","cubic-bezier(0.4, 0.0, 1, 1) "+transitionTime+"s","50%"),this.setTransition(this.$blocker,"opacity","cubic-bezier(0.0, 0.0, 0.2, 1) "+transitionTime+"s","0.4"),this.setLatch("open")},animateToExpanded:function(opt_transitionTime){var transitionTime=opt_transitionTime||this.TRANSITION_DURATION;this.$content.style.height="100%",this.setTransition(this.$content,"top","cubic-bezier(0.4, 0.0, 1, 1) "+transitionTime+"s","0"),this.setLatch("expanded")},animateToCollapsed:function(opt_transitionTime){var transitionTime=opt_transitionTime||this.TRANSITION_DURATION;this.setTransition(this.$content,"top","cubic-bezier(0.4, 0.0, 1, 1) "+transitionTime+"s","50%"),this.setLatch("open",function(){this.$content.style.height="50%"}.bind(this))},dragStart:function(point){var self=this.animationStrategy;if(!self.dragging_){var contentRect=this.$content.getBoundingClientRect();if(!(point.y0<contentRect.top||point.y0>contentRect.top+this.dragHandleHeight)){var parentRect=this.$.getBoundingClientRect(),delta=parentRect.top+point.y0-contentRect.top;this.setTransition(this.$content,"top"),this.$content.style.height="100%",self.onDrag=function(){this.$content.style.top=point.y-delta}.bind(this),point.y$.addListener(self.onDrag),self.onDrag(),self.dragging_=!0}}},dragEnd:function(point){var self=this.animationStrategy;if(self.dragging_){point.y$.removeListener(self.onDrag),self.onDrag=nop;var parentRect=this.$.getBoundingClientRect(),contentRect=this.$content.getBoundingClientRect(),bounds=self.bounds[this.state];if(bounds){var transitionTime;if(bounds[0](contentRect,parentRect))transitionTime=this.TRANSITION_DURTION*((contentRect.top-parentRect.top)/parentRect.height),this.expand(transitionTime);else if(bounds[1](contentRect,parentRect)){var halfSize=parentRect.height/2;transitionTime=this.TRANSITION_DURTION*(Math.abs(contentRect.top-parentRect.top-halfSize)/halfSize),this.collapse(transitionTime)}else transitionTime=this.TRANSITION_DURTION*(1-(contentRect.top-parentRect.top)/parentRect.height),this.close(transitionTime);self.dragging_=!1}}},onDrag:function nop(){},dragging_:!1,bounds:{open:[function(contentRect,parentRect){return contentRect.top<=parentRect.top+2*parentRect.height/5},function(contentRect,parentRect){return contentRect.top<=parentRect.top+3*parentRect.height/5}],expanded:[function(contentRect,parentRect){return contentRect.top<=parentRect.top+parentRect.height/10},function(contentRect,parentRect){return contentRect.top<=parentRect.top+2*parentRect.height/10}]}}}],methods:[function open(sourceElement){if(this.latch(),"closed"==this.state){this.delegateView=this.delegate({data$:this.data$},this.Y),this.layoutMode=sourceElement?"relative":"fixed",this.$&&(this.$.outerHTML="");var parentElement=sourceElement||this.document.body;parentElement.insertAdjacentHTML("beforeend",this.toHTML()),this.initializePosition(),this.setTimeout(function(){this.animateToOpen()}.bind(this),100),this.initHTML(),this.state="opening"}},function expandOrCollapse(opt_transitionTime){"open"===this.state?this.expand(opt_transitionTime):"expanded"===this.state&&this.collapse(opt_transitionTime)},function expand(opt_transitionTime){this.latch(),this.setTimeout(function(){this.animateToExpanded(opt_transitionTime)}.bind(this),100),this.state="expanding"},function collapse(opt_transitionTime){this.latch(),this.setTimeout(function(){this.animateToCollapsed(opt_transitionTime)}.bind(this),100),this.state="collapsing"},function initializePosition(){this.$content.style.zIndex="1010",this.$content.style.opacity=this.$blocker.style.opacity="0",this.width&&(this.$content.style.width=this.width),this.height&&(this.$content.style.height=this.height)},function animateToOpen(opt_transitionTime){this.animationStrategy.animateToOpen.call(this,opt_transitionTime),this.isHidden=!1},function animateToExpanded(opt_transitionTime){this.animationStrategy.animateToExpanded&&this.animationStrategy.animateToExpanded.call(this,opt_transitionTime)},function animateToCollapsed(opt_transitionTime){this.animationStrategy.animateToCollapsed&&this.animationStrategy.animateToCollapsed.call(this,opt_transitionTime)},function animateToHidden(opt_transitionTime){this.isHidden=!0,this.animationStrategy.animateToHidden.call(this,opt_transitionTime)},function close(opt_transitionTime){this.latch(),this.state="closing",this.animateToHidden(opt_transitionTime)},function destroy(p){this.$&&(this.$.outerHTML=""),this.delegateView=null,this.state="closed",this.SUPER(p)},function setTransition(e,prop,transition,value){e.style.transition=transition?prop+" "+transition:"",e.offsetLeft=e.offsetLeft,value&&(e.style[prop]=value);var listener=function(evt){evt.propertyName===prop&&(this.latch(),e.removeEventListener("transitionend",listener))}.bind(this);e.addEventListener("transitionend",listener)},function setLatch(state,opt_f){this.latch_=opt_f||"",this.latchState_=state},function latch(){this.latch_&&this.latch_(),this.latchState_&&(this.state=this.latchState_),this.latchState_=this.latch_=""},function initHTML(){this.SUPER(),this.gestureManager&&!this.gestureTargetsInstalled_&&(this.gestureManager.install(this.GestureTarget.create({containerID:this.id,handler:this,gesture:"drag"})),this.gestureTargetsInstalled_=!0)}],listeners:[{name:"dragStart",code:function(point){this.animationStrategy.dragStart&&this.animationStrategy.dragStart.call(this,point)}},{name:"dragEnd",code:function(point){this.animationStrategy.dragEnd&&this.animationStrategy.dragEnd.call(this,point)}}],templates:[{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      "),this.delegateView&&(out('\n        <div id="',this.id,"Blocker\" class='popup-view-modal-blocker'></div>\n        "),this.on("click",function(){"cancellable"===this.blockerMode&&(self.close(),self.publish(self.CANCEL))},this.id+"Blocker"),out('\n        <div id="',this.id,"Content\" class='md-popup-view-content ",this.cardClass,"'>\n          ",self.delegateView,"\n        </div>\n        "),this.setClass("center",function(){return"center"===this.layoutPosition},this.id),this.setClass("top",function(){return"top"===this.layoutPosition},this.id),this.setClass("bottom",function(){return"bottom"===this.layoutPosition},this.id),this.setClass("fixed",function(){return"fixed"===this.layoutMode},this.id),this.setClass("relative",function(){return"relative"===this.layoutMode},this.id)),out("\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate(".fixed .popup-view-modal-blocker, .fixed.popup-view-container{position:fixed}.relative .popup-view-modal-blocker, .relative.popup-view-container{position:absolute}.popup-view-modal-blocker{top:0px;left:0px;bottom:0px;right:0px;background:black;opacity:0}.popup-view-container{display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;top:0px;left:0px;bottom:0px;right:0px;z-index:1000}.popup-view-container.center{-webkit-align-items:center;align-items:center}.popup-view-container.bottom{-webkit-align-items:flex-end;align-items:flex-end;margin-bottom:5%;max-height:90%}.popup-view-container.top{-webkit-align-items:flex-start;align-items:flex-start;margin-top:5%;max-height:90%}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"DateTimeFieldView","extends":"foam.ui.md.DateFieldView",requires:["foam.ui.md.TimePickerView"],listeners:[{name:"onTimeClick",code:function(){var active=this.document.activeElement;active&&active.blur(),this.PopupView.create({delegate:this.TimePickerView,cardClass:"md-card-shell",data$:this.data$}).open()}}],templates:[{name:"CSS",code:ConstantTemplate(""),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),">\n        "),this.floatingLabel&&out('\n          <label id="',this.id,'-label" class="md-floating-label">\n            ',this.label,"\n          </label>\n        "),out('\n        <div id="',this.id,'-date" class="md-date-field-body">\n          ',self.dynamicTag("span",function(){return this.data?this.data.toDateString():"Choose date"}.bind(this)),'\n        </div>\n        <div id="',this.id,'-time" class="md-date-field-body">\n          ',self.dynamicTag("span",function(){return this.data?this.data.toTimeString():"Choose time"}.bind(this)),"\n        </div>\n      </div>\n      "),this.on("click",this.onClick,this.id+"-date"),out("\n      "),this.on("click",this.onTimeClick,this.id+"-time"),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"TimePickerView","extends":"foam.ui.SimpleView",imports:["dynamicFn","gestureManager","popup"],properties:[{name:"data",postSet:function(old,nu){if(nu){var h=nu.getHours();12>h?(this.amPM="AM",this.hours=0===h?12:h):(this.amPM="PM",this.hours=12===h?12:h-12);var m=nu.getMinutes();this.minutes=10>m?"0"+m:m}}},{name:"hours",defaultValue:12},{name:"minutes",defaultValue:"00"},{name:"amPM",defaultValue:"AM"},{name:"showHours",defaultValue:!0},{name:"$hand",getter:function(){return this.X.$(this.id+"-hand")}},{name:"$face"},{name:"rotation",postSet:function(old,nu){this.$hand&&(this.$hand.style.transform="rotate("+nu+"deg)")}},{name:"className",defaultValue:"time-picker"},{name:"dragListener_"}],actions:[{name:"ok",code:function(){var d=this.data?new Date(this.data):new Date;d.setSeconds(0);var h=12===this.hours?0:this.hours;"PM"===this.amPM&&(h+=12),d.setHours(h),d.setMinutes(+this.minutes),this.popup.close(),this.data=d}},{name:"cancel",code:function(){this.popup.close()}}],methods:[function init(){this.SUPER(),this.dynamicFn(function(){this.hours,this.minutes,this.showHours}.bind(this),function(){this.rotation=this.showHours?30*this.hours:6*this.minutes}.bind(this))},function hourClick(i){this.hours=0===i?12:i,this.showHours=!1},function minuteClick(i){this.minutes=10>i?"0"+i:i},function initHTML(){this.SUPER(),this.rotation=this.rotation,this.$face=this.X.$(this.id+"-face");var gesture=this.GestureTarget.create({gesture:"drag",containerID:this.id+"-face",handler:this});this.gestureManager.install(gesture),this.addDestructor(function(){this.gestureManager.uninstall(gesture),this.dragListener_&&(this.dragListener_.destroy(),this.dragListener_="")}.bind(this))}],listeners:[{name:"dragStart",code:function(p){this.dragListener_=this.dynamicFn(function(){p.x,p.y},this.dragMove.bind(this,p))}},{name:"dragEnd",code:function(){this.dragListener_.destroy(),this.dragListener_="",this.showHours&&(this.showHours=!1)}},{name:"dragMove",code:function(p){var tx=p.x-this.$face.offsetLeft,ty=p.y-this.$face.offsetTop,dx=tx-135,dy=135-ty,d=Math.sqrt(dx*dx+dy*dy);if(d>=90&&135>=d){var angleRadCCW3=Math.atan2(dy,dx),angleDegCCW3=360*(angleRadCCW3/(2*Math.PI)),angleDegCW12=90-angleDegCCW3;if(0>angleDegCW12&&(angleDegCW12+=360),this.showHours){var snapped=Math.round(angleDegCW12/30);this.hours=0===snapped?12:snapped}else{var snapped=Math.round(angleDegCW12/6);60===snapped&&(snapped=0),10>snapped&&(snapped="0"+snapped),this.minutes=snapped}}}}],templates:[{name:"CSS",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n.time-picker {\ncursor: pointer;\ndisplay: flex;\nflex-direction: column;\nheight: 450px;\nuser-select: none;\nwidth: 300px;\n}\n.time-picker-header {\nalign-items: center;\nbackground-color: #3e50b4;\ncolor: #fff;\ndisplay: flex;\nflex-shrink: 0;\nfont-size: 56px;\nheight: 80px;\njustify-content: flex-end;\n}\n.time-picker-header-time-part {\nmargin: 0 4px;\nopacity: 0.76;\n}\n.time-picker-header-time-part.time-picker-highlight {\nopacity: 1;\n}\n.time-picker-header-colon {\nopacity: 0.76;\n}\n.time-picker-half-day {\ndisplay: flex;\nflex-direction: column;\nfont-size: 20px;\nmargin: 0 24px 0 18px;\n}\n.time-picker-half-day-part {\nfont-weight: 500;\nopacity: 0.76;\n}\n.time-picker-half-day-part.time-picker-highlight {\nopacity: 1;\n}\n\n.time-picker-body {\ndisplay: flex;\nflex-direction: column;\nflex-grow: 1;\n}\n.time-picker-face {\nalign-self: center;\nbackground-color: #e0e0e0;\nborder-radius: 50%;\nheight: 270px;\nmargin: 20px 0;\nposition: relative;\nwidth: 270px;\n}\n\n.time-picker-body-number {\nalign-items: center;\ncolor: #000;\ndisplay: flex;\nfont-size: 16px;\nheight: 20px;\njustify-content: space-around;\nposition: absolute;\nwidth: 20px;\nz-index: 20;\n}\n");for(var leftOffset=10,topOffset=10,outerRadius=135,innerRadius=112,angles=[90,60,30,0,330,300,270,240,210,180,150,120],i=0;12>i;i++){var angleDeg=angles[i],angleRad=angleDeg/360*2*Math.PI,y=Math.sin(angleRad)*innerRadius,x=Math.cos(angleRad)*innerRadius,top=outerRadius-y-topOffset,left=outerRadius+x-leftOffset;
out(" .time-picker-body-number-",i," {\ntop: ",top,"px;\nleft: ",left,"px;\n}\n")}return out("\n\n.time-picker-hand {\nposition: absolute;\nleft: 0;\ntop: 0;\nheight: 100%;\nwidth: 100%;\nz-index: 10;\n}\n.time-picker-hand-inner {\nposition: relative;\nheight: 100%;\nwidth: 100%;\n}\n.time-picker-hand-end {\nbackground-color: #7baaf7;\nborder-radius: 50%;\nheight: 40px;\nleft: 115px;\nposition: absolute;\ntop: 3px;\nwidth: 40px;\n}\n.time-picker-hand-arm {\nbackground-color: #7baaf7;\nheight: 95px;\nleft: 134px;\nposition: absolute;\ntop: 43px;\nwidth: 2px;\n}\n.time-picker-hand-center {\nbackground-color: #4285f4;\nborder-radius: 50%;\nheight: 6px;\nleft: 132px;\nposition: absolute;\ntop: 132px;\nwidth: 6px;\n}\n\n.time-picker-buttons {\ndisplay: flex;\njustify-content: flex-end;\n}\n\n.hidden {\ndisplay: none;\n}\n"),X.foam.grammars.CSSDecl.create({model:this.model_}).parser.parseString(out.toString())},language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out('\n      <div id="',self.id,'" ',self.cssClassAttr(),'>\n        <div class="time-picker-header">\n          <span id="',self.id,'-hours" class="time-picker-header-time-part">\n            ',self.dynamicTag("span",function(){return this.hours}.bind(this)),'\n          </span>\n          <span class="time-picker-header-colon">:</span>\n          <span id="',self.id,'-minutes" class="time-picker-header-time-part">\n            ',self.dynamicTag("span",function(){return this.minutes}.bind(this)),'\n          </span>\n          <div class="time-picker-half-day">\n            <span id="',self.id,'-am" class="time-picker-half-day-part">AM</span>\n            <span id="',self.id,'-pm" class="time-picker-half-day-part">PM</span>\n          </div>\n          '),this.on("click",function(){self.showHours=!0},this.id+"-hours"),this.on("click",function(){self.showHours=!1},this.id+"-minutes"),this.on("click",function(){self.amPM="AM"},this.id+"-am"),this.on("click",function(){self.amPM="PM"},this.id+"-pm"),this.setClass("time-picker-highlight",function(){return self.showHours},this.id+"-hours"),this.setClass("time-picker-highlight",function(){return!self.showHours},this.id+"-minutes"),this.setClass("time-picker-highlight",function(){return"AM"===self.amPM},this.id+"-am"),this.setClass("time-picker-highlight",function(){return"PM"===self.amPM},this.id+"-pm"),out('\n        </div>\n        <div class="time-picker-body">\n          <div id="',self.id,'-face" class="time-picker-face">\n            <div id="',self.id,'-body-hours" class="time-picker-body-hours">\n              ');var hours=[12,1,2,3,4,5,6,7,8,9,10,11];out("\n              ");for(var i=0;12>i;i++)out('\n                <span id="',self.id,"-hour-",i,'" class="time-picker-body-number\n                    time-picker-body-number-',i,'">\n                  ',hours[i],"\n                </span>\n                "),this.on("click",this.hourClick.bind(this,i),this.id+"-hour-"+i),out("\n              ");out('\n            </div>\n            <div id="',self.id,'-body-minutes" class="time-picker-body-hours">\n              ');var minutes=["00","05","10","15","20","25","30","35","40","45","50","55"];out("\n              ");for(var i=0;12>i;i++)out('\n                <span id="',self.id,"-minute-",i,'" class="time-picker-body-number\n                    time-picker-body-number-',i,'">\n                  ',minutes[i],"\n                </span>\n                "),this.on("click",this.minuteClick.bind(this,5*i),this.id+"-minute-"+i),out("\n              ");return out('\n            </div>\n            <div id="',self.id,'-hand" class="time-picker-hand">\n              <div class="time-picker-hand-inner">\n                <div class="time-picker-hand-end"></div>\n                <div class="time-picker-hand-arm"></div>\n                <div class="time-picker-hand-center"></div>\n              </div>\n            </div>\n            '),this.setClass("hidden",function(){return!self.showHours},this.id+"-body-hours"),this.setClass("hidden",function(){return self.showHours},this.id+"-body-minutes"),out('\n          </div>\n          <div class="time-picker-buttons">\n            ',self.createTemplateView("cancel"),"\n            ",self.createTemplateView("ok"),"\n          </div>\n        </div>\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"ColorFieldView","extends":"foam.ui.md.TextFieldView",properties:[{name:"type",defaultValue:"color"},{name:"underline",defaultValue:!1},{name:"choices"},{name:"updateMode",defaultValue:"EACH_KEYSTROKE"}],listeners:[{name:"onKeyPress",code:function(e){e.stopPropagation()}}],templates:[{name:"CSS",code:ConstantTemplate('.md-text-field-input[type="color"]{max-width:250px;height:32px}'),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n      ");var input=this.inputId=this.nextID(),label=this.labelId=this.nextID();if(this.floatingLabel?this.setClass("md-text-field-label-offset",function(){var focused=self.focused,data=self.data;return focused||(""+data).length>0},label):this.setClass("md-text-field-no-label",function(){return!0},this.id),this.setClass("disabled",function(){return"read-only"==self.mode},this.id),this.on("keypress",this.onKeyPress,input),this.setMDClasses(),out("\n      <div ",this.cssClassAttr(),' id="',self.id,'">\n        '),this.floatingLabel&&out('\n          <label id="',label,'" class="md-text-field-label">',self.label,"</label>\n        "),out('\n        <input\n          id="',input,'"\n          type="',self.type,'"\n          class="md-text-field-input md-text-field-borderless"\n          '),this.choices&&out(' list="',input,'list" '),out("\n        /> ",self.createTemplateView("data",{model_:"foam.ui.TextFieldView",mode:"read-only",floatingLabel:!1}),"\n        "),this.choices){out('\n          <datalist id="',input,'list">\n          ');for(var i=0;i<this.choices.length;i++)out("\n            <option>",this.choices[i],"</option>\n          ");out("\n          </datalist>\n        ")}return out("\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"ImagePickerView","extends":"foam.ui.SimpleView",traits:["foam.ui.md.MDStyleTrait"],properties:[{name:"tagName",defaultValue:"image-picker"},{name:"data"},{name:"$input",getter:function(){return this.X.$(this.inputId)}},{name:"inputId",getter:function(){return this.id+"-input"}},{name:"hintText",defaultValue:"Click to select an image or Drag & drop an image file here"},{name:"mode",defaultValue:"read-write"},{name:"useCamera",defaultValue:!1}],methods:[function loadFile(files){if(files.length){var fr=new FileReader;fr.onload=this.setDataBuffer,fr.readAsDataURL(files[0])}}],listeners:[{name:"setDataBuffer",code:function(e){var buf=e.target.result;this.data=buf}},{name:"inputClick",code:function(e){this.$input&&this.$input.click(),e.preventDefault()}},{name:"squelchEvent",code:function(e){e.stopPropagation(),e.preventDefault()}},{name:"inputDrop",code:function(e){e.stopPropagation(),e.preventDefault(),this.loadFile(e.dataTransfer.files)}},{name:"inputFileChange",code:function(){this.loadFile(this.$input.files)}}],templates:[{name:"CSS",code:ConstantTemplate("image-picker{position:relative;min-height:100px;min-width:200px;border:2px dashed;padding:5px;display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;overflow:hidden}image-picker .content{padding:8px;margin:8px;-webkit-flex-grow:0;flex-grow:0;background:rgba(0, 0, 0, 0.5);color:white;z-index:1}image-picker .image-picker-preview{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      "),"read-only"==this.mode?out("\n        ",self.createTemplateView("data",{model_:"foam.ui.ImageView"}),"\n      "):(out("\n        <image-picker ",this.cssClassAttr(),' id="',self.id,'">\n          ',self.createTemplateView("data",{model_:"foam.ui.ImageView",extraClassName:"image-picker-preview"}),'\n          <div class="content">\n            ',self.createTemplateView("hintText",{mode:"read-only",floatingLabel:!1}),'\n          </div>\n          <input type="file" id="',self.inputId,'" accept="image/*" style="display:none"\n          '),this.useCamera&&out('capture="camera" '),out(" >\n        </image-picker>\n        "),this.on("change",this.inputFileChange,this.inputId),this.on("click",this.inputClick,this.id),this.on("dragenter",this.squelchEvent,this.id),this.on("dragover",this.squelchEvent,this.id),this.on("drop",this.inputDrop,this.id),this.setMDClasses()),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"DetailView","extends":"foam.ui.View",requires:["Property","foam.ui.TextFieldView","foam.ui.IntFieldView","foam.ui.FloatFieldView","foam.ui.DAOController"],exports:["propertyViewProperty"],properties:[{name:"className",defaultValue:"detailView"},{name:"data",preSet:function(old,nu){return nu.model_&&(this.model=nu.model_),nu}},{name:"model",postSet:function(_,model){console.assert(Model.isInstance(model),"Invalid model specified for "+this.name_)}},{name:"title",defaultValueFn:function(){return this.model.label}},{model_:"StringProperty",name:"mode",type:"String",defaultValue:"read-write"},{model_:"BooleanProperty",name:"showRelationships",type:"Boolean",defaultValue:!1},{name:"propertyViewProperty",type:"Property",defaultValueFn:function(){return this.Property.DETAIL_VIEW}}],methods:[function shouldDestroy(old,nu){return old&&old.model_&&nu&&nu.model_?old.model_!==nu.model_:!0},function generateContent(){this.$&&(this.$.outerHTML=this.toHTML(),this.initHTML())},function titleHTML(){var title=this.title;return title?'<tr><td colspan="2" class="heading">'+title+"</td></tr>":""},function startForm(){return"<table>"},function endForm(){return"</table>"},function startColumns(){return"<tr><td colspan=2><table valign=top><tr><td valign=top><table>"},function nextColumn(){return"</table></td><td valign=top><table valign=top>"},function endColumns(){return"</table></td></tr></table></td></tr>"},function rowToHTML(prop,view){var str="";return prop.detailViewPreRow&&(str+=prop.detailViewPreRow(this)),str+='<tr class="detail-'+prop.name+'">',this.DAOController.isInstance(view)?(str+="<td colspan=2><div class=detailArrayLabel>"+prop.label+"</div>",str+=view.toHTML(),str+="</td>"):(str+="<td class='label'>"+prop.label+"</td>",str+="<td>",str+=view.toHTML(),str+="</td>"),str+="</tr>",prop.detailViewPostRow&&(str+=prop.detailViewPostRow(this)),str},function toHTML(){if(!this.data)return'<span id="'+this.id+'"></span>';if(!this.model)throw"DetailView: either 'data' or 'model' must be specified.";return(this.model.getPrototype().toDetailHTML||this.defaultToHTML).call(this)},function getDefaultProperties(){return this.model.getRuntimeProperties()},function defaultToHTML(){this.children=[];var model=this.model,str="";str+='<div id="'+this.id+'" '+this.cssClassAttr()+'" name="form">',str+=this.startForm(),str+=this.titleHTML();for(var properties=this.getDefaultProperties(),i=0;i<properties.length;i++){var prop=properties[i];if(!prop.hidden){var view=this.createView(prop);this.addDataChild(view),str+=this.rowToHTML(prop,view)}}if(str+=this.endForm(),this.showRelationships){var view=this.X.lookup("foam.ui.RelationshipsView").create({data:this.data});this.addDataChild(view),str+=view.toHTML()}return str+="</div>"}],templates:[{name:"CSS",code:ConstantTemplate(".detailView{border:solid 2px #dddddd;background:#fafafa;display:table}.detailView .heading{color:black;float:left;font-size:16px;margin-bottom:8px;padding:2px}.detailView .propertyLabel{font-size:14px;display:block;font-weight:bold;text-align:right;float:left}.detailView input{font-size:12px;padding:4px 2px;border:solid 1px #aacfe4;margin:2px 0 0px 10px}.detailView textarea{float:left;font-size:12px;padding:4px 2px;border:solid 1px #aacfe4;margin:2px 0 0px 10px;width:98%;overflow:auto}.detailView select{font-size:12px;padding:4px 2px;border:solid 1px #aacfe4;margin:2px 0 0px 10px}.detailView .label{color:#444;font-size:smaller;padding-left:6px;padding-top:8px;vertical-align:top}.detailArrayLabel{font-size:medium}.detailArrayLabel .foamTable{margin:1px}"),language:"css"}]}),CLASS({"package":"foam.ui",name:"TextFieldView",label:"Text Field","extends":"foam.ui.SimpleView",requires:["foam.ui.AutocompleteView"],properties:[{model_:"StringProperty",name:"name",type:"String",defaultValue:"field"},{model_:"IntProperty",name:"displayWidth",type:"Int",defaultValue:30},{model_:"IntProperty",name:"displayHeight",type:"Int",defaultValue:1},{model_:"StringProperty",name:"type",type:"String",defaultValue:"text"},{model_:"StringProperty",name:"placeholder",type:"String",defaultValue:""},{model_:"BooleanProperty",name:"onKeyMode",type:"Boolean",getter:function(){return this.updateMode===this.EACH_KEYSTROKE},setter:function(nu){this.updateMode=nu?this.EACH_KEYSTROKE:this.DONE_EDITING},help:"If true, value is updated on each keystroke."},{model_:"foam.core.types.StringEnumProperty",name:"updateMode",defaultValue:"DONE_EDITING",help:"Controls when the real .data is updated: on every keystroke, when the user presses enter or blurs the box, or on enter only.",choices:[["DONE_EDITING","Done editing"],["EACH_KEYSTROKE","Every keystroke"],["ENTER_ONLY","Enter only"]]},{model_:"BooleanProperty",name:"escapeHTML",type:"Boolean",help:"If true, HTML content is escaped in display mode.",defaultValue:!0},{model_:"StringProperty",name:"mode",type:"String",defaultValue:"read-write",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]}},{model_:"BooleanProperty",name:"required",type:"Boolean"},{model_:"StringProperty",name:"pattern",type:"String"},{name:"domValue",visibility:"hidden",hidden:!0},{name:"data"},{model_:"StringProperty",name:"readWriteTagName",type:"String",visibility:"hidden",hidden:!0,defaultValueFn:function(){return 1===this.displayHeight?"input":"textarea"}},{model_:"BooleanProperty",name:"autocomplete",type:"Boolean",defaultValue:!0},{name:"autocompleter"},{name:"autocompleteView"}],constants:[{name:"ESCAPE",value:["escape"]},{name:"DONE_EDITING",value:"DONE_EDITING"},{name:"EACH_KEYSTROKE",value:"EACH_KEYSTROKE"},{name:"ENTER_ONLY",value:"ENTER_ONLY"}],methods:[function toHTML(){return"read-write"===this.mode?this.toReadWriteHTML():this.toReadOnlyHTML()},function toReadWriteHTML(){var str="<"+this.readWriteTagName+' id="'+this.id+'"';return str+=' type="'+this.type+'" '+this.cssClassAttr(),this.on("click",this.onClick,this.id),str+="input"===this.readWriteTagName?' size="'+this.displayWidth+'"':' rows="'+this.displayHeight+'" cols="'+this.displayWidth+'"',this.required&&(str+=" required"),this.pattern&&(str+=' pattern="'+this.pattern+'"'),str+=this.extraAttributes(),str+=' name="'+this.name+'">',str+="</"+this.readWriteTagName+">"},function extraAttributes(){return""},function toReadOnlyHTML(){var self=this;return this.setClass("placeholder",function(){return""===self.data},this.id),"<"+this.tagName+' id="'+this.id+'"'+this.cssClassAttr()+' name="'+this.name+'"></'+this.tagName+">"},function setupAutocomplete(){if(this.autocomplete&&this.autocompleter){var view=this.autocompleteView=this.AutocompleteView.create({autocompleter:this.autocompleter,target:this});this.bindAutocompleteEvents(view)}},function onAutocomplete(data){this.data=data},function bindAutocompleteEvents(view){this.$.addEventListener("blur",function(){view.publish("blur")}),this.$.addEventListener("input",function(){view.autocomplete(this.textToValue(this.$.value))}.bind(this)),this.$.addEventListener("focus",function(){view.autocomplete(this.textToValue(this.$.value))}.bind(this))},function initHTML(){this.$&&(this.SUPER(),"read-write"===this.mode?(this.placeholder&&(this.$.placeholder=this.placeholder),this.updateMode===this.EACH_KEYSTROKE?this.domValue=DomValue.create(this.$,"input"):this.updateMode===this.DONE_EDITING?this.domValue=DomValue.create(this.$,"change"):this.domValue=this.OnEnterValue.create({element:this.$}),Events.relate(this.data$,this.domValue,this.valueToText.bind(this),this.textToValue.bind(this),this.updateMode===this.EACH_KEYSTROKE),this.updateMode===this.EACH_KEYSTROKE&&this.$.addEventListener("blur",this.onBlur),this.$.addEventListener("keydown",this.onKeyDown),this.$.addEventListener("keypress",this.onKeyPress),this.setupAutocomplete()):(this.domValue=DomValue.create(this.$,"undefined",this.escapeHTML?"textContent":"innerHTML"),Events.map(this.data$,this.domValue,this.valueToText.bind(this))))},function textToValue(text){return text},function valueToText(value){return"read-only"===this.mode&&""===value?this.placeholder:value},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),Events.unlink(this.domValue,this.data$)}],listeners:[{name:"onKeyDown",code:function(e){27==e.keyCode?(this.domValue.set(this.data),this.publish(this.ESCAPE)):this.publish(["keydown"],e)}},{name:"onKeyPress",code:function(e){e.stopPropagation()}},{name:"onBlur",code:function(e){this.domValue.get()!==this.data&&this.domValue.set(this.data)}},{name:"onClick",code:function(e){this.$&&this.$.focus()}}],models:[{"package":"foam.ui.TextFieldView",name:"OnEnterValue",properties:[{name:"element"},{name:"listeners",factory:function(){return[]}}],methods:[function get(){return this.element.value},function set(value){this.get()!==value&&(this.element.value=value)},function addListener(listener){listener&&(0===this.listeners.length&&this.element.addEventListener("keydown",this.onKeyDown),this.listeners.push(listener))},function removeListener(listener){var index=this.listeners.indexOf(listener);index>=0&&this.listeners.splice(i,1)},function fireListeners(e){for(var i=0;i<this.listeners.length;i++)this.listeners[i](e)}],listeners:[{name:"onKeyDown",code:function(e){13===e.keyCode&&this.fireListeners(e)}}]}]}),CLASS({"package":"foam.ui",name:"AutocompleteView","extends":"foam.ui.PopupView",requires:["foam.ui.ChoiceListView"],properties:[{name:"closeTimeout"},{name:"autocompleter"},{name:"completer"},{name:"current"},{model_:"IntProperty",name:"closeTime",type:"Int",units:"ms",help:"Time to delay the actual close on a .close call.",defaultValue:200},{name:"view",postSet:function(prev,v){prev&&(prev.data$.removeListener(this.complete),prev.choices$.removeListener(this.choicesUpdate)),v.data$.addListener(this.complete),v.choices$.addListener(this.choicesUpdate)}},{name:"target",postSet:function(prev,v){prev&&prev.unsubscribe(["keydown"],this.onKeyDown),v.subscribe(["keydown"],this.onKeyDown)}},{name:"maxHeight",defaultValue:400},{name:"className",defaultValue:"autocompletePopup"}],methods:[function autocomplete(partial){if(!this.completer){var proto=this.X.lookup(this.autocompleter);this.completer=proto.create(null,this.Y)}this.view||(this.view=this.makeView()),this.current=partial,this.open(this.target),this.completer.autocomplete(partial)},function makeView(){return this.ChoiceListView.create({dao:this.completer.autocompleteDao$Proxy,extraClassName:"autocomplete",orientation:"vertical",mode:"final",objToChoice:this.completer.f,useSelection:!0},this.Y)},function init(args){this.SUPER(args),this.subscribe("blur",function(){this.close()}.bind(this))},function open(e,opt_delay){if(this.closeTimeout&&(this.X.clearTimeout(this.closeTimeout),this.closeTimeout=0),this.$)return void this.position(this.$.firstElementChild,e.$||e);var parentNode=e.$||e,document=parentNode.ownerDocument;console.assert(this.X.document===document,"X.document is not global document");var div=document.createElement("div"),window=document.defaultView;console.assert(this.X.window===window,"X.window is not global window"),parentNode.insertAdjacentHTML("afterend",this.toHTML().trim()),this.position(this.$.firstElementChild,parentNode),this.initHTML()},function close(opt_now){if(opt_now)return this.closeTimeout&&(this.X.clearTimeout(this.closeTimeout),this.closeTimeout=0),void this.SUPER();if(!this.closeTimeout){var realClose=this.SUPER,self=this;this.closeTimeout=this.X.setTimeout(function(){self.closeTimeout=0,realClose.call(self)},this.closeTime)}},function position(div,parentNode){var document=parentNode.ownerDocument,pos=findPageXY(parentNode),pageWH=[document.firstElementChild.offsetWidth,document.firstElementChild.offsetHeight];pageWH[1]-(pos[1]+parentNode.offsetHeight)<(this.height||this.maxHeight||400)&&(div.style.bottom=parentNode.offsetHeight,document.defaultView.innerHeight-pos[1]),pos[2].offsetWidth-pos[0]<600?div.style.left=600-pos[2].offsetWidth:div.style.left=-parentNode.offsetWidth,this.width&&(div.style.width=this.width+"px"),this.height&&(div.style.height=this.height+"px"),this.maxWidth&&(div.style.maxWidth=this.maxWidth+"px",div.style.overflowX="auto"),this.maxHeight&&(div.style.maxHeight=this.maxHeight+"px",div.style.overflowY="auto")}],listeners:[{name:"onKeyDown",code:function(_,__,e){this.view&&(38===e.keyCode?(this.view.index--,this.view.scrollToSelection(this.$),e.preventDefault()):40===e.keyCode?(this.view.index++,this.view.scrollToSelection(this.$),e.preventDefault()):13===e.keyCode&&(this.view.commit(),e.preventDefault()))}},{name:"complete",code:function(){this.target.onAutocomplete(this.view.data),this.view=this.makeView(),this.close(!0)}},{name:"choicesUpdate",code:function(){this.view&&(0===this.view.choices.length||1===this.view.choices.length&&this.view.choices[0][1]===this.current)&&this.close(!0)}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n  <span id="',this.id,'" style="position:relative"><div ',this.cssClassAttr(),' style="position:absolute">',this.view,"</div></span>\n    "),out.toString()},language:"html"}],help:"Default autocomplete popup."}),CLASS({"package":"foam.ui",name:"PopupView","extends":"foam.ui.SimpleView",properties:[{name:"view"},{name:"x"},{name:"y"},{name:"width",defaultValue:""},{name:"maxWidth",defaultValue:""},{name:"maxHeight",defaultValue:""},{name:"height",defaultValue:""}],constants:[{name:"CLOSED_TOPIC",value:["closed"]}],methods:[function open(){if(!this.$){var document=this.X.document,div=document.createElement("div");div.style.left=this.x+"px",div.style.top=this.y+"px",this.width&&(div.style.width=this.width+"px"),this.height&&(div.style.height=this.height+"px"),this.maxWidth&&(div.style.maxWidth=this.maxWidth+"px"),this.maxHeight&&(div.style.maxHeight=this.maxHeight+"px"),div.style.position="absolute",div.id=this.id,div.innerHTML=this.view.toHTML(),document.body.appendChild(div),this.view.initHTML()}},function openOn(parent){if(!this.$){var self=this,document=this.X.document,bg=document.createElement("div"),div=document.createElement("div");bg.style.width=bg.style.height="10000px",bg.style.opacity=0,bg.style.position="fixed",bg.style.top="0",bg.style.zIndex=998,div.style.zIndex=999,this.y||(this.y=(parent.clientHeight-this.height)/2),this.x||(this.x=(parent.clientWidth-this.width)/2),div.className="popup",div.style.left=this.x+"px",div.style.top=this.y+"px",this.width&&(div.style.width=this.width+"px"),this.height&&(div.style.height=this.height+"px"),this.maxWidth&&(div.style.maxWidth=this.maxWidth+"px"),this.maxHeight&&(div.style.maxHeight=this.maxHeight+"px"),parent.style.position="relative",div.id=this.id,div.innerHTML=this.view.toHTML(),document.body.appendChild(bg),bg.addEventListener("click",function(){div.remove(),bg.remove(),self.destroy(),self.publish(self.CLOSED_TOPIC)}),parent.appendChild(div),this.view.initHTML()}},function close(){this.$&&this.$.remove()},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),this.close(),this.view.destroy()}],templates:[{name:"CSS",code:ConstantTemplate(".popup{background:#999;-webkit-box-shadow:3px 3px 6px 0 gray;box-shadow:3px 3px 6px 0 gray;color:white;font-size:18px;opacity:0.9;padding:20px;position:absolute;box-sizing:border-box}"),language:"css"}]}),CLASS({"package":"foam.ui",name:"IntFieldView","extends":"foam.ui.AbstractNumberFieldView",methods:[function textToValue(text){return parseInt(text)||"0"},function valueToText(value){return value?value:"0"}]}),CLASS({"package":"foam.ui",name:"AbstractNumberFieldView","extends":"foam.ui.TextFieldView",properties:[{name:"type",defaultValue:"number"},{name:"step"}],methods:[function extraAttributes(){return this.step?' step="'+this.step+'"':""}]}),CLASS({"package":"foam.ui",name:"FloatFieldView","extends":"foam.ui.AbstractNumberFieldView",properties:[{name:"precision",defaultValue:""}],methods:[function formatNumber(val){if(!val)return"0";val=val.toFixed(this.precision);for(var i=val.length-1;i>0&&"0"===val.charAt(i);i--);return val.substring(0,"."===val.charAt(i)?i:i+1)},function valueToText(val){return this.hasOwnProperty("precision")?this.formatNumber(val):""+val},function textToValue(text){return parseFloat(text)||0}]}),CLASS({"package":"foam.ui",name:"DAOController",label:"DAO Controller","extends":"foam.ui.View",properties:[{model_:"ModelProperty",name:"model",type:"Model"},{name:"subType",setter:function(v){this.model=v}},{name:"dao",view:"foam.ui.TableView"},{name:"data",getter:function(){return this.dao},setter:function(v){this.dao=v}},{name:"selection"},{model_:"BooleanProperty",name:"useSearchView",type:"Boolean",defaultValue:!1}],actions:[{name:"new",help:"Create a new record.",code:function(){var createView=this.X.DAOCreateController.create({model:this.model,dao:this.dao,showActions:!0});createView.parentController=this,this.X.stack.pushView(createView,"New")}},{name:"edit",help:"Edit the current record.","default":!0,code:function(){this.selection=this.daoView.selection;for(var obj=this.selection,actions=this.X.DAOUpdateController.actions.slice(0),i=0;i<this.model.actions.length;i++){var action=this.model.actions[i],newAction=this.X.Action.create(action);newAction.action=function(oldAction){return function(){oldAction.call(obj)}}(action.action),actions.push(newAction)}console.log(["selection: ",this.selection]);var updateView=this.X.DAOUpdateController.create({data:this.selection,model:this.model,dao:this.dao,showActions:!0});this.X.stack.pushView(updateView,"Edit")}},{name:"delete",help:"Delete the current record.",code:function(){this.selection=this.daoView.selection;var self=this;this.dao.remove(this.selection)}}],methods:[function init(){this.SUPER(),this.showActions=!0},function initHTML(){this.SUPER(),this.daoView.subscribe(this.daoView.DOUBLE_CLICK,this.onDoubleClick),this.daoView.selection$.addListener(this.onSelection)}],listeners:[{name:"onDoubleClick",code:function(evt){for(var i=0;i<this.model_.getRuntimeActions().length;i++){var action=this.model_.getRuntimeActions()[i];if(action["default"]){action.action.call(this);break}}}},{name:"onSelection",code:function(evt){var obj=this.daoView.selection;obj&&this.X.stack.setPreview(this.X.SummaryView.create({model:this.model,data:this.daoView.selection}))}}],templates:[{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out(" ",self.createTemplateView("dao",{model:this.model})," "),out.toString()},language:"html"}]}),CLASS({"package":"com.google.mail",name:"InnerComposeView","extends":"foam.ui.md.DetailView",requires:["foam.ui.md.ToolbarRichTextView","foam.ui.md.TextFieldView"],templates:[{name:"CSS",code:ConstantTemplate(".email-compose-view .richText{-webkit-flex-grow:1;flex-grow:1;margin-top:30px;margin-left:-2px}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n<div id="',self.id,'" class="email-compose-view">\n',self.createTemplateView("to",{placeholder:"To",model_:"foam.ui.md.TextFieldView"})," <br>\n",self.createTemplateView("cc",{placeholder:"Cc",model_:"foam.ui.md.TextFieldView"})," <br>\n",self.createTemplateView("bcc",{placeholder:"Bcc",model_:"foam.ui.md.TextFieldView"})," <br>\n",self.createTemplateView("subject",{placeholder:"Subject",onKeyMode:!0,model_:"foam.ui.md.TextFieldView"}),"\n",self.createTemplateView("body",{model_:"foam.ui.md.ToolbarRichTextView",height:300,placeholder:"Message"}),"\n</div>\n"),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"ToolbarRichTextView","extends":"foam.ui.RichTextView",requires:["foam.graphics.ActionButtonCView"],actions:[{name:"bold",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTEyLjE5OSwxMC41YzAsMCwxLjgwMS0wLjUsMS44MDEtMlMxMyw2LDExLjUsNkg2djloNS41YzEuNSwwLDIuNS0xLDIuNS0yLjVTMTIuMTk5LDEwLjUsMTIuMTk5LDEwLjV6IE0xMC41LDE0SDl2LTNoMS41DQoJYzAuNTUzLDAsMC44NSwwLjY3MiwwLjg1LDEuNVMxMS4wNTMsMTQsMTAuNSwxNHogTTEwLjUsMTBIOVY3aDEuNWMwLjU1MywwLDAuODUsMC42NzIsMC44NSwxLjVTMTEuMDUzLDEwLDEwLjUsMTB6Ii8+DQo8cmVjdCBvcGFjaXR5PSIwIiBmaWxsPSIjNDM4N0ZEIiB3aWR0aD0iMjEiIGhlaWdodD0iMjEiLz4NCjwvc3ZnPg0K"},{name:"italic",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBvbHlnb24gZmlsbD0iIzg4OCIgcG9pbnRzPSI5LDYgOSw3IDEwLjksNyA2LjksMTQgNSwxNCA1LDE1IDExLjI1LDE1IDExLjI1LDE0IDkuMSwxNCAxMy4xLDcgMTUsNyAxNSw2ICIvPg0KPHJlY3Qgb3BhY2l0eT0iMCIgZmlsbD0iIzQzODdGRCIgd2lkdGg9IjIxIiBoZWlnaHQ9IjIxIi8+DQo8L3N2Zz4NCg=="},{name:"underline",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTEwLDE0YzIsMCw0LTEuNSw0LTRWNWgtMS44MDF2NWMwLDEuNS0wLjY5OSwyLjI1LTIuMTk5LDIuMjVTNy44LDExLjUsNy44LDEwVjVINnY1QzYsMTIuNSw4LDE0LDEwLDE0eiBNNSwxNXYxaDEwdi0xSDV6Ig0KCS8+DQo8cmVjdCBvcGFjaXR5PSIwIiBmaWxsPSIjNDM4N0ZEIiB3aWR0aD0iMjEiIGhlaWdodD0iMjEiLz4NCjwvc3ZnPg0K"
},{name:"link",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTIuNzY4LDExLjAwOFY5Ljk5MkMyLjc2OCw5LjMxMSwzLjMxOCw4Ljc2LDQsOC43Nmg1QzguNTksNy43NjgsNy41MjUsNyw2LjUsN2gtMkMyLjU2Niw3LDEsOC41NjcsMSwxMC41UzIuNTY2LDE0LDQuNSwxNA0KCWgyYzEuMDI1LDAsMi4wOS0wLjc2OCwyLjUtMS43Nkg0QzMuMzE4LDEyLjI0LDIuNzY4LDExLjY4OSwyLjc2OCwxMS4wMDh6IE0xNS41LDdoLTJjLTEuMDI1LDAtMi4wOSwwLjc2OC0yLjUsMS43Nmg1DQoJYzAuNjgyLDAsMS4yMzIsMC41NTEsMS4yMzIsMS4yMzJ2MS4wMTZjMCwwLjY4Mi0wLjU1MSwxLjIzMi0xLjIzMiwxLjIzMmgtNWMwLjQxLDAuOTkyLDEuNDc1LDEuNzYsMi41LDEuNzZoMg0KCWMxLjkzNCwwLDMuNS0xLjU2NywzLjUtMy41UzE3LjQzNCw3LDE1LjUsN3ogTTYsMTAuNDk5YzAsMC40MTQsMC4zMzYsMC43NTEsMC43NSwwLjc1MWg2LjVjMC40MTQsMCwwLjc1LTAuMzM3LDAuNzUtMC43NTENCgljMC0wLjQxNS0wLjMzNi0wLjc0OS0wLjc1LTAuNzQ5aC02LjVDNi4zMzYsOS43NSw2LDEwLjA4NCw2LDEwLjQ5OXoiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="},{name:"leftJustify",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTMsMTZoMTB2LTFIM1YxNnogTTEzLDExSDN2MWgxMFYxMXogTTEzLDdIM3YxaDEwVjd6IE0zLDE0aDE0di0xSDNWMTR6IE0zLDEwaDE0VjlIM1YxMHogTTMsNXYxaDE0VjVIM3oiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="},{name:"centerJustify",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTUsMTF2MWgxMHYtMUg1eiBNMywxNGgxNHYtMUgzVjE0eiBNNSwxNmgxMHYtMUg1VjE2eiBNMywxMGgxNFY5SDNWMTB6IE01LDd2MWgxMFY3SDV6IE0zLDV2MWgxNFY1SDN6Ii8+DQo8cmVjdCBvcGFjaXR5PSIwIiBmaWxsPSIjNDM4N0ZEIiB3aWR0aD0iMjEiIGhlaWdodD0iMjEiLz4NCjwvc3ZnPg0K"},{name:"rightJustify",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTUsMTF2MWgxMHYtMUg1eiBNMywxNGgxNHYtMUgzVjE0eiBNNSwxNmgxMHYtMUg1VjE2eiBNMywxMGgxNFY5SDNWMTB6IE01LDd2MWgxMFY3SDV6IE0zLDV2MWgxNFY1SDN6Ii8+DQo8cmVjdCBvcGFjaXR5PSIwIiBmaWxsPSIjNDM4N0ZEIiB3aWR0aD0iMjEiIGhlaWdodD0iMjEiLz4NCjwvc3ZnPg0K"},{name:"numberedList",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTYsMTVjMC0wLjU1My0wLjQ0Ny0xLTEtMUgzdjFoMi4yNWwtMSwxbDEsMUgzdjFoMmMwLjU1MywwLDEtMC40NDcsMS0xYzAtMC4yNzYtMC4xMTEtMC41MjYtMC4yOTMtMC43MDdMNS40MTQsMTYNCglsMC4yOTMtMC4yOTNDNS44ODksMTUuNTI2LDYsMTUuMjc2LDYsMTV6IE01LjcwNywxMC43MDdDNS44ODksMTAuNTI2LDYsMTAuMjc2LDYsMTBjMC0wLjU1My0wLjQ0Ny0xLTEtMUgzdjFoMi4yNUwzLDEyLjI1VjEzaDN2LTENCglINC40MTRDNC40MTQsMTIsNS41MjUsMTAuODg5LDUuNzA3LDEwLjcwN3ogTTgsNXYxaDlWNUg4eiBNNCw4aDFWNEgzdjFoMVY4eiBNOCwxMWg5di0xSDhWMTF6IE04LDE2aDl2LTFIOFYxNnoiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="},{name:"bulletList",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTYsMTVjMC0wLjU1My0wLjQ0Ny0xLTEtMUgzdjFoMi4yNWwtMSwxbDEsMUgzdjFoMmMwLjU1MywwLDEtMC40NDcsMS0xYzAtMC4yNzYtMC4xMTEtMC41MjYtMC4yOTMtMC43MDdMNS40MTQsMTYNCglsMC4yOTMtMC4yOTNDNS44ODksMTUuNTI2LDYsMTUuMjc2LDYsMTV6IE01LjcwNywxMC43MDdDNS44ODksMTAuNTI2LDYsMTAuMjc2LDYsMTBjMC0wLjU1My0wLjQ0Ny0xLTEtMUgzdjFoMi4yNUwzLDEyLjI1VjEzaDN2LTENCglINC40MTRDNC40MTQsMTIsNS41MjUsMTAuODg5LDUuNzA3LDEwLjcwN3ogTTgsNXYxaDlWNUg4eiBNNCw4aDFWNEgzdjFoMVY4eiBNOCwxMWg5di0xSDhWMTF6IE04LDE2aDl2LTFIOFYxNnoiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="},{name:"decreaseIndentation",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTMsMTZoMTR2LTFIM1YxNnogTTgsOGg5VjdIOFY4eiBNOCwxMGg5VjlIOFYxMHogTTgsMTJoOXYtMUg4VjEyeiBNOCwxNGg5di0xSDhWMTR6IE0zLDV2MWgxNFY1SDN6Ii8+DQo8cG9seWdvbiBvcGFjaXR5PSIwLjg1IiBwb2ludHM9IjYsOCA2LDEzIDMsMTAuNSAiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="},{name:"increaseIndentation",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTYsMTVjMC0wLjU1My0wLjQ0Ny0xLTEtMUgzdjFoMi4yNWwtMSwxbDEsMUgzdjFoMmMwLjU1MywwLDEtMC40NDcsMS0xYzAtMC4yNzYtMC4xMTEtMC41MjYtMC4yOTMtMC43MDdMNS40MTQsMTYNCglsMC4yOTMtMC4yOTNDNS44ODksMTUuNTI2LDYsMTUuMjc2LDYsMTV6IE01LjcwNywxMC43MDdDNS44ODksMTAuNTI2LDYsMTAuMjc2LDYsMTBjMC0wLjU1My0wLjQ0Ny0xLTEtMUgzdjFoMi4yNUwzLDEyLjI1VjEzaDN2LTENCglINC40MTRDNC40MTQsMTIsNS41MjUsMTAuODg5LDUuNzA3LDEwLjcwN3ogTTgsNXYxaDlWNUg4eiBNNCw4aDFWNEgzdjFoMVY4eiBNOCwxMWg5di0xSDhWMTF6IE04LDE2aDl2LTFIOFYxNnoiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="},{name:"blockQuote",label:"",iconUrl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiIFsNCgk8IUVOVElUWSBuc19mbG93cyAiaHR0cDovL25zLmFkb2JlLmNvbS9GbG93cy8xLjAvIj4NCl0+DQo8c3ZnIHZlcnNpb249IjEuMSINCgkgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyINCgkgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjIxcHgiIHZpZXdCb3g9IjAgMCAyMSAyMSIgb3ZlcmZsb3c9InZpc2libGUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIxIDIxIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxkZWZzPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzg4OCIgZD0iTTMsMTZoMTR2LTFIM1YxNnogTTgsOGg5VjdIOFY4eiBNOCwxMGg5VjlIOFYxMHogTTgsMTJoOXYtMUg4VjEyeiBNOCwxNGg5di0xSDhWMTR6IE0zLDV2MWgxNFY1SDN6Ii8+DQo8cG9seWdvbiBvcGFjaXR5PSIwLjg1IiBwb2ludHM9IjYsOCA2LDEzIDMsMTAuNSAiLz4NCjxyZWN0IG9wYWNpdHk9IjAiIGZpbGw9IiM0Mzg3RkQiIHdpZHRoPSIyMSIgaGVpZ2h0PSIyMSIvPg0KPC9zdmc+DQo="}],methods:[function init(){this.SUPER(),this.Y_=this.Y.sub(),this.Y.registerModel(this.X.lookup("foam.graphics.ActionButtonCView").xbind({background:"white",radius:18}),"foam.ui.ActionButton")},function toHTML(){return this.SUPER()+this.toolbar()}],templates:[{name:"CSS",code:ConstantTemplate("@media (max-width: 360px){.actionButtonCView-leftJustify, .actionButtonCView-centerJustify, .actionButtonCView-rightJustify{display:none}}@media (max-width: 440px){.actionButtonCView-numberedList, .actionButtonCView-bulletList{display:none}}@media (max-width: 510px){.actionButtonCView-decreaseIndentation, .actionButtonCView-increaseIndentation{display:none}}@media (max-width: 560px){.actionButtonCView-blockQuote{display:none}}"),language:"css"},{name:"toolbar",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div class="toolbar">\n      ',self.createTemplateView("bold")," ",self.createTemplateView("italic")," ",self.createTemplateView("underline")," ",self.createTemplateView("link")," ",self.createTemplateView("leftJustify")," ",self.createTemplateView("centerJustify")," ",self.createTemplateView("rightJustify")," ",self.createTemplateView("numberedList")," ",self.createTemplateView("bulletList")," ",self.createTemplateView("decreaseIndentation")," ",self.createTemplateView("increaseIndentation")," ",self.createTemplateView("blockQuote"),"\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.graphics",name:"ActionButtonCView","extends":"foam.graphics.CView",requires:["foam.ui.md.Halo","foam.input.touch.GestureTarget"],imports:["gestureManager"],properties:[{name:"action",postSet:function(oldValue,action){this.bindIsAvailableAndEnabled()}},{model_:"StringProperty",name:"font",type:"String",defaultValue:""},{name:"data",postSet:function(){this.bindIsAvailableAndEnabled()}},{name:"label",defaultValue:""},{name:"showLabel",defaultValueFn:function(){return this.action.showLabel}},{name:"iconUrl",defaultValueFn:function(){return this.action.iconUrl},postSet:function(_,v){this.image_&&(this.image_.src=v)}},{name:"haloColor",defaultValue:"rgb(241, 250, 65)"},{name:"halo",factory:function(){return this.Halo.create({alpha:0,r:10,color$:this.haloColor$,isEnabled:function(){return this.action.isEnabled.call(this.data,this.action)}.bind(this)})},postSet:function(old,nu){old&&this.removeChild(old),nu&&this.addChild(nu)}},{name:"iconWidth",defaultValue:0},{name:"iconHeight",defaultValue:0},{name:"radius",defaultValue:0,postSet:function(_,r){r&&(this.width=this.height=2*r)}},{name:"tapGesture",visibility:"hidden",hidden:!0,"transient":!0,lazyFactory:function(){return this.GestureTarget.create({containerID:this.view.id,handler:this,gesture:"tap"})}},{name:"className",defaultValueFn:function(){return"actionButtonCView actionButtonCView-"+this.action.name},help:"CSS class name(s), space separated."},{name:"tooltip",defaultValueFn:function(){return this.action.help}},{name:"speechLabel",defaultValueFn:function(){return this.action.speechLabel}},{name:"tabIndex"},{name:"role"},{name:"state_",defaultValue:"default"}],methods:[function init(){this.SUPER(),this.X.dynamicFn(function(){this.iconUrl,this.iconWidth,this.iconHeight}.bind(this),function(){this.iconUrl&&(this.image_=new Image,this.image_.onload=function(){this.iconWidth||(this.iconWidth=this.image_.width),this.iconHeight||(this.iconHeight=this.image_.height),this.view.$&&this.view.paint()}.bind(this),this.image_.src=this.iconUrl)}.bind(this))},function bindIsAvailableAndEnabled(){if(this.action&&this.data){var self=this;this.X.dynamicFn(function(){self.action.isAvailable.call(self.data,self.action),self.action.isEnabled.call(self.data,self.action)},function(){self.action.isAvailable.call(self.data,self.action)?self.oldWidth_&&self.oldHeight_&&(self.x=self.oldX_,self.y=self.oldY_,self.width=self.oldWidth_,self.height=self.oldHeight_):(self.width||self.height)&&(self.oldX_=self.x,self.oldY_=self.y,self.oldWidth_=self.width,self.oldHeight_=self.height,self.width=0,self.height=0,self.x=0,self.y=0),self.action.isEnabled.call(self.data,self.action)?self.alpha=1:self.alpha=.5,self.view&&self.view.paint()})}},function initCView(){this.gestureManager&&this.gestureManager.install(this.tapGesture),this.$.addEventListener("keypress",function(e){32!=e.charCode||e.altKey||e.ctrlKey||e.shiftKey||(e.preventDefault(),e.stopPropagation(),this.tapClick())}.bind(this)),this.$.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),(e.x||e.y)&&this.gestureManager||this.tapClick()}.bind(this))},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),this.gestureManager&&this.gestureManager.uninstall(this.tapGesture)},function erase(c){c.clearRect(0,0,this.width,this.height);var r=Math.min(this.width,this.height)/2;c.fillStyle=this.background,c.beginPath(),c.arc(this.width/2,this.height/2,r,0,2*Math.PI,!0),c.closePath(),c.fill()},function paintSelf(c){this.font&&(c.font=this.font),c.globalAlpha=this.alpha,c.textAlign="center",c.textBaseline="middle",c.fillStyle=this.color,this.image_&&this.image_.complete?c.drawImage(this.image_,this.x+(this.width-this.iconWidth)/2,this.y+(this.height-this.iconHeight)/2,this.iconWidth,this.iconHeight):c.fillText(this.label||this.action.labelFn.call(this.data,this.action),this.x+this.width/2,this.y+this.height/2)}],listeners:[{name:"tapClick",code:function(){this.action.maybeCall(this.X,this.data)}}]}),CLASS({"package":"foam.ui",name:"RichTextView","extends":"foam.ui.SimpleView",requires:["foam.util.Base64Decoder","foam.ui.Link"],properties:[{model_:"StringProperty",name:"height",type:"String",defaultValue:"400"},{model_:"StringProperty",name:"width",type:"String",defaultValue:"100%"},{model_:"StringProperty",name:"mode",type:"String",defaultValue:"read-write",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]}},{name:"data",postSet:function(){this.maybeShowPlaceholder()}},{name:"placeholder",help:"Placeholder text to appear when no text is entered."},{name:"document",visibility:"hidden",hidden:!0}],actions:[{name:"bold",label:"<b>B</b>",help:"Bold (Ctrl-B)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("bold")}},{name:"italic",label:"<i>I</i>",help:"Italic (Ctrl-I)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("italic")}},{name:"underline",label:"<u>U</u>",help:"Underline (Ctrl-U)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("underline")}},{name:"link",label:"Link",help:"Insert link (Ctrl-K)",code:function(){this.Link.create({richTextView:this,label:this.getSelectionText()}).open(5,120)}},{name:"fontSize",label:"Font Size",help:"Change the font size.",code:function(){}},{name:"small",label:"small",help:"Set's the font size to small.",parent:"fontSize",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontSize",!1,"2")}},{name:"normal",label:"normal",help:"Set's the font size to normal.",parent:"fontSize",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontSize",!1,"3")}},{name:"large",label:"large",help:"Set's the font size to small.",parent:"fontSize",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontSize",!1,"5")}},{name:"huge",label:"huge",help:"Set's the font size to huge.",parent:"fontSize",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontSize",!1,"7")}},{name:"fontFace",label:"Font",help:"Set's the font face."},{name:"sansSerif",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"arial, sans-serif")}},{name:"serif",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"times new roman, serif")}},{name:"wide",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"arial bold, sans-serif")}},{name:"narrow",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"arial narrow, sans-serif")}},{name:"comicSans",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"comic sans, sans-serif")}},{name:"courierNew",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"courier new, monospace")}},{name:"garamond",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"garamond, sans-serif")}},{name:"georgia",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"georgia, sans-serif")}},{name:"tahoma",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"tahoma, sans-serif")}},{name:"trebuchet",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"trebuchet ms, sans-serif")}},{name:"verdana",help:"Set's the font face.",parent:"fontFace",code:function(){this.$.contentWindow.focus(),this.document.execCommand("fontName",!1,"verdana, sans-serif")}},{name:"removeFormatting",help:"Removes formatting from the current selection.",code:function(){this.$.contentWindow.focus(),this.document.execCommand("removeFormat")}},{name:"justification",code:function(){}},{name:"leftJustify",help:"Align Left (Ctrl-Shift-W)",parent:"justification",code:function(){this.$.contentWindow.focus(),this.document.execCommand("justifyLeft")}},{name:"centerJustify",help:"Align Center (Ctrl-Shift-E)",parent:"justification",code:function(){this.$.contentWindow.focus(),this.document.execCommand("justifyCenter")}},{name:"rightJustify",help:"Align Right (Ctrl-Shift-R)",parent:"justification",code:function(){this.$.contentWindow.focus(),this.document.execCommand("justifyRight")}},{name:"numberedList",help:"Numbered List (Ctrl-Shift-7)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("insertOrderedList")}},{name:"bulletList",help:"Bulleted List (Ctrl-Shift-7)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("insertUnorderedList")}},{name:"decreaseIndentation",help:"Indent Less (Ctrl-[)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("outdent")}},{name:"increaseIndentation",help:"Indent More (Ctrl-])",code:function(){this.$.contentWindow.focus(),this.document.execCommand("indent")}},{name:"blockQuote",help:"Quote (Ctrl-Shift-9)",code:function(){this.$.contentWindow.focus(),this.document.execCommand("formatBlock",!1,"<blockquote>")}}],methods:[function toHTML(){var sandbox="read-write"===this.mode?"":' sandbox="allow-same-origin"',id=this.id;return this.dropId=this.nextID(),this.placeholderId=this.nextID(),'<div class="richtext"><div id="'+this.dropId+'" class="dropzone"><div class=spacer></div>Drop files here<div class=spacer></div></div><div id="'+this.placeholderId+'" class="placeholder">'+this.placeholder+'</div><iframe style="width:'+this.width+";min-height:"+this.height+'px" id="'+this.id+'"'+sandbox+' img-src="*"></iframe></div>'},function initHTML(){this.SUPER();var drop=$(this.dropId);this.dropzone=drop,this.document=this.$.contentDocument;var body=this.document.body;body.style.whiteSpace="pre-wrap",$(this.placeholderId).addEventListener("click",function(){body.focus()}),this.document.head.insertAdjacentHTML("afterbegin","<style>blockquote{border-left-color:#ccc;border-left-style:solid;padding-left:1ex;}</style>"),body.style.overflow="auto",body.style.margin="5px";var self=this;body.ondrop=function(e){e.preventDefault(),self.showDropMessage(!1);for(var length=e.dataTransfer.files.length,i=0;length>i;i++){var file=e.dataTransfer.files[i],id=this.addAttachment(file);if(file.type.startsWith("image/")){var img=document.createElement("img");img.id=id,img.src=URL.createObjectURL(file),this.insertElement(img)}}if(length=e.dataTransfer.items.length){var div=this.sanitizeDroppedHtml(e.dataTransfer.getData("text/html"));this.insertElement(div)}}.bind(this),self.dragging_=0,body.ondragenter=function(e){self.dragging_++,self.showDropMessage(!0)},body.ondragleave=function(e){0==--self.dragging_&&self.showDropMessage(!1)},"read-write"===this.mode&&(this.document.body.contentEditable=!0),this.domValue=DomValue.create(this.document.body,"input","innerHTML"),Events.link(this.data$,this.domValue),this.maybeShowPlaceholder()},function getSelectionText(){var window=this.$.contentWindow,selection=window.getSelection();return selection.rangeCount?selection.getRangeAt(0).toLocaleString():""},function insertElement(e){var window=this.$.contentWindow,selection=window.getSelection();if(selection.rangeCount){var r=selection.getRangeAt(0);r.deleteContents(),r.insertNode(e)}else{var range=window.document.createRange();range.selectNodeContents(window.document.body),range.insertNode(e)}this.updateValue()},function updateValue(){this.data=this.document.body.innerHTML},function showDropMessage(show){this.$.style.opacity=show?"0":"1"},function sanitizeDroppedHtml(html){function copyNodes(parent,node){for(var i=0;i<allowedElements.length;i++)if(allowedElements[i].name===node.nodeName){if(allowedElements[i].clone)newNode=allowedElements[i].clone(node);else if(node.nodeType===Node.ELEMENT_NODE){newNode=document.createElement(node.nodeName);for(var j=0;j<allowedElements[i].attributes.length;j++)node.hasAttribute(allowedElements[i].attributes[j])&&newNode.setAttribute(allowedElements[i].attributes[j],node.getAttribute(allowedElements[i].attributes[j]))}else node.nodeType===Node.TEXT_NODE?newNode=document.creatTextNode(node.nodeValue):newNode=document.createTextNode("");break}for(i===allowedElements.length&&(newNode=document.createElement("div")),newNode&&parent.appendChild(newNode),j=0;j<node.children.length;j++)copyNodes(newNode,node.children[j])}var self=this,allowedElements=[{name:"B",attributes:[]},{name:"I",attributes:[]},{name:"U",attributes:[]},{name:"P",attributes:[]},{name:"SECTION",attributes:[]},{name:"BR",attributes:[]},{name:"BLOCKQUOTE",attributes:[]},{name:"DIV",attributes:[]},{name:"IMG",attributes:["src"],clone:function(node){var newNode=document.createElement("img");if(node.src.startsWith("http")){var xhr=new XMLHttpRequest;xhr.open("GET",node.src),xhr.responseType="blob",xhr.asend(function(blob){blob.name="dropped image",blob?(newNode.id=self.addAttachment(blob),newNode.src=URL.createObjectURL(blob)):blob.parent.removeChild(blob),self.updateValue()})}else{if(!node.src.startsWith("data:"))return null;var type=node.src.substring(5,node.src.indexOf(";")),decoder=self.Base64Decoder.create({bufsize:node.src.length});decoder.put(node.src.substring(node.src.indexOf("base64,")+7)),decoder.eof();var blob=new Blob(decoder.sink,{type:type});blob.name="dropped image",newNode.id=self.addAttachment(blob),newNode.src=URL.createObjectURL(blob)}return newNode}},{name:"A",attributes:["href"]},{name:"#TEXT",attributes:[]}],frame=document.createElement("iframe");frame.sandbox="allow-same-origin",frame.style.display="none",document.body.appendChild(frame),frame.contentDocument.body.innerHTML=html;for(var sanitizedContent=new DocumentFragment,i=0;i<frame.contentDocument.body.children.length;i++)copyNodes(sanitizedContent,frame.contentDocument.body.children[i]);return document.body.removeChild(frame),sanitizedContent},function addAttachment(file){var id="att"+{}.$UID;return console.log("file: ",file,id),this.publish("attachmentAdded",file,id),id},function removeImage(imageID){var e=this.document.getElementById(imageID);e&&(e.outerHTML="",this.data=this.document.body.innerHTML)},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),Events.unlink(this.domValue,this.value)},function textToValue(text){return text},function valueToText(value){return value},function setForegroundColor(color){this.$.contentWindow.focus(),this.document.execCommand("foreColor",!1,color)},function setBackgroundColor(color){this.$.contentWindow.focus(),this.document.execCommand("backColor",!1,color)}],listeners:[{name:"maybeShowPlaceholder",code:function(){var e=$(this.placeholderId);e&&(e.style.visibility=""==this.data?"visible":"hidden")}}]}),CLASS({"package":"foam.util",name:"Base64Decoder",properties:[{model_:"IntProperty",name:"bufsize",type:"Int",help:"Size of the internal buffer to use.",defaultValue:512},{name:"buffer",factory:function(){return new ArrayBuffer(this.bufsize)}},{model_:"IntProperty",name:"pos",type:"Int",defaultValue:0},{model_:"IntProperty",name:"chunk",type:"Int",defaultValue:3},{name:"sink",factory:function(){return[].sink}}],constants:[{name:"TABLE",value:{0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,"+":62,"/":63,"-":62,_:63}}],methods:[function lookup(data){return this.TABLE[data]},function put(data){var tmp=0;this.view=new DataView(this.buffer);for(var i=0;i<data.length&&"="!=data[i];i++){var value=this.lookup(data[i]);void 0!==value&&(tmp|=value<<6*this.chunk,0==this.chunk?(this.emit(3,tmp),tmp=0,this.chunk=3):this.chunk-=1)}"="==data[i]&&(i++,i<data.length?"="==data[i]&&this.emit(1,tmp):this.emit(2,tmp))},function emit(bytes,tmp){for(var j=0;bytes>j;j++)this.view.setUint8(this.pos,tmp>>8*(2-j)&255),this.pos+=1,this.pos>=this.buffer.byteLength&&(this.sink.put(this.buffer),this.buffer=new ArrayBuffer(this.bufsize),this.view=new DataView(this.buffer),this.pos=0)},function eof(){this.sink.put(this.buffer.slice(0,this.pos)),this.sink.eof&&this.sink.eof()}]}),CLASS({"package":"foam.ui",name:"Link",requires:["foam.ui.LinkView"],properties:[{name:"richTextView"},{name:"label",displayWidth:28},{name:"link",displayWidth:19,view:{factory_:"foam.ui.TextFieldView",placeholder:"Type or paste link."},preSet:function(_,value){return value=value.trim(),value.toLowerCase().startsWith("javascript:")&&(value=""),value}}],actions:[{name:"insert",label:"Apply",help:"Insert this link into the document.",code:function(){var a=document.createElement("a"),txt=document.createTextNode(this.label);a.href=this.link,a.appendChild(txt),this.richTextView.insertElement(a),this.view.close()}}],methods:[function open(x,y){var view=this.LinkView.create({data:this});this.richTextView.$.parentNode.insertAdjacentHTML("beforebegin",view.toHTML()),view.$.style.left=x+this.richTextView.$.offsetLeft,view.$.style.top=y+this.richTextView.$.offsetTop,view.initHTML(),this.view=view}]}),CLASS({"package":"foam.ui",name:"LinkView","extends":"foam.ui.DetailView",properties:[{name:"insertButton",factory:function(){return ActionButton.create({action:Link.INSERT,data:this.data})}}],methods:[function init(){this.SUPER(),this.addChild(this.insertButton)},function initHTML(){this.SUPER(),this.$.addEventListener("keyup",this.keyUp),this.labelView.focus()},function close(){this.$.remove()}],listeners:[{name:"keyUp",code:function(e){27==e.keyCode&&(e.stopPropagation(),this.close())}}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('<div id="',this.id,'" class="linkDialog" style="position:absolute">        <table><tr>        <th>Text</th><td>',self.createTemplateView("label"),"</td></tr><tr>        <th>Link</th><td>",self.createTemplateView("link"),"        ",self.insertButton,"</td>        </tr></table>        </div>"),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"DetailView","extends":"foam.ui.md.BaseDetailView",traits:["foam.ui.md.ToolbarViewTrait"]}),CLASS({"package":"foam.ui.md",name:"ToolbarViewTrait",requires:["foam.ui.md.ToolbarAction"],imports:["mdToolbar as toolbar"],properties:[{name:"toolbar",postSet:function(old,nu){old&&old.removeRightActions&&old.removeRightActions(this.toolbarActions_.concat(this.dataToolbarActions_)),nu&&nu.addRightActions&&nu.addRightActions(this.toolbarActions_.concat(this.dataToolbarActions_));
}},{name:"data",postSet:function(old,nu){old!==nu&&(this.dataToolbarActions_=this.wrapToolbarActions(nu,nu&&nu.model_&&nu.model_.getRuntimeActions()||[]))}},{model_:"ArrayProperty",name:"toolbarActions_",type:"Array",subType:"foam.ui.md.ToolbarAction",postSet:function(old,nu){old!==nu&&this.toolbar&&(old&&this.toolbar.removeRightActions&&this.toolbar.removeRightActions(old),nu&&this.toolbar.addRightActions&&this.toolbar.addRightActions(nu))}},{model_:"ArrayProperty",name:"dataToolbarActions_",type:"Array",subType:"foam.ui.md.ToolbarAction",postSet:function(old,nu){old!==nu&&this.toolbar&&(old&&this.toolbar.removeRightActions&&this.toolbar.removeRightActions(old),nu&&this.toolbar.addRightActions&&this.toolbar.addRightActions(nu))}},{model_:"BooleanProperty",name:"hideOwnActions",type:"Boolean",help:"If true, do not autoxmatically add the view's own actions to the toolbar, just the data's actions",defaultValue:!1}],methods:[function init(){if(this.SUPER(),!this.hideOwnActions){var initializer=function(){this.toolbarActions_=this.wrapToolbarActions(this,this.model_.getRuntimeActions()),this.addDestructor(destructor)}.bind(this),destructor=function(){this.removeToolbarActions(),this.addInitializer(initializer)}.bind(this);this.addInitializer(initializer)}},function removeToolbarActions(){this.toolbar&&this.toolbar.removeRightActions(this.toolbarActions_.concat(this.dataToolbarActions_))},function wrapToolbarActions(data,actions){return actions.map(this.wrapToolbarAction.bind(this,data))},function wrapToolbarAction(data,action){var isAvailable=action.isAvailable,isEnabled=action.isEnabled,toolbarAction=this.ToolbarAction.create({data:data,action:action},this.Y);return this.X.dynamicFn(function(){toolbarAction.available=isAvailable.apply(data,action)}),this.X.dynamicFn(function(){toolbarAction.enabled=isEnabled.apply(data,action)}),toolbarAction}]}),CLASS({"package":"com.google.mail",name:"EMailCitationView","extends":"foam.ui.DetailView",requires:["foam.ui.md.MonogramStringView","foam.ui.RelativeDateTimeFieldView","foam.ui.ImageBooleanView"],imports:["controller"],properties:[{name:"className",defaultValue:"email-citation"},{name:"preferredHeight",defaultValue:82,help:"Specifying the preferred height of this view for the ScrollView, since an empty row is too small."}],templates:[{name:"CSS",code:ConstantTemplate(".email-citation{display:-webkit-flex;display:flex;display:-webkit-flex;border-bottom:solid #B5B5B5 1px;padding:10px 14px 10px 6px;height:82px}.email-citation.unread{font-weight:bold}.email-citation .from{display:block;font-size:17px;line-height:24px;white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;-webkit-flex-grow:1;flex-grow:1;-webkit-flex-grow:1}.email-citation .timestamp{font-size:12px;color:rgb(17, 85, 204);white-space:nowrap;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-shrink:0}.email-citation .subject{display:block;font-size:13px;line-height:17px;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}.email-citation .snippet{color:rgb(119, 119, 119);display:block;font-size:13px;height:20px;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap}.email-citation .monogram-string-view{margin:auto 6px auto 0}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n      ");var id=this.setClass("unread",function(){return self.data&&self.data.unread},this.id);return out('\n\n      <div id="',id,'" ',self.cssClassAttr()," >\n        ",self.createTemplateView("from",{model_:"foam.ui.md.MonogramStringView"}),'\n        <div style="flex: 1; -webkit-flex: 1">\n          <div style="display: flex; display: -webkit-flex">\n            ',self.createTemplateView("from",{mode:"read-only",className:"from",escapeHTML:!0}),"\n            ",self.createTemplateView("timestamp",{model_:"foam.ui.RelativeDateTimeFieldView",mode:"read-only",className:"timestamp"}),"\n          </div>\n          <div style=\"display: flex; display: -webkit-flex\">\n            <div style='flex-grow: 1; -webkit-flex-grow: 1'>\n              ",self.createTemplateView("subject",{mode:"read-only",className:"subject"}),"\n              ",self.createTemplateView("snippet",{mode:"read-only",className:"snippet"}),"\n            </div>\n            ",self.createTemplateView("starred",{model_:"foam.ui.ImageBooleanView",className:"star",trueImage:"images/ic_star_24dp.png",falseImage:"images/ic_star_outline_24dp.png"}),"\n          </div>\n        </div>\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"MonogramStringView","extends":"foam.ui.View",traits:["foam.ui.md.ColoredBackgroundTrait"],properties:[{name:"className",defaultValue:"monogram-string-view"},{name:"tooltip",defaultValueFn:function(){return this.data}},{name:"data",postSet:function(old,nu){this.updateHTML()}},{name:"width",defaultValue:40},{name:"height",defaultValueFn:function(){return this.width}}],methods:[function generateColor(data){return data?this.SUPER(data):"url(images/silhouette.png) center no-repeat #e0e0e0"},function updateHTML(){return this.$&&(this.$.style.background=this.generateColor(this.data)),this.SUPER()}],templates:[{name:"CSS",code:ConstantTemplate(".monogram-string-view{-webkit-align-items:center;-webkit-flex-grow:0;-webkit-flex-shrink:0;-webkit-justify-content:center;-webkit-align-items:center;align-items:center;border-radius:50%;border:1px solid rgba(0, 0, 0, .1);box-sizing:border-box;color:#fff;display:-webkit-inline-flex;display:inline-flex;-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;font-size:20px;-webkit-justify-content:center;justify-content:center;margin-right:16px;overflow:hidden;padding-bottom:2px}"),language:"css"},{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out(" ",this.data[0]&&this.data[0].toUpperCase()||"&nbsp;"," "),out.toString()},language:"html"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),' style="background: ',this.generateColor(this.data),"; width: ",this.width,"px; height: ",this.height,'px">\n        ',this.toInnerHTML(),"\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"ColoredBackgroundTrait",properties:[{name:"colors",defaultValue:["e8ad62","9b26af","6639b6","4184f3","02a8f3","00bbd3","009587","0e9c57","9e9c57","8ac249","ccdb38","ffea3a","f3b300","ff9700","ff5621","785447"]}],methods:[function generateColor(data){return"#"+this.colors[Math.abs(data.hashCode())%this.colors.length]},function generateColorStyle(data){return' style="background:'+this.generateColor(data)+';"'}]}),CLASS({"package":"foam.ui",name:"RelativeDateTimeFieldView",label:"Relative Date-Time Field","extends":"foam.ui.DateTimeFieldView",properties:[{name:"mode",defaultValue:"read-only"}],methods:[function valueToDom(value){return value?value.toRelativeDateString():""}]}),CLASS({"package":"foam.ui",name:"DateTimeFieldView",label:"Date-Time Field","extends":"foam.ui.SimpleView",properties:[{model_:"StringProperty",name:"name",type:"String"},{model_:"StringProperty",name:"mode",type:"String",defaultValue:"read-write"},{name:"domValue",postSet:function(oldValue){oldValue&&this.value&&Events.unlink(oldValue,this.value)}},{name:"data"},{model_:"BooleanProperty",name:"localeAware",help:"allow editing of date time in local timezone",defaultValue:!0}],methods:[function valueToDom(value){return value?this.localeAware?value.getTime()-6e4*value.getTimezoneOffset():value.getTime():0},function domToValue(dom){var d=new Date(dom);return this.localeAware?new Date(d.getTime()+6e4*d.getTimezoneOffset()):d},function toHTML(){return"read-write"===this.mode?'<input id="'+this.id+'" type="datetime-local" name="'+this.name+'"/>':'<span id="'+this.id+'" name="'+this.name+'" '+this.cssClassAttr()+"></span>"},function initHTML(){this.SUPER(),this.domValue=DomValue.create(this.$,"read-write"===this.mode?"input":void 0,"read-write"===this.mode?"valueAsNumber":"textContent"),Events.relate(this.data$,this.domValue,this.valueToDom.bind(this),this.domToValue.bind(this))}]}),CLASS({"package":"foam.ui",name:"ImageBooleanView","extends":"foam.ui.SimpleView",properties:[{name:"data",postSet:function(old,nu){this.updateHTML()}},{model_:"StringProperty",name:"name",label:"Name",type:"String",defaultValue:""},{name:"trueImage"},{name:"falseImage"},{name:"trueClass"},{name:"falseClass"}],methods:[function image(){return this.data?this.trueImage:this.falseImage},function toHTML(){var id=this.id;return this.on("click",this.onClick,id),this.name?'<img id="'+id+'" '+this.cssClassAttr()+'" name="'+this.name+'">':'<img id="'+id+'" '+this.cssClassAttr()+">"},function initHTML(){this.$&&(this.SUPER(),this.updateHTML())},function updateHTML(){this.$&&(this.$.src=this.image(),this.data?(this.trueClass&&this.$.classList.add(this.trueClass),this.falseClass&&this.$.classList.remove(this.falseClass)):(this.trueClass&&this.$.classList.remove(this.trueClass),this.falseClass&&this.$.classList.add(this.falseClass)))}],listeners:[{name:"onClick",code:function(e){e.stopPropagation(),this.data=!this.data}}]}),CLASS({"package":"com.google.mail",name:"EMailDAO","extends":"foam.dao.ProxyDAO",requires:["Binding","foam.dao.CachingDAO","foam.dao.ContextualizingDAO","foam.dao.FutureDAO","foam.dao.IDBDAO","MDAO","PersistentContext","com.google.mail.FOAMGMailMessage","com.google.mail.GMailMessageDAO","com.google.mail.GMailToEMailDAO","com.google.mail.Sync","com.google.mail.SyncDecorator","foam.core.dao.MergeDAO","foam.core.dao.PropertyOffloadDAO","foam.core.dao.StripPropertiesDAO","foam.core.dao.CloningDAO","foam.core.dao.VersionNoDAO","foam.lib.email.EMail"],imports:["setInterval"],exports:["as emailDao"],properties:[{model_:"BooleanProperty",name:"withSync",type:"Boolean",defaultValue:!0},{model_:"IntProperty",name:"syncInterval",type:"Int",defaultValue:3e4},{name:"persistentContext",lazyFactory:function(){var context={};return this.PersistentContext.create({dao:this.IDBDAO.create({model:this.Binding,name:"EMailDAO-Bindings"}),predicate:NOT_TRANSIENT,context:context})}},{name:"remoteDao",factory:function(){var future=afuture();return this.persistentContext.bindObject("remoteDao",this.GMailMessageDAO)(future.set),this.GMailToEMailDAO.create({delegate:this.FutureDAO.create({future:future.get})})}},{name:"bodyDAO",factory:function(){return this.IDBDAO.create({model:this.EMail,name:"EMail-Bodies",loadOnSelect:!1})}},{model_:"foam.core.types.DAOProperty",name:"delegate",factory:function(){return this.ContextualizingDAO.create({delegate:this.VersionNoDAO.create({property:this.EMail.CLIENT_VERSION,delegate:this.cachingDAO})})},type:"foam.core.types.DAO"},{name:"cachingDAO",factory:function(){return this.PropertyOffloadDAO.create({property:this.EMail.BODY,offloadDAO:this.bodyDAO,delegate:this.CloningDAO.create({delegate:this.CachingDAO.create({src:this.IDBDAO.create({model:this.EMail}),delegate:this.MDAO.create({model:this.EMail})})})})},postSet:function(_,dao){dao.select(COUNT())(function(c){0===c.count&&this.StripPropertiesDAO.create({delegate:this.remoteDao,propertyNames:["serverVersion"]}).where(EQ(this.EMail.LABELS,"INBOX")).limit(100).select(dao)}.bind(this))}},{name:"sync",factory:function(){if(this.withSync){var sync=this.Sync.create({local:this.SyncDecorator.create({delegate:this.MergeDAO.create({delegate:this.cachingDAO,mergeStrategy:function(ret,oldValue,newValue){newValue.clientVersion<oldValue.clientVersion&&(newValue.labelIds=oldValue.labelIds,newValue.clientVersion=oldValue.clientVersion),ret(newValue)}})}),remote:this.remoteDao,localVersionProp:this.EMail.CLIENT_VERSION,remoteVersionProp:this.EMail.SERVER_VERSION,deletedProp:this.EMail.DELETED,initialSyncWindow:100});return this.delegate.listen(this.doSync),this.setInterval(this.doSync,this.syncInterval),sync}}}],listeners:[{name:"doSync",code:function(){this.sync.sync()},isMerged:1e3}]}),CLASS({"package":"foam.dao",name:"CachingDAO","extends":"foam.dao.ProxyDAO",requires:["foam.dao.FutureDAO"],properties:[{name:"src"},{name:"cache",labels:["javascript"],getter:function(){return this.delegate},setter:function(dao){this.delegate=dao},help:"Alias for delegate."},{model_:"BooleanProperty",name:"initWithFutureDao",type:"Boolean",swiftDefaultValue:"true",defaultValue:!0},{name:"model",defaultValueFn:function(){return this.src.model||this.cache.model}}],methods:[function init(){this.SUPER();var src=this.src,cache=this.cache,futureDelegate=afuture();this.initWithFutureDao&&(this.cache=this.FutureDAO.create({future:futureDelegate.get})),src.select(cache)(function(){src.listen(cache),futureDelegate.set(cache),this.cache=cache}.bind(this))},function put(obj,sink){this.src.put(obj,sink)},function remove(query,sink){this.src.remove(query,sink)},function removeAll(sink,options){return this.src.removeAll(sink,options)}]}),CLASS({"package":"foam.dao",name:"ContextualizingDAO","extends":"foam.dao.ProxyDAO",methods:[function find(id,sink){var X=this.Y;this.delegate.find(id,{put:function(o){o.X=X,sink&&sink.put&&sink.put(o)},error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}})}]}),CLASS({"package":"foam.dao",name:"IDBDAO",label:"IndexedDB DAO","extends":"AbstractDAO",properties:[{model_:"ModelProperty",name:"model",type:"Model",required:!0},{model_:"StringProperty",name:"name",label:"Store Name",type:"String",defaultValueFn:function(){return this.model.id}},{model_:"BooleanProperty",name:"useSimpleSerialization",type:"Boolean",defaultValue:!0},{model_:"StringArrayProperty",name:"indicies",type:"StringArray"}],methods:[function init(){this.SUPER();for(var propKeys=this.propKeys_={},properties=this.model.getRuntimeProperties(),i=0;i<properties.length;i++){var prop=properties[i];propKeys[prop.name]=prop.name,prop.shortName&&(propKeys[prop.shortName]=prop.name)}this.useSimpleSerialization?(this.serialize=this.SimpleSerialize,this.deserialize=this.SimpleDeserialize):(this.serialize=this.FOAMSerialize,this.deserialize=this.FOAMDeserialize),this.withDB=amemo(this.openDB.bind(this))},function FOAMDeserialize(json){return JSONToObject.visitObject(json)},function FOAMSerialize(obj){return ObjectToJSON.visitObject(obj)},function SimpleDeserialize(json){var obj=this.model.create();for(var key in json){var key2=this.propKeys_[key];key2&&(obj[key2]=json[key])}return obj},function SimpleSerialize(obj){var s={};for(var key in obj.instance_){var prop=obj.model_.getProperty(key),val=obj.instance_[key];prop["transient"]||val===prop.defaultValue||(s[prop.shortName||prop.name]=val)}return s},function openDB(cc){var indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,request=indexedDB.open("FOAM:"+this.name,1);request.onupgradeneeded=function(e){for(var store=e.target.result.createObjectStore(this.name),i=0;i<this.indicies.length;i++)store.createIndex(this.indicies[i][0],this.indicies[i][0],{unique:this.indicies[i][1]})}.bind(this),request.onsuccess=function(e){cc(e.target.result)}.bind(this),request.onerror=function(e){console.log("************** failure",e)}},function withStore(mode,fn){if("readwrite"!==mode)return this.withStore_(mode,fn);var self=this;if(this.q_)this.q_.push(fn),1e4==this.q_.length&&(this.q_=void 0);else{var q=[fn];this.q_=q,EventService.async(function(){self.withStore_(mode,function(store){self.q_==q&&(self.q_=void 0);for(var i=0;i<q.length;i++)q[i](store)})},this.X)()}},function withStore_(mode,fn){if(GLOBAL.__TXN__&&GLOBAL.__TXN__.store)try{return void fn.call(this,__TXN__.store)}catch(x){GLOBAL.__TXN__=void 0}this.withDB(function(db){var tx=db.transaction([this.name],mode),os=tx.objectStore(this.name);GLOBAL.__TXN__&&(GLOBAL.__TXN__.store=os),fn.call(this,os)}.bind(this))},function put(value,sink){var self=this;this.withStore("readwrite",function(store){var request=store.put(self.serialize(value),value[self.model.ids[0]]);request.transaction.addEventListener("complete",function(e){self.notify_("put",[value]),sink&&sink.put&&sink.put(value)}),request.transaction.addEventListener("error",function(e){sink&&sink.error&&sink.error("put",value)})})},function find(key,sink){if(Expr.isInstance(key)){var found=!1;return void this.limit(1).where(key).select({put:function(){found=!0,sink.put.apply(sink,arguments)},eof:function(){found||sink.error("find",key)}})}var self=this;this.withStore("readonly",function(store){var request=store.get(key);request.transaction.addEventListener("complete",function(){if(!request.result)return void(sink&&sink.error&&sink.error("find",key));var result=self.deserialize(request.result);sink&&sink.put&&sink.put(result)}),request.onerror=function(e){sink&&sink.error&&sink.error("find",key)}})},function remove(obj,sink){var self=this,key=void 0!=obj[this.model.ids[0]]?obj[this.model.ids[0]]:obj;this.withStore("readwrite",function(store){var getRequest=store.get(key);getRequest.onsuccess=function(e){if(!getRequest.result)return void(sink&&sink.error&&sink.error("remove",obj));var data=self.deserialize(getRequest.result),delRequest=store["delete"](key);delRequest.transaction.addEventListener("complete",function(e){self.notify_("remove",[data]),sink&&sink.remove&&sink.remove(data)}),delRequest.onerror=function(e){sink&&sink.error&&sink.error("remove",e)}},getRequest.onerror=function(e){sink&&sink.error&&sink.error("remove",e)}})},function removeAll(sink,options){var query=options&&options.query&&options.query.partialEval()||{f:function(){return!0}},future=afuture(),self=this;return options||sink&&sink.remove||this.daoListeners_&&0!=this.daoListeners_.length?(this.withStore("readwrite",function(store){var request=store.openCursor();request.onsuccess=function(e){var cursor=e.target.result;if(cursor){var value=self.deserialize(cursor.value);if(query.f(value)){var deleteReq=cursor["delete"]();deleteReq.transaction.addEventListener("complete",function(){self.notify_("remove",[value]),sink&&sink.remove&&sink.remove(value)}),deleteReq.onerror=function(e){sink&&sink.error&&sink.error("remove",e)}}cursor["continue"]()}},request.transaction.oncomplete=function(){sink&&sink.eof&&sink.eof(),future.set(sink)},request.onerror=function(e){sink&&sink.error&&sink.error("remove",e)}}),future.get):(this.withStore("readwrite",function(store){var req=store.clear();req.onsuccess=function(){future.set()},req.onerror=function(){future.set()}}),future.get)},function select(sink,options){sink=sink||[].sink,sink=this.decorateSink_(sink,options,!1);var fc=this.createFlowControl_(),future=afuture(),self=this;return this.withStore("readonly",function(store){if(options&&options.query&&EqExpr.isInstance(options.query)&&store.indexNames.contains(options.query.arg1.name))var request=store.index(options.query.arg1.name).openCursor(IDBKeyRange.only(options.query.arg2.f()));else var request=store.openCursor();request.onsuccess=function(e){var cursor=e.target.result;if(!fc.stopped){if(fc.errorEvt)return sink.error&&sink.error(fc.errorEvt),void future.set(sink,fc.errorEvt);if(!cursor)return sink.eof&&sink.eof(),void future.set(sink);var value=self.deserialize(cursor.value);sink.put(value),cursor["continue"]()}},request.onerror=function(e){sink.error&&sink.error(e)}}),future.get},function addIndex(prop){return this.indicies.push([prop.name,!1]),this}],listeners:[{name:"updated",code:function(evt){console.log("updated: ",evt),this.publish("updated")}}]}),CLASS({"package":"com.google.mail",name:"FOAMGMailMessage","extends":"com.google.mail.GMailMessage",plural:"messages",requires:["foam.util.Base64Decoder","foam.util.Base64Encoder","foam.util.encodings.IncrementalUtf8"],properties:[{name:"emailId"},{model_:"StringProperty",name:"historyId",type:"String",help:"The ID of the last history record that modified this message."},{model_:"StringProperty",name:"id",type:"String",help:"The immutable ID of the message."},{model_:"StringArrayProperty",name:"labelIds",type:"StringArray",help:"List of IDs of labels applied to this message."},{name:"payload",subType:"MessagePart",help:"The parsed email structure in the message parts."},{model_:"StringProperty",name:"raw",type:"String",help:"The entire email message in an RFC 2822 formatted string. Returned in messages.get and drafts.get responses when the format=RAW parameter is supplied."},{model_:"IntProperty",name:"sizeEstimate",type:"Int",help:"Estimated size in bytes of the message."},{model_:"StringProperty",name:"snippet",type:"String",help:"A short part of the message text."},{model_:"StringProperty",name:"threadId",type:"String",help:'The ID of the thread the message belongs to. To add a message or draft to a thread, the following criteria must be met: \n- The requested threadId must be specified on the Message or Draft.Message you supply with your request. \n- The References and In-Reply-To headers must be set in compliance with the <a href="https://tools.ietf.org/html/rfc2822"RFC 2822 standard. \n- The Subject headers must match.'},{model_:"BooleanProperty",name:"deleted",type:"Boolean"},{model_:"BooleanProperty",name:"isSent",type:"Boolean",defaultValue:!1},{model_:"IntProperty",name:"clientVersion",type:"Int"},{model_:"StringProperty",name:"draftId",type:"String"},{model_:"StringProperty",name:"messageId",type:"String"}],constants:[{name:"FOAM_MESSAGEID_HEADER",value:"X-FOAM-Message-ID"}],methods:[function getHeader(name){if(!this.payload)return null;for(var i=0;i<this.payload.headers.length;i++)if(this.payload.headers[i].name===name)return this.payload.headers[i].value;return null},function setHeader(name,value){if(this.payload){for(var i=0;i<this.payload.headers.length;i++)if(this.payload.headers[i].name===name)return void(this.payload.headers[i].value=value);this.payload.headers.push({name:name,value:value})}},function toRaw(){function doPart(p){for(var i=0,header;header=p.headers[i];i++)if(buffer+=header.name+": "+header.value+"\r\n","Content-Type"===header.name&&header.value.startsWith("multipart"))var boundary=header.value.match(/boundary=([\S]+)/)[1];if(buffer+="\r\n",p.body&&p.body.size>0){var decoder=self.Base64Decoder.create({sink:self.IncrementalUtf8.create(),bufsize:p.body.size});decoder.put(p.body.data),decoder.eof(),buffer+=decoder.sink.string}if(p.parts&&p.parts.length>0){for(var i=0,part;part=p.parts[i];i++)buffer+="--"+boundary+"\r\n",doPart(part),buffer+="\r\n";buffer+="--"+boundary+"--\r\n"}}var buffer="",self=this,obj=this.clone();return obj.clearProperty("payload"),obj.raw||(doPart(this.payload),obj.raw=this.Base64Encoder.create({urlSafe:!0}).encode(new Uint8Array(stringtoutf8(buffer)))),obj}]}),CLASS({"package":"foam.util",name:"Base64Encoder",properties:[{name:"table",defaultValueFn:function(){return this.TABLE}},{model_:"BooleanProperty",name:"urlSafe",type:"Boolean",postSet:function(_,v){this.table=this.TABLE.clone(),v&&(this.table[62]="-",this.table[63]="_")}}],constants:[{name:"TABLE",value:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"]}],methods:[function encode(b,opt_break){var result="",out;if(opt_break>=0){var count=0;out=function(c){result+=c,count=(count+1)%opt_break,0===count&&(result+="\r\n")}}else out=function(c){result+=c};for(var view=new Uint8Array(b),i=0;i+2<b.byteLength;i+=3)out(this.table[view[i]>>>2]),out(this.table[(3&view[i])<<4|view[i+1]>>>4]),out(this.table[(15&view[i+1])<<2|view[i+2]>>>6]),out(this.table[63&view[i+2]]);return i<b.byteLength&&(out(this.table[view[i]>>>2]),i+1<b.byteLength?(out(this.table[(3&view[i])<<4|view[i+1]>>>4]),out(this.table[(15&view[i+1])<<2])):(out(this.table[(3&view[i])<<4]),out("=")),out("=")),result}]}),CLASS({"package":"foam.util.encodings",name:"IncrementalUtf8",properties:[{name:"charcode",defaultValue:null},{name:"remaining",defaultValue:0},{name:"string"}],methods:[function reset(){this.string="",this.remaining=0,this.charcode=null},function put(byte){if(byte instanceof ArrayBuffer)for(var data=new Uint8Array(byte),i=0;i<data.length;i++)this.put(data[i]);else{if(null==this.charcode)if(this.charcode=byte,128&this.charcode)if(192==(224&this.charcode))this.remaining=1,this.charcode=(31&byte)<<6*this.remaining;else if(224==(240&this.charcode))this.remaining=2,this.charcode=(15&byte)<<6*this.remaining;else if(240==(248&this.charcode))this.remaining=3,this.charcode=(7&byte)<<6*this.remaining;else if(248==(252&this.charcode))this.remaining=4,this.charcode=(3&byte)<<6*this.remaining;else{if(252!=(254&this.charcode))throw"Bad charcode value";this.remaining=5,this.charcode=(1&byte)<<6*this.remaining}else this.remaining=0,this.charcode=(127&byte)<<6*this.remaining;else this.remaining>0&&(this.remaining--,this.charcode|=(63&byte)<<6*this.remaining);0==this.remaining&&(this.string+=String.fromCharCode(this.charcode),this.charcode=void 0)}}]}),CLASS({"package":"com.google.mail",name:"GMailMessage",plural:"messages",properties:[{model_:"StringProperty",name:"historyId",type:"String",help:"The ID of the last history record that modified this message."},{model_:"StringProperty",name:"id",type:"String",help:"The immutable ID of the message."},{model_:"StringArrayProperty",name:"labelIds",type:"StringArray",help:"List of IDs of labels applied to this message."},{name:"payload",subType:"MessagePart",help:"The parsed email structure in the message parts."},{model_:"StringProperty",name:"raw",type:"String",help:"The entire email message in an RFC 2822 formatted string. Returned in messages.get and drafts.get responses when the format=RAW parameter is supplied."},{model_:"IntProperty",name:"sizeEstimate",type:"Int",help:"Estimated size in bytes of the message."},{model_:"StringProperty",name:"snippet",type:"String",help:"A short part of the message text."},{model_:"StringProperty",name:"threadId",type:"String",help:'The ID of the thread the message belongs to. To add a message or draft to a thread, the following criteria must be met: \n- The requested threadId must be specified on the Message or Draft.Message you supply with your request. \n- The References and In-Reply-To headers must be set in compliance with the <a href="https://tools.ietf.org/html/rfc2822"RFC 2822 standard. \n- The Subject headers must match.'}]}),CLASS({"package":"com.google.mail",name:"GMailMessageDAO","extends":"com.google.mail.GMailRestDAO",requires:["com.google.mail.FOAMGMailMessage","com.google.mail.GMailRestDAO","com.google.mail.GMailDraft","com.google.mail.GMailMessage","com.google.mail.GMailHistory","foam.dao.NullDAO","com.google.mail.GMailHistory"],imports:["ajsonp"],properties:[{name:"url","transient":!0,defaultValue:"https://www.googleapis.com/gmail/v1/users"},{name:"modelName","transient":!0,defaultValueFn:function(){return this.model.plural}},{name:"xhr","transient":!0,factory:function(){return this.X.XHR.create({responseType:"json"},this.Y)}},{name:"model",visibility:"hidden",hidden:!0,"transient":!0,defaultValueFn:function(){return this.FOAMGMailMessage}},{name:"messageUrl","transient":!0,defaultValueFn:function(){return this.url+"/me/messages"}},{name:"draftUrl","transient":!0,defaultValueFn:function(){return this.url+"/me/drafts"}},{name:"draftDao",visibility:"hidden",hidden:!0,"transient":!0,factory:function(){return this.GMailRestDAO.create({model:this.GMailDraft})}},{name:"localDao",visibility:"hidden",hidden:!0,"transient":!0,factory:function(){return this.NullDAO.create({model:this.GMailMessage})}},{name:"historyDao",visibility:"hidden",hidden:!0,"transient":!0,factory:function(){return this.GMailRestDAO.create({model:this.GMailHistory})}},{model_:"IntProperty",name:"pollingPeriod",type:"Int",units:"ms",defaultValue:1e4},{model_:"BooleanProperty",name:"syncing",type:"Boolean","transient":!0,defaultValue:!1},{model_:"IntProperty",name:"lastClientVersion",type:"Int"}],methods:[function listen(l,options){this.SUPER(l,options),1===this.daoListeners_.length&&this.startSync()},function unlisten(l){this.SUPER(l),0===this.daoListeners_.length&&this.stopSync()},function doSync(ret){var self=this;this.historyDao.where(GT(this.GMailHistory.ID,self.lastHistoryId)).select({put:function(item){self.lastHistoryId=item.id;for(var i=0,msg;msg=item.messages[i];i++)self.find(msg.id,{put:function(obj){self.notify_("put",[obj])},error:function(_,status){if(404===status){var obj=self.jsonToObj(msg);return void self.notify_("remove",[obj])}}})},error:function(){ret()},eof:function(){ret()}})},function startSync(){var self=this;this.syncing||aseq(function(ret){return self.syncing=!0,self.lastHistoryId?void ret():void self.limit(1).select()(function(msgs){return msgs&&0!==msgs.length?(self.lastHistoryId=msgs[0].historyId,void ret()):void self.X.setTimeout(self.startSync.bind(self),6e4)})},awhile(function(){return self.syncing},aseq(function(ret){self.doSync(ret)},function(ret){self.X.setTimeout(ret,self.pollingPeriod)})))(function(){})},function stopSync(){this.syncing=!1},function postProcessObject(ret,error,obj){var self=this,earlyOut=ret;return obj.payload?1===obj.payload.headers.length&&"From"===obj.payload.headers[0].name?(obj.labelIds=["CHAT"].concat(obj.labelIds),void ret(obj)):void aseq(aif(function(){return-1!=obj.labelIds.indexOf("DRAFT")&&0!=obj.id.indexOf("draft_")},aseq(function(ret){self.setDraftId_(ret,obj)},function(ret,success){return success?void ret():(error("Could not find matching draft for "+obj.id),void earlyOut(null))})),function(ret){ret(obj)})(ret):void this.find(obj.id,{put:function(o){ret(o)},error:function(){error("Failed to find object."),ret(null)}})},function onSelectData(ret,data,sink,fc){if(!sink||!sink.put)return void ret();var self=this,obj,earlyOut=ret,tmp;aseq(function(ret){self.postProcessObject(ret,fc.error.bind(fc),data)},function(ret,o){return"CHAT"===o.labelIds[0]?void ret():(fc.errorEvt||sink.put(o,null,fc),void ret())})(ret)},function setDraftId_(ret,obj){var self=this;self.draftDao.where(EQ({partialEval:function(){return this},f:function(o){return o.message.id}},obj.id)).limit(1).select()(function(drafts){return 0===drafts.length?void ret(!1):(obj.messageId=drafts[0].message.id,obj.draftId=drafts[0].id,obj.id=obj.getHeader(obj.FOAM_MESSAGEID_HEADER)||"draft_"+obj.draftId,void ret(!0))})},function sendDraft_(ret,draftId,obj,sink){return void ret();var self},function saveDraft_(ret,draftId,obj,url,method,sink){var self=this;aseq(function(ret){var raw=obj.toRaw(),payload={id:draftId,message:{raw:raw.raw}},formatter={__proto__:JSONUtil.pretty,outputModel_:function(){}};self.xhr.asend(ret,self.draftUrl+url,formatter.stringify(payload),method)},function(ret,response,xhr){return xhr.status<200||xhr.status>=300?void(sink&&sink.error&&sink.error(["Error updating/creating draft.",url,method])):(self.lastClientVersion=Math.max(self.lastClientVersion,obj.clientVersion),void self.find("draft_"+response.id,{put:function(o){o.messageId=response.message.id,o.draftId=response.id,o.clientVersion=obj.clientVersion,ret(o)},error:function(){sink&&sink.error&&sink.error(["Error fetching created message."])}}))})(ret)},function put(obj,sink){var self=this,jsonToObj,dstUrl,dstMethod;if(obj.setHeader(obj.FOAM_MESSAGEID_HEADER,obj.id),0===obj.id.indexOf("draft_"))var draftId=obj.draftId||obj.id.substring(6);aif(0===obj.id.indexOf("draft_"),aseq(function(ret){self.xhr.asend(ret,self.draftUrl+"/"+draftId+"?format=minimal")},function(ret,response,xhr){if(dstUrl="/"+draftId,dstMethod="PUT",404===xhr.status)dstUrl="",dstMethod="POST";else if(200!==xhr.status)return void(sink&&sink.error&&sink.error(["Can't fetch draft."]));self.saveDraft_(ret,draftId,obj,dstUrl,dstMethod,sink)},aif(obj.isSent,function(ret,draft){self.sendDraft_(ret,draft.draftId,draft,sink)},function(ret,draft){self.lastClientVersion=Math.max(self.lastClientVersion,obj.clientVersion),sink&&sink.put&&sink.put(obj)})),aseq(function(ret){self.xhr.asend(ret,self.messageUrl+"/"+obj.id+"?format=minimal")},function(ret,response,xhr){
if(xhr.status<200||xhr.status>=300)return void(sink&&sink.error&&sink.error(["Error fetching message for comparison."]));var msg=self.jsonToObj(response),diff=msg.labelIds.diff(obj.labelIds);if(0==diff.added.length&&0==diff.removed.length)return void ret({},xhr);var payload={addLabelIds:diff.added,removeLabelIds:diff.removed};self.xhr.asend(ret,self.messageUrl+"/"+obj.id+"/modify",JSON.stringify(payload),"POST")},function(ret,response,xhr){return xhr.status<200||xhr.status>=300?void(sink&&sink.error&&sink.error(["Error modifying message."])):(obj=obj.deepClone(),response.labelIds&&(obj.labelIds=response.labelIds),self.lastClientVersion=Math.max(self.lastClientVersion,obj.clientVersion),void(sink&&sink.put&&sink.put(obj)))}))(function(){})},function remove(obj,sink){sink&&sink.error&&sink.error("Unimplemented.")},function find(key,sink){if(key.startsWith("draft_"))return void this.findDraft_(key,sink);var self=this;this.SUPER(key,{put:function(o){self.postProcessObject(function(obj){!obj&&sink?sink.error():sink&&sink.put&&sink.put(obj)},sink&&sink.error?sink.error.bind(sink):function(){},o)},error:function(args){return 404===args[1]?void(sink&&sink.put&&sink.put(self.model.create({id:key,deleted:!0}))):void(sink&&sink.error&&sink.error.apply(sink,arguments))}})},function findDraft_(key,sink){var self=this;aseq(function(ret){self.xhr.asend(ret,self.draftUrl+"/"+key.substring(6)+"?format=full")},function(ret,response,xhr){if(xhr.status<200||xhr.status>=300||!response)return void(sink&&sink.error&&sink.error(["Error fetching draft",response,xhr]));var msg=self.jsonToObj(response.message);msg.id="draft_"+response.id,sink&&sink.put&&sink.put(msg),ret()})(function(){})},function selectFromHistory_(sink,historyId){sink=sink||[];var fc=this.createFlowControl_(),self=this,future=afuture();return this.historyDao.where(GT(this.GMailHistory.ID,historyId)).select()(function(items){if(!items||!items.length)return void future.set(sink);var next=function(){var i=0,j=0,item=items[0];return function me(){return item?item.messages&&item.messages[j]?item.messages[j++]:(j=0,item=items[++i],me()):null}}(),current;awhile(function(){return current=next(),current&&!fc.stopped},aseq(function(ret){self.find(current.id,{put:ret,error:function(){sink.error&&sink.error.apply(sink,arguments),future.set(sink)}})},function(ret,obj){return fc.errorEvt?(sink.error&&sink.error(fc.errorEvt),void future.set(sink)):("CHAT"!=obj.labelIds[0]&&sink.put&&sink.put(obj,null,fc),void ret())}))(function(){sink.eof&&sink.eof(),future.set(sink)})}),future.get},function select(sink,options){if(sink=sink||[].sink,MaxExpr.isInstance(sink)&&sink.arg1==this.model.CLIENT_VERSION)return sink.max=this.lastClientVersion,aconstant(sink);if(options&&options.query){var query=options&&options.query;if(GtExpr.isInstance(query)&&query.arg1==this.model.getPrototype().HISTORY_ID&&0!==query.arg2.f())return this.selectFromHistory_(sink,query.arg2.f())}return this.SUPER(sink,options)}]}),CLASS({"package":"com.google.mail",name:"GMailRestDAO","extends":"foam.core.dao.RestDAO",requires:["com.google.mail.GMailHistory"],imports:["ajsonp"],properties:[{name:"daoListeners_",visibility:"hidden",hidden:!0,"transient":!0,factory:function(){return[]}},{name:"model",label:"Type of data stored in this DAO."},{model_:"ArrayProperty",name:"paramProperties",type:"Array",help:"Properties that are handled as separate parameters rather than in the query.",subType:"Property"},{model_:"IntProperty",name:"batchSize",type:"Int",defaultValue:200},{model_:"IntProperty",name:"skipThreshold",type:"Int",defaultValue:1e3},{name:"url",label:"REST API URL.",defaultValue:"https://www.googleapis.com/gmail/v1/users"},{name:"modelName",defaultValueFn:function(){return this.model.plural}},{name:"xhr","transient":!0,factory:function(){return this.X.XHR.create({responseType:"json"},this.Y)}},{name:"ajsonp",visibility:"hidden",hidden:!0,"transient":!0}],methods:[function buildURL(){return this.url+"/me/"+this.modelName},function buildSelectParams(sink,query){var params=[];return CountExpr.isInstance(sink)&&params.push("maxResults=1"),this.GMailHistory.isSubModel(this.model)&&GtExpr.isInstance(query)&&query.arg1===this.GMailHistory.ID&&params.push("startHistoryId="+query.arg2.f()),this.model.LABEL_IDS&&EqExpr.isInstance(query)&&this.model.LABEL_IDS==query.arg1&&params.push("labelIds="+encodeURIComponent(query.arg2)),params},function select(sink,options){sink=sink||[],options&&!CountExpr.isInstance(sink)&&(sink=this.decorateSink_(sink,options)),options=options||{};var params=this.buildSelectParams(sink,options.query);options.limit&&!options.query&&params.push("maxResults="+options.limit);var url=this.buildURL(),fc=this.createFlowControl_(),self=this,future=afuture(),pageToken;return awhile(function(){return!fc.stopped&&!fc.errorEvt},aseq(function(ret){var p=pageToken?params.concat("pageToken="+pageToken):params;self.xhr.asend(ret,url+"?"+p.join("&"))},function(ret,data){if(!data||!data[self.modelName])return fc.error("No data"),void ret();CountExpr.isInstance(sink)&&(sink.count=data.resultSizeEstimate,fc.stop());var items=data[self.modelName],i=0;pageToken=data.nextPageToken,awhile(function(){return i<items.length},function(ret){return fc.stopped?(i=items.length,void ret()):fc.errorEvt?(sink.error&&sink.error(fc.errorEvt),i=items.length,void ret()):void self.onSelectData(ret,items[i++],sink,fc)})(ret)},function(ret){pageToken||fc.stop(),ret()}))(function(){sink.eof&&sink.eof(),future.set(sink)}),future.get},function onSelectData(ret,data,sink,fc){sink.put&&sink.put(this.jsonToObj(data),null,fc),ret()},function find(key,sink,options){options=options||{};var self=this,obj;aseq(function(ret){self.xhr.asend(ret,self.buildFindURL(key)+"?"+self.buildFindParams(options.urlParams).join("&"))},function(ret,response,xhr){return xhr.status<200||xhr.status>=300||!response?void(sink&&sink.error&sink.error(["Failed to find message.",xhr.status])):(obj=self.jsonToObj(response),sink&&sink.put&&sink.put(obj),void ret())})(function(){})},function buildFindURL(key){return this.url+"/me/"+this.modelName+"/"+key},function buildFindParams(urlParams){var params=urlParams||[];return params}]}),CLASS({"package":"com.google.mail",name:"GMailHistory",plural:"history",properties:[{model_:"StringProperty",name:"id",type:"String",help:"The mailbox sequence ID."},{model_:"ReferenceArrayProperty",name:"messages",type:"ReferenceArray",help:"The messages that changed in this history record.",subType:"Message",subKey:"ID"}]}),CLASS({"package":"foam.core.dao",name:"RestDAO","extends":"AbstractDAO",imports:["ajsonp"],properties:[{name:"model",label:"Type of data stored in this DAO."},{name:"url",label:"REST API URL."},{model_:"ArrayProperty",name:"paramProperties",type:"Array",help:"Properties that are handled as separate parameters rather than in the query.",subType:"Property"},{model_:"IntProperty",name:"batchSize",type:"Int",defaultValue:200},{model_:"IntProperty",name:"skipThreshold",type:"Int",defaultValue:1e3}],methods:[function jsonToObj(json){return this.model.create(json)},function objToJson(obj){return JSONUtil.compact.stringify(obj)},function buildURL(query){return this.url},function buildFindURL(key){return this.url+"/"+key},function buildPutURL(obj){return this.url},function buildPutParams(obj){return[]},function buildSelectParams(sink,query){return[]},function put(value,sink){var self=this,extra={};this.ajsonp(this.buildPutURL(value),this.buildPutParams(value),"POST",this.objToJson(value,extra))(function(resp,status){var obj;return void 0!==status&&200!==status||!(obj=self.jsonToObj(resp,extra))?void(sink&&sink.error&&sink.error([resp,status])):(sink&&sink.put&&sink.put(obj),void self.notify_("put",[obj]))})},function remove(query,sink){},function select(sink,options){sink=sink||[].sink;var fut=afuture(),self=this,limit,skipped=0,index=0,fc=this.createFlowControl_(),extra={},params=[];if(options){index+=options.skip||0;var query=options.query.partialEval(),url;if(query){var origQuery=query;query=query.normalize();var outquery=[query,origQuery.deepClone()];params=this.buildSelectParams(sink,outquery),url=this.buildURL(outquery,extra),query=outquery[0],origQuery=outquery[1];var mql=query.toMQL();mql&&params.push("q="+encodeURIComponent(query.toMQL()))}else url=this.buildURL();if(options.order){var sort=options.order.toMQL();params.push("sort="+sort)}options.limit&&(limit=options.limit)}var finished=!1;return awhile(function(){return!finished},function(ret){var batch=self.batchSize;if(Number.isFinite(limit))var batch=Math.min(batch,limit);CountExpr.isInstance(sink)&&(batch=0);var myparams=params.slice();myparams.push("maxResults="+batch),myparams.push("startIndex="+index),self.ajsonp(url,myparams)(Movement.whenIdle(function(data){if(CountExpr.isInstance(sink))return sink.count=data.totalResults,finished=!0,void ret();var items=data&&data.items?data.items:[];0==items.length&&(finished=!0),index+=items.length;for(var i=0;i<items.length;i++){var item=self.jsonToObj(items[i],extra);if(!origQuery||origQuery.f(item)){if(Number.isFinite(limit)){if(0>=limit){finished=!0;break}limit--}if(fc.stopped){finished=!0;break}if(fc.errorEvt){sink.error&&sink.error(fc.errorEvt),finished=!0;break}sink&&sink.put&&sink.put(item,null,fc)}else skipped++}0>=limit&&(finished=!0),(!data||index>=data.totalResults)&&(finished=!0),skipped>=self.skipThreshold&&(finished=!0),ret()}))})(function(){sink&&sink.eof&&sink.eof(),fut.set(sink)}),fut.get},function buildFindParams(key){return[]},function find(key,sink){var self=this;this.ajsonp(this.buildFindURL(key),this.buildFindParams())(function(data,status){var deserialized;return 200===status&&(deserialized=self.jsonToObj(data))?void(sink&&sink.put&&sink.put(deserialized)):void(sink&&sink.error&&sink.error("Network error"))})}]}),CLASS({"package":"com.google.mail",name:"GMailDraft",plural:"drafts",properties:[{model_:"StringProperty",name:"id",type:"String",help:"The immutable ID of the draft."},{name:"message",subType:"Message",help:"The message content of the draft."}]}),CLASS({"package":"com.google.mail",name:"GMailToEMailDAO","extends":"foam.core.dao.AbstractAdapterDAO",requires:["foam.lib.email.EMail","com.google.mail.FOAMGMailMessage","foam.util.Base64Encoder","foam.util.Base64Decoder","foam.util.encodings.IncrementalUtf8"],properties:[{model_:"ModelProperty",name:"model",type:"Model",defaultValueFn:function(){return this.EMail}}],methods:[function adaptSink_(sink){return MaxExpr.isInstance(sink)&&sink.arg1==this.EMail.CLIENT_VERSION?MAX(this.FOAMGMailMessage.CLIENT_VERSION,sink.arg2):this.SUPER(sink)},function init(args){this.SUPER(args);var identityMap=function(x){return x},toArrayMap=function(x){return x.split(",").map(function(x){return x.trim()})},fromArrayMap=function(x){return x.join(", ")},headersMap=[["Date","timestamp",identityMap,identityMap],["From","from",identityMap,identityMap],["To","to",identityMap,identityMap],["Cc","cc",toArrayMap,fromArrayMap],["Bcc","bcc",toArrayMap,fromArrayMap],["Reply-To","replyTo",toArrayMap,fromArrayMap],["Subject","subject",identityMap,identityMap]];this.writeHeaders=function(headers,obj){for(var i=0,mapping;mapping=headersMap[i];i++)obj.hasOwnProperty(mapping[1])&&(Array.isArray(obj[mapping[1]])&&0==obj[mapping[1]].length||headers.push({name:mapping[0],value:mapping[3](obj[mapping[1]])}))},this.readHeaders=function(headers,obj){for(var map={},i=0;i<headers.length;i++)map[headers[i].name]=headers[i].value;for(var i=0,mapping;mapping=headersMap[i];i++)map.hasOwnProperty(mapping[0])&&(obj[mapping[1]]=mapping[2](map[mapping[0]]))}},function aToB(obj){var msg=this.FOAMGMailMessage.create({id:obj.id,labelIds:obj.labels,isSent:obj.messageSent,clientVersion:obj.clientVersion,snippet:obj.snippet,deleted:obj.deleted}),headers=[];headers.push({name:"MIME-Version",value:"1.0"}),headers.push({name:"Content-Type",value:"text/html; charset=UTF-8"}),this.writeHeaders(headers,obj);var payload={headers:headers,body:{size:obj.body.length,data:this.Base64Encoder.create({urlSafe:!0}).encode(new Uint8Array(stringtoutf8(obj.body)))}};return msg.payload=payload,msg},function bToA(obj){var self=this,decode=function(str){var decoder=self.Base64Decoder.create({sink:self.IncrementalUtf8.create()});return decoder.put(str),decoder.eof(),decoder.sink.string},body="",plainBody,richBody;!function go(part){if("text/plain"===part.mimeType)plainBody=part;else if("text/html"===part.mimeType)richBody=part;else if(part.parts)for(var i=0;i<part.parts.length;i++)go(part.parts[i])}(obj.payload),richBody?body=decode(richBody.body.data):plainBody&&(body="<pre>"+decode(plainBody.body.data)+"</pre>");var args={id:obj.id,convId:obj.threadId,labels:obj.labelIds,serverVersion:obj.historyId,body:body,plainBody:plainBody?decode(plainBody.body.data):"",snippet:obj.snippet,deleted:obj.deleted};return this.readHeaders(obj.payload.headers||[],args),this.EMail.create(args)},function adaptOptions_(options){var newoptions={};if(options){if(options.limit&&(newoptions.limit=options.limit),options.skip&&(newoptions.skip=options.skip),options.query){var query=options.query;EqExpr.isInstance(query)&&this.EMail.LABELS===query.arg1?newoptions.query=EQ(this.FOAMGMailMessage.LABEL_IDS,query.arg2):GtExpr.isInstance(query)&&query.arg1==this.EMail.SERVER_VERSION?newoptions.query=GT(this.FOAMGMailMessage.getPrototype().HISTORY_ID,query.arg2):MQLExpr.isInstance(query)&&(newoptions.query=query)}return newoptions}}]}),CLASS({"package":"foam.lib.email",name:"EMail",traits:["foam.core.dao.SyncTrait"],plural:"EMail",tableProperties:["from","subject","timestamp"],properties:[{name:"id",visibility:"hidden",hidden:!0},{model_:"StringProperty",name:"gmailId",label:"Message ID",type:"String",mode:"read-write",required:!0,visibility:"hidden",hidden:!0,displayWidth:50,compareProperty:function(a,b){if(a.length!==b.length)return a.length<b.length?-1:1;for(var TABLE="0123456789abcdef",i=0;i<a.length;i++){var ia=TABLE.indexOf(a[i]),ib=TABLE.indexOf(b[i]);if(ia!==ib)return ib>ia?-1:1}return 0}},{model_:"StringProperty",name:"convId",label:"Conversation ID",type:"String",mode:"read-write",visibility:"hidden",hidden:!0,displayWidth:30},{model_:"DateTimeProperty",name:"timestamp",label:"Date",type:"DateTime",aliases:["time","modified","t"],visibility:"ro",displayHeight:1,factory:function(){return new Date},tableWidth:"100",displayWidth:45},{model_:"StringProperty",name:"from",type:"String",shortName:"f",required:!0,visibility:"final",displayWidth:90,factory:function(){return GLOBAL.user||""},tableFormatter:function(t){var ret;return ret=-1!=t.search("<.*>")?t.replace(/<.*>/,"").replace(/"/g,""):t.replace(/@.*/,""),ret.trim()},tableWidth:"120"},{model_:"StringArrayProperty",name:"to",type:"StringArray",shortName:"t",required:!0,visibility:"final",tableFormatter:function(t){return t.replace(/"/g,"").replace(/<.*/,"")},displayWidth:90},{model_:"StringArrayProperty",name:"cc",type:"StringArray",required:!0,visibility:"final",tableFormatter:function(t){return t.replace(/"/g,"").replace(/<.*/,"")},displayWidth:90},{model_:"StringArrayProperty",name:"bcc",type:"StringArray",required:!0,visibility:"final",tableFormatter:function(t){return t.replace(/"/g,"").replace(/<.*/,"")},displayWidth:90},{model_:"StringArrayProperty",name:"replyTo",type:"StringArray",visibility:"final"},{model_:"StringProperty",name:"subject",type:"String",shortName:"s",required:!0,visibility:"final",displayWidth:100,tableWidth:"45%"},{model_:"StringArrayProperty",name:"labels",type:"StringArray",visibility:"rw",postSet:function(_,a){if(a)for(var i=0;i<a.length;i++)a[i]=a[i].intern()},help:"Email labels."},{name:"attachments",label:"Attachments",tableLabel:"@",subType:"Attachment",view:"ArrayView",factory:function(){return[]},tableFormatter:function(a){return a.length?a.length:""},tableWidth:"20",help:"Email attachments."},{model_:"StringProperty",name:"body",label:"",type:"String",shortName:"b",visibility:"final",displayWidth:70,summaryFormatter:function(t){return'<div class="messageBody">'+t.replace(/\n/g,"<br/>")+"</div>"},help:"Email message body.",displayHeight:20,view:"foam.ui.TextFieldView"},{model_:"StringProperty",name:"plainBody",type:"String",visibility:"final",displayHeight:40},{model_:"foam.lib.email.EMailLabelProperty",name:"starred"},{model_:"foam.lib.email.EMailLabelProperty",name:"unread"},{model_:"foam.lib.email.EMailLabelProperty",name:"isDraft",labelName:"DRAFT"},{model_:"foam.lib.email.EMailLabelProperty",name:"inInbox",labelName:"INBOX"},{model_:"StringProperty",name:"snippet",type:"String",mode:"read-only",visibility:"ro",defaultValueFn:function(){return this.body.substr(0,100)}},{model_:"BooleanProperty",name:"messageSent",type:"Boolean",help:"True if the user has marked this message to be sent.",defaultValue:!1},{model_:"BooleanProperty",name:"deleted",type:"Boolean"},{model_:"IntProperty",name:"clientVersion",type:"Int"},{model_:"IntProperty",name:"serverVersion",type:"Int"},{name:"type",visibility:"hidden",hidden:!0,defaultValue:"EMail"},{name:"iconURL",view:"foam.ui.ImageView",defaultValue:"images/email.png"}],actions:[{model_:"foam.lib.email.EMailMutationAction",code:function(){this.messageSent=!0},name:"send",help:"Send the email.",isAvailable:function(){return this.isDraft},isEnabled:function(){return!this.messageSent},backOnComplete:!0},{name:"reply",help:"Reply to an email.",code:function(X){var replyMail=X.foam.lib.email.EMail.create({to:[this.from],subject:this.subject,body:this.body,labels:["DRAFT"]});X.openComposeView(X,replyMail)}},{name:"replyAll",help:"Reply to all recipients of an email.",code:function(X){for(var replyMail=X.foam.lib.email.EMail.create({to:[this.from],cc:this.cc,subject:"Re.: "+this.subject,body:this.body,labels:["DRAFT"]}),i=0;i<this.to;i++)replyMail.to.push(this.to[i]);X.openComposeView(X,replyMail)}},{name:"forward",help:"Forward an email.",code:function(X){var forwardedMail=X.foam.lib.email.EMail.create({subject:this.subject,body:this.body,labels:["DRAFT"]});X.openComposeView(X,forwardedMail)}},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.toggleLabel("STARRED")},name:"star",help:"Star an email."},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.removeLabel("INBOX")},name:"archive",help:"Archive an email.",isAvailable:function(){return this.hasLabel("INBOX")}},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.addLabel("INBOX"),this.removeLabel("SPAM"),this.removeLabel("TRASH")},name:"moveToInbox",help:"Un-archive an email.",isAvailable:function(){return!this.hasLabel("INBOX")}},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.removeLabel("INBOX"),this.addLabel("SPAM")},name:"spam",help:"Report an email as SPAM.",isAvailable:function(){return!this.hasLabel("SPAM")}},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.removeLabel("INBOX"),this.addLabel("TRASH")},name:"trash",help:"Move an email to the trash.",isAvailable:function(){return!this.hasLabel("TRASH")}},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.removeLabel("UNREAD")},name:"markRead",help:"Mark an email as read.",isAvailable:function(){return this.hasLabel("UNREAD")}},{model_:"foam.lib.email.EMailMutationAction",code:function(){this.addLabel("UNREAD")},name:"markUnread",help:"Mark an email as unread.",isAvailable:function(){return!this.hasLabel("UNREAD")}}],methods:[function updateLabelByName(id){var self=this;EMailLabelDAO.find(EQ(EMailLabel.DISPLAY_NAME,id),{put:function(label){var mail=self.clone();mail.toggleLabel(label.id),EMailDAO.put(mail)}})},function hasLabel(l){return-1!=this.labels.indexOf(l)},function toggleLabel(l){this.hasLabel(l)?this.removeLabel(l):this.addLabel(l)},function addLabel(l){this.labels=this.labels.deleteF(l).pushF(l)},function removeLabel(l){this.labels=this.labels.deleteF(l)},function atoMime(ret){for(var inline=[],attachments=[],i=0;i<this.attachments.length;i++)this.attachments[i].inline?inline.push(this.attachments[i]):attachments.push(this.attachments[i]);var newBoundary=function(){var boundary=Math.floor(1e4*Math.random());return function(){return(boundary+=1).toString(16)}}(),body="Content-Type: text/html; charset=UTF-8\r\n\r\n",fragment=new DocumentFragment;fragment.appendChild(document.createElement("body")),fragment.firstChild.innerHTML=this.body;for(var images=fragment.querySelectorAll("img"),i=0;i<images.length;i++)images[i].id&&(images[i].src="cid:"+images[i].id,images[i].removeAttribute("id"));body+=fragment.firstChild.innerHTML+"\r\n";var i,self=this,addAttachments=function(attachments,inline){return aseq(function(ret){boundary=newBoundary(),body="Content-Type: multipart/"+(inline?"related":"mixed")+"; boundary="+boundary+"\r\n\r\n--"+boundary+"\r\n"+body+"\r\n--"+boundary,i=0,ret()},awhile(function(){return i<attachments.length},aseq(function(ret){var att=attachments[i];i++,att.atoMime(ret)},function(ret,data){body+="\r\n"+data,body+="--"+boundary,ret()})),function(ret){body+="--",ret()})};aseq(aif(inline.length>0,addAttachments(inline,!0)),aif(attachments.length>0,addAttachments(attachments,!1)))(function(){body="From: "+self.from+"\r\nTo: "+self.to.join(", ")+"\r\n"+(self.cc.length?"Cc: "+self.cc.join(", ")+"\r\n":"")+(self.bcc.length?"Bcc: "+self.bcc.join(", ")+"\r\n":"")+"Subject: "+self.subject+"\r\n"+body,ret(body)})}]}),CLASS({"package":"foam.core.dao",name:"SyncTrait",properties:[{model_:"IntProperty",name:"syncProperty",type:"Int",visibility:"hidden",hidden:!0,defaultValue:-1},{model_:"BooleanProperty",name:"deleted",type:"Boolean",visibility:"hidden",hidden:!0,defaultValue:!1}]}),CLASS({"package":"foam.lib.email",name:"EMailLabelProperty","extends":"BooleanProperty",properties:[{name:"labelName"},{name:"setter",defaultValue:function(v,name){var old=this.v,label=this.model_[constantize(name)].labelName;v?this.addLabel(label):this.removeLabel(label),this.propertyChange_(this.propertyTopic(name),old,v)}},{name:"getter",defaultValue:function(name){var label=this.model_[constantize(name)].labelName;return this.hasLabel(label)}}]}),CLASS({"package":"foam.lib.email",name:"EMailMutationAction","extends":"Action",properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the action."},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.name.labelize()},help:"The display label for the action."},{name:"speechLabel",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The speech label for the action."},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",help:"Help text associated with the action."},{model_:"DocumentationProperty",name:"documentation",getter:function(){var doc=this.instance_.documentation;return!doc||"undefined"==typeof Documentation||!Documentation||doc.model_&&doc.model_.getPrototype&&Documentation.isInstance(doc)||(doc.body?this.instance_.documentation=Documentation.create(doc):this.instance_.documentation=Documentation.create({body:doc})),this.instance_.documentation}},{name:"default",type:"Boolean",view:"BooleanView",defaultValue:!1,help:"Indicates if this is the default action."},{model_:"FunctionProperty",name:"isAvailable",label:"Available",type:"Function",displayHeight:3,help:"Function to determine if action is available.",displayWidth:70,defaultValue:function(){return!0}},{model_:"FunctionProperty",name:"isEnabled",label:"Enabled",type:"Function",displayHeight:3,help:"Function to determine if action is enabled.",displayWidth:70,defaultValue:function(){return!0}},{model_:"FunctionProperty",name:"labelFn",label:"Label Function",type:"Function",help:"Function to determine label. Defaults to 'this.label'.",defaultValue:function(action){return action.label}},{name:"iconUrl",type:"String",defaultValue:"",help:"Provides a url for an icon to render for this action"},{name:"showLabel",type:"String",defaultValue:!0,help:"Property indicating whether the label should be rendered alongside the icon"},{name:"children",type:"Array",subType:"Action",view:"ArrayView",factory:function(){return[]},help:"Child actions of this action."},{name:"parent",type:"String",help:"The parent action of this action"},{model_:"StringArrayProperty",name:"keyboardShortcuts",type:"StringArray"},{name:"translationHint",label:"Description for Translation",type:"String",defaultValue:""},{model_:"BooleanProperty",name:"backOnComplete",type:"Boolean",defaultValue:!1},{model_:"FunctionProperty",name:"action",type:"Function",displayHeight:20,preSet:function(_,a){var f=function(X,action){var obj=this;a.apply(obj,arguments);var self=this,sink=action.backOnComplete?{put:function(){X.stack.popView()},error:function(){X.stack.popView()}}:void 0;X.EMailDAO&&X.EMailDAO.put(obj,sink)};return f.toString=function(){return a.toString()},f},help:"Function to implement action.",displayWidth:80,defaultValue:""}]}),CLASS({"package":"foam.core.dao",name:"AbstractAdapterDAO","extends":"foam.dao.ProxyDAO",methods:[function adaptKey_(key){return key},function put(obj,sink){obj=this.aToB(obj),this.SUPER(obj,sink)},function remove(obj,sink){obj=this.aToB(obj),this.SUPER(obj,sink)},function adaptSink_(sink){var self=this;return{put:function(o,s,fc){o=self.bToA(o),sink&&sink.put&&sink.put(o,s,fc)},eof:function(){sink&&sink.eof&&sink.eof()}}},function select(sink,options){sink=this.decorateSink_(sink,options);var mysink=this.adaptSink_(sink);options=this.adaptOptions_(options);var future=afuture();return this.SUPER(mysink,options)(function(){future.set(sink)}),future.get},function find(key,sink){var self=this;this.SUPER(this.adaptKey_(key),{put:function(o){sink&&sink.put&&sink.put(self.bToA(o))},error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}})},function removeAll(sink,options){options=this.adaptOptions_(options);var self=this,mysink={remove:function(o,sink,fc){sink&&sink.remove&&sink.remove(self.bToA(o),sink,fc)},error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}};this.SUPER(mysink,options)},function listen(s,options){if(options)var myoptions=this.adaptOptions_(options);var self=this,mysink={$UID:s.$UID,put:function(o,sink,fc){s.put&&s.put(o&&self.bToA(o),sink,fc)},remove:function(o,sink,fc){s.remove&&s.remove(self.bToA(o),sink,fc)},error:function(){s.error&&s.error.apply(s,arguments)}};s=this.decorateSink_(s,options,!0),this.SUPER(mysink,myoptions)}],help:"An abstract decorator for adapting a DAO of one data type to another data type.  Extend this class and implement aToB() and bToA()."}),CLASS({"package":"com.google.mail",name:"Sync","extends":"foam.core.dao.Sync",requires:["foam.lib.email.EMail"],methods:[function purge(ret,remoteLocal){var self=this;this.SUPER(function(purged){this.local.where(AND(LTE(this.localVersionProp,remoteLocal),EQ(this.EMail.MESSAGE_SENT,!0),EQ(this.EMail.LABELS,"DRAFT"))).removeAll(purged)(ret)}.bind(this),remoteLocal)}]}),CLASS({"package":"foam.core.dao",name:"Sync",properties:[{name:"local",visibility:"hidden",hidden:!0},{name:"remote",visibility:"hidden",hidden:!0},{name:"localVersionProp",visibility:"hidden",hidden:!0},{name:"remoteVersionProp",visibility:"hidden",hidden:!0},{name:"deletedProp",visibility:"hidden",hidden:!0},{model_:"IntProperty",name:"syncs",type:"Int"},{model_:"BooleanProperty",name:"syncing",type:"Boolean",defaultValue:!1},{model_:"IntProperty",name:"initialSyncWindow",type:"Int",help:"Number of objects to sync from client if client store is empty.  0 to sync them all",defaultValue:0},{model_:"IntProperty",name:"syncedFromServer",type:"Int"},{model_:"IntProperty",name:"syncedFromClient",type:"Int"},{model_:"IntProperty",name:"purgedFromClient",type:"Int"}],actions:[{name:"sync",isEnabled:function(){return!this.syncing},code:function(){this.syncing=!0,this.syncs+=1;var self=this;aseq(apar(aseq(function(ret){self.local.select(MAX(self.remoteVersionProp))(function(m){ret(m&&m.max||0)})},function(ret,localRemote){var remote=self.remote;0==localRemote&&self.initialSyncWindow>0&&(remote=remote.limit(self.initialSyncWindow)),remote=remote.where(GT(self.remoteVersionProp,localRemote)),remote.select(SEQ(self.local,COUNT()))(ret)}),aseq(function(ret){self.remote.select(MAX(self.localVersionProp))(function(m){ret(m&&m.max||0)})},apar(function(ret,remoteLocal){var local=self.local;local=local.where(GT(self.localVersionProp,remoteLocal)),local.select(SEQ(self.remote,COUNT()))(ret)},self.purge.bind(self)))),function(ret,downstream,upstream,purged){self.syncedFromServer+=downstream.args[1].count,self.syncedFromClient+=upstream.args[1].count,self.purgedFromClient-=purged.count,ret()})(function(){self.syncing=!1})}}],methods:[function purge(ret,remoteLocal){var local=this.local;local=local.where(AND(LTE(this.localVersionProp,remoteLocal),EQ(this.deletedProp,!0))),local.removeAll(COUNT())(ret)}]}),CLASS({"package":"com.google.mail",name:"SyncDecorator","extends":"foam.dao.ProxyDAO",requires:["com.google.mail.FOAMGMailMessage"],methods:[function put(obj,sink){obj.deleted&&this.delegate.where(EQ(this.FOAMGMailMessage.MESSAGE_ID,obj.id)).update(SET(this.FOAMGMailMessage.DELETED,!0)),this.SUPER(obj,sink)}]}),CLASS({"package":"foam.core.dao",name:"MergeDAO","extends":"foam.dao.ProxyDAO",properties:[{model_:"FunctionProperty",name:"mergeStrategy",type:"Function",required:!0}],methods:[function put(obj,sink){var self=this;this.delegate.find(obj.id,{put:function(oldValue){aseq(function(ret){self.mergeStrategy(ret,oldValue,obj)},function(ret,obj){self.delegate.put(obj,sink)})()},error:function(){self.delegate.put(obj,sink)}})}]}),CLASS({"package":"foam.core.dao",name:"PropertyOffloadDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"property"},{name:"offloadDAO"},{model_:"BooleanProperty",name:"loadOnSelect",type:"Boolean"}],methods:[function put(obj,sink){if(obj.hasOwnProperty(this.property.name)){var offload=this.model.create({id:obj.id});offload[this.property.name]=this.property.f(obj),obj.clearProperty(this.property.name),this.offloadDAO.put(offload)}this.delegate.put(obj,sink)},function select(sink,options){if(!this.loadOnSelect)return this.delegate.select(sink,options);var mysink=this.offloadSink(sink);return this.delegate.select(mysink,options)},function offloadSink(sink){var self=this;return{__proto__:sink,put:function(obj){sink.put&&sink.put.apply(sink,arguments),self.offloadDAO.find(obj.id,{put:function(offload){offload[self.property.name]&&(obj[self.property.name]=offload[self.property.name])}})}}},function find(id,sink){this.delegate.find(id,this.offloadSink(sink))}]}),CLASS({"package":"foam.core.dao",name:"StripPropertiesDAO","extends":"foam.dao.ProxyDAO",properties:[{model_:"StringArrayProperty",name:"propertyNames",type:"StringArray"}],methods:[function process_(obj){obj=obj.clone();for(var i=0;i<this.propertyNames.length;i++)obj.clearProperty(this.propertyNames[i]);return obj},function select(sink,options){sink=sink||[].sink;var self=this,future=afuture();return this.SUPER({put:function(obj,_,fc){sink.put&&sink.put(self.process_(obj),null,fc)},error:function(){sink.error&&sink.error.apply(sink,arguments)},eof:function(){sink.eof&&sink.eof()}},options)(function(){future.set(sink)}),future.get}]}),CLASS({"package":"foam.core.dao",name:"CloningDAO","extends":"foam.dao.ProxyDAO",properties:[{model_:"BooleanProperty",name:"onSelect",type:"Boolean",defaultValue:!1}],methods:[function select(sink,options){if(!this.onSelect)return this.SUPER(sink,options);sink=sink||[].sink;var future=afuture();return this.delegate.select({put:function(obj,s,fc){obj=obj.deepClone(),sink.put&&sink.put(obj,s,fc)},error:function(){sink.error&&sink.error.apply(sink,argumentS)},eof:function(){sink.eof&&sink.eof(),future.set(sink)}},options),future.get},function find(key,sink){return this.SUPER(key,{put:function(o){var clone=o.deepClone();sink&&sink.put&&sink.put(clone)},error:sink&&sink.error&&sink.error.bind(sink)})},function put(obj,sink){obj=obj.deepClone(),this.SUPER(obj,sink)}]}),CLASS({"package":"foam.core.dao",
name:"VersionNoDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"property",type:"Property",required:!0,visibility:"hidden",hidden:!0,"transient":!0},{model_:"IntProperty",name:"version",type:"Int",defaultValue:1}],methods:[function init(){this.SUPER();var future=afuture();this.WHEN_READY=future.get,this.delegate.select(MAX(this.property))(function(max){max.max&&(this.version=max.max+1),future.set(!0)}.bind(this))},function put(obj,sink){this.WHEN_READY(function(){var val=this.property.f(obj);obj[this.property.name]=this.version++,this.delegate.put(obj,sink)}.bind(this))}]}),CLASS({"package":"com.google.mail",name:"EMailView","extends":"foam.ui.md.DetailView",requires:["foam.ui.WebView","foam.ui.md.MonogramStringView","foam.ui.RelativeDateTimeFieldView","foam.ui.ImageBooleanView","foam.ui.ActionSheetView","foam.ui.StringArrayView"],templates:[{name:"CSS",code:ConstantTemplate(".actionButtonCView-moreActions{margin-right:10px}.email-view{}.email-view .content{-webkit-align-items:stretch;align-items:stretch;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;margin:0 18px 18px;word-break:word}.email-view .content iframe{border:none;overflow:hidden;padding:0}.email-view .monogram-string-view{margin:auto 6px auto 0}.email-view .from{font-size:14px;font-weight:bold;display:block;overflow-x:hidden;white-space:nowrap;text-overflow:ellipsis}.email-view .details{font-size:12px;color:rgb(119, 119, 119);overflow-x:hidden;white-space:nowrap;text-overflow:ellipsis}.email-view .subject{color:#fff;display:block;font-size:20px;line-height:28px;margin:auto;overflow-x:hidden;padding:0px 16px;text-overflow:ellipsis;white-space:nowrap;-webkit-flex:1;flex:1;-webkit-box-flex:1.0}.email-view .body{white-space:pre-wrap;margin-top:20px;display:block}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      "),this.destroy(),out('\n      <div id="',this.id,'" class="email-view">\n        <div class="content">\n          <div style="display: flex; display: -webkit-flex">\n            ',self.createTemplateView("from",{model_:"foam.ui.md.MonogramStringView"}),"\n            <div style='flex: 1; -webkit-flex: 1'>\n              ",self.createTemplateView("from",{mode:"read-only",floatingLabel:!1,className:"from",escapeHTML:!0}),"\n              <div class='details'>\n                ",self.createTemplateView("to",{mode:"read-only"}),"\n                ",self.createTemplateView("cc",{mode:"read-only"}),"\n                <br>\n                ",self.createTemplateView("timestamp",{model_:"foam.ui.RelativeDateTimeFieldView",mode:"read-only",className:"timestamp"}),"\n              </div>\n            </div>\n            ",self.createTemplateView("starred",{model_:"foam.ui.ImageBooleanView",className:"actionButton",trueImage:"images/ic_star_24dp.png",falseImage:"images/ic_star_outline_24dp.png"}),"\n          </div>\n          ",self.createTemplateView("body",{model_:"foam.ui.WebView",className:"body"}),"\n        </div>\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"WebView","extends":"foam.ui.SimpleView",imports:["window"],properties:[{name:"data"},{name:"intervalId"}],methods:[function init(){this.SUPER(),this.data$.addListener(function(){this.$.outerHTML=this.toHTML(),this.initHTML()}.bind(this))},function toHTML(){var id=this.id;return'<iframe scrolling="no" id="'+id+'"></iframe>'},function initHTML(){this.SUPER(),this.$.contentDocument.write("<div>"+this.data+"</div>"),this.intervalId=this.window.setInterval(this.onResize,500),this.rawResize()},function destroy(){this.window.clearInterval(this.intervalId)},function rawResize(){this.$.contentDocument.documentElement&&(this.$.style.height=this.$.contentDocument.body.children[0].clientHeight+16)}],listeners:[{name:"onResize",code:function(){return this.$?void this.rawResize():void this.window.clearInterval(this.intervalId)},isMerged:500}],help:"A view that renders the HTML given to it."}),CLASS({"package":"foam.ui",name:"ActionSheetView","extends":"foam.ui.View",traits:["foam.ui.layout.PositionedDOMViewTrait"],properties:[{name:"actions"},{name:"data"},{name:"className",defaultValue:"actionSheet"},{name:"preferredWidth",defaultValue:200}],templates:[{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n      ");for(var i=0,action;action=this.actions[i];i++){var view=this.createActionView(action);this.addDataChild(view),out(view)}return out("\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate(".actionSheet{background:white}"),language:"css"}],help:"A controller that shows a list of actions."}),CLASS({"package":"foam.ui",name:"StringArrayView","extends":"foam.ui.TextFieldView",methods:[function findCurrentValues(){for(var start=this.$.selectionStart,value=this.$.value,values=value.split(","),i=0,sum=0;sum+values[i].length<start;)sum+=values[i].length+1,i++;return{values:values,i:i}},function setValues(values,index){this.domValue.set(this.valueToText(values)+","),this.data=this.textToValue(this.domValue.get());for(var isLast=values.length-1===index,selection=0,i=0;index>=i;i++)selection+=values[i].length+1;this.$.setSelectionRange(selection,selection),isLast&&this.X.setTimeout(function(){this.autocompleteView.autocomplete("")}.bind(this),0)},function onAutocomplete(data){var current=this.findCurrentValues();current.values[current.i]=data,this.setValues(current.values,current.i)},function bindAutocompleteEvents(view){function onInput(){var values=self.findCurrentValues();view.autocomplete(values.values[values.i])}var self=this;this.$.addEventListener("input",onInput),this.$.addEventListener("focus",onInput),this.$.addEventListener("blur",function(){view.publish("blur")})},function textToValue(text){return""===text?[]:text.replace(/\s/g,"").split(",")},function valueToText(value){return value?value.toString():""}]}),CLASS({"package":"com.google.mail",name:"FOAMGMailLabel","extends":"com.google.mail.GMailLabel",properties:[{model_:"StringProperty",name:"id",type:"String",help:"The immutable ID of the label."},{model_:"StringProperty",name:"labelListVisibility",type:"String",help:"The visibility of the label in the label list in the Gmail web interface."},{model_:"StringProperty",name:"messageListVisibility",type:"String",help:"The visibility of the label in the message list in the Gmail web interface."},{model_:"StringProperty",name:"type",type:"String",help:"The owner type for the label. User labels are created by the user and can be modified and deleted by the user and can be applied to any message or thread. System labels are internally created and cannot be added, modified, or deleted. System labels may be able to be applied to or removed from messages and threads under some circumstances but this is not guaranteed. For example, users can apply and remove the INBOX and UNREAD labels from messages and threads, but cannot apply or remove the DRAFTS or SENT labels from messages or threads."},{model_:"StringProperty",name:"name",type:"String",postSet:function(_,nu){"system"===this.type&&this.LABELS[nu]&&(this.label=this.LABELS[nu])},help:"The display name of the label."},{name:"label",defaultValueFn:function(){return this.name}},{name:"iconUrl",view:"foam.ui.ImageView",defaultValueFn:function(){return this.ICONS[this.name]?this.ICONS[this.name]:"icons/ic_label_black_24dp.png"}}],constants:[{name:"LABELS",value:{INBOX:"Inbox",STARRED:"Starred",DRAFT:"Drafts",SENT:"Sent",SPAM:"Spam",TRASH:"Trash",CATEGORY_FORUMS:"Forums",CATEGORY_PERSONAL:"Personal",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_SOCIAL:"Social",CATEGORY_UPDATES:"Updates",IMPORTANT:"Priority Inbox"}},{name:"ICONS",value:{INBOX:"icons/ic_inbox_black_24dp.png",STARRED:"icons/ic_star_black_24dp.png",DRAFT:"icons/ic_drafts_black_24dp.png",SENT:"icons/ic_send_black_24dp.png",SPAM:"icons/ic_report_black_24dp.png",TRASH:"icons/ic_delete_black_24dp.png",IMPORTANT:"icons/ic_priority_inbox_black_24dp.png"}}]}),CLASS({"package":"com.google.mail",name:"GMailLabel",plural:"labels",properties:[{model_:"StringProperty",name:"id",type:"String",help:"The immutable ID of the label."},{model_:"StringProperty",name:"labelListVisibility",type:"String",help:"The visibility of the label in the label list in the Gmail web interface."},{model_:"StringProperty",name:"messageListVisibility",type:"String",help:"The visibility of the label in the message list in the Gmail web interface."},{model_:"StringProperty",name:"name",type:"String",help:"The display name of the label."},{model_:"StringProperty",name:"type",type:"String",help:"The owner type for the label. User labels are created by the user and can be modified and deleted by the user and can be applied to any message or thread. System labels are internally created and cannot be added, modified, or deleted. System labels may be able to be applied to or removed from messages and threads under some circumstances but this is not guaranteed. For example, users can apply and remove the INBOX and UNREAD labels from messages and threads, but cannot apply or remove the DRAFTS or SENT labels from messages or threads."}]}),CLASS({"package":"com.google.mail",name:"GMailUserInfo",properties:[{name:"email"},{name:"name"},{name:"avatarUrl"}],methods:[function fromJSON(obj){this.email=obj.email,this.name=obj.name,this.avatarUrl=obj.picture+"?sz=50"}]}),CLASS({"package":"com.google.mail",name:"MenuView","extends":"foam.ui.View",traits:["foam.ui.layout.PositionedDOMViewTrait"],requires:["com.google.mail.MenuLabelCitationView","com.google.mail.FOAMGMailLabel","com.google.mail.ProfileView","foam.lib.email.EMail"],imports:["profile$","EMailDAO"],exports:["counts"],properties:[{name:"topSystemLabelDAO",view:{factory_:"foam.ui.DAOListView",rowView:"com.google.mail.MenuLabelCitationView"}},{name:"bottomSystemLabelDAO",view:{factory_:"foam.ui.DAOListView",rowView:"com.google.mail.MenuLabelCitationView"}},{name:"userLabelDAO",view:{factory_:"foam.ui.DAOListView",rowView:"com.google.mail.MenuLabelCitationView"}},{name:"preferredWidth",defaultValue:280},{name:"counts",factory:function(){var sink=GROUP_BY(this.EMail.LABELS,COUNT());return this.EMailDAO.select(sink),sink}}],templates:[{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div class="menuView">\n        <div class="menuHeader">\n          ',this.ProfileView.create({data$:this.profile$}),"\n        </div>\n        ",self.createTemplateView("topSystemLabelDAO"),"\n        <hr>\n        ",self.createTemplateView("bottomSystemLabelDAO"),"\n        <hr>\n        ",this.MenuLabelCitationView.create({data:this.FOAMGMailLabel.create({id:"All Mail",name:"All Mail"})}),"\n        ",self.createTemplateView("userLabelDAO"),"\n      </div>\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate(".menuView{height:100%;display:block;overflow-y:auto;background:white}.menuView div:hover{background:#e0e0e0}"),language:"css"}]}),CLASS({"package":"com.google.mail",name:"MenuLabelCitationView","extends":"foam.ui.DetailView",requires:["SimpleValue"],imports:["counts","controller"],properties:[{name:"count",view:{factory_:"foam.ui.TextFieldView",mode:"read-only",extraClassName:"count"}}],methods:[function init(){this.SUPER(),this.counts.groups[this.data.id]?this.bindGroup():this.bindCounts()},function bindCounts(){this.counts.addListener(this.bindGroup)}],listeners:[{name:"bindGroup",code:function(){this.counts.groups[this.data.id]&&(this.counts.removeListener(this.bindGroup),this.counts.groups[this.data.id].addListener(this.updateCount),this.updateCount())}},{name:"updateCount",code:function(){this.counts.groups[this.data.id]&&(this.count=this.counts.groups[this.data.id].count)}}],templates:[{name:"CSS",code:ConstantTemplate(".label-row{height:42px;line-height:42px;padding-left:15px;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}.label-row img{height:24px;width:24px;opacity:0.6;margin-right:25px;-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0}.label-row .label{-webkit-flex-grow:1;flex-grow:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.label-row .count{-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;margin-right:10px;text-align:center;text-align:right;width:40px}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',self.id,'" class="label-row">\n        ',self.createTemplateView("iconUrl"),"\n        ",self.createTemplateView("label",{mode:"read-only",extraClassName:"label"}),"\n        ",self.createTemplateView("count"),"\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"com.google.mail",name:"ProfileView","extends":"foam.ui.View",requires:["com.google.mail.GMailUserInfo","foam.ui.ImageView"],properties:[{model_:"ModelProperty",name:"model",type:"Model",factory:function(){return this.GMailUserInfo}},{name:"className",defaultValue:"profile"}],templates:[{name:"CSS",code:ConstantTemplate(".profile{-webkit-align-items:flex-start;align-items:flex-start;background:#db4437;-webkit-box-shadow:0 3px 6px #888;box-shadow:0 3px 6px #888;color:white;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;padding:10px 0 8px 15px}.profile:hover{background:#db4437 !important}.profile img{border-radius:50%;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-grow:0;flex-grow:0;margin-bottom:15px}.profile .profile-text{-webkit-align-items:flex-start;align-items:flex-start;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column}.profile .profile-name{font-weight:bold}"),language:"css"},{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      "),this.data&&out("\n          ",self.createTemplateView("avatarUrl",{model_:"foam.ui.ImageView"}),'\n          <div class="profile-text">\n            ',self.createTemplateView("name",{mode:"read-only",extraClassName:"profile-name"}),"\n            ",self.createTemplateView("email",{mode:"read-only",extraClassName:"profile-email"}),"\n          </div>\n      "),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"com.google.mail",name:"QueryParser",requires:["foam.lib.email.EMail"],properties:[{name:"parser",lazyFactory:function(){var EMail=this.EMail,parser={__proto__:QueryParserFactory(EMail),id:sym("string"),labelMatch:seq(alt("label","l"),alt(":","="),sym("valueList"))}.addActions({id:function(v){return OR(CONTAINS_IC(EMail.TO,v),CONTAINS_IC(EMail.FROM,v),CONTAINS_IC(EMail.SUBJECT,v),CONTAINS_IC(EMail.BODY,v))},labelMatch:function(v){for(var or=OR(),values=v[2],i=0;i<values.length;i++)or.args.push(EQ(EMail.LABELS,values[i]));return or}});return parser.expr=alt(sym("labelMatch"),parser["export"]("expr")),parser}}]}),CLASS({"package":"foam.mlang",name:"CannedQuery",properties:[{name:"id",defaultValueFn:function(){return this.label}},{model_:"StringProperty",name:"label",type:"String",required:!0},{name:"expression"},{name:"iconUrl",view:"foam.ui.ImageView"},{name:"section",visibility:"hidden",hidden:!0,defaultValue:1e5},{name:"order",visibility:"hidden",hidden:!0,defaultValue:1e5}]}),CLASS({"package":"foam.lib.contacts",name:"Contact",properties:[{model_:"StringProperty",name:"id",type:"String"},{name:"type",visibility:"hidden",hidden:!0,defaultValue:"Contact"},{model_:"StringProperty",name:"title",type:"String",displayWidth:50},{model_:"DateTimeProperty",name:"updated",type:"DateTime",factory:function(){return new Date}},{model_:"BooleanProperty",name:"deleted",type:"Boolean"},{model_:"StringProperty",name:"etag",type:"String"},{model_:"StringProperty",name:"prefix",type:"String"},{model_:"StringProperty",name:"first",type:"String"},{model_:"StringProperty",name:"middle",type:"String"},{model_:"StringProperty",name:"last",type:"String"},{model_:"StringProperty",name:"suffix",type:"String"},{model_:"StringProperty",name:"displayName",type:"String",defaultValueFn:function(){return this.title.length>0?this.title:this.first.length>0||this.last.length>0?this.first+" "+this.last:this.email}},{model_:"StringProperty",name:"email",label:"",type:"String"},{model_:"ArrayProperty",name:"phoneNumbers",type:"Array",subType:"PhoneNumber"},{model_:"ArrayProperty",name:"addresses",type:"Array",subType:"Address"},{model_:"DateProperty",name:"birthday",type:"Date"},{model_:"StringProperty",name:"url",type:"String",displayWidth:70},{name:"avatar",type:"String",view:"foam.ui.ImageView",defaultValueFn:function(){var key=this.title?this.title[0].toUpperCase():this.email?this.email[0].toUpperCase():"";return this.generateAvatar(key)}},{name:"iconURL",view:"foam.ui.ImageView",defaultValue:"images/contact.png"},{model_:"StringProperty",name:"note",type:"String",displayHeight:10}],methods:[function init(){this.SUPER(),this.model_.getPrototype().generateAvatar.memoized||(this.model_.getPrototype().generateAvatar=memoize(this.model_.getPrototype().generateAvatar),this.model_.getPrototype().generateAvatar.memoized=!0)},function generateAvatar(letter){return letter.length<1?"":'data:image/svg+xml;utf-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" width="21" height="21"><rect width="21" height="21" x="0" y="0" style="fill:#d40000"/><text x="10" y="17" style="text-anchor:middle;font-size:19;font-style:normal;font-weight:bold;font-family:Arial, sans;fill:#fff">'+letter+"</text></svg>"}]}),CLASS({"package":"foam.lib.contacts",name:"ContactNetworkDAO","extends":"AbstractDAO",requires:["foam.lib.contacts.Contact as Contact","foam.lib.contacts.PhoneNumber as PhoneNumber","foam.lib.contacts.Address as Address"],imports:["ajsonp","authAgent"],properties:[{name:"daoListeners_",visibility:"hidden",hidden:!0,"transient":!0,factory:function(){return[]}},{name:"url",defaultValue:"https://www.google.com/m8/feeds/contacts/default/full"},{name:"authAgent"},{model_:"IntProperty",name:"batchSize",type:"Int",defaultValue:1e3},{name:"ajsonp",visibility:"hidden",hidden:!0,"transient":!0}],methods:[function select(sink,options){options={__proto__:options};var params=["alt=json","v=3.0","max-results="+this.batchSize,"orderby=lastmodified"];this.authAgent&&this.authAgent.accessToken&&param.push("access_token="+encodeURIComponent(this.authAgent.accessToken));var query=options.query;query&&GtExpr.isInstance(query)&&query.arg1.equals(this.Contact.UPDATED)&&ConstantExpr.isInstance(query.arg2)&&(params.push("updated-min="+encodeURIComponent(query.arg2.f().toISOString())),query=TRUE),options.query=query,options.order&&(options.order.equals(this.Contact.UPDATED)?options.order=void 0:DescExpr.isInstance(options.order)&&options.order.arg1.equals(this.Contact.UPDATE)&&(options.order=void 0,params.push("sortorder=descending"))),sink=this.decorateSink_(sink||[].sink,options);var url=this.url,fc=this.createFlowControl_(),self=this,future=afuture(),index=1,total=1/0,error=!1;return awhile(function(){return total>=index&&!fc.stopped&&!fc.errorEvt},aseq(function(ret){var myparams=params.slice();myparams.push("start-index="+index),self.ajsonp(url,myparams)(ret)},function(ret,data){var contacts=data&&data.feed&&data.feed.entry;if(!contacts)return error=!0,sink&&sink.error&&sink.error("Error loading contacts"),void future.set(sink);total=data.feed.openSearch$totalResults.$t;for(var i=0;i<contacts.length&&!fc.stopped;i++){if(fc.errorEvt)return error=!0,sink.error&&sink.error(fc.errorEvt),future.set(sink),void ret();var c=contacts[i],contact=self.objFromJson(c);index++,sink.put&&sink.put(contact,null,fc)}ret()}))(function(){error||(sink.eof&&sink.eof(),future.set(sink))}),future.get},function objFromJson(c){var self=this,obj=this.Contact.create({id:c.id?c.id.$t.split("/").pop():"",title:c.title?c.title.$t:"",email:c.gd$email?c.gd$email[0].address:"",updated:c.updated?c.updated.$t:""});return c.gd$phoneNumber&&c.gd$phoneNumber.forEach(function(p){obj.phoneNumbers.push(self.PhoneNumber.create({type:p.rel?p.rel.replace(/^.*#/,""):p.label?p.label:"main",number:p.$t}))}),c.gd$postalAddress&&c.gd$postalAddress.forEach(function(a){obj.addresses.push(self.Address.create({type:a.rel.replace(/^.*#/,""),street:a.$t}))}),obj}]}),CLASS({"package":"foam.lib.contacts",name:"PhoneNumber",ids:["number"],properties:[{model_:"StringProperty",name:"type",type:"String"},{model_:"StringProperty",name:"number",type:"String"}]}),CLASS({"package":"foam.lib.contacts",name:"Address",ids:["type"],properties:[{model_:"StringProperty",name:"type",type:"String"},{model_:"StringProperty",name:"poBox",label:"P.O. Box",type:"String",displayWidth:70},{model_:"StringProperty",name:"street",type:"String",displayWidth:70},{model_:"StringProperty",name:"localArea",type:"String",displayWidth:70},{model_:"StringProperty",name:"city",type:"String",displayWidth:70},{model_:"StringProperty",name:"county",label:"County / Area",type:"String",displayWidth:70},{model_:"StringProperty",name:"postalCode",type:"String",displayWidth:12},{model_:"StringProperty",name:"country",type:"String",displayWidth:40}]}),CLASS({"package":"foam.oauth2",name:"OAuth2RedirectJsonp","extends":"foam.oauth2.OAuth2Redirect",methods:[function setJsonpFuture(X,future){var agent=this;future.set(function(url,params){var tries=0;return params=params.clone(),params.push("access_token="+encodeURIComponent(agent.accessToken)),function(ret){function callback(data){null===data?(tries++,3==tries?ret(null):agent.refresh(function(token){params[params.length-1]="access_token="+encodeURIComponent(token),ajsonp(url,params)(callback)})):ret(data)}ajsonp(url,params)(callback)}})}]}),CLASS({"package":"foam.oauth2",name:"OAuth2Redirect","extends":"foam.oauth2.OAuth2",imports:["window","setTimeout"],properties:[{name:"redirectURL","transient":!0,defaultValueFn:function(){return this.window.location.protocol+"//"+this.window.location.host+this.window.location.pathname+this.window.location.search}},{name:"redirects","transient":!0,defaultValue:0}],methods:[function init(args){this.loadState_();var self=this;this.setTimeout(function(){self.redirects=0},this.REDIRECTS_TIMEOUT),this.loadToken_(),this.SUPER(args),this.window.location.hash=""},function loadState_(){var state=this.window.location.hash.match(/state=([^&]*)/);return state=state&&state[1],state&&(this.redirects=parseInt(state)),state},function loadToken_(){var token=this.window.location.hash.match(/token=([^&]*)/);return token=token&&token[1],token&&(this.accessToken=token),token},function refreshNow_(ret){if(this.accessToken)return this.redirects+=1,void ret(this.accessToken);if(this.redirects<3){this.redirects+=1;var params=["response_type=token","client_id="+encodeURIComponent(this.clientId),"redirect_uri="+encodeURIComponent(this.redirectURL),"scope="+encodeURIComponent(this.scopes.join(" ")),"state="+this.redirects];return void(this.window.location=this.endpoint+"auth?"+params.join("&"))}console.error("Failed to authenticated after ",this.redirects,"attempts.")}],help:"OAuth2 strategy that uses the redirect."}),CLASS({"package":"foam.oauth2",name:"OAuth2",label:"OAuth 2.0",requires:["XHR"],properties:[{name:"accessToken",help:"Token used to authenticate requests."},{name:"clientId",required:!0,"transient":!0},{name:"clientSecret",required:!0,"transient":!0},{model_:"StringArrayProperty",name:"scopes",type:"StringArray",required:!0,"transient":!0},{model_:"URLProperty",name:"endpoint",type:"URL",defaultValue:"https://accounts.google.com/o/oauth2/"},{model_:"FunctionProperty",name:"refresh_",type:"Function","transient":!0,lazyFactory:function(){return this.refresh_=amerged(this.refreshNow_.bind(this))}}],methods:[function refreshNow_(){},function refresh(ret,opt_forceInteractive){return this.refresh_(ret,opt_forceInteractive)},function setJsonpFuture(X,future){var agent=this;future.set(function(){var factory=agent.XHR.xbind({authAgent:agent,responseType:"json",retries:3});return function(url,params,opt_method,opt_payload){return function(ret){var xhr=factory.create();xhr.asend(function(data,xhr){ret(data,xhr.status)},url+(params?"?"+params.join("&"):""),opt_payload,opt_method?opt_method:"GET")}}}())}]}),CLASS({"package":"foam.ui",name:"ScrollView","extends":"foam.ui.AbstractDAOView",traits:["foam.input.touch.VerticalScrollNativeTrait"],requires:["foam.util.busy.BusyStatus","foam.ui.SpinnerView","foam.ui.ScrollViewRow"],imports:["selection$"],properties:[{name:"model",defaultValueFn:function(){return this.dao.model}},{name:"runway",defaultValue:800},{name:"count",defaultValue:0,postSet:function(old,nu){this.scrollHeight=nu*this.rowHeight}},{name:"scrollHeight",postSet:function(old,nu){this.$&&(this.container$().style.height=nu+"px")}},{name:"scrollTop",defaultValue:0},{name:"rowHeight",defaultValue:-1},{name:"rowSizeView",visibility:"hidden",hidden:!0},{model_:"ViewFactoryProperty",name:"rowView",type:"ViewFactory",postSet:function(_,nu){if("string"==typeof nu&&this.rowHeight<0){var view=this.Y.lookup(nu);view.PREFERRED_HEIGHT&&(this.rowHeight=view.create({model:this.dao.model}).preferredHeight)}}},{name:"viewportHeight"},{name:"visibleRows",factory:function(){return{}}},{name:"extraRows",factory:function(){return[]}},{model_:"ArrayProperty",name:"cache",type:"Array",factory:function(){return[]}},{name:"scrollerID",factory:function(){return this.nextID()}},{name:"containerID",factory:function(){return this.nextID()}},{name:"loadedTop",defaultValue:-1},{name:"loadedBottom",defaultValue:-1},{name:"visibleTop",defaultValue:0},{name:"visibleBottom",defaultValue:0},{name:"daoUpdateNumber",visibility:"hidden",hidden:!0,"transient":!0,defaultValue:0},{name:"mode",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]},defaultValue:"read-write"},{name:"oldVisibleTop",defaultValue:-1},{name:"oldVisibleBottom",defaultValue:-1},{name:"spinnerBusyStatus",factory:function(){return this.BusyStatus.create()}},{name:"busyComplete_"},{name:"spinnerContainerID",factory:function(){return this.nextID()}},{name:"spinner",factory:function(){return this.SpinnerView.create({data$:this.spinnerBusyStatus.busy$})}}],methods:[function initHTML(){if(this.SUPER(),this.$.style.height||(this.$.style.height="100%"),this.addScrollListener(),this.onResize(),this.rowHeight<0){var outer=this.X.$(this.id+"-rowsize"),style=this.X.window.getComputedStyle(outer.children[0]);this.rowHeight=parseFloat(style.height),this.rowSizeView.destroy(),this.rowSizeView="",outer.outerHTML=""}this.onDAOUpdate()},function container$(){return this.X.document.getElementById(this.containerID)},function allocateVisible(){if(this.visibleTop!==this.oldVisibleTop||this.visibleBottom!==this.oldVisibleBottom){for(var homeless=[],foundIDs={},self=this,i=this.visibleTop;i<=this.visibleBottom;i++)this.visibleRows[i]?foundIDs[i]=!0:homeless.push(i);for(var keys=Object.keys(this.visibleRows),i=0;i<keys.length&&0!==homeless.length;i++)if(!foundIDs[keys[i]]){var h=homeless.shift(),r=self.visibleRows[keys[i]];delete self.visibleRows[keys[i]],self.visibleRows[h]=r,r.data=self.cache[h],r.y=h*self.rowHeight}if(homeless.length){for(var html=[],newViews=[],i=0;i<homeless.length;i++){var h=homeless[i],x=self.cache[h];if(x)if(this.extraRows.length){var r=this.extraRows.shift();self.visibleRows[h]=r,r.data=x,r.y=h*self.rowHeight}else{var v=this.rowView({model:x.model_,data:x},this.Y),svr=self.ScrollViewRow.create({data:x,id:v.nextID()});self.visibleRows[h]=svr,html.push('<div style="width: 100%; position: absolute; height: '+self.rowHeight+'px; overflow: visible" id="'+svr.id+'">'),html.push(v.toHTML()),html.push("</div>"),v.on("click",function(){self.selection=this.data},v.id),newViews.push([h,svr]),svr.view=v}}html.length&&this.container$().insertAdjacentHTML("beforeend",html.join(""));for(var i=0;i<newViews.length;i++){var r=newViews[i];r[1].view.initHTML(),r[1].y=r[0]*self.rowHeight}}for(var i=0;i<this.extraRows.length;i++)this.extraRows[i].y=-1e4;this.oldVisibleTop=this.visibleTop,this.oldVisibleBottom=this.visibleBottom}},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),this.softDestroy(),this.removeScrollListener()},function softDestroy(){for(var keys=Object.keys(this.visibleRows),i=0;i<keys.length;i++)this.visibleRows[keys[i]].destroy();for(this.visibleRows={},i=0;i<this.extraRows.length;i++)this.extraRows[i].destroy();this.extraRows=[];var container=this.container$();container&&(container.innerHTML=""),this.cache=[],this.loadedTop=-1,this.loadedBottom=-1,this.oldVisibleBottom=-1,this.oldVisibleTop=-1},function invalidate(){if(this.visibleRows){for(var keys=Object.keys(this.visibleRows),i=0;i<keys.length;i++)this.extraRows.push(this.visibleRows[keys[i]]);this.visibleRows={}}this.cache=[],this.loadedTop=-1,this.loadedBottom=-1,this.oldVisibleBottom=-1,this.oldVisibleTop=-1},function addScrollListener(){this.$&&this.$.ownerDocument.defaultView.addEventListener("resize",this.onResize)},function removeScrollListener(){this.$&&this.$.ownerDocument.defaultView.removeEventListener("resize",this.onResize)}],listeners:[{name:"onResize",code:function(){this.viewportHeight=this.$.offsetHeight},isMerged:100},{name:"onScroll",code:function(){this.scrollTop=this.scroller$.scrollTop,this.update()}},{name:"onDAOUpdate",code:function(){this.invalidate();var oldComplete=this.busyComplete_;this.busyComplete_=this.spinnerBusyStatus.start(),oldComplete&&oldComplete(),this.dao.select(COUNT())(function(c){this.count=c.count;var s=this.scroller$;s&&(s.scrollTop=this.scrollTop),this.X.setTimeout(this.update.bind(this),0)}.bind(this))},isFramed:!0},{name:"update",code:function(){if(this.$&&!(this.rowHeight<0)){var runwayCount=Math.ceil(this.runway/this.rowHeight);this.visibleIndex=Math.floor(this.scrollTop/this.rowHeight),this.visibleTop=Math.max(0,this.visibleIndex-runwayCount),this.visibleBottom=Math.min(this.count-1,this.visibleIndex+Math.ceil((this.runway+this.viewportHeight)/this.rowHeight));var maxVisible=Math.ceil((2*this.runway+this.viewportHeight)/this.rowHeight);this.visibleBottom-this.visibleTop+1<maxVisible&&(0===this.visibleTop?this.visibleBottom=Math.min(maxVisible-1,this.count-1):this.visibleTop=Math.max(0,this.visibleBottom-maxVisible+1));var toLoadTop,toLoadBottom;if(this.visibleTop>=this.loadedTop&&this.visibleBottom<=this.loadedBottom||(this.visibleTop<this.loadedTop&&this.visibleBottom>=this.loadedTop?(toLoadBottom=this.loadedTop-1,toLoadTop=Math.max(0,this.visibleTop-2*runwayCount)):this.visibleBottom>this.loadedBottom&&this.visibleTop<=this.loadedBottom?(toLoadTop=this.loadedBottom+1,toLoadBottom=Math.min(this.count-1,this.visibleBottom+2*runwayCount)):(this.invalidate(),toLoadTop=Math.max(0,this.visibleTop-2*runwayCount),toLoadBottom=Math.min(this.count,this.visibleBottom+2*runwayCount))),toLoadTop>=0&&toLoadBottom>=0&&toLoadBottom>=toLoadTop){var self=this,updateNumber=++this.daoUpdateNumber;this.dao.skip(toLoadTop).limit(toLoadBottom-toLoadTop+1).select()(function(a){if(updateNumber===self.daoUpdateNumber&&a&&a.length){self.busyComplete_();for(var i=0;i<a.length;i++){var o=a[i];"read-write"===self.mode&&(o=a[i].clone(),o.addListener(function(x){this.dao.put(x.deepClone())}.bind(self,o))),self.cache[toLoadTop+i]=o}self.loadedTop=self.loadedTop>=0?Math.min(toLoadTop,self.loadedTop):toLoadTop,self.loadedBottom=Math.max(toLoadBottom,self.loadedBottom),self.allocateVisible()}})}else this.allocateVisible(),this.busyComplete_()}}}],templates:[{name:"CSS",code:ConstantTemplate(".scrollview{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-flex-grow:1;flex-grow:1;overflow:hidden;position:relative}.scrollview-scroller{-webkit-overflow-scrolling:touch;overflow-y:auto;width:100%;-webkit-flex-grow:1;flex-grow:1}.scrollview-inner{position:relative;-webkit-transform:translate3d(0, 0, 0);transform:translate3d(0, 0, 0);width:100%}"),language:"css"},{name:"toHTML",
code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out("\n      "),this.destroy(),out('\n      <div id="',self.id,'" class="scrollview">\n        '),this.rowHeight<0&&(out('\n          <div id="',this.id+"-rowsize",'" style="visibility: hidden">\n            '),this.rowSizeView=this.rowView({data:this.dao.model.create()},this.Y),out(this.rowSizeView.toHTML()),this.addChild(this.rowSizeView),out("\n          </div>\n        ")),out('\n        <div id="',self.spinnerContainerID,'" style="display: none; width: 100%; height: 100%">\n          ',this.spinner,"\n        </div>\n        "),this.addInitializer(function(){self.spinnerBusyStatus.busy$.addListener(function(){var e=this.X.$(self.spinnerContainerID);e&&(e.style.display=self.spinnerBusyStatus.busy?"block":"none")})}),out('\n        <div id="',self.scrollerID,'" class="scrollview-scroller">\n          <div id="',self.containerID,'" class="scrollview-inner" style="height:100%;">\n          </div>\n        </div>\n      </div>\n    '),out.toString()},language:"html"}]}),CLASS({"package":"foam.util.busy",name:"BusyStatus",imports:["clearTimeout","setTimeout"],properties:[{name:"busy",defaultValue:!1},{name:"minPreSpinnerWait",units:"ms",defaultValue:500},{name:"minSpinnerShowTime",units:"ms",defaultValue:500},{name:"waiting_",visibility:"hidden",hidden:!0,getter:function(){return Object.keys(this.processes_).length>0}},{name:"processes_",factory:function(){return{}}},{name:"nextProcessId_",defaultValue:0},{name:"timer_"}],methods:[function start(){var alreadyWaiting=this.waiting_,pid=this.nextProcessId_++;this.processes_[pid]=!0;var completeFunc=this.done_.bind(this,pid);return alreadyWaiting?completeFunc:(this.timer_&&this.clearTimeout(this.timer_),this.timer_=this.setTimeout(this.onTimer,this.minPreSpinnerWait),completeFunc)},function done_(pid){this.processes_[pid]&&(delete this.processes_[pid],this.waiting_||(this.timer_&&!this.busy?(this.clearTimeout(this.timer_),this.timer_=""):this.busy&&(this.busy=!1)))}],listeners:[{name:"onTimer",code:function(){var waiting=this.waiting_;this.timer_="",this.busy&&!waiting?this.busy=!1:!this.busy&&waiting&&(this.busy=!0)}}]}),CLASS({"package":"foam.ui",name:"SpinnerView","extends":"foam.ui.View",properties:[{name:"data",defaultValue:!0,postSet:function(old,nu){this.$&&(nu?!old&&nu&&(this.$.innerHTML=this.toInnerHTML(),this.initInnerHTML(),this.$.style.display=""):(this.$.innerHTML="",this.hideContainer&&(this.$.style.display="none")))}},{name:"hideContainer",defaultValue:!1},{name:"color",defaultValue:"#4285F4"},{name:"extraClassName",defaultValue:"spinner-container"}],constants:[{name:"DURATION",value:"1333"}],methods:[function initHTML(){this.SUPER(),this.data=this.data}],templates:[{name:"CSS",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n");var prefixes=["-webkit-","-moz-",""];out("\n");var bezier="cubic-bezier(0.4, 0.0, 0.2, 1)";out("\n.spinner-container {\ndisplay: flex;\nalign-items: center;\njustify-content: center;\nheight: 100%;\nwidth: 100%;\n}\n.spinner-fixed-box {\nposition: relative;\nheight: 64px;\nwidth: 64px;\n");for(var i=0;i<prefixes.length;i++)out("\n",prefixes[i],"transform: translate3d(0px, 0px, 0px);\n");out("\n}\n\n.spinner-turning-box {\n");for(var i=0;i<prefixes.length;i++)out("\n",prefixes[i],"animation: container-rotate 1568ms linear infinite;\n");out("\nwidth: 100%;\nheight: 100%;\n}\n\n.spinner-layer {\nposition: absolute;\nheight: 100%;\nwidth: 100%;\n");for(var j=0;j<prefixes.length;j++)out("\n",prefixes[j],"animation: fill-unfill-rotate ",4*this.DURATION,"ms ",bezier," infinite both;\n");out("\n}\n\n.spinner-circle-clipper {\noverflow: hidden;\nborder-color: inherit;\ndisplay: inline-block;\nheight: 100%;\nposition: relative;\nwidth: 50%;\n}\n\n.spinner-circle-clipper.spinner-clipper-left .spinner-circle {\n");for(var i=0;i<prefixes.length;i++)out("\n",prefixes[i],"animation: left-spin ",this.DURATION,"ms ",bezier," infinite;\n",prefixes[i],"transform: rotate(129deg);\n");out("\nborder-right-color: transparent !important;\n}\n\n.spinner-circle-clipper.spinner-clipper-right .spinner-circle {\n");for(var i=0;i<prefixes.length;i++)out("\n",prefixes[i],"animation: right-spin ",this.DURATION,"ms ",bezier," infinite;\n",prefixes[i],"transform: rotate(-129deg);\n");out("\nborder-left-color: transparent !important;\nleft: -100%\n}\n\n.spinner-circle-clipper .spinner-circle {\nwidth: 200%;\n}\n\n.spinner-circle {\nposition: absolute;\ntop: 0;\nbottom: 0;\nleft: 0;\nright: 0;\nbox-sizing: border-box;\nheight: 100%;\nborder-width: 4px;\nborder-style: solid;\nborder-color: inherit;\nborder-bottom-color: transparent !important;\nborder-radius: 50%;\n");for(var i=0;i<prefixes.length;i++)out("\n",prefixes[i],"animation: none;\n");out("\n}\n\n.spinner-gap-patch {\nposition: absolute;\nbox-sizing: border-box;\ntop: 0;\nleft: 45%;\nwidth: 10%;\nheight: 100%;\noverflow: hidden;\nborder-color: inherit;\n}\n\n.spinner-gap-patch .spinner-circle {\nwidth: 1000%;\nleft: -450%;\n}\n\n");for(var i=0;i<prefixes.length;i++)out("\n@",prefixes[i],"keyframes fill-unfill-rotate {\n12.5% { ",prefixes[i],"transform: rotate(135deg); }\n25%   { ",prefixes[i],"transform: rotate(270deg); }\n37.5% { ",prefixes[i],"transform: rotate(405deg); }\n50%   { ",prefixes[i],"transform: rotate(540deg); }\n62.5% { ",prefixes[i],"transform: rotate(675deg); }\n75%   { ",prefixes[i],"transform: rotate(810deg); }\n87.5% { ",prefixes[i],"transform: rotate(945deg); }\nto    { ",prefixes[i],"transform: rotate(1080deg); }\n}\n\n@",prefixes[i],"keyframes left-spin {\nfrom { ",prefixes[i],"transform: rotate(130deg); }\n50%  { ",prefixes[i],"transform: rotate(-5deg); }\nto   { ",prefixes[i],"transform: rotate(130deg); }\n}\n\n@",prefixes[i],"keyframes right-spin {\nfrom { ",prefixes[i],"transform: rotate(-130deg); }\n50%  { ",prefixes[i],"transform: rotate(5deg); }\nto   { ",prefixes[i],"transform: rotate(-130deg); }\n}\n\n@",prefixes[i],"keyframes container-rotate {\nto { ",prefixes[i],"transform: rotate(360deg); }\n}\n");return out("\n"),X.foam.grammars.CSSDecl.create({model:this.model_}).parser.parseString(out.toString())},language:"css"},{name:"toInnerHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div class="spinner-fixed-box">\n        <div class="spinner-turning-box">\n          <div class="spinner-layer" style="border-color: ',this.color,'">\n            <div class="spinner-circle-clipper spinner-clipper-left"><div class="spinner-circle"></div></div><div class="spinner-gap-patch"><div class="spinner-circle"></div></div><div class="spinner-circle-clipper spinner-clipper-right"><div class="spinner-circle"></div></div>\n          </div>\n        </div>\n      </div>\n    '),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"ScrollViewRow",requires:["foam.ui.DetailView"],properties:[{name:"data",postSet:function(old,nu){if(this.view&&(this.view.data=nu,!this.DetailView.isInstance(this.view))){var e=this.X.$(this.id);e.innerHTML=this.view.toHTML(),this.view.initHTML()}}},{name:"view",postSet:function(old,nu){nu&&(nu.data=this.data)}},{name:"id"},{name:"y",postSet:function(old,nu){this.view&&this.id&&old!==nu&&(this.X.$(this.id).style.webkitTransform="translate3d(0px,"+nu+"px, 0px)")}}],methods:[function destroy(isParentDestroyed){this.view.destroy(isParentDestroyed)}]}),CLASS({"package":"foam.ui",name:"AbstractDAOView","extends":"foam.ui.SimpleView",exports:["dao as daoViewCurrentDAO"],properties:[{name:"data",postSet:function(oldDAO,dao){this.dao!==dao&&(this.dao=dao)}},{model_:"foam.core.types.DAOProperty",name:"dao",label:"DAO",postSet:function(oldDAO,dao){dao?this.data!==dao&&(this.data=dao):this.data=""},help:"An alias for the data property.",onDAOUpdate:"onDAOUpdate"}],methods:[function onDAOUpdate(){}]}),CLASS({"package":"foam.util.busy",name:"BusyFlagTracker",properties:[{name:"busyStatus"},{name:"target",postSet:function(oldTarget,newTarget){this.callback&&(this.callback(),this.callback=null),oldTarget&&oldTarget.remoteListener(this.onChange),newTarget.addListener(this.onChange)}},{name:"callback"}],listeners:[{name:"onChange",code:function(_,__,oldValue,newValue){newValue?(this.callback&&this.callback(),this.callback=this.busyStatus.start()):(this.callback(),this.callback=null)}}]}),CLASS({"package":"foam.browser.ui",name:"BrowserView","extends":"foam.ui.DetailView",requires:["foam.browser.BrowserConfig","foam.browser.ui.StackView","foam.ui.md.FlatButton","foam.input.touch.GestureManager","foam.input.touch.TouchManager","foam.ui.DAOListView","foam.ui.PopupChoiceView","foam.ui.Tooltip","foam.ui.md.DetailView","foam.ui.md.SharedStyles","foam.ui.md.UpdateDetailView"],exports:["gestureManager","stack","touchManager"],properties:[{name:"touchManager",factory:function(){return this.X.touchManager||this.TouchManager.create()}},{name:"gestureManager",factory:function(){return this.X.gestureManager||this.GestureManager.create()}},{name:"stack",factory:function(){return this.StackView.create()}},{name:"className",defaultValue:"browser-outer-container"}],methods:[function init(args){this.SUPER(args),this.Y.registerModel(this.FlatButton.xbind({displayMode:"ICON_ONLY",height:24,width:24}),"foam.ui.ActionButton"),this.SharedStyles.create()},function initHTML(){this.SUPER(),this.stack.initHTML(),this.stack.pushView(this.InnerBrowserView.create({parent:this,data$:this.data$},this.Y))}],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',self.id,'" ',this.cssClassAttr(),">\n        "),this.stack.toHTML(out),out("\n      </div>\n    "),out.toString()},language:"html"},{name:"CSS",code:ConstantTemplate(".browser-outer-container{background-color:#9e9e9e}"),language:"css"}],models:[{"package":"foam.browser.ui.BrowserView",name:"InnerBrowserView","extends":"foam.ui.DetailView",requires:["foam.ui.md.FlatButton","foam.ui.PopupChoiceView","foam.ui.SpinnerView","foam.ui.md.HaloView"],imports:["document","stack","selection$"],exports:["selection"],properties:[{name:"data",postSet:function(old,nu){old&&old.unsubscribe(old.MENU_CLOSE,this.onMenuTouch),nu&&nu.subscribe(nu.MENU_CLOSE,this.onMenuTouch),this.onMenuTouch(),old.dao&&old.dao.unlisten(this),nu.dao&&nu.dao.listen(this)}},{name:"className",defaultValue:"browser"},{name:"selection",postSet:function(old,nu){nu&&this.data&&this.data.dao?this.data.dao.find(nu.id,{put:function(obj){this.stack.pushView(this.data.detailView({data:obj,controllerMode:"update",innerView:this.data.innerDetailView},this.Y.sub({dao:this.data.dao})))}.bind(this),error:function(){this.selection=""}.bind(this)}):old!=nu&&this.stack.popChildViews()}},{name:"menuExpanded",defaultValue:!1},{name:"menuView_"},{name:"menuHeaderView_"},{name:"menuOpen",defaultValue:!1,postSet:function(old,nu){if(nu){var html="";this.data.menuHeaderView&&(this.menuHeaderView_=this.data.menuHeaderView(),html+=this.menuHeaderView_.toHTML()),this.menuView_=this.data.menuFactory(),html+=this.menuView_.toHTML(),this.$menuBody.innerHTML=html,this.menuHeaderView_&&this.menuHeaderView_.initHTML(),this.menuView_.initHTML()}else this.menuView_&&(this.menuView_.destroy(),this.menuView_="",this.menuHeaderView_&&(this.menuHeaderView_.destroy(),this.menuHeaderView_=""))}},{name:"searchMode",defaultValue:!1},{name:"spinner",factory:function(){return this.data.busyStatus?this.SpinnerView.create({data$:this.data.busyStatus.busy$,color:"#fff"}):void 0}},{name:"listView_",visibility:"hidden",hidden:!0},{name:"sortOrderView_",factory:function(){return!this.data.sortChoices||this.data.sortChoices.length<=1?void 0:this.PopupChoiceView.create({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAIUlEQVQ4y2NgGAVEg/9EAMo0DCFPU0/DIPc0bTSMArwAAI+/j3GjMHVsAAAAAElFTkSuQmCC",data$:this.data.sortOrder$,choices:this.data.sortChoices})}},{name:"minWidth",getter:function(){return this.listView_.minWidth||300}},{name:"preferredWidth",getter:function(){return this.listView_.preferredWidth||400}},{name:"maxWidth",getter:function(){return this.listView_.maxWidth||1280}},{name:"$menuContainer",getter:function(){return this.X.$(this.id+"-menu-container")}},{name:"$menuBody",getter:function(){return this.X.$(this.id+"-menu-body")}}],actions:[{name:"menuButton",isAvailable:function(){return!this.menuExpanded},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAGklEQVQ4y2NgGAVEg/9EAMo0jHp61NOjAAgAUWrXKeQhPE4AAAAASUVORK5CYII=",ligature:"menu",code:function(){this.menuOpen=!0}},{name:"searchButton",iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAvklEQVQ4Ec3BO4rCYBgAwA/NOf6gZ1jZRlDwVoreI4W9+DiS0VJTGytlthMCyZLSmYjvZuGk8lY5msf/ZLaaCll0s8XDUjKQW6lRRBcLPPzEh4kas2jnhGU0WOMQ7VRI0WCEW7TzxiAaDPGKdirk0WCMe7RzxCoabLCPduaoTeLDryem0UWB2trI0NjGE7voJlNo2uEqj25mDm5e7vamEa64yKMvuQtKKfqSK1FK0ZdcibMUfUlKZyn6k6T4Xn//4NdJ9ptTNwAAAABJRU5ErkJggg==",ligature:"search",code:function(){this.searchMode=!0}},{name:"backButton",iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAPUlEQVQ4y2NgGLbgf8P/BtKU////+78WacpDSFMeSlPlYaQo/0OacjyAcg1wJ4WTGmHDS4sWaVrqhm/mBQAoLpX9t+4i2wAAAABJRU5ErkJggg==",ligature:"arrow_back",code:function(){this.searchMode=!1,this.data.search=""}},{name:"createButton",isAvailable:function(){return this.data.showAdd},iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAH0lEQVQ4y2NgGAUw8B8IRjXgUoQLUEfDaDyQqmF4AwADqmeZrHJtnQAAAABJRU5ErkJggg==",ligature:"add",code:function(){this.data.createFunction.call(this)}}],methods:[function initHTML(){var out=TemplateOutput.create(this);this.menuHTML(out),this.document.body.insertAdjacentHTML("afterbegin",out.toString()),this.$menuBody.addEventListener("transitionend",this.onMenuClosed),this.SUPER()},function destroy(s){this.SUPER(s);var menuBodyElem=this.$menuBody;menuBodyElem&&this.$menuBody.removeEventListener("transitionend",this.onMenuClosed);var menuElem=this.$menuContainer;menuElem&&(menuElem.outerHTML="")},function remove(selection){this.selection&&this.selection.id&&this.selection.id==selection.id&&(this.selection="")}],listeners:[{name:"onMenuTouch",code:function(){this.menuOpen=!1},isMerged:200},{name:"onMenuClosed",code:function(evt){evt.propertyName&&!this.menuOpen&&(this.selection="")}},{name:"onViewDestroyed",code:function(sender,topic,view){view.data&&this.selection&&view.data.id==this.selection.id&&(this.selection="")}}],templates:[{name:"CSS",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out("\n.hidden {\ndisplay: none !important;\n}\n.expand {\nflex-grow: 1;\n}\n\n.browser {\ndisplay: flex;\nflex-direction: column;\nheight: 100%;\nposition: relative;\n}\n.browser-header {\nalign-items: center;\ncolor: #fff;\ndisplay: flex;\nflex-grow: 0;\nflex-shrink: 0;\nheight: 56px;\npadding: 0;\n}\n.browser-header .title {\nmargin-left: 12px;\n}\n.browser-header .md-title {\ncolor: #fff;\n}\n\n.browser-header .browser-spinner {\ndisplay: inline-block;\nheight: 42px;\noverflow: hidden;\nwidth: 42px;\n}\n.browser-header .browser-spinner .spinner-fixed-box {\nheight: 26px;\nwidth: 26px;\n}\n.browser-header .browser-spinner .spinner-circle {\nborder-width: 3px;\n}\n\n.browser-header.search-header .md-text-field-input {\ncolor: #fff;\n}\n");for(var prefixes=["::-webkit-input",":-moz","::-moz",":-ms-input"],i=0;i<prefixes.length;i++)out("\n.browser-header.search-header .md-text-field-input>",prefixes[i],"-placeholder {\ncolor: #ccc;\n}\n");out("\n\n");var ANIMATION_TIME="0.4s";return out("\n\n.browser-menu-container {\nvisibility: hidden;\nposition: fixed;\ntop: 0;\nbottom: 0;\nleft: 0;\nright: 0;\nz-index: 20;\ntransition: visibility 0.01s linear ",ANIMATION_TIME,";\n}\n.browser-menu-container.menu-open {\nvisibility: visible;\ntransition: visibility ",ANIMATION_TIME," linear;\n}\n.browser-menu-inner {\nposition: relative;\nheight: 100%;\nwidth: 100%;\n}\n\n.browser-menu-overlay {\nbackground-color: #000;\nopacity: 0;\nposition: absolute;\nheight: 100%;\ntop: 0;\nleft: 0;\nwidth: 100%;\ntransition: opacity ",ANIMATION_TIME," ease;\n}\n.menu-open .browser-menu-overlay {\nopacity: 0.4;\ntransition: opacity ",ANIMATION_TIME," ease;\n}\n\n.browser-menu {\nbackground-color: #fff;\nposition: absolute;\nheight: 100%;\ntop: 0;\nleft: 0;\ntransform: translate3d(-300px, 0, 0);\noverflow-y: auto;\nwidth: 300px;\ntransition: transform ",ANIMATION_TIME," ease;\n}\n.menu-open .browser-menu {\ntransform: translate3d(0, 0, 0);\ntransition: transform ",ANIMATION_TIME," ease;\n}\n\n.browser-body {\ndisplay: flex;\nflex-direction: column;\nflex-grow: 1;\noverflow-x: hidden;\noverflow-y: auto;\n}\n"),X.foam.grammars.CSSDecl.create({model:this.model_}).parser.parseString(out.toString())},language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);out('\n          <div id="',this.id,'" ',this.cssClassAttr(),">\n            <style>\n              .browser-header-color { background-color: ",this.data.headerColor,"; }\n              .browser-body-color { background-color: ",this.data.backgroundColor,'; }\n            </style>\n\n            <div id="',this.id,'-header" class="browser-header browser-header-color">\n              ',self.createTemplateView("menuButton"),"\n              ",self.createTemplateView("title",{mode:"read-only",extraClassName:"md-title expand title"}),"\n              "),this.spinner&&out('\n                <span class="browser-spinner">',self.spinner,"</span>\n              "),out("\n              ");for(var i=0;i<this.parent.model_.getRuntimeActions().length;i++){var v=this.createActionView(this.parent.model_.getRuntimeActions()[i]);v.data=this.parent,out(v)}if(out("\n              ",self.createTemplateView("searchButton"),"\n              "),this.sortOrderView_&&out("\n                ",this.sortOrderView_,"\n              "),out('\n            </div>\n            <div id="',this.id,'-header-search" class="browser-header search-header browser-header-color hidden">\n              ',self.createTemplateView("backButton"),"\n              ",self.createTemplateView("search",{extraClassName:"expand search-field"}),"\n            </div>\n            "),this.searchMode$.addListener(function(){DOM.setClass(self.X.$(self.id+"-header"),"hidden",self.searchMode),DOM.setClass(self.X.$(self.id+"-header-search"),"hidden",!self.searchMode),self.searchMode&&self.searchView.focus()}),out('\n            <div class="browser-body browser-body-color">\n              ',this.listView_=this.data.listView({data$:this.data.filteredDAO$},this.Y),"\n            </div>\n            "),this.data.showAdd){out('\n              <div class="floating-action">\n                ');var createButtonX=this.Y.sub();createButtonX.registerModel(this.FlatButton.xbind({haloColor:"black",displayMode:"ICON_ONLY"}),"foam.ui.ActionButton"),out("\n                ",self.createTemplateView("createButton",{extraClassName:"floatingActionButton",color:"white",font:"30px Roboto Arial",alpha:1,width:44,height:44,radius:22,background:"#e51c23",X:createButtonX}),"\n              </div>\n            ")}return out("\n          </div>\n        "),out.toString()},language:"html"},{name:"menuHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n          <div id="',this.id,'-menu-container" class="browser-menu-container">\n            <div class="browser-menu-inner">\n              <div id="',this.id,'-menu-overlay" class="browser-menu-overlay"></div>\n              <div id="',this.id,'-menu-body" class="browser-menu"></div>\n            </div>\n          </div>\n          '),this.setClass("menu-open",function(){return self.menuOpen},this.id+"-menu-container"),this.on("click",this.onMenuTouch,this.id+"-menu-overlay"),out("\n        "),out.toString()},language:"html"}]}]}),CLASS({"package":"foam.browser",name:"BrowserConfig",requires:["foam.dao.EasyDAO","foam.dao.NullDAO","foam.mlang.CannedQuery","foam.ui.DAOListView","foam.ui.md.CannedQueryCitationView","foam.ui.md.CitationView"],exports:["dao"],properties:[{name:"title",defaultValueFn:function(){return this.model&&this.model.name?this.model.name+" Browser":"Browser"}},{model_:"foam.core.types.DAOProperty",name:"dao",lazyFactory:function(){return this.instance_.model&&this.EasyDAO.create({model:this.model,daoType:"MDAO",seqNo:!0})}},{model_:"ModelProperty",name:"model",type:"Model",required:!0,factory:function(){return this.instance_.dao&&this.dao.model}},{name:"filteredDAO",view:"foam.ui.DAOListView",dynamicValue:function(){this.dao,this.query,this.sortOrder;var query=this.query||(this.showAllWithNoQuery?TRUE:FALSE),dao=this.dao.where(this.query);return this.sortOrder&&(dao=dao.orderBy(this.sortOrder)),dao}},{name:"query",dynamicValue:function(){this.search,this.cannedQuery,this.searchWithinCannedQuery;var canned=this.cannedQuery.expression;if(""!==this.search){var query=this.queryParser.parseString(this.search);return this.searchWithinCannedQuery?AND(query,canned):query}return canned}},{name:"queryParser",defaultValue:{parseString:function KEYWORD(word){return KeywordExpr.create({arg1:word})}}},{model_:"foam.core.types.DAOProperty",name:"cannedQueryDAO",factory:function(){return this.NullDAO.create()},postSet:function(old,nu){!nu||this.query||this.cannedQuery||nu.limit(1).select([])(function(arr){this.cannedQuery=arr[0]}.bind(this))},view:{factory_:"foam.ui.DAOListView",rowView:"foam.ui.md.CannedQueryCitationView"}},{name:"cannedQuery"},{name:"sortChoices",factory:function(){return[]}},{name:"sortOrder",factory:function(){return this.sortChoices&&this.sortChoices.length&&this.sortChoices[0][0]}},{model_:"StringProperty",name:"search",type:"String",view:{factory_:"foam.ui.md.TextFieldView",label:"Search",floatingLabel:!1,placeholder:"Search",onKeyMode:!0}},{model_:"ViewFactoryProperty",name:"listView",type:"ViewFactory",defaultValue:{factory_:"foam.ui.DAOListView",rowView:"foam.ui.md.CitationView",minWidth:350,preferredWidth:500,maxWidth:500}},{model_:"ViewFactoryProperty",name:"detailView",type:"ViewFactory",defaultValue:{factory_:"foam.ui.md.UpdateDetailView",perferredWidth:1e3}},{model_:"ViewFactoryProperty",name:"innerDetailView",type:"ViewFactory",defaultValue:"foam.ui.md.DetailView"},{model_:"ViewFactoryProperty",name:"createView",type:"ViewFactory",defaultValue:function(args,X){var newObj=this.model.create();return this.detailView({data:newObj,innerView:this.innerDetailView},X)}},{model_:"FunctionProperty",name:"createFunction",type:"Function",defaultValue:function(){this.stack.pushView(this.data.createView(null,this.Y.sub({dao:this.data.dao})))}},{model_:"ViewFactoryProperty",name:"menuRowView",type:"ViewFactory",defaultValue:"foam.ui.md.CannedQueryCitationView"},{model_:"ViewFactoryProperty",name:"menuHeaderView",type:"ViewFactory"},{name:"menuFactory",defaultValue:function(){var view=this.DAOListView.create({data:this.cannedQueryDAO.orderBy(this.CannedQuery.SECTION,this.CannedQuery.ORDER,this.CannedQuery.LABEL),rowView:this.menuRowView},this.Y.sub({selection$:this.cannedQuery$}));return view.subscribe(view.ROW_CLICK,function(){this.publish(this.MENU_CLOSE)}.bind(this)),view}},{name:"busyStatus"},{name:"headerColor",defaultValue:"#3e50b4"},{name:"backgroundColor",defaultValue:"#ffffff"},{name:"showAllWithNoQuery",defaultValue:!0},{model_:"BooleanProperty",name:"showAdd",type:"Boolean",defaultValue:!0},{model_:"BooleanProperty",name:"searchWithinCannedQuery",type:"Boolean",defaultValue:!1}],constants:[{name:"MENU_CLOSE",value:["menu-close"]}]}),CLASS({"package":"foam.dao",name:"EasyDAO","extends":"foam.dao.ProxyDAO",requires:["MDAO","foam.core.dao.CloningDAO","foam.core.dao.MergeDAO","foam.core.dao.MigrationDAO","foam.core.dao.StorageDAO","foam.core.dao.SyncDAO","foam.core.dao.SyncTrait","foam.core.dao.sync.PollingSyncDAO","foam.core.dao.sync.SocketSyncDAO","foam.core.dao.VersionNoDAO","foam.dao.CachingDAO","foam.dao.ContextualizingDAO","foam.dao.DeDupDAO","foam.dao.EasyClientDAO","foam.dao.GUIDDAO","foam.dao.IDBDAO","foam.dao.SeqNoDAO","foam.dao.LoggingDAO","foam.dao.TimingDAO"],imports:["document"],properties:[{name:"name",defaultValueFn:function(){return this.model.id}},{model_:"BooleanProperty",name:"seqNo",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"guid",label:"GUID",type:"Boolean",defaultValue:!1},{name:"seqProperty",type:"Property"},{model_:"BooleanProperty",name:"cache",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"dedup",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"logging",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"timing",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"contextualize",type:"Boolean",defaultValue:!1},{model_:"BooleanProperty",name:"cloning",type:"Boolean",defaultValue:!1},{name:"daoType",defaultValue:"foam.dao.IDBDAO"},{model_:"BooleanProperty",name:"autoIndex",type:"Boolean",defaultValue:!1},{model_:"ArrayProperty",name:"migrationRules",type:"Array",subType:"foam.core.dao.MigrationRule"},{model_:"BooleanProperty",name:"syncWithServer",type:"Boolean"},{model_:"BooleanProperty",name:"sockets",type:"Boolean",defaultValue:!1},{model_:"StringProperty",name:"serverUri",type:"String",defaultValueFn:function(){return this.document&&this.document.location?this.document.location.origin+"/api":""}},{model_:"BooleanProperty",name:"isServer",type:"Boolean",defaultValue:!1},{name:"syncProperty"},{name:"deletedProperty"}],constants:[{name:"ALIASES",value:{IDB:"foam.dao.IDBDAO",LOCAL:"foam.core.dao.StorageDAO",SYNC:"foam.core.dao.StorageDAO"}}],methods:[function init(args){this.SUPER(args),window.chrome&&chrome.storage&&(this.ALIASES.LOCAL="foam.core.dao.ChromeStorageDAO",this.ALIASES.SYNC="foam.core.dao.ChromeSyncStorageDAO");var daoType="string"==typeof this.daoType?this.ALIASES[this.daoType]||this.daoType:this.daoType,daoModel="string"==typeof daoType?this.X.lookup(daoType)||GLOBAL[daoType]:daoType,params={model:this.model,autoIndex:this.autoIndex};daoModel||console.warn("EasyDAO: Unknown DAO Type.  Add '"+daoType+"' to requires: list."),this.name&&(params.name=this.name),(this.seqNo||this.guid)&&(params.property=this.seqProperty);var dao=daoModel.create(params,this.Y);if(MDAO.isInstance(dao)?(this.mdao=dao,this.dedup&&(dao=this.DeDupDAO.create({delegate:dao},this.Y))):(this.migrationRules&&this.migrationRules.length&&(dao=this.MigrationDAO.create({delegate:dao,rules:this.migrationRules,name:this.model.id+"_"+daoModel.id+"_"+this.name},this.Y)),this.cache&&(this.mdao=this.MDAO.create(params,this.Y),dao=this.CachingDAO.create({cache:this.dedup?this.mdao:this.DeDupDAO.create({delegate:this.mdao}),src:dao,model:this.model},this.Y))),this.seqNo&&this.guid)throw"EasyDAO 'seqNo' and 'guid' features are mutually exclusive.";if(this.seqNo){var args={__proto__:params,delegate:dao,model:this.model};this.seqProperty&&(args.property=this.seqProperty),dao=this.SeqNoDAO.create(args,this.Y)}if(this.guid){var args={__proto__:params,delegate:dao,model:this.model};this.seqProperty&&(args.property=this.seqProperty),dao=this.GUIDDAO.create(args,this.Y)}var model=this.model;if(this.syncWithServer&&this.isServer)throw"isServer and syncWithServer are mutually exclusive.";if((this.syncWithServer||this.isServer)&&(!this.syncProperty||!this.deletedProperty)){if(-1==model.traits.indexOf("foam.core.dao.SyncTrait"))throw"Syncing with server requires the foam.core.dao.SyncTrait be applied to your model, '"+this.model.id+"'.";this.syncProperty=model.getPrototype().SYNC_PROPERTY,this.deletedProperty=model.getPrototype().DELETED}if(this.syncWithServer){var syncStrategy=this.sockets?this.SocketSyncDAO:this.PollingSyncDAO;dao=syncStrategy.create({remoteDAO:this.EasyClientDAO.create({serverUri:this.serverUri,model:model,sockets:this.sockets,reconnectPeriod:5e3},this.Y),syncProperty:this.syncProperty,deletedProperty:this.deletedProperty,delegate:dao,period:1e3},this.Y),dao.syncRecordDAO=foam.dao.EasyDAO.create({model:dao.SyncRecord,cache:!0,daoType:this.daoType,name:this.name+"_SyncRecords"},this.Y)}this.isServer&&(dao=this.VersionNoDAO.create({delegate:dao,property:this.syncProperty,version:2},this.Y)),this.contextualize&&(dao=this.ContextualizingDAO.create({delegate:dao},this.Y)),this.cloning&&(dao=this.CloningDAO.create({delegate:dao},this.Y)),this.timing&&(dao=this.TimingDAO.create({name:this.model.plural+"DAO",delegate:dao},this.Y)),this.logging&&(dao=this.LoggingDAO.create({delegate:dao},this.Y)),this.delegate=dao},function addIndex(){return this.mdao&&this.mdao.addIndex.apply(this.mdao,arguments),this},function addRawIndex(){return this.mdao&&this.mdao.addRawIndex.apply(this.mdao,arguments),this}],help:"A facade for easy DAO setup."}),CLASS({"package":"foam.core.dao",name:"MigrationDAO","extends":"foam.dao.ProxyDAO",requires:["foam.core.dao.MigrationRule","foam.dao.FutureDAO","foam.dao.DAOVersion"],imports:["daoVersionDao"],properties:[{name:"delegate"},{model_:"ArrayProperty",name:"rules",type:"Array",subType:"foam.core.dao.MigrationRule"},{name:"name"}],methods:[function init(){var dao=this.delegate,future=afuture();this.delegate=this.FutureDAO.create({future:future.get});var self=this,version;aseq(function(ret){self.daoVersionDao.find(self.name,{put:function(c){version=c,ret()},error:function(){version=self.DAOVersion.create({name:self.name,version:0}),ret()}})},function(ret){function updateVersion(ret,v){var c=version.clone();c.version=v,self.daoVersionDao.put(c,ret)}var rulesDAO=self.rules.dao;rulesDAO.where(AND(GT(self.MigrationRule.VERSION,version.version))).select()(function(rules){for(var seq=[],i=0;i<rules.length;i++)!function(rule){seq.push(aseq(function(ret){rule.migration(ret,dao)},function(ret){updateVersion(ret,rule.version)}))}(self.rules[i]);seq.length>0?aseq.apply(null,seq)(ret):ret()})})(function(){future.set(dao)}),this.SUPER()}]}),CLASS({"package":"foam.core.dao",name:"MigrationRule",ids:["modelName"],properties:[{model_:"StringProperty",name:"modelName",type:"String"},{model_:"IntProperty",name:"version",type:"Int"},{model_:"FunctionProperty",name:"migration",type:"Function"}]}),CLASS({"package":"foam.dao",name:"DAOVersion",ids:["name"],properties:[{name:"name"},{name:"version"}]}),CLASS({"package":"foam.core.dao",name:"StorageDAO","extends":"MDAO",properties:[{model_:"StringProperty",name:"name",label:"Store Name",type:"String",defaultValueFn:function(){return this.model.id}}],methods:[function init(){this.SUPER();var objs=localStorage.getItem(this.name);objs&&JSONUtil.parse(this.Y,objs).select(this),this.addRawIndex({execute:function(){},bulkLoad:function(){},toString:function(){return"StorageDAO Update"},plan:function(){return{cost:Number.MAX_VALUE}},put:this.updated,remove:this.updated})}],listeners:[{name:"updated",code:function(){this.select()(function(a){localStorage.setItem(this.name,JSONUtil.compact.where(NOT_TRANSIENT).stringify(a))}.bind(this))},isMerged:100}]}),CLASS({"package":"foam.core.dao",name:"SyncDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"remoteDAO",required:!0,"transient":!0},{name:"syncRecordDAO",required:!0,"transient":!0},{name:"syncProperty",required:!0,"transient":!0},{name:"deletedProperty",required:!0,"transient":!0},{name:"model",required:!0,"transient":!0}],methods:[function put(obj,sink){this.delegate.put(obj,{put:function(o){this.syncRecordDAO.put(this.SyncRecord.create({id:o.id,syncNo:-1})),sink&&sink.put&&sink.put(o)}.bind(this),error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}})},function remove(obj,sink){this.delegate.remove(obj,{remove:function(o){this.syncRecordDAO.put(this.SyncRecord.create({id:o.id,deleted:!0,syncNo:-1})),sink&&sink.remove&&sink.remove(o)}.bind(this),error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}})},function processFromServer(obj){this.syncRecordDAO.put(this.SyncRecord.create({id:obj.id,syncNo:obj[this.syncProperty.name]
})),obj[this.deletedProperty.name]?this.delegate.remove(obj):this.delegate.put(obj,{error:function(){console.error.apply(console,arguments)}})},function syncFromServer(ret){this.syncRecordDAO.select(MAX(this.SyncRecord.SYNC_NO))(function(m){this.remoteDAO.where(GT(this.syncProperty,m.max)).select({put:function(obj){this.processFromServer(obj)}.bind(this)})}.bind(this))},function syncToServer(ret){this.syncRecordDAO.where(EQ(this.SyncRecord.SYNC_NO,-1)).select(GROUP_BY(this.SyncRecord.DELETED,MAP(this.SyncRecord.ID,[].sink)))(function(records){if(records.groups["true"])for(var i=0;i<records.groups["true"].arg2.length;i++){var id=records.groups["true"].arg2[i],obj=this.model.create({id:id});obj[this.deletedProperty.name]=!0,this.remoteDAO.put(obj,{put:function(obj){this.delegate.remove(obj)}.bind(this)})}if(records.groups["false"])for(var list=records.groups["false"].arg2,i=0;i<list.length;i++)this.delegate.find(list[i],{put:function(obj){this.remoteDAO.put(obj,{put:function(obj){this.syncRecordDAO.put(this.SyncRecord.create({id:obj.id,syncNo:-1*obj[this.syncProperty.name]}))}.bind(this)})}.bind(this)})}.bind(this))}],listeners:[{name:"sync",code:function(){this.syncToServer(),this.syncFromServer()},isMerged:100}],models:[{"package":"foam.core.dao.SyncDAO",name:"SyncRecord",properties:[{name:"id"},{model_:"IntProperty",name:"syncNo",type:"String",defaultValue:-1},{model_:"BooleanProperty",name:"deleted",type:"String",defaultValue:!1}]}]}),CLASS({"package":"foam.core.dao.sync",name:"PollingSyncDAO","extends":"foam.core.dao.SyncDAO",imports:["setTimeout","clearTimeout"],properties:[{name:"period",postSet:function(){this.start()}},{name:"timer"}],methods:[function start(){this.timer&&this.clearTimeout(this.timer),this.timer=this.setTimeout(function(){this.sync(),this.start()}.bind(this),this.period)}],help:"Polling based sync strategy, calls sync periodically."}),CLASS({"package":"foam.core.dao.sync",name:"SocketSyncDAO","extends":"foam.core.dao.SyncDAO",methods:[function init(){this.SUPER();var self=this;this.remoteDAO.listen({put:function(o){self.processFromServer(o)},remove:function(o){},reset:function(){self.sync()}})},function put(obj,sink){var self=this;this.SUPER(obj,{put:function(){self.sync(),sink&&sink.put&&sink.put.apply(sink,arguments)},error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}})},function remove(obj,sink){var self=this;this.SUPER(obj,{remove:function(){self.sync(),sink&&sink.remove&&sink.remove.apply(sink,arguments)},error:function(){sink&&sink.error&&sink.error.apply(sink,arguments)}})}],listeners:[{name:"onConnect",code:function(){this.sync()}}],help:"Socket based sync strategy.  Listens on remote dao and syncs on put/remove"}),CLASS({"package":"foam.dao",name:"DeDupDAO","extends":"foam.dao.ProxyDAO",methods:[function put(obj,sink){this.dedup(obj),this.delegate.put(obj,sink)},function dedup(obj){var inst=obj.instance_;for(var key in inst){var val=inst[key];"string"==typeof val&&(inst[key]=val.intern())}}]}),CLASS({"package":"foam.dao",name:"EasyClientDAO","extends":"foam.dao.ProxyDAO",requires:["XHR","foam.core.dao.ClientDAO","foam.core.dao.WebSocketDAO","foam.dao.FutureDAO","foam.dao.LoggingDAO","foam.messaging.WebSocket","foam.oauth2.GoogleSignIn"],imports:["document"],properties:[{name:"serverUri",factory:function(){return this.document.location.origin+"/api"}},{name:"model"},{name:"subject",defaultValueFn:function(){return this.model.id+"DAO"}},{name:"googleAuth",defaultValue:!1,postSet:function(old,nu){nu&&(this.googleSignIn_=this.GoogleSignIn.create())}},{name:"googleSignIn_"},{model_:"BooleanProperty",name:"sockets",type:"Boolean",defaultValue:!1},{name:"reconnectPeriod",defaultValue:0},{model_:"BooleanProperty",name:"logging",type:"Boolean",defaultValue:!1},{name:"delegate",factory:function(){var dao=this.logging?this.LoggingDAO.create(null,this.Y):this.X.lookup("foam.dao.ProxyDAO").create(null,this.Y);if(this.sockets){var uri=this.serverUri.replace(/^https/,"wss").replace(/^http/,"ws"),socket=this.WebSocket.create({uri:uri,reconnectPeriod:this.reconnectPeriod}),future=afuture();return socket.subscribe(socket.ON_CONNECT,EventService.oneTime(function(){dao.delegate=this.WebSocketDAO.create({uri:this.serverUri,subject:this.subject,model:this.model,socket:socket},this.Y),future.set(dao)}.bind(this))),this.FutureDAO.create({future:future.get})}return dao.delegate=this.ClientDAO.create({asend:this.asend.bind(this),model:this.model,subject:this.subject},this.Y),dao}}],methods:[function asend(ret,data){var json=JSONUtil.where(function(prop,obj){return Property.isInstance(obj)&&"name"!==prop.name&&"modelId"!==prop.name?!1:!0}),auth=this.googleAuth?this.googleSignIn_.alogin.bind(this.googleSignIn_):aconstant(void 0);aseq(auth,function(ret){var xhr=this.XHR.create();this.googleAuth&&xhr.addDecorator(this.googleSignIn_),xhr.asend(ret,this.serverUri,json.stringify(data),"POST")}.bind(this),function(ret,resp,_,success){return success?window.IN_CHROME_APP&&IN_CHROME_APP()?void aeval("("+resp+")")(function(data){JSONUtil.amapToObj(ret,this.X,data)}.bind(this)):void JSONUtil.aparse(ret,this.X,resp):void ret(null)})(ret)}]}),CLASS({"package":"foam.core.dao",name:"ClientDAO","extends":"AbstractDAO",properties:[{name:"asend",required:!0,help:"afunc used to send request to the DAOServer."},{name:"model",required:!0},{name:"subject",factory:function(){return this.model.id+"DAO"}}],methods:[function oneShot_(method,params,sink){var self=this;this.asend(function(resp){sink&&(resp||sink&&sink.error&&sink.error(method,params[0]),resp.put?(resp.put.model_?self.notify_("put",[resp.put]):self.notify_("put",[params[0]]),sink&&sink.put&&sink.put(resp.put)):resp.remove?(self.notify_("remove",[params[0]]),sink&&sink.remove&&sink.remove(resp.remove)):resp.error&&sink.error&&sink.error(resp.error))},{subject:self.subject,method:method,params:params})},function put(obj,sink){this.oneShot_("put",[obj],sink)},function remove(obj,sink){this.oneShot_("remove",[obj],sink)},function find(q,sink){this.oneShot_("find",[q],sink)},function removeAll(sink,options){var future=afuture(),self=this;return this.asend(function(response){future.set()},{subject:self.subject,method:"removeAll",params:[null,options]}),future},function select(sink,options){var future=afuture(),self=this;if(Expr.isInstance(sink)||Array.isArray(sink)||!sink)this.asend(function(response){response||sink&&sink.error&&sink.error(),future.set(response||sink)},{subject:self.subject,method:"select",params:[sink||null,options]});else{var fc=this.createFlowControl_();this.asend(function(response){if(!response)return sink&&sink.error&&sink.error(""),void future.set(sink);if(!Array.isArray(response))return void(sink.error&&sink.error("Received response that wasn't an array."));for(var i=0;i<response.length&&!fc.stopped;i++){if(fc.errorEvt){sink.error&&sink.error(fc.errorEvt);break}if(!response[i].model_){sink.error&&sink.error("Received response that wasn't an object.");break}sink.put&&sink.put(response[i],null,fc)}sink.eof&&sink.eof(),future.set(sink)},{subject:self.subject,method:"select",params:[null,options]})}return future.get}]}),CLASS({"package":"foam.core.dao",name:"WebSocketDAO","extends":"foam.core.dao.ClientDAO",requires:["foam.messaging.WebSocket"],properties:[{name:"uri"},{name:"socket",factory:function(){return this.WebSocket.create({uri:this.uri,reconnectPeriod:this.reconnectPeriod})},postSet:function(_,s){s.subscribe(s.ON_MESSAGE,this.onMessage),s.subscribe(s.ON_CONNECT,this.onConnect)}},{name:"reconnectPeriod",defaultValue:0},{name:"msgid",defaultValue:1},{name:"pending",factory:function(){return{}}},{name:"json",factory:function(){return JSONUtil.where(function(prop,obj){return prop["transient"]||Property.isInstance(obj)&&"name"!==prop.name&&"modelId"!==prop.name?!1:!0})}},{name:"asend",factory:function(){return function(ret,data){var msg=this.envelope(data);this.pending[msg.msgid]=ret,this.socket.send(this.json.stringify(msg))}}}],methods:[function envelope(msg){var msgid=this.msgid;return this.msgid+=1,{msgid:msgid,msg:msg}},function remoteListen(){var self=this;this.asend(function(resp){resp||sink&&sink.error&&sink.error()},{subject:self.subject,method:"listen",params:[null,null]})},function listen(sink,options){this.daoListeners_.length||this.remoteListen(),this.SUPER(sink,options)}],listeners:[{name:"onMessage",code:function(_,__,msg){JSONUtil.aparse(function(data){if(this.pending[data.msgid]){var ret=this.pending[data.msgid];return delete this.pending[data.msgid],void ret(data.msg)}return data.msg.notify?void this.notify_(data.msg.notify[0],[data.msg.notify[1]]):void console.warn("Unknown response.")}.bind(this),this.X,msg)}},{name:"onConnect",code:function(){this.remoteListen(),this.notify_("reset",[])}}]}),CLASS({"package":"foam.messaging",name:"WebSocket",imports:["setTimeout","window"],properties:[{name:"uri"},{name:"reconnectPeriod",defaultValue:0},{name:"reconnectTimer"},{name:"socket",postSet:function(old,s){old&&old.removeEventListener("onMessage",this.onMessage)}}],constants:[{name:"ON_MESSAGE",value:["message"]},{name:"ON_CONNECT",value:["connect"]}],methods:[function init(){this.SUPER(),this.connect(),this.window.addEventListener("online",this.connect)},function scheduleReconnect(){this.reconnectTimer||this.reconnectPeriod&&(this.reconnectTimer=this.setTimeout(this.connect,this.reconnectPeriod))},function send(msg){this.socket&&this.socket.send(msg)}],listeners:[{name:"connect",code:function(){this.reconnectTimer=0;var socket=new WebSocket(this.uri),self=this;socket.addEventListener("open",function(){self.socket=socket,self.publish(self.ON_CONNECT)}),socket.addEventListener("message",this.onMessage),socket.addEventListener("close",function(){self.socket="",self.scheduleReconnect()})}},{name:"onMessage",code:function(msg){this.publish(this.ON_MESSAGE,msg.data)}}]}),CLASS({"package":"foam.dao",name:"LoggingDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"name"},{name:"logger",lazyFactory:function(){return console.log.bind(console,this.name)}},{model_:"BooleanProperty",name:"logReads",type:"Boolean",defaultValue:!1}],methods:[function put(obj,sink){this.logger("put",obj),this.SUPER(obj,sink)},function remove(query,sink){this.logger("remove",query),this.SUPER(query,sink)},function select(sink,options){if(this.logger("select",options||""),this.logReads){var put=sink.put.bind(sink),newSink={__proto__:sink};return newSink.put=function(o){return this.logger("read",o),put.apply(null,arguments)}.bind(this),this.SUPER(newSink,options)}return this.SUPER(sink,options)},function removeAll(sink,options){return this.logger("removeAll",options),this.SUPER(sink,options)},function find(id,sink){return this.logger("find",id),this.SUPER(id,sink)}]}),CLASS({"package":"foam.oauth2",name:"GoogleSignIn",requires:["Binding","PersistentContext","foam.dao.IDBDAO","foam.oauth2.GoogleSignInTokenCarrier","foam.ui.md.PopupView"],imports:["document","googleClientId","window"],properties:[{name:"popupView_"},{name:"persistentContext_",factory:function(){return this.PersistentContext.create({dao:this.IDBDAO.create({model:this.Binding,name:"google-auth-"+this.googleClientId}),predicate:NOT_TRANSIENT,context:this})}},{name:"authToken_"}],constants:[{name:"AUTH_HEADER",value:"X-FOAM-Auth"}],methods:[function alogin(ret){var future=this.persistentContext_.bindObject("authToken_",this.GoogleSignInTokenCarrier,void 0,2);future(function(token){if(token&&token.token&&new Date(token.expiry)>new Date)return void ret();if(this.window.__googleSignInListeners)return void this.window.__googleSignInListeners.push(ret);if(this.window.__googleSignInListeners=[ret],this.window.__googleSignInSuccess=this.onSuccess,!this.googleClientId)return void console.error("No googleClientId found on the context. See https://developers.google.com/identity/sign-in/web/devconsole-projectto set up a project and acquire a client ID, then set it on the context.");this.document.head.insertAdjacentHTML("beforeend",'<meta name="google-signin-client_id" content="'+this.googleClientId+'" />');var script=this.document.createElement("script");script.src="https://apis.google.com/js/platform.js",this.document.body.appendChild(script),this.popupView_=this.PopupView.create({delegate:function(args,X){return this.LoginPopupView.create(args,X)}.bind(this)}),this.document.body.insertAdjacentHTML("beforeend",this.popupView_.toHTML()),this.popupView_.initHTML(),this.popupView_.open()}.bind(this))},function configure(decorator,delegate,args){var xhr=args[0];return xhr.setRequestHeader("X-FOAM-Auth",decorator.authToken_.token),delegate.apply(this,args)}],listeners:[{name:"onSuccess",code:function(googleUser){this.popupView_.close();var auth=googleUser.getAuthResponse();this.authToken_.token=auth.id_token,this.authToken_.expiry=auth.expires_at;for(var i=0;i<this.window.__googleSignInListeners.length;i++)this.window.__googleSignInListeners[i]()}}],models:[{"package":"foam.oauth2.GoogleSignIn",name:"LoginPopupView","extends":"foam.ui.SimpleView",templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n          <div id="',self.id,'" ',self.cssClassAttr(),'>\n            <h3>Sign in</h3>\n            <div>Press the button below to sign in with your Google account.</div>\n            <div class="g-signin2" data-onsuccess="__googleSignInSuccess"></div>\n          </div>\n        '),out.toString()},language:"html"}]}]}),CLASS({"package":"foam.oauth2",name:"GoogleSignInTokenCarrier",properties:[{name:"token"},{name:"expiry"}]}),CLASS({"package":"foam.dao",name:"GUIDDAO",label:"foam.dao.GUIDDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"property",type:"Property",required:!0,visibility:"hidden",hidden:!0,"transient":!0,defaultValueFn:function(){return this.delegate.model?this.delegate.model.ID:void 0}}],methods:[function put(obj,sink){obj.hasOwnProperty(this.property.name)||(obj[this.property.name]=createGUID()),this.delegate.put(obj,sink)}]}),CLASS({"package":"foam.dao",name:"SeqNoDAO",label:"foam.dao.SeqNoDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"property",type:"Property",required:!0,visibility:"hidden",hidden:!0,"transient":!0,defaultValueFn:function(){return this.delegate.model?this.delegate.model.ID:void 0}},{model_:"IntProperty",name:"sequenceValue",type:"Int",defaultValue:1}],methods:[function init(){this.SUPER();var future=afuture();this.WHEN_READY=future.get,this.delegate.select(MAX(this.property))(function(max){max.max&&(this.sequenceValue=max.max+1),future.set(!0)}.bind(this))},function put(obj,sink){this.WHEN_READY(function(){var val=this.property.f(obj);val&&val!=this.property.defaultValue||(obj[this.property.name]=this.sequenceValue++),this.delegate.put(obj,sink)}.bind(this))}]}),CLASS({"package":"foam.dao",name:"TimingDAO","extends":"foam.dao.ProxyDAO",properties:[{name:"name"},{name:"id"},{name:"activeOps",defaultValue:{put:0,remove:0,find:0,select:0}}],methods:[function start(op){var str=this.name+"-"+op,key=this.activeOps[op]++?str+"-"+this.id++:str;return console.time(this.id),[key,str,window.performance.now(),op]},function end(act){this.activeOps[act[3]]--,this.id--,console.timeEnd(act[0]),console.log("Timing: ",act[1]," ",(window.performance.now()-act[2]).toFixed(3)," ms")},function endSink(act,sink){var self=this;return{put:function(){self.end(act),sink&&sink.put&&sink.put.apply(sink,arguments)},remove:function(){self.end(act),sink&&sink.remove&&sink.remove.apply(sink,arguments)},error:function(){self.end(act),sink&&sink.error&&sink.error.apply(sink,arguments)},eof:function(){self.end(act),sink&&sink.eof&&sink.eof.apply(sink,arguments)}}},function put(obj,sink){var act=this.start("put");this.SUPER(obj,this.endSink(act,sink))},function remove(query,sink){var act=this.start("remove");this.SUPER(query,this.endSink(act,sink))},function find(key,sink){var act=this.start("find");this.SUPER(key,this.endSink(act,sink))},function select(sink,options){var act=this.start("select"),fut=afuture();return this.SUPER(sink,options)(function(s){this.end(act),fut.set(s)}.bind(this)),fut.get}]}),CLASS({"package":"foam.ui",name:"DAOListView","extends":"foam.ui.SimpleView",traits:["foam.ui.DAODataViewTrait"],requires:["SimpleValue"],properties:[{model_:"BooleanProperty",name:"isHidden",type:"Boolean",postSet:function(_,isHidden){this.dao&&!isHidden&&this.onDAOUpdate()},defaultValue:!1},{model_:"ViewFactoryProperty",name:"rowView",type:"ViewFactory",defaultValue:"foam.ui.DetailView"},{name:"mode",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]},defaultValue:"read-write"},{name:"useSelection",postSet:function(old,nu){this.useSelection&&!this.X.selection$&&(this.X.selection$=this.SimpleValue.create()),this.selection$=this.X.selection$},help:"Backward compatibility for selection mode. Create a X.selection$ value in your context instead."},{name:"selection",factory:function(){return this.SimpleValue.create()},help:"Backward compatibility for selection mode. Create a X.selection$ value in your context instead."},{name:"scrollContainer",help:"Containing element that is responsible for scrolling."},{name:"chunkSize",defaultValue:0,help:"Number of entries to load in each infinite scroll chunk."},{name:"chunksLoaded",defaultValue:1,help:"The number of chunks currently loaded."},{model_:"BooleanProperty",name:"painting",type:"Boolean","transient":!0,defaultValue:!1},{model_:"BooleanProperty",name:"repaintRequired",type:"Boolean","transient":!0,defaultValue:!1},{model_:"ArrayProperty",name:"propertyListeners_",type:"Array",lazyFactory:function(){return[]}}],constants:[{name:"ROW_CLICK",value:["row-click"]}],methods:[function init(){this.SUPER();var self=this;this.subscribe(this.ON_HIDE,function(){self.isHidden=!0}),this.subscribe(this.ON_SHOW,function(){self.isHidden=!1}),this.X.selection$&&(this.selection$=this.X.selection$)},function initHTML(){if(this.SUPER(),this.chunkSize>0){for(var e=this.$;e&&"scroll"!==window.getComputedStyle(e).overflow;)e=e.parentElement;this.scrollContainer=e||window,this.scrollContainer.addEventListener("scroll",this.onScroll,!1)}this.isHidden||this.updateHTML()},function construct(){if(this.dao&&this.$){if(this.painting)return void(this.repaintRequired=!0);this.painting=!0;var out=[];this.children=[],this.initializers_=[];var doneFirstItem=!1,d=this.dao;this.chunkSize&&(d=d.limit(this.chunkSize*this.chunksLoaded)),d.select({put:function(o){"read-write"===this.mode&&(o=o.model_.create(o,this.Y));var view=this.rowView({data:o,model:o.model_},this.Y);if(view.DAO=this.dao,"read-write"===this.mode&&this.addRowPropertyListener(o,view),this.addChild(view),doneFirstItem?this.separatorToHTML(out):doneFirstItem=!0,this.X.selection$){var itemId=this.on("click",function(){this.selection=o,this.publish(this.ROW_CLICK)}.bind(this));this.setClass("dao-selected",function(){return equals(this.selection,o)}.bind(this),itemId),this.setClass(this.className+"-row",function(){return!0},itemId),out.push('<div id="'+itemId+'">')}out.push(view.toHTML()),this.X.selection$&&out.push("</div>")}.bind(this)})(function(){if(this.repaintRequired)return this.repaintRequired=!1,this.painting=!1,void this.realDAOUpdate();var e=this.$;e&&(e.innerHTML=out.join(""),this.initInnerHTML(),this.painting=!1)}.bind(this))}},function destroy(isParentDestroyed){for(var listeners=this.propertyListeners_,i=0;i<listeners.length;++i)listeners[i].data.removePropertyListener(null,listeners[i].listener);return this.propertyListeners_=[],this.SUPER(isParentDestroyed)},function fromElement(e){var children=e.children;1==children.length&&"rowView"===children[0].nodeName?this.SUPER(e):this.rowView=e.innerHTML},function separatorToHTML(out){},function addRowPropertyListener(data,view){var listener=function(o,topic){var prop=o.model_.getProperty(topic[1]);prop["transient"]||view.DAO.put(o.deepClone())};data.addPropertyListener(null,listener),this.propertyListeners_.push({data:data,listener:listener})}],listeners:[{name:"onDAOUpdate",code:function(){this.realDAOUpdate()}},{name:"realDAOUpdate",code:function(){this.isHidden||this.updateHTML()},isFramed:!0},{name:"onScroll",code:function(){var e=this.scrollContainer;this.chunkSize>0&&e.scrollTop+e.offsetHeight>=e.scrollHeight&&(this.chunksLoaded++,this.updateHTML())}}]}),CLASS({"package":"foam.ui",name:"DAODataViewTrait",exports:["dao as daoViewCurrentDAO"],properties:[{name:"data",preSet:function(old,nu){return this.dao!==nu&&(this.dao=nu),nu}},{model_:"foam.core.types.DAOProperty",name:"dao",label:"DAO",postSet:function(oldDAO,dao){dao?equals(this.data,dao)||(this.data=dao):this.data=""},help:"An alias for the data property.",onDAOUpdate:"onDAOUpdate"}],methods:[function onDAOUpdate(){}]}),CLASS({"package":"foam.ui.md",name:"CannedQueryCitationView","extends":"foam.ui.View",properties:[{name:"className",defaultValueFn:function(){return"canned-query-citation"+(this.data.iconUrl?" canned-query-icon":"")}}],templates:[{name:"CSS",code:ConstantTemplate(".canned-query-citation{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;font-size:16px;height:42px;line-height:42px;padding:8px 16px}.canned-query-citation img{-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;height:24px;margin-right:25px;opacity:0.6;width:24px}.canned-query-label{-webkit-flex-grow:1;flex-grow:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),">\n        "),this.data.iconUrl&&out("\n          ",self.createTemplateView("iconUrl"),"\n        "),out("\n        ",self.createTemplateView("label",{mode:"read-only",floatingLabel:!1,extraClassName:"canned-query-label"}),"\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui.md",name:"CitationView","extends":"foam.ui.md.DetailView",properties:[{name:"model",defaultValueFn:function(){return this.data.model_}},{name:"className",defaultValue:"md-citation-view"}],methods:[function pickNameProperty(){var prop=this.model.getFeature("label")||this.model.getFeature("name");if(!prop){for(var props=this.model.getRuntimeProperties(),stringProps=[],i=0;i<props.length;i++){var p=props[i];(!p.hidden&&"id"!==p.name&&"Property"===p.model_.id||"StringProperty"===p.model_.id)&&stringProps.push(p)}for(var i=0;i<stringProps.length;i++){var p=stringProps[i],pname=p.name.toLowerCase();if(pname.indexOf("name")>-1||pname.indexOf("label")>-1){prop=p;break}}!prop&&stringProps.length&&(prop=stringProps[0])}return prop||(prop=this.model.getFeature("id")),prop}],templates:[{name:"CSS",code:ConstantTemplate(".md-citation-view{-webkit-align-items:center;align-items:center;border-bottom:1px solid #eee;display:-webkit-flex;display:flex;min-height:48px}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),">\n        ",this.createTemplateView(this.pickNameProperty().name,{mode:"read-only",floatingLabel:!1}),"\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.browser.ui",name:"StackView","extends":"foam.ui.SimpleView",imports:["setTimeout","window"],exports:["as stack"],properties:[{model_:"IntProperty",name:"maxVisibleViews",type:"Int",defaultValue:2},{name:"views_",factory:function(){return[]}},{name:"visibleStart_",defaultValue:0},{name:"visibleEnd_",defaultValue:0},{name:"className",defaultValue:"stackview-container"},{model_:"BooleanProperty",name:"noDecoration",type:"Boolean",defaultValue:!1},{name:"transition",defaultValue:"slide"}],methods:[function init(args){this.SUPER(args),this.window.addEventListener("resize",this.onResize)},function pushView(view,hints){this.pushView_(-1,view,hints)},function popView(){this.popView_(0)},function popChildViews(){this.popView_(1)},function elementAnimationAdd_(style){"slide"==this.transition?(style.width="0px",style.left=this.$.offsetWidth,style.transition="left 300ms ease"):"fade"==this.transition&&(style.opacity=0,style.transition="opacity 300ms ease",this.X.setTimeout(function(){style.opacity=1},50))},function elementAnimationRemove_(style){"slide"==this.transition?style.left=this.$.offsetWidth:"fade"==this.transition&&(style.opacity=0)},function destroyChildViews_(index){for(;this.views_.length>index;){var obj=this.views_.pop(),e=this.X.$(obj.id);e&&this.elementAnimationRemove_(e.style),this.resize(),this.finishDestroy(obj)}},function finishDestroy(obj){this.X.setTimeout(function(){obj.view.destroy(),obj.hideBinding&&obj.hideBinding();var e=this.X.$(obj.id);e&&(e.outerHTML="")}.bind(this),1e3)},function renderChild(index){var obj=this.views_[index];this.$.insertAdjacentHTML("beforeend",this.childHTML(index,this.views_[index])),this.elementAnimationAdd_(this.X.$(obj.id).style),obj.view.setClass("stackview-hidden",function(){return this.noDecoration}.bind(this),obj.id+"-edge"),obj.view.initHTML()},function childHTML(index){var obj=this.views_[index],html='<div id="'+obj.id+'" class="stackview-panel stackview-hidden stackview-no-input">';html+=obj.view.toHTML(),html+='  <div id="'+obj.id+'-edge" class="stackview-edge"></div>',html+="</div>";var self=this;return obj.view.addInitializer(function(){obj.hideBinding=self.X.dynamicFn(function(){self.visibleStart_,self.visibleEnd_},function(){var e=self.X.$(obj.id);if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION;DOM.setClass(e,"stackview-hidden",index<self.visibleStart_-1||index>self.visibleEnd_+1),DOM.setClass(e,"stackview-no-input",index<self.visibleStart_||index>self.visibleEnd_)}).destroy}),html},function resize(){if(this.$){for(var width=this.$.offsetWidth,index=this.views_.length-1;index>=0&&width>=this.views_[index].view.minWidth;)width-=this.views_[index].view.minWidth,index--;if(index=Math.min(index+1,this.views_.length-1),this.visibleStart_=Math.max(index,this.views_.length-this.maxVisibleViews),this.visibleEnd_=this.views_.length-1,!(this.visibleStart_<0)){width=this.$.offsetWidth;for(var sizes=[],i=this.visibleStart_;i<=this.visibleEnd_;i++){var min=this.views_[i].view.minWidth;sizes[i]=min,width-=min}for(i=this.visibleEnd_;width>0&&i>=this.visibleStart_;i--){var newSize=Math.min(sizes[i]+width,this.views_[i].view.preferredWidth);width-=newSize-sizes[i],sizes[i]=newSize}for(i=this.visibleEnd_;width>0&&i>=this.visibleStart_;i--){var newSize=Math.min(sizes[i]+width,this.views_[i].view.maxWidth);width-=newSize-sizes[i],sizes[i]=newSize}0!==width&&(i=this.visibleEnd_,sizes[i]+=width);var foundTop=!1,pos=this.$.offsetWidth;for(i=this.visibleEnd_;i>=0;i--){var size=sizes[i]||0;pos-=size;var s=this.X.$(this.views_[i].id).style;"slide"==this.transition&&(foundTop?s.transition="left 300ms ease, width 300ms ease":(s.transition="left 300ms ease",foundTop=!0)),size>0&&(s.width=size+"px"),s.zIndex=i,s.left=pos+"px",s.top="0px"}}}}],listeners:[{name:"onLoad",code:function(){for(var i=0;i<this.views_.length;i++)this.renderChild(i);this.resize()}},{name:"onResize",code:function(){this.resize()},isFramed:!0},{name:"pushView_",code:function(index,view,hints){if(view){hints||(hints={}),this.destroyChildViews_(index+1);var substack={__proto__:this,pushView:this.pushView_.bind(this,this.views_.length),popView:this.popView_.bind(this,this.views_.length),popChildViews:this.popView_.bind(this,this.views_.length+1),replaceView:this.replaceView_.bind(this,this.views_.length)};view.stack&&(view.stack=substack),view.X.stack=substack,view.Y.stack=substack,this.views_.push({id:this.nextID(),view:view}),this.$&&this.renderChild(index+1),this.setTimeout(this.onResize,100)}},isFramed:!0},{name:"popView_",code:function popView_(index){index>=this.views_.length||(this.visibleStart_-=this.visibleEnd_-index+1,this.visibleEnd_=index-1,this.destroyChildViews_(index),this.setTimeout(this.onResize,100))},isFramed:!0},{name:"replaceView_",code:function(index,view,hints){this.popView_(index),this.pushView_(index-1,view,hints)},isFramed:!0}],templates:[{name:"CSS",code:ConstantTemplate(".stackview-container{height:100%;width:100%;overflow-x:hidden;position:relative}.stackview-panel{background-color:#fff;height:100%;position:absolute;height:100%;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;overflow:hidden}.stackview-edge{background-color:#000;height:100%;position:absolute;right:0px;top:0px;opacity:0.1;width:1px;z-index:100}.stackview-hidden{display:none}.stackview-no-input{pointer-events:none}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this);return out('\n      <div id="',this.id,'" ',this.cssClassAttr(),"></div>\n      "),this.addInitializer(this.onLoad),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.input.touch",name:"GestureManager",requires:["foam.input.touch.DragGesture","foam.input.touch.Gesture","foam.input.touch.GestureTarget","foam.input.touch.PinchTwistGesture","foam.input.touch.ScrollGesture","foam.input.touch.TapGesture","foam.input.touch.InputPoint"],imports:["document","touchManager"],properties:[{name:"gestures",factory:function(){return{verticalScroll:this.ScrollGesture.create(),verticalScrollMomentum:this.ScrollGesture.create({momentumEnabled:!0}),verticalScrollNative:this.ScrollGesture.create({nativeScrolling:!0}),horizontalScroll:this.ScrollGesture.create({direction:"horizontal"}),horizontalScrollMomentum:this.ScrollGesture.create({direction:"horizontal",momentumEnabled:!0}),horizontalScrollNative:this.ScrollGesture.create({direction:"horizontal",nativeScrolling:!0}),tap:this.TapGesture.create(),drag:this.DragGesture.create(),pinchTwist:this.PinchTwistGesture.create()}}},{name:"targets",factory:function(){return{}}},{name:"active",factory:function(){return{}},help:"Gestures that are active right now and should be checked for recognition. This is the gestures active on the FIRST touch. Rectangles are not checked for subsequent touches."},{name:"recognized",help:"Set to the recognized gesture. Cleared when all points are lifted."},{name:"points",factory:function(){return{}}},{name:"wheelTimer"},{name:"scrollWheelTimeout",defaultValue:300},{name:"scrollViewTargets",defaultValue:0}],methods:[function init(){this.SUPER(),this.touchManager.subscribe(this.touchManager.TOUCH_START,this.onTouchStart),this.touchManager.subscribe(this.touchManager.TOUCH_MOVE,this.onTouchMove),this.touchManager.subscribe(this.touchManager.TOUCH_END,this.onTouchEnd),this.document.addEventListener("mousedown",this.onMouseDown),this.document.addEventListener("mousemove",this.onMouseMove),this.document.addEventListener("mouseup",this.onMouseUp),this.document.addEventListener("wheel",this.onWheel),this.document.addEventListener("contextmenu",this.onContextMenu)},function install(target){target.containerID?(this.targets[target.containerID]||(this.targets[target.containerID]=[]),this.targets[target.containerID].push(target)):console.warn("no container ID on touch target")},function uninstall(target){var arr=this.targets[target.containerID];if(arr){for(var i=0;i<arr.length;i++)if(arr[i]===target){arr.splice(i,1);break}0===arr.length&&delete this.targets[target.containerID]}},function purge(){for(var keys=Object.keys(this.targets),count=0,i=0;i<keys.length;i++)this.document.getElementById(keys[i])||(delete this.targets[keys[i]],count++);return console.log("Purged "+count+" targets"),count},function activateContainingGestures(x,y,opt_predicate){for(var e=this.X.document.elementFromPoint(x,y);e;){if(e.id){var matches=this.targets[e.id];if(matches&&matches.length)for(var i=0;i<matches.length;i++){var t=matches[i],g=this.gestures[t.gesture];!g||opt_predicate&&!opt_predicate(g)||(this.active[g.name]||(this.active[g.name]=[]),this.active[g.name].push(t))}}e=e.parentNode}},function checkRecognition(){if(!this.recognized){var self=this,matches=[];if(Object.keys(this.active).forEach(function(name){var answer=self.gestures[name].recognize(self.points);
answer>=self.Gesture.WAIT?matches.push([name,answer]):delete self.active[name]}),0!==matches.length){var i,lastYes=-1;for(i=0;i<matches.length;i++)matches[i][1]===this.Gesture.YES&&(lastYes=i);var lastMaybe=-1;for(i=0;i<matches.length;i++)matches[i][1]===this.Gesture.MAYBE&&(lastMaybe=i);var match;if(0>lastYes){if(matches.length>1||0>lastMaybe)return;match=matches[lastMaybe][0]}else match=matches[lastYes][0];var matched=this.active[match].filter(function(m){if(!m.enforceContainment)return!0;for(var r=m.getElement().getBoundingClientRect(),keys=Object.keys(self.points),i=0;i<keys.length;++i){var p=self.points[keys[i]];if(p.x<r.left||p.x>r.right||p.y<r.top||p.y>r.bottom)return!1}return!0}),legal=[];for(i=0;i<matched.length;i++){for(var m=matched[i].getElement(),contained=0,j=0;j<matched.length;j++){var n=matched[j].getElement();m!==n&&m.contains(n)&&contained++}0===contained&&legal.push(matched[i].handler)}legal.length>0&&this.gestures[match].attach(this.points,legal),this.recognized=this.gestures[match]}}},function resetState(){this.active={},this.recognized=null,this.points={}}],listeners:[{name:"onTouchStart",code:function(_,__,touch){if(this.recognized)return void(this.recognized.addPoint&&this.recognized.addPoint(touch));var pointCount=Object.keys(this.points).length;pointCount||this.activateContainingGestures(touch.x,touch.y),this.points[touch.id]=touch,this.checkRecognition()}},{name:"onMouseDown",code:function(event){var point=this.InputPoint.create({id:"mouse",type:"mouse",x:event.clientX,y:event.clientY});if(this.recognized)return void(this.recognized.addPoint&&this.recognized.addPoint(point));var pointCount=Object.keys(this.points).length;pointCount||this.activateContainingGestures(point.x,point.y),this.points[point.id]=point,this.checkRecognition()}},{name:"onTouchMove",code:function(_,__,touch){this.recognized||this.checkRecognition()}},{name:"onMouseMove",code:function(event){this.points.mouse&&(this.points.mouse.x=event.clientX,this.points.mouse.y=event.clientY,this.checkRecognition())}},{name:"onTouchEnd",code:function(_,__,touch){this.recognized||this.checkRecognition(),delete this.points[touch.id],this.active={},this.recognized=void 0}},{name:"onMouseUp",code:function(event){this.points.mouse&&(this.points.mouse.x=event.clientX,this.points.mouse.y=event.clientY,this.points.mouse.done=!0,this.recognized||this.checkRecognition(),delete this.points.mouse,this.active={},this.recognized=void 0)}},{name:"onWheel",code:function(event){if(this.wheelTimer)this.points.wheel.x-=event.deltaX,this.points.wheel.y-=event.deltaY,this.X.window.clearTimeout(this.wheelTimer),this.wheelTimer=this.X.window.setTimeout(this.onWheelDone,this.scrollWheelTimeout);else{if(this.recognized||Object.keys(this.points).length>0)return;var wheel=this.InputPoint.create({id:"wheel",type:"wheel",x:event.clientX,y:event.clientY}),dir=Math.abs(event.deltaX)>Math.abs(event.deltaY)?"horizontal":"vertical",gestures=[dir+"Scroll",dir+"ScrollMomentum",dir+"ScrollNative"];this.activateContainingGestures(wheel.x,wheel.y,function(g){return gestures.indexOf(g.name)>=0}),wheel.x-=event.deltaX,wheel.y-=event.deltaY;for(var i=0;i<gestures.length;i++){var gesture=gestures[i];if(this.active[gesture]&&this.active[gesture].length){this.points.wheel||(this.points.wheel=wheel),this.gestures[gesture].attach(this.points,this.active[gesture].map(function(gt){return gt.handler})),this.recognized=this.gestures[gesture],this.wheelTimer=this.X.window.setTimeout(this.onWheelDone,this.scrollWheelTimeout);break}}}}},{name:"onWheelDone",code:function(){this.wheelTimer=void 0,this.points.wheel.done=!0,delete this.points.wheel,this.recognized=void 0}},{name:"onContextMenu",code:function(){this.resetState()}}]}),CLASS({"package":"foam.input.touch",name:"DragGesture","extends":"foam.input.touch.Gesture",properties:[{name:"name",defaultValue:"drag"}],constants:[{name:"DRAG_TOLERANCE",value:20}],methods:[function recognize(map){var keys=Object.keys(map);if(keys.length>1)return this.NO;var point=map[keys[0]];if(point.done)return this.NO;var delta=Math.max(Math.abs(point.totalX),Math.abs(point.totalY)),r=delta>=this.DRAG_TOLERANCE?this.YES:this.MAYBE;return r!=this.NO&&(point.shouldPreventDefault=!0),r},function attach(map,handlers){var point=map[Object.keys(map)[0]];this.handlers=handlers||[],point.done$.addListener(this.onDone),this.pingHandlers("dragStart",point)},function pingHandlers(method,point){for(var i=0;i<this.handlers.length;i++){var h=this.handlers[i];h&&h[method]&&h[method](point)}}],listeners:[{name:"onDone",code:function(obj,prop,old,nu){obj.done$.removeListener(this.onDone),this.pingHandlers("dragEnd",obj)}}],help:"Gesture that understands a hold and drag with mouse or one touch point."}),CLASS({"package":"foam.input.touch",name:"Gesture",properties:[{name:"name",required:!0}],constants:[{name:"YES",value:3},{name:"MAYBE",value:2},{name:"WAIT",value:1},{name:"NO",value:0}],methods:[function recognize(map){return this.NO},function attach(handlers){},function newPoint(point){}],help:"Installed in the GestureManager to watch for a particular kind of gesture"}),CLASS({"package":"foam.input.touch",name:"PinchTwistGesture","extends":"foam.input.touch.Gesture",properties:[{name:"name",defaultValue:"pinchTwist"},{name:"handlers"},{name:"points"}],methods:[function getPoints(map){var keys=Object.keys(map);return[map[keys[0]],map[keys[1]]]},function recognize(map){if(2!==Object.keys(map).length)return this.NO;var points=this.getPoints(map);if(points[0].done||points[1].done)return this.NO;var moved=!(0===points[0].dx&&0===points[0].dy||0===points[1].dx&&0===points[1].dy);return moved?this.YES:this.MAYBE},function attach(map,handlers){Object_forEach(map,function(p){p.shouldPreventDefault=!0}),this.points=this.getPoints(map),this.handlers=handlers||[],this.points.forEach(function(p){p.x$.addListener(this.onMove),p.y$.addListener(this.onMove),p.done$.addListener(this.onDone)}.bind(this)),this.pingHandlers("pinchStart"),this.onMove()},function pingHandlers(method,scale,rotation){for(var i=0;i<this.handlers.length;i++){var h=this.handlers[i];h&&h[method]&&h[method](scale,rotation)}},function distance(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;return Math.sqrt(dx*dx+dy*dy)}],listeners:[{name:"onMove",code:function(){for(var oldDist=this.distance(this.points[0].x0,this.points[0].y0,this.points[1].x0,this.points[1].y0),newDist=this.distance(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y),scale=newDist/oldDist,oldAngle=Math.atan2(this.points[1].y0-this.points[0].y0,this.points[1].x0-this.points[0].x0),newAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x),rotation=newAngle-oldAngle;rotation<-Math.PI;)rotation+=2*Math.PI;for(;rotation>Math.PI;)rotation-=2*Math.PI;rotation*=360,rotation/=2*Math.PI,this.pingHandlers("pinchMove",scale,rotation)}},{name:"onDone",code:function(obj,prop,old,nu){this.points.forEach(function(p){p.x$.removeListener(this.onMove),p.y$.removeListener(this.onMove),p.done$.removeListener(this.onDone)}),this.pingHandlers("pinchEnd")}}],help:"Gesture that understands a two-finger pinch/stretch and rotation"}),CLASS({"package":"foam.input.touch",name:"ScrollGesture","extends":"foam.input.touch.Gesture",properties:[{name:"name",factory:function(){return this.direction+"Scroll"+(this.momentumEnabled?"Momentum":this.nativeScrolling?"Native":"")}},{name:"direction",defaultValue:"vertical"},{name:"isVertical",factory:function(){return"vertical"===this.direction}},{name:"momentumEnabled",defaultValue:!1,help:'Set me to true (usually by attaching the "verticalScrollMomentum" gesture) to enable momentum'},{name:"nativeScrolling",defaultValue:!1,help:'Set me to true (usually by attaching the "verticalScrollNative" gesture) to enable native browser scrolling'},{name:"dragCoefficient",defaultValue:.94,help:"Each frame, the momentum will be multiplied by this coefficient. Higher means LESS drag."},{name:"dragClamp",defaultValue:.05,help:"The speed threshold (pixels/millisecond) below which the momentum drops to 0."},{name:"momentum",defaultValue:0,help:"The current speed, in pixels/millisecond, at which the scroller is sliding."},{name:"lastTime",visibility:"hidden",hidden:!0,defaultValue:0,help:"The performance.now() value for the last time we computed the momentum slide."},{name:"tickRunning",visibility:"hidden",hidden:!0,defaultValue:!1,help:"True when the physics tick should run."},{name:"handlers"}],constants:[{name:"DRAG_TOLERANCE",value:10}],methods:[function recognize(map){if(1!==Object.keys(map).length)return this.NO;var point=map[Object.keys(map)[0]];if("mouse"===point.type||point.done)return this.NO;if(Math.abs(this.momentum)>0)return this.YES;var delta=Math.abs(this.isVertical?point.totalY:point.totalX);return delta>this.DRAG_TOLERANCE?this.YES:this.MAYBE},function attach(map,handlers){var point=map[Object.keys(map)[0]];this.handlers=handlers||[],this.nativeScrolling||(Object_forEach(map,function(p){p.shouldPreventDefault=!0}),(this.isVertical?point.y$:point.x$).addListener(this.onDelta),point.done$.addListener(this.onDone),0===this.momentum?this.pingHandlers(this.direction+"ScrollStart",0,0,this.isVertical?point.y0:point.x0):this.tickRunning=!1)},function pingHandlers(method,d,t,c){for(var i=0;i<this.handlers.length;i++){var h=this.handlers[i];h&&h[method]&&h[method](d,t,c,this.stopMomentum)}},function sendEndEvent(point){var delta=this.isVertical?point.dy:point.dx,total=this.isVertical?point.totalY:point.totalX,current=this.isVertical?point.y:point.x;this.pingHandlers(this.direction+"ScrollEnd",delta,total,current)},function calculateInstantaneousVelocity(point){var now=this.X.performance.now(),lastTime=this.tickRunning?this.lastTime:point.lastTime,velocity=(this.isVertical?point.dy:point.dx)/(now-point.lastTime);return this.tickRunning&&(this.lastTime=now),velocity}],listeners:[{name:"onDelta",code:function(obj,prop,old,nu){if(this.momentumEnabled){var velocity=this.calculateInstantaneousVelocity(obj),delta=velocity-this.momentum;this.momentum+=delta}var delta=this.isVertical?obj.dy:obj.dx,total=this.isVertical?obj.totalY:obj.totalX,current=this.isVertical?obj.y:obj.x;this.pingHandlers(this.direction+"ScrollMove",delta,total,current)}},{name:"onDone",code:function(obj,prop,old,nu){(this.isVertical?obj.y$:obj.x$).removeListener(this.onDelta),obj.done$.removeListener(this.onDone),this.momentumEnabled?Math.abs(this.momentum)<this.dragClamp?(this.momentum=0,this.sendEndEvent(obj)):(this.tickRunning=!0,this.lastTime=this.X.performance.now(),this.tick(obj)):this.sendEndEvent(obj)}},{name:"tick",code:function(touch){if(this.tickRunning){var xy=this.isVertical?"y":"x",now=this.X.performance.now(),elapsed=now-this.lastTime;this.lastTime=now;var distance=this.momentum*elapsed;touch[xy]+=distance;var delta,total,current;this.isVertical?(delta=touch.dy,total=touch.totalY,current=touch.y):(delta=touch.dx,total=touch.totalX,current=touch.x),0!=delta&&this.pingHandlers(this.direction+"ScrollMove",delta,total,current),this.momentum*=this.dragCoefficient,Math.abs(this.momentum)<this.dragClamp?(this.momentum=0,this.tickRunning=!1,this.sendEndEvent(touch)):this.tick(touch)}},isFramed:!0},{name:"stopMomentum",code:function(){this.momentum=0}}],help:"Gesture that understands vertical or horizontal scrolling."}),CLASS({"package":"foam.input.touch",name:"TapGesture","extends":"foam.input.touch.Gesture",properties:[{name:"name",defaultValue:"tap"},{name:"handlers"}],constants:[{name:"DRAG_TOLERANCE",value:40}],methods:[function recognize(map){for(var response,doneCount=0,self=this,keys=Object.keys(map),i=0;i<keys.length;i++){var key=keys[i],p=map[key];if(Math.abs(p.totalX)>=this.DRAG_TOLERANCE||Math.abs(p.totalY)>=this.DRAG_TOLERANCE)return this.NO;p.done&&doneCount++}return response===this.NO?response:doneCount===keys.length?this.YES:this.WAIT},function attach(map,handlers){if(handlers&&handlers.length){var points=0;Object_forEach(map,function(point){points++,point.shouldPreventDefault=!0}),handlers.forEach(function(h){h&&h.tapClick&&h.tapClick(map)})}}],help:"Gesture that understands a quick, possible multi-point tap. Calls into the handler: tapClick(numberOfPoints)."}),CLASS({"package":"foam.input.touch",name:"InputPoint",properties:[{name:"id"},{name:"type"},{model_:"BooleanProperty",name:"done",type:"Boolean"},{name:"x",postSet:function(old,nu){this.lastX=old}},{name:"y",postSet:function(old,nu){this.lastY=old}},{name:"x0",factory:function(){return this.x}},{name:"y0",factory:function(){return this.y}},{name:"lastX",factory:function(){return this.x}},{name:"lastY",factory:function(){return this.y}},{name:"dx",getter:function(){return this.x-this.lastX}},{name:"dy",getter:function(){return this.y-this.lastY}},{name:"totalX",getter:function(){return this.x-this.x0}},{name:"totalY",getter:function(){return this.y-this.y0}},{name:"lastTime"},{name:"shouldPreventDefault",defaultValue:!1}]}),CLASS({"package":"foam.input.touch",name:"TouchManager",requires:["foam.input.touch.InputPoint"],properties:[{name:"touches",factory:function(){return{}}}],constants:[{name:"TOUCH_START",value:["touch-start"]},{name:"TOUCH_END",value:["touch-end"]},{name:"TOUCH_MOVE",value:["touch-move"]}],methods:[function init(){this.SUPER(),this.X.document&&this.install(this.X.document)},function install(d){d.addEventListener("touchstart",this.onTouchStart)},function attach(e){e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd),e.addEventListener("touchcancel",this.onTouchCancel),e.addEventListener("touchleave",this.onTouchEnd)},function detach(e){e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("touchcancel",this.onTouchCancel),e.removeEventListener("touchleave",this.onTouchEnd)},function touchStart(i,t,e){this.touches[i]=this.InputPoint.create({id:i,type:"touch",x:t.pageX,y:t.pageY}),this.publish(this.TOUCH_START,this.touches[i])},function touchMove(i,t,e){var touch=this.touches[i];touch.x=t.pageX,touch.y=t.pageY,touch.lastTime=this.X.performance.now(),touch.shouldPreventDefault&&e.preventDefault(),this.publish(this.TOUCH_MOVE,this.touch)},function touchEnd(i,t,e){var touch=this.touches[i];touch.x=t.pageX,touch.y=t.pageY,touch.done=!0,this.publish(this.TOUCH_END,touch),touch.shouldPreventDefault&&e.cancelable&&e.preventDefault(),delete this.touches[i]},function touchCancel(i,t,e){this.touches[i].done=!0,this.publish(this.TOUCH_END,this.touches[i])},function touchLeave(i,t,e){this.touches[i].done=!0,this.publish(this.TOUCH_END,this.touches[i])}],listeners:[{name:"onTouchStart",code:function(e){e._touchcount||(e._touchcount=0),e._touchcount++,1==e._touchcount&&this.attach(e.target);for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i];this.touchStart(t.identifier,t,e)}}},{name:"onTouchMove",code:function(e){for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier;this.touches[id]?this.touchMove(id,t,e):console.warn("Touch move for unknown touch.")}}},{name:"onTouchEnd",code:function(e){e._touchcount--,0==e._touchcount&&this.detach(e.target);for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier;this.touches[id]?this.touchEnd(id,t,e):console.warn("Touch end for unknown touch "+id,Object.keys(this.touches))}}},{name:"onTouchCancel",code:function(e){this.detach(e.target);for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier;this.touches[id]?this.touchCancel(id,t,e):console.warn("Touch cancel for unknown touch.")}}},{name:"onTouchLeave",code:function(e){this.detach(e.target);for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier;this.touches[id]?this.touchLeave(id,t,e):console.warn("Touch cancel for unknown touch.")}}}]}),CLASS({"package":"foam.ui",name:"Tooltip","extends":"foam.ui.View",properties:[{name:"text",help:"Help text to be shown in tooltip."},{name:"target",help:"Target element to provide tooltip for."},{name:"className",defaultValue:"tooltip"},{name:"closed",defaultValue:!1}],methods:[function init(){this.SUPER();var document=this.X.document;document.previousTooltip_=this,this.X.setTimeout(function(){if(document.previousTooltip_===this){for(var oldTips=document.getElementsByClassName("tooltip"),i=0;i<oldTips.length;i++)oldTips[i].remove();var div=document.createElement("div");this.target.addEventListener("mousedown",this.close.bind(this)),this.target.addEventListener("touchstart",this.close.bind(this)),div.className=this.className,div.id=this.id,div.innerHTML=this.toInnerHTML(),document.body.appendChild(div);var s=this.X.window.getComputedStyle(div),pos=findViewportXY(this.target),screenHeight=this.X.document.body.clientHeight,scrollY=this.X.window.scrollY,above=pos[1]-scrollY>screenHeight/2,left=pos[0]+(this.target.clientWidth-toNum(s.width))/2,maxLeft=this.X.document.body.clientWidth+this.X.window.scrollX-15-div.clientWidth,targetHeight=this.target.clientHeight||this.target.offsetHeight;div.style.top=above?pos[1]-targetHeight-8:pos[1]+targetHeight+8,div.style.left=Math.max(this.X.window.scrollX+15,Math.min(maxLeft,left)),this.initHTML()}}.bind(this),400)},function toInnerHTML(){return this.text},function close(){this.$&&this.$.remove()},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),this.close()}],templates:[{name:"CSS",code:ConstantTemplate(".tooltip{background:rgba(80, 80, 80, 0.9);border-radius:4px;color:white;font-size:10pt;left:0;padding:5px 8px;position:absolute;top:0;z-index:2000;-webkit-transform:translate3d(0, 0, 2px)}"),language:"css"}]}),CLASS({"package":"foam.ui.md",name:"SharedStyles","extends":"foam.ui.SimpleView",templates:[{name:"CSS",code:ConstantTemplate("body, .md-font, .md-quote{font-family:Roboto, 'Helvetica Neue', Helvetica, Arial;-webkit-font-smoothing:antialiased}p{margin:0}p + p{margin-top:1em}table{border-spacing:0}*{box-sizing:border-box}body, tbody, tr, td{margin:0;padding:0}hr{border-top:1px solid rgba(0, 0, 0, .1);border:none;height:1px;margin:0;padding:0;background:rgba(0, 0, 0, .1)}a{text-decoration:none;color:#4285f4}.mdui-app-controller{background:white;display:-webkit-flex;display:flex;display:-webkit-flex;-webkit-flex-direction:column;flex-direction:column;-webkit-flex-direction:column;height:100%}.mdui-app-controller .header{display:-webkit-flex;display:flex;display:-webkit-flex;background:#3e50b4;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-shrink:0;padding:0;height:56px}.mdui-app-controller .header .default{-webkit-flex:1.0;flex:1.0;-webkit-box-flex:1.0;display:-webkit-flex;display:flex;display:-webkit-flex;margin:4px;-webkit-flex-grow:1.0;flex-grow:1.0;-webkit-flex-grow:1.0}.mdui-app-controller.searchMode .header{height:50px}.mdui-app-controller.searchMode .header .default{display:none}.mdui-app-controller:not(.searchMode) .header .search{display:none}.mdui-app-controller.searchMode .header .search{display:inherit;height:50px;width:100%;background:#3e50b4;z-index:2}.swipeAltInner{overflow:hidden}.mdui-app-controller.searchMode .swipeAltHeader{display:none}.mdui-app-controller .header .name{-webkit-align-self:center;-webkit-box-flex:1.0;-webkit-flex-grow:1.0;-webkit-align-self:center;align-self:center;color:white;-webkit-flex-grow:1.0;flex-grow:1.0;-webkit-flex:1.0;flex:1.0;font-size:20px;font-weight:500;margin-left:16px;overflow-x:hidden;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap}input[name=q]{-webkit-align-self:center;-webkit-align-self:center;align-self:center;background:#3e50b4;border:none;color:white;font-size:20px;height:30px;margin:13px 20px 13px 6px;padding-left:10px;width:100%}input[name=q]:focus{outline:none;opacity:0.76}input[name=q]::-webkit-input-placeholder{font-size:20px;color:white;opacity:0.76;height:55px}.backButton{margin:3px 6px 2px 4px}.header canvas{background:#3e50b4}.body canvas{background:white}.popupChoiceView{padding:0}.md-floating-label-container{-webkit-align-items:center;align-items:center;display:-webkit-flex;display:flex;padding:36px 16px 8px;position:relative}.md-floating-label{color:#999;-webkit-flex-grow:1;flex-grow:1;font-size:12px;font-weight:500;position:absolute;top:16px;z-index:0}.md-title{color:rgba(0, 0, 0, 0.87);font-size:20px;font-weight:500;letter-spacing:.02em}.md-headline{color:rgba(0, 0, 0, 0.87);font-size:24px;font-weight:400;line-height:32px}.md-card.md-popup-view-content .md-card-heading{padding:0}.md-card-shell.md-popup-view-content .md-card-heading{padding:24px 24px 0 24px}.md-card-heading-content-spacer{-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;height:20px;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-grow:0;flex-grow:0}.md-card-shell.md-popup-view-content .md-card-content{padding:0 24px;-webkit-flex-grow:1;flex-grow:1;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;overflow:hidden}.md-card-content-footer-spacer{-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;height:24px;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-grow:0;flex-grow:0}.md-subhead{font-size:16px;font-weight:400;line-height:24px;letter-spacing:.04em}.md-body, .md-quote{font-size:14px;font-weight:400;line-height:24px;letter-spacing:0}.md-quote{margin-left:16px}.md-popup-view-content{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;max-width:calc(100% - 80px)}.md-popup-view-content > .md-subhead, .md-popup-view-content > .md-quote{margin:0 0 24px 0}.md-grey{opacity:0.54}.md-button{padding:8px;margin:8px}.md-button.raised{-webkit-box-shadow:1px 2px 3px rgba(0, 0, 0, 0.33);box-shadow:1px 2px 3px rgba(0, 0, 0, 0.33)}.md-button:not(.icon-only){min-width:64px;min-height:36px;height:36px}.md-button .md-button-label{color:rgba(0, 0, 0, 0.87);text-transform:uppercase;font-size:14px;font-weight:500;letter-spacing:0}.md-flex-row{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;overflow-x:auto}.md-flex-row-baseline{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-align-items:baseline;align-items:baseline;overflow:hidden}.md-flex-row-end{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-align-items:flex-end;align-items:flex-end;overflow:hidden}.md-flex-col{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;overflow-y:auto}.floatingActionButton{position:absolute;bottom:10px;right:20px;z-index:10;background:rgba(0, 0, 0, 0);-webkit-box-shadow:3px 3px 3px rgba(0, 0, 0, 0.33);box-shadow:3px 3px 3px rgba(0, 0, 0, 0.33);border-radius:30px;margin:0;height:initial}.md-card-shell{display:block;background:#fff;margin:10px;overflow:hidden}.md-card{background:#fff;display:block;margin:10px;padding:24px 16px}.md-card.md-popup-view-content{padding:24px}.md-actions{display:-webkit-flex;display:flex}.md-actions.horizontal{-webkit-justify-content:flex-end;justify-content:flex-end}.md-actions.vertical{-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-flex-direction:column;flex-direction:column}.md-card-shell .md-actions{width:100%}.md-card-shell .md-actions.vertical, .md-card .md-actions.vertical, .md-popup-view-content .md-actions.vertical{-webkit-align-items:flex-end;align-items:flex-end}.md-actions.horizontal .md-button{margin-left:0}.md-actions.vertical .md-button{margin-top:0}.md-card p, .md-card-shell p{width:initial;-webkit-flex-shrink:0;flex-shrink:0;-webkit-flex-grow:0;flex-grow:0}.md-heading{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;height:56px;-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0}.md-heading.md-headline{padding:0 0 0 12px}.md-style-trait-standard{padding:8px;margin:8px}.md-card-shell.md-popup-view-content .md-style-trait-standard{padding-left:0;padding-right:0;margin-left:0;margin-right:0}.md-style-trait-inline{padding:0}@media not print{.md-card-shell, .md-card{-webkit-box-shadow:0 1px 3px rgba(0, 0, 0, 0.38);box-shadow:0 1px 3px rgba(0, 0, 0, 0.38);margin:10px;border-radius:3px}}@media print{.md-card-shell, .md-card{border:6px double #000;margin:6pt;page-break-inside:avoid}}@media (max-width: 600px){.md-card-shell{margin:4}.md-popup-view-content{max-width:100%}}.noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;user-select:none}"),language:"css"}]});
